<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>稳中求进：Jenkins 集成 IAST 全流程 - Lab on Mercury</title><meta name=Description content="Lab on Mercury"><meta property="og:title" content="稳中求进：Jenkins 集成 IAST 全流程"><meta property="og:description" content="工作中写的一份指南文档。由于用的是测试环境，并没有需要脱敏的地方。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.sigmerc.top/jenkins-iast/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-28T15:28:05+00:00"><meta property="article:modified_time" content="2020-07-28T15:28:05+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="稳中求进：Jenkins 集成 IAST 全流程"><meta name=twitter:description content="工作中写的一份指南文档。由于用的是测试环境，并没有需要脱敏的地方。"><meta name=application-name content="Lab on Mercury"><meta name=apple-mobile-web-app-title content="Lab on Mercury"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://blog.sigmerc.top/jenkins-iast/><link rel=prev href=https://blog.sigmerc.top/shred-dict/><link rel=next href=https://blog.sigmerc.top/think-php-myadmin/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"稳中求进：Jenkins 集成 IAST 全流程","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.sigmerc.top\/jenkins-iast\/"},"genre":"posts","keywords":"CI\/CD, 实践记录","wordcount":1857,"url":"https:\/\/blog.sigmerc.top\/jenkins-iast\/","datePublished":"2020-07-28T15:28:05+00:00","dateModified":"2020-07-28T15:28:05+00:00","publisher":{"@type":"Organization","name":"Mercury","logo":{"@type":"ImageObject","url":"https:\/\/blog.sigmerc.top\/my_avatar.png","width":400,"height":400}},"author":{"@type":"Person","name":"Mercury"},"description":""}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Lab on Mercury"><span class=header-title-pre><i class='fas fa-meteor fa-fw'></i></span>Lab on Mercury</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/><i class='fas fa-archive fa-fw'></i> 文章 </a><a class=menu-item href=/tags/><i class='fas fa-tags fa-fw'></i> 标签 </a><a class=menu-item href=/categories/><i class='fas fa-th fa-fw'></i> 分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Lab on Mercury"><span class=header-title-pre><i class='fas fa-meteor fa-fw'></i></span>Lab on Mercury</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title><i class='fas fa-archive fa-fw'></i>文章</a><a class=menu-item href=/tags/ title><i class='fas fa-tags fa-fw'></i>标签</a><a class=menu-item href=/categories/ title><i class='fas fa-th fa-fw'></i>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">稳中求进：Jenkins 集成 IAST 全流程</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Mercury</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/%E8%87%AA%E5%8A%A8%E5%8C%96/><i class="far fa-folder fa-fw"></i>自动化</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-07-28>2020-07-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 1857 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 4 分钟&nbsp;<span id=/jenkins-iast/ class=leancloud_visitors data-flag-title="稳中求进：Jenkins 集成 IAST 全流程">
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/0.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/0.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/0.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/0.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/0.png title=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/0.png></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#环境准备>环境准备</a><ul><li><a href=#创建虚拟机>创建虚拟机</a></li><li><a href=#配置虚拟机-ssh可选>配置虚拟机 ssh（可选）</a></li><li><a href=#网络配置>网络配置</a></li></ul></li><li><a href=#gitlab-配置>GitLab 配置</a></li><li><a href=#jenkins-配置>Jenkins 配置</a></li><li><a href=#进行插桩扫描>进行插桩扫描</a></li><li><a href=#附录>附录</a></li></ul></nav></div></div><div class=content id=content><p>工作中写的一份指南文档。由于用的是测试环境，并没有需要脱敏的地方。</p><h2 id=环境准备>环境准备</h2><p>之前 XXX（同事名）已经按照 <a href=https://github.com/hysnsec/DevSecOps-Studio target=_blank rel="noopener noreffer">DevSecOps Studio</a> 中的说明搭建好了 DevSecOps 的基本环境，可以从他那里拷贝一份。由于我们演示时只需要用到 GitLab 和 Jenkins 两个虚拟机，其它的可以不用拷贝。大小在 11G 左右。</p><p>拷贝完成后，目录结构大致如下：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png title="图 1" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png data-sub-html="<h2> </h2><p>图 1</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/1.png></a><figcaption class=image-caption>图 1</figcaption></figure></p><p>这里的 <code>2200</code> , <code>2201</code> 是配置端口转发后，两个虚拟机的 ssh 服务在本机上的对应端口，可以不用更改。</p><h3 id=创建虚拟机>创建虚拟机</h3><blockquote><p>这一部分的操作对 GitLab 和 Jenkins 都需要做。</p></blockquote><p>在创建虚拟机前需要先修改 <code>.vbox</code> 文件的配置，用文本编辑器打开 <code>.vbox</code> 文件，搜索 <code>\Users\neoo\gitool\</code>，替换为你电脑上存放 <code>DevSecOps-Studio</code> 的目录（绝对路径）。例如我的电脑上是：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png title="图 2" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png data-sub-html="<h2> </h2><p>图 2</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/2.png></a><figcaption class=image-caption>图 2</figcaption></figure></p><blockquote><p>实际上，只需要保证文件 <code>ubuntu-xenial-16.04-cloudimg-console.log</code> 和 <code>gitlab-2201</code> 文件夹处于同一目录下。</p></blockquote><p>随后打开 VirtualBox ，点击 <code>工具 -> 注册</code> 并选择对应的 <code>.vbox</code> 文件，即可导入两个虚拟机：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png title="图 3" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png data-sub-html="<h2> </h2><p>图 3</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/3.png></a><figcaption class=image-caption>图 3</figcaption></figure></p><h3 id=配置虚拟机-ssh可选>配置虚拟机 ssh（可选）</h3><blockquote><p>这一部分的操作不是必需的。</p></blockquote><p>进入虚拟机设置界面，点击 <code>网络 -> 高级 -> 端口转发</code> ，就可以将虚拟机的 ssh 端口映射到本机。正常情况下，此时已经映射到了 <code>2200/2201</code> 端口。</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png title="图 4" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png data-sub-html="<h2> </h2><p>图 4</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/4.png></a><figcaption class=image-caption>图 4</figcaption></figure></p><p>接下来，需要启动虚拟机，用 <code>vagrant/vagrant</code> 登录，并运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo vim /etc/ssh/sshd_config
</span></span></code></pre></td></tr></table></div></div><p>将 52 行改为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PasswordAuthentication yes
</span></span></code></pre></td></tr></table></div></div><p>最后运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo service sshd restart
</span></span></code></pre></td></tr></table></div></div><p>这样就可以通过本机的 ssh 客户端连接虚拟机了：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png title="图 5" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png data-sub-html="<h2> </h2><p>图 5</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/5.png></a><figcaption class=image-caption>图 5</figcaption></figure></p><h3 id=网络配置>网络配置</h3><p>默认情况下，Jenkins 和 GitLab 都采用 NAT 模式，此时我们本机是无法 ping 通虚拟机的。为了后续操作方便，我们可以将 GitLab 设置为桥接模式，即在 <code>网络 -> 连接方式</code> 中选择桥接网卡。</p><p>此时再启动 GitLab，用 <code>vagrant/vagrant</code> 登录，并运行 <code>ifconfig | more</code> ，可以看到桥接模式下的 IP 地址，这个地址对我们本机而言是可达的。</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png title="图 6" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png data-sub-html="<h2> </h2><p>图 6</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/6.png></a><figcaption class=image-caption>图 6</figcaption></figure></p><p>如图所示，GitLab 虚拟机的 IP 为 192.168.0.109。</p><blockquote><p>桥接模式下就不需要端口转发了。此时 ssh 连接的目标也变成 <code>192.168.0.109:22</code>。</p></blockquote><p>由于 GitLab 的服务运行在 443 端口，此时直接访问 https://192.168.0.109 是可以看到 GitLab 界面的。当然，也有可能是如下界面：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png title="图 7" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png data-sub-html="<h2> </h2><p>图 7</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/7.png></a><figcaption class=image-caption>图 7</figcaption></figure></p><p>这种情况下一般只需要多等待一会儿就好了。</p><p>之所以采用桥接模式，是为了配合解析 GitLab 内置的域名 <code>gitlab.local</code>。现在只需要修改本机 hosts 文件，让 <code>gitlab.local</code> 解析到 <code>192.168.0.109</code> 即可。</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png title="图 8" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png data-sub-html="<h2> </h2><p>图 8</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/8.png></a><figcaption class=image-caption>图 8</figcaption></figure></p><p>访问 <code>https://gitlab.local</code>，应该能得到正常的 GitLab 登录页面了。</p><blockquote><p>默认情况下 Jenkins 虚拟机应该能够解析 <code>gitlab.local</code> 域名，如果后面设置 Jenkins 时遇到域名解析问题，请检查 Jenkins 虚拟机的 <code>/etc/hosts</code> 文件。</p></blockquote><blockquote><p>如果需要信任 GitLab 的自签名证书，可以先 <code>cd /etc/gitlab && sudo mv ssl/* ./</code>，然后将 <code>gitlab.local.crt</code> 通过 SFTP 下载到本机并导入到受信任的根证书颁发机构里。</p></blockquote><h2 id=gitlab-配置>GitLab 配置</h2><p>注册账号、登录、创建新的公开 repo。在本地准备一个 Java Web 应用，我使用的是 <a href=https://github.com/JoyChou93/java-sec-code target=_blank rel="noopener noreffer">java-sec-code</a> 这个项目。</p><blockquote><p>如果使用其它项目，请确保可以在 Java 6/7/8 中的至少一个运行环境上运行。原因：<figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png title="图 9" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png data-sub-html="<h2> </h2><p>图 9</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/9.png></a><figcaption class=image-caption>图 9</figcaption></figure></p></blockquote><p>随后删除原项目目录下 <code>.git</code> 目录（如果你对 git 比较熟悉也可以不删除），运行（项目名需自行替换）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> java-sec-code
</span></span><span class=line><span class=cl>git init
</span></span><span class=line><span class=cl>git remote add origin https://GitLab.local/merc/java-sec-code.git
</span></span><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;Initial commit&#34;</span>
</span></span><span class=line><span class=cl>git push -u origin master
</span></span></code></pre></td></tr></table></div></div><p>即可将项目推送到 GitLab 上。期间遇到的问题请参考 <a href=https://git-scm.com/doc target=_blank rel="noopener noreffer">Git 文档</a>。</p><h2 id=jenkins-配置>Jenkins 配置</h2><p>首先配置端口转发，将虚拟机 8080 端口映射到本机的任意未占用端口，如 8008：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png title="图 10" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png data-sub-html="<h2> </h2><p>图 10</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/10.png></a><figcaption class=image-caption>图 10</figcaption></figure></p><p>然后访问 http://localhost:8008/ ，即可看到 Jenkins 页面。</p><p>接下来，按照 <strong>雳鉴 IAST 第三方插件帮助文档</strong> 一步步配置 Jenkins。需要注意的几点：</p><ol><li><p><strong>雳鉴中提供的 Jenkins 插件可能存在兼容性问题，请务必使用修改后的 <code>IAST.hpi</code> 文件代替</strong>。</p></li><li><p>第二步中 <code>IAST 服务器地址</code> 请填写公网雳鉴地址，即 <code>http://47.100.14.22:81/</code>。</p></li><li><p>第三步结束后，先如图配置好 repo 地址（项目名需自行替换）：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png title="图 11" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png data-sub-html="<h2> </h2><p>图 11</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/11.png></a><figcaption class=image-caption>图 11</figcaption></figure></p></li><li><p>第四步中 <code>被测站点地址</code> 即部署 Java Web 应用的服务器地址，形式一般是 <code>ip:port</code>。</p></li><li><p>在第五步前，请先在服务器上部署好 Java Web 应用并运行，<strong>防止雳鉴中项目创建失败</strong>。例如我的应用是基于 Springboot 的，只需要运行 <code>java -jar java-sec-code-1.0.0.jar</code> 即可。</p></li></ol><p>在构建完成后，预期结果是在雳鉴中创建了新的项目。但是扫描结果中是没有漏洞的，因为还没有进行插桩：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png title="图 12" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png data-sub-html="<h2> </h2><p>图 12</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/12.png></a><figcaption class=image-caption>图 12</figcaption></figure></p><h2 id=进行插桩扫描>进行插桩扫描</h2><p>进入新创建的项目详情页面下载 agent，然后 SFTP 传到服务器上。根据 <strong>雳鉴 IAST 插桩 agent 帮助文档</strong>来部署 agent。例如对于我的 Springboot 应用，只需要运行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>java -javaagent:./iast_agent.jar -jar java-sec-code-1.0.0.jar
</span></span></code></pre></td></tr></table></div></div><p>待项目启动后，通过浏览器访问 Java Web 应用，即可在项目详情页面看到已经启动的 agent 了。</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png title="图 13" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png data-sub-html="<h2> </h2><p>图 13</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/13.png></a><figcaption class=image-caption>图 13</figcaption></figure></p><blockquote><p>插桩扫描是基于流量的，因此只有发送请求后才能检测到 agent。</p></blockquote><p>接下来对要测试的功能点发送请求即可进行扫描。例如对于存在 SSRF 漏洞的功能点发起请求：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png title="图 14" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png data-sub-html="<h2> </h2><p>图 14</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/14.png></a><figcaption class=image-caption>图 14</figcaption></figure></p><p>在雳鉴界面中可以看到：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png title="图 15" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png data-sub-html="<h2> </h2><p>图 15</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/15.png></a><figcaption class=image-caption>图 15</figcaption></figure></p><p>这时回到 Jenkins 再次进行构建，就可以得到正确的扫描结果了：</p><p><figure><a class=lightgallery href=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png title="图 16" data-thumbnail=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png data-sub-html="<h2> </h2><p>图 16</p>"><img class=lazyload src=/svg/loading.min.svg data-src=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png data-srcset="https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png 1.5x, https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/SignorMercurio/blog-cdn/JenkinsIAST/16.png></a><figcaption class=image-caption>图 16</figcaption></figure></p><h2 id=附录>附录</h2><ul><li>内网（仅主机网络下） IP：<ul><li>Jenkins：<code>10.0.1.11</code></li><li>GitLab： <code>10.0.1.15</code></li></ul></li><li>相关目录：<ul><li>Jenkins：<code>/var/lib/jenkins</code>，项目目录位于 <code>jobs</code> 下</li><li>GitLab：<code>/etc/gitlab</code>，配置文件为 <code>gitlab.rb</code></li></ul></li><li>在 Jenkins 中删除一个项目后，重新创建新项目前建议运行 <code>rm -rf /var/lib/jenkins/jobs/jobs</code></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2020-07-28</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/ci/cd/>CI/CD</a>,&nbsp;<a href=/tags/%E5%AE%9E%E8%B7%B5%E8%AE%B0%E5%BD%95/>实践记录</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/shred-dict/ class=prev rel=prev title=粉碎字典：设计方便记忆的安全口令><i class="fas fa-angle-left fa-fw"></i>粉碎字典：设计方便记忆的安全口令</a>
<a href=/think-php-myadmin/ class=next rel=next title="ThinkPHP & phpMyAdmin 漏洞学习">ThinkPHP & phpMyAdmin 漏洞学习<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2017 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Mercury</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/valine/Valine.min.js></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/algoliasearch/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:30},comment:{valine:{appId:"RkxCznUcvfzFBgfMiMr0BAfd-gzGzoHsz",appKey:"sw2sEPOl4haCAXKUFYiBFMrR",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@5.0.1/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:10,placeholder:"你的评论 ...",recordIP:!1,visitor:!0}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"P149SBLX5U",algoliaIndex:"blog",algoliaSearchKey:"cbd5db1f3910ee11bc18688f21b64bd4",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>