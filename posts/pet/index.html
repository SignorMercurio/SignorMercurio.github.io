<!doctype html><html lang=zh dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ &#183; Lab on Mercury</title><meta name=title content="æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ &#183; Lab on Mercury"><meta name=description content="Lab on Mercury"><link rel=canonical href=https://blog.sigmerc.top/posts/pet/><link type=text/css rel=stylesheet href=/css/main.bundle.min.32ddf7dee8011260365c3436dd92254eeda3ec27bea2822527e6cb67f6ede1ff17904557445f0f6747a03b5aa59bbf754e43fc9b0c77b1cd957ef7061fd0c6d2.css integrity="sha512-Mt333ugBEmA2XDQ23ZIlTu2j7Ce+ooIlJ+bLZ/bt4f8XkEVXRF8PZ0egO1qlm791TkP8mwx3sc2VfvcGH9DG0g=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE+kxhPaP44V1nkaYuHY8umoPeUk8H+2ZrVho1A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ"><meta property="og:description" content="Privacy Enhancing Technologies (PET)ï¼Œå®é™…ä¸Šè¿˜æ˜¯å¯†ç å­¦ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.sigmerc.top/posts/pet/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-04T09:23:11+00:00"><meta property="article:modified_time" content="2022-06-23T14:51:02+08:00"><meta property="og:site_name" content="Lab on Mercury"><meta name=twitter:card content="summary"><meta name=twitter:title content="æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ"><meta name=twitter:description content="Privacy Enhancing Technologies (PET)ï¼Œå®é™…ä¸Šè¿˜æ˜¯å¯†ç å­¦ã€‚"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ","headline":"æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ","abstract":"\u003cp\u003ePrivacy Enhancing Technologies (PET)ï¼Œå®é™…ä¸Šè¿˜æ˜¯å¯†ç å­¦ã€‚\u003c\/p\u003e","inLanguage":"zh","url":"https:\/\/blog.sigmerc.top\/posts\/pet\/","author":{"@type":"Person","name":"Mercury"},"copyrightYear":"2022","dateCreated":"2022-02-04T09:23:11\u002b00:00","datePublished":"2022-02-04T09:23:11\u002b00:00","dateModified":"2022-06-23T14:51:02\u002b08:00","keywords":["å¯¹ç§°å¯†ç å­¦","å…¬é’¥å¯†ç å­¦","åŒæ€åŠ å¯†"],"mainEntityOfPage":"true","wordCount":"6943"}]</script><meta name=author content="Mercury"><link href=mailto:signormercurio@gmail.com rel=me><link href=https://github.com/SignorMercurio rel=me><link href=https://t.me/m9r_at_tG rel=me><link type=text/css rel=stylesheet href=/lib/katex/katex.min.61fc68ef35c6690632cd6371cfcaf8b3c6b135f1b88d2ddd8a9b3ca761c0ff03569ae6a96a49108a48befd7037a373a5fa2f16234ddc4495430d412512d103ea.css integrity="sha512-Yfxo7zXGaQYyzWNxz8r4s8axNfG4jS3dips8p2HA/wNWmuapakkQiki+/XA3o3Ol+i8WI03cRJVDDUElEtED6g=="><script defer src=/lib/katex/katex.min.33bfe3919a0a1259f58da698daba022bd26de2dfa3fe2aeed1edaf2270e454ee4b634101b779baead8d34f95c5b061f62c91be55144bdae7884775347ebb3f19.js integrity="sha512-M7/jkZoKEln1jaaY2roCK9Jt4t+j/iru0e2vInDkVO5LY0EBt3m66tjTT5XFsGH2LJG+VRRL2ueIR3U0frs/GQ=="></script>
<script defer src=/lib/katex/auto-render.min.5ac29af4b37f66b53b4da03fbcd0e7bdc643e775ad035ffa51a53a725c11d3fc812d2893f8d506b504cb881b248387da2eedee13dccdda496f993bc1609bfec5.js integrity="sha512-WsKa9LN/ZrU7TaA/vNDnvcZD53WtA1/6UaU6clwR0/yBLSiT+NUGtQTLiBskg4faLu3uE9zN2klvmTvBYJv+xQ==" onload=renderMathInElement(document.body)></script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentcolor" d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438.0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1H112L112.1 454.3zM191.4.0132C89.44.3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.0313.25.0938.5166.125.7823h160.2c.0313-.2656.0938-.5166.125-.7823 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.61 288.9-.2837 191.4.0132zM192 96.01c-44.13.0-80 35.89-80 79.1.0 9.69-7.2 16.89-16 16.89S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1 8.844.0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg></span><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Lab on Mercury</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>æ–‡ç« </a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>åˆ†ç±»</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>æ ‡ç­¾</a></li><li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Lab on Mercury</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/pet/>æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">æ‰‘æœ”è¿·ç¦»ï¼šéšç§å¢å¼ºæŠ€æœ¯å®è·µ</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-02-04 09:23:11 +0000 UTC">2022-02-04</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-06-23 14:51:02 +0800 +0800">Updated: 2022-06-23</time><span class="px-2 text-primary-500">&#183;</span><span>6943 å­—</span><span class="px-2 text-primary-500">&#183;</span><span title=é¢„è®¡é˜…è¯»>33 åˆ†é’Ÿ</span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/categories/%E5%AF%86%E7%A0%81%E5%AD%A6/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">å¯†ç å­¦</a>
<a href=/tags/%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81%E5%AD%A6/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">å¯¹ç§°å¯†ç å­¦</a>
<a href=/tags/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81%E5%AD%A6/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">å…¬é’¥å¯†ç å­¦</a>
<a href=/tags/%E5%90%8C%E6%80%81%E5%8A%A0%E5%AF%86/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">åŒæ€åŠ å¯†</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 sideNav rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block sticky top-0 py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 pr-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#éšç§ä¸éšç§ä¾µçŠ¯>éšç§ä¸éšç§ä¾µçŠ¯</a></li><li><a href=#éšç§å¢å¼ºæŠ€æœ¯åˆ†ç±»>éšç§å¢å¼ºæŠ€æœ¯åˆ†ç±»</a></li><li><a href=#é€šä¿¡éšç§-communications-privacy>é€šä¿¡éšç§ Communications Privacy</a><ul><li><a href=#å¯¹ç§°åŠ å¯†>å¯¹ç§°åŠ å¯†</a></li><li><a href=#éå¯¹ç§°åŠ å¯†>éå¯¹ç§°åŠ å¯†</a></li><li><a href=#ç­¾å>ç­¾å</a></li><li><a href=#å®Œæ•´çš„åŠ å¯†é€šä¿¡å®ç°>å®Œæ•´çš„åŠ å¯†é€šä¿¡å®ç°</a></li><li><a href=#ä¾§ä¿¡é“æ”»å‡»>ä¾§ä¿¡é“æ”»å‡»</a></li></ul></li><li><a href=#åŒ¿åé€šä¿¡-anonymous-communications>åŒ¿åé€šä¿¡ Anonymous Communications</a><ul><li><a href=#é«˜å»¶è¿ŸåŒ¿åé€šä¿¡>é«˜å»¶è¿ŸåŒ¿åé€šä¿¡</a><ul><li><a href=#å•ä¸ª-mix>å•ä¸ª Mix</a></li><li><a href=#å¤šä¸ª-mix>å¤šä¸ª Mix</a></li><li><a href=#æµé‡åˆ†æ>æµé‡åˆ†æ</a></li></ul></li><li><a href=#ä½å»¶è¿ŸåŒ¿åé€šä¿¡>ä½å»¶è¿ŸåŒ¿åé€šä¿¡</a></li></ul></li><li><a href=#éšç§å‹å¥½å‹è®¡ç®—-privacy-friendly-computation>éšç§å‹å¥½å‹è®¡ç®— Privacy-friendly Computation</a><ul><li><a href=#åŒæ€åŠ å¯†>åŒæ€åŠ å¯†</a></li><li><a href=#ç§˜å¯†åˆ†äº«>ç§˜å¯†åˆ†äº«</a></li><li><a href=#ç§å¯†æŠ•ç¥¨>ç§å¯†æŠ•ç¥¨</a></li></ul></li><li><a href=#é›¶çŸ¥è¯†è¯æ˜-zkp>é›¶çŸ¥è¯†è¯æ˜ ZKP</a><ul><li><a href=#schnorr-identification-åè®®>Schnorr Identification åè®®</a></li><li><a href=#fiat-shamir-å¯å‘å¼æŠ€æœ¯>Fiat-Shamir å¯å‘å¼æŠ€æœ¯</a></li><li><a href=#ç›¸ç­‰æ€§è¯æ˜>ç›¸ç­‰æ€§è¯æ˜</a></li></ul></li><li><a href=#å®‰å…¨å¤šæ–¹è®¡ç®—-mpc>å®‰å…¨å¤šæ–¹è®¡ç®— MPC</a><ul><li><a href=#å®‰å…¨å®šä¹‰>å®‰å…¨å®šä¹‰</a></li><li><a href=#æ¶‰åŠæŠ€æœ¯>æ¶‰åŠæŠ€æœ¯</a></li></ul></li><li><a href=#ç§æœ‰é›†åˆäº¤é›†-psi>ç§æœ‰é›†åˆäº¤é›† PSI</a><ul><li><a href=#æ¶‰åŠæŠ€æœ¯-1>æ¶‰åŠæŠ€æœ¯</a></li><li><a href=#åˆ†ç±»>åˆ†ç±»</a></li><li><a href=#åº”ç”¨åœºæ™¯>åº”ç”¨åœºæ™¯</a></li><li><a href=#-apple-psi>ğŸŒ° Apple PSI</a></li></ul></li><li><a href=#selective-disclosure>Selective Disclosure</a><ul><li><a href=#algebraic-mac>Algebraic MAC</a></li><li><a href=#amac--zkp>aMAC + ZKP</a></li><li><a href=#åº”ç”¨>åº”ç”¨</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><figure><img class="my-0 rounded-md" src=0.png alt=featuredImage></figure><p>Privacy Enhancing Technologies (PET)ï¼Œå®é™…ä¸Šè¿˜æ˜¯å¯†ç å­¦ã€‚</p><h2 id=éšç§ä¸éšç§ä¾µçŠ¯ class="relative group">éšç§ä¸éšç§ä¾µçŠ¯ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%9a%90%e7%a7%81%e4%b8%8e%e9%9a%90%e7%a7%81%e4%be%b5%e7%8a%af aria-label=é”šç‚¹>#</a></span></h2><p>éšç§å¯ä»¥çœ‹ä½œæ˜¯å¯¹æ•°æ®çš„æ§åˆ¶çš„ä¸€ç§å‡†è®¸ï¼š</p><ul><li>æœºå¯†æ€§ - ä¿è¯ä¸€ä¸ªäººçš„ç§˜å¯†ä¸è¢«æ³„æ¼</li><li>æ§åˆ¶ - ç»™ä¸ªäººæ§åˆ¶è‡ªå·±ä¸ªäººä¿¡æ¯çš„æƒåˆ©</li><li>è‡ªæˆ‘å®ç° - å…è®¸ä¸ªäººä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥è¾¾æˆè‡ªå·±çš„ç›®çš„</li></ul><p>Solove åˆ†ç±»å°†éšç§ä¾µçŠ¯åˆ†ä¸º 4 ç±»ï¼š</p><ul><li>ä¿¡æ¯æ”¶é›†</li><li>ä¿¡æ¯å¤„ç†</li><li>ä¿¡æ¯ä¼ æ’­</li><li>å…¥ä¾µï¼ˆå³å¹²æ‰°ä¸ªäººçš„æ´»åŠ¨ä¸å†³ç­–ï¼‰</li></ul><h2 id=éšç§å¢å¼ºæŠ€æœ¯åˆ†ç±» class="relative group">éšç§å¢å¼ºæŠ€æœ¯åˆ†ç±» <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%9a%90%e7%a7%81%e5%a2%9e%e5%bc%ba%e6%8a%80%e6%9c%af%e5%88%86%e7%b1%bb aria-label=é”šç‚¹>#</a></span></h2><p>æ ¹æ®ä¸åŒçš„å‡è®¾ï¼Œéšç§å¢å¼ºæŠ€æœ¯å¯ä»¥åˆ†ä¸º Soft PET å’Œ Hard PETã€‚å‰è€…ä¸»è¦å…³æ³¨åˆè§„æ€§ï¼Œå‡è®¾å¤„ç†ç”¨æˆ·æ•°æ®çš„ç¬¬ä¸‰æ–¹æœåŠ¡æ˜¯åˆæ³•å¯ä¿¡çš„ï¼Œå› æ­¤ä¾§é‡äºå»ºç«‹å®‰å…¨ä¿¡é“ã€å¼ºåŒ–è®¿é—®æ§åˆ¶ç­–ç•¥ç­‰ç­‰ã€‚</p><p>åè€…åˆ™å‡è®¾ä»»ä¸€ç¬¬ä¸‰æ–¹æœåŠ¡å‡ä¸å¯ä¿¡ï¼Œå› æ­¤æ³¨é‡å®Œæ•´æ€§ã€å®¡è®¡ã€ä¸æ³„æ¼æ•°æ®ç»™ç¬¬ä¸‰æ–¹ç­‰ç­‰ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ Alice å’Œ Bob è¦é€šè¿‡ä¸€å°æœåŠ¡å™¨ï¼ˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆåœ¨ Soft PET ä¸­ï¼ŒåŒæ–¹éƒ½ä¼šä¸æœåŠ¡å™¨å»ºç«‹ TLS è¿æ¥ä¼ è¾“åŠ å¯†æ•°æ®ã€‚æœåŠ¡å™¨å¯ä»¥çœ‹åˆ°æ•°æ®æ˜æ–‡ï¼Œä¸è¿‡ç›‘å¬è€…çœ‹ä¸åˆ°ã€‚</p><p>è€Œåœ¨ Hard PET ä¸­ï¼ŒAlice å’Œ Bob ä¸ä¿¡ä»»æœåŠ¡å™¨ã€‚æ­¤æ—¶ Alice å¯èƒ½ä½¿ç”¨ Bob çš„å…¬é’¥åŠ å¯†åç»æœåŠ¡å™¨ä¼ è¾“ç»™ Bobï¼Œè¿™ä¸€è¿‡ç¨‹ä¸­æœåŠ¡å™¨å°±æ— æ³•çœ‹åˆ°æ˜æ–‡äº†ã€‚</p><h2 id=é€šä¿¡éšç§-communications-privacy class="relative group">é€šä¿¡éšç§ Communications Privacy <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%80%9a%e4%bf%a1%e9%9a%90%e7%a7%81-communications-privacy aria-label=é”šç‚¹>#</a></span></h2><p>è¿™ä¸ªéƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œå³å¯†ç å­¦ä¸­çš„æ··åˆåŠ å¯†æœºåˆ¶ã€‚</p><h3 id=å¯¹ç§°åŠ å¯† class="relative group">å¯¹ç§°åŠ å¯† <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label=é”šç‚¹>#</a></span></h3><p>é¦–å…ˆæ˜¯å¯¹ç§°åŠ å¯†éƒ¨åˆ†ï¼Œç°åœ¨é€šå¸¸é‡‡ç”¨ AEAD æ–¹å¼åŒæ—¶ç¡®ä¿æœºå¯†æ€§å’Œå®Œæ•´æ€§ï¼Œæœ€è‘—åçš„ç®—æ³•è«è¿‡äº AES-GCM äº†ã€‚</p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºåŒä¸€å¯†é’¥ä¸èƒ½é‡å¤ä½¿ç”¨ç›¸åŒçš„ IVã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦å®ç° <code>encrypt_message</code> å’Œ <code>decrypt_message</code> ä¸¤ä¸ªå‡½æ•°ï¼Œåœ¨å®ç°å‰å…ˆåˆ©ç”¨ pytest å†™å¥½æµ‹è¯•ï¼Œä»¥ AES-128-GCM ä¸ºä¾‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_gcm_encrypt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Tests encryption with AES-GCM &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Hello World!&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span> <span class=o>=</span> <span class=n>encrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_gcm_decrypt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Tests decryption with AES-GCM &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Hello World!&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span> <span class=o>=</span> <span class=n>encrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>decrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>m</span> <span class=o>==</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_gcm_fails</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>pytest</span> <span class=kn>import</span> <span class=n>raises</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Hello World!&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span> <span class=o>=</span> <span class=n>encrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)),</span> <span class=n>tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)),</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypt_message</span><span class=p>(</span><span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)),</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span></code></pre></div><p>å‡½æ•°å®ç°éƒ¨åˆ†åˆ™åˆ©ç”¨ petlibï¼Œæ³¨æ„æ•è·å¼‚å¸¸ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Encrypt a message under a key given as input &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>length</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=n>length</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=s2>&#34;aes-128-gcm&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>quick_gcm_enc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Decrypt a cipher text under a key given as input
</span></span></span><span class=line><span class=cl><span class=s2>        In case the decryption fails, throw an exception.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=s2>&#34;aes-128-gcm&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>plain</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>quick_gcm_dec</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;decryption failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plain</span>
</span></span></code></pre></div><h3 id=éå¯¹ç§°åŠ å¯† class="relative group">éå¯¹ç§°åŠ å¯† <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%9d%9e%e5%af%b9%e7%a7%b0%e5%8a%a0%e5%af%86 aria-label=é”šç‚¹>#</a></span></h3><p>éå¯¹ç§°éƒ¨åˆ†é‡‡ç”¨ ECDH æ¥å‡å°å¯†é’¥é•¿åº¦ï¼Œè€ƒè™‘åˆ° Forward Secrecy çš„è¦æ±‚ï¼Œå¯ä»¥å‡çº§æˆ ECDHEã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆå¤ä¹ ä¸€ä¸‹æ¤­åœ†æ›²çº¿ç®—æœ¯ã€‚</p><p>å‡è®¾æ›²çº¿ä¸º $y^2\equiv x^3+ax+b\ (mod\ p)$ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨æ›²çº¿ä¸Šçš„å‡½æ•°ã€‚æˆ‘ä»¬ç”¨å°è£…å¥½çš„ <code>petlib.ec</code> å†™æµ‹è¯•ï¼Œä½†åªä½¿ç”¨ <code>petlib.Bn</code> æ¥è®¡ç®—æ¤­åœ†æ›²çº¿ç®—æœ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_on_curve</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test the procedues that tests whether a point is on a curve.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Example on how to define a curve</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>petlib.ec</span> <span class=kn>import</span> <span class=n>EcGroup</span><span class=p>,</span> <span class=n>EcPt</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=mi>713</span><span class=p>)</span>  <span class=c1># NIST curve</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;b&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx</span><span class=p>,</span> <span class=n>gy</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Lab01Code</span> <span class=kn>import</span> <span class=n>is_point_on_curve</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx</span><span class=p>,</span> <span class=n>gy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Check that a point (x, y) is on the curve defined by a,b and prime p.
</span></span></span><span class=line><span class=cl><span class=s2>    Reminder: an Elliptic Curve on a prime field p is defined as:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>              y^2 = x^3 + ax + b (mod p)
</span></span></span><span class=line><span class=cl><span class=s2>                  (Weierstrass form)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Return True if point (x,y) is on curve, otherwise False.
</span></span></span><span class=line><span class=cl><span class=s2>    By convention a (None, None) point represents &#34;infinity&#34;.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>b</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span> <span class=ow>and</span> <span class=n>p</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>Bn</span><span class=p>))</span> \
</span></span><span class=line><span class=cl>        <span class=ow>or</span> <span class=p>(</span><span class=n>x</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>lhs</span> <span class=o>=</span> <span class=p>(</span><span class=n>y</span> <span class=o>*</span> <span class=n>y</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=n>rhs</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span> <span class=o>*</span> <span class=n>x</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=n>a</span> <span class=o>*</span> <span class=n>x</span> <span class=o>+</span> <span class=n>b</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=n>on_curve</span> <span class=o>=</span> <span class=p>(</span><span class=n>lhs</span> <span class=o>==</span> <span class=n>rhs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>on_curve</span>
</span></span></code></pre></div><p>éšåï¼Œå¯¹äº $(x_r,y_r)=(x_p,y_p)+(x_q,y_q)$ï¼Œæˆ‘ä»¬æœ‰ï¼š</p><p>$$
\lambda=(y_q-y_p)(x_q-x_p)^{-1}\ (mod\ p)\\
x_r=\lambda^2-x_p-x_q\ (mod\ p)\\
y_r=\lambda(x_p-x_r)-y_p\ (mod\ p)
$$</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_point_addition</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test whether the EC point addition is correct.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>pytest</span> <span class=kn>import</span> <span class=n>raises</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>petlib.ec</span> <span class=kn>import</span> <span class=n>EcGroup</span><span class=p>,</span> <span class=n>EcPt</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=mi>713</span><span class=p>)</span>  <span class=c1># NIST curve</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;b&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>*</span> <span class=n>g</span><span class=p>)</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Test a simple addition</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>hx1</span><span class=p>,</span> <span class=n>hy1</span> <span class=o>=</span> <span class=n>h</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>,</span> <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>x</span> <span class=o>==</span> <span class=n>hx1</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>y</span> <span class=o>==</span> <span class=n>hy1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Ensure commutativity</span>
</span></span><span class=line><span class=cl>    <span class=n>xp</span><span class=p>,</span> <span class=n>yp</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>xp</span><span class=p>,</span> <span class=n>yp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>x</span> <span class=o>==</span> <span class=n>xp</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>y</span> <span class=o>==</span> <span class=n>yp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Ensure addition with neutral returns the element</span>
</span></span><span class=line><span class=cl>    <span class=n>xp</span><span class=p>,</span> <span class=n>yp</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>xp</span><span class=p>,</span> <span class=n>yp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>xp</span> <span class=o>==</span> <span class=n>gx1</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>yp</span> <span class=o>==</span> <span class=n>gy1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>xp</span><span class=p>,</span> <span class=n>yp</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>xp</span><span class=p>,</span> <span class=n>yp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>gx0</span> <span class=o>==</span> <span class=n>xp</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>gy0</span> <span class=o>==</span> <span class=n>yp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># An error is raised in case the points are equal</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;EC Points must not be equal&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_point_addition_check_inf_result</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test whether the EC point addition is correct for pt - pt = inf
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>petlib.ec</span> <span class=kn>import</span> <span class=n>EcGroup</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=mi>713</span><span class=p>)</span>  <span class=c1># NIST curve</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;b&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span> <span class=o>=</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>p</span> <span class=o>-</span> <span class=n>gy0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>,</span> <span class=n>gx1</span><span class=p>,</span> <span class=n>gy1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span> <span class=o>==</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>y0</span><span class=p>,</span> <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Define the &#34;addition&#34; operation for 2 EC Points.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Reminder: (xr, yr) = (xq, yq) + (xp, yp)
</span></span></span><span class=line><span class=cl><span class=s2>    is defined as:
</span></span></span><span class=line><span class=cl><span class=s2>        lam = (yq - yp) * (xq - xp)^-1 (mod p)
</span></span></span><span class=line><span class=cl><span class=s2>        xr  = lam^2 - xp - xq (mod p)
</span></span></span><span class=line><span class=cl><span class=s2>        yr  = lam * (xp - xr) - yp (mod p)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Return the point resulting from the addition by
</span></span></span><span class=line><span class=cl><span class=s2>    implementing the above pseudocode.
</span></span></span><span class=line><span class=cl><span class=s2>    Raises an Exception if the points are equal.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x0</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y0</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x1</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y1</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x0</span><span class=p>,</span> <span class=n>y0</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x0</span> <span class=o>==</span> <span class=n>x1</span> <span class=ow>and</span> <span class=n>y0</span> <span class=o>==</span> <span class=n>y1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;EC Points must not be equal&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>x0</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>y0</span><span class=p>,</span> <span class=n>Bn</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>y1</span><span class=p>,</span> <span class=n>Bn</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>inv</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>inv</span> <span class=o>=</span> <span class=p>(</span><span class=n>x1</span><span class=o>-</span><span class=n>x0</span><span class=p>)</span><span class=o>.</span><span class=n>mod_inverse</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>lamb</span> <span class=o>=</span> <span class=p>(</span><span class=n>y1</span><span class=o>-</span><span class=n>y0</span><span class=p>)</span><span class=o>.</span><span class=n>mod_mul</span><span class=p>(</span><span class=n>inv</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>xr</span> <span class=o>=</span> <span class=n>lamb</span><span class=o>.</span><span class=n>mod_pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span><span class=o>.</span><span class=n>mod_sub</span><span class=p>(</span><span class=n>x0</span><span class=o>+</span><span class=n>x1</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>yr</span> <span class=o>=</span> <span class=n>lamb</span><span class=o>.</span><span class=n>mod_mul</span><span class=p>(</span><span class=n>x0</span><span class=o>-</span><span class=n>xr</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span><span class=o>.</span><span class=n>mod_sub</span><span class=p>(</span><span class=n>y0</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>xr</span><span class=p>,</span> <span class=n>yr</span>
</span></span></code></pre></div><p>ç‰¹åˆ«åœ°ï¼Œå½“ä¸¤ä¸ªåŠ æ•°ç›¸åŒæ—¶ï¼š</p><p>$$
\lambda=(3x_p^2+a)(2y_p)^{-1}\ (mod\ p)\\
x_r=\lambda^2-2x_p\ (mod\ p)\\
y_r=\lambda(x_p-x_r)-y_p\ (mod\ p)
$$</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_point_doubling</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test whether the EC point doubling is correct.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>petlib.ec</span> <span class=kn>import</span> <span class=n>EcGroup</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=mi>713</span><span class=p>)</span>  <span class=c1># NIST curve</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;b&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>gx2</span><span class=p>,</span> <span class=n>gy2</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>g</span><span class=p>)</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>point_double</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>x2</span> <span class=o>==</span> <span class=n>gx2</span> <span class=ow>and</span> <span class=n>y2</span> <span class=o>==</span> <span class=n>gy2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>point_double</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>x2</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y2</span> <span class=ow>is</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>point_double</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Define &#34;doubling&#34; an EC point.
</span></span></span><span class=line><span class=cl><span class=s2>     A special case, when a point needs to be added to itself.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>     Reminder:
</span></span></span><span class=line><span class=cl><span class=s2>        lam = (3 * xp ^ 2 + a) * (2 * yp) ^ -1 (mod p)
</span></span></span><span class=line><span class=cl><span class=s2>        xr  = lam ^ 2 - 2 * xp
</span></span></span><span class=line><span class=cl><span class=s2>        yr  = lam * (xp - xr) - yp (mod p)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns the point representing the double of the input (x, y).
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=ow>is</span> <span class=kc>None</span> <span class=ow>and</span> <span class=n>y</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>isinstance</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=p>,</span> <span class=n>Bn</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>inv</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span><span class=o>*</span><span class=n>y</span><span class=p>)</span><span class=o>.</span><span class=n>mod_inverse</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>lamb</span> <span class=o>=</span> <span class=p>(</span><span class=mi>3</span><span class=o>*</span><span class=n>x</span><span class=o>**</span><span class=mi>2</span><span class=o>+</span><span class=n>a</span><span class=p>)</span><span class=o>.</span><span class=n>mod_mul</span><span class=p>(</span><span class=n>inv</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>xr</span> <span class=o>=</span> <span class=n>lamb</span><span class=o>.</span><span class=n>mod_pow</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span><span class=o>.</span><span class=n>mod_sub</span><span class=p>(</span><span class=n>x</span><span class=o>*</span><span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>yr</span> <span class=o>=</span> <span class=n>lamb</span><span class=o>.</span><span class=n>mod_mul</span><span class=p>(</span><span class=n>x</span><span class=o>-</span><span class=n>xr</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span><span class=o>.</span><span class=n>mod_sub</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>xr</span><span class=p>,</span> <span class=n>yr</span>
</span></span></code></pre></div><p>è€Œå¯¹äºä¹˜æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¿«é€Ÿå¹‚çš„æ–¹æ³•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_point_scalar_mult_double_and_add</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test the scalar multiplication using double and add.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>petlib.ec</span> <span class=kn>import</span> <span class=n>EcGroup</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=mi>713</span><span class=p>)</span>  <span class=c1># NIST curve</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;b&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>gx2</span><span class=p>,</span> <span class=n>gy2</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>*</span> <span class=n>g</span><span class=p>)</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>point_scalar_multiplication_double_and_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>is_point_on_curve</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>gx2</span> <span class=o>==</span> <span class=n>x2</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>gy2</span> <span class=o>==</span> <span class=n>y2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>point_scalar_multiplication_double_and_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>scalar</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Implement Point multiplication with a scalar:
</span></span></span><span class=line><span class=cl><span class=s2>        r * (x, y) = (x, y) + ... + (x, y)    (r times)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Reminder of Double and Multiply algorithm: r * P
</span></span></span><span class=line><span class=cl><span class=s2>        Q = infinity
</span></span></span><span class=line><span class=cl><span class=s2>        for i = 0 to num_bits(P)-1
</span></span></span><span class=line><span class=cl><span class=s2>            if bit i of r == 1 then
</span></span></span><span class=line><span class=cl><span class=s2>                Q = Q + P
</span></span></span><span class=line><span class=cl><span class=s2>            P = 2 * P
</span></span></span><span class=line><span class=cl><span class=s2>        return Q
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Q</span> <span class=o>=</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>P</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>scalar</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>scalar</span><span class=o>.</span><span class=n>num_bits</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>scalar</span><span class=o>.</span><span class=n>is_bit_set</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>Q</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>Q</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>Q</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>P</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>P</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>P</span> <span class=o>=</span> <span class=n>point_double</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>P</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>P</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Q</span>
</span></span></code></pre></div><p>åœ¨åç»­å®éªŒä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•´æ•°åŸŸä¸Šçš„è¿ç®—â€œè¿ç§»â€åˆ°æ¤­åœ†æ›²çº¿ä¸Šæ—¶ä¼šé™é˜¶ï¼Œå³ä¹˜æ³•å˜ä¸ºåŠ æ³•ï¼Œå¹‚è¿ç®—å˜ä¸ºä¹˜æ³•ã€‚</p><h3 id=ç­¾å class="relative group">ç­¾å <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ad%be%e5%90%8d aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨æˆ‘ä»¬çš„æ··åˆåŠ å¯†ä½“åˆ¶ä¸­è¿˜å¯ä»¥åŠ å…¥æ•°å­—ç­¾åï¼Œè¿™é‡Œç”¨ ECDSAï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_key_gen</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Tests the key generation of ECDSA&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Lab01Code</span> <span class=kn>import</span> <span class=n>ecdsa_key_gen</span>
</span></span><span class=line><span class=cl>    <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_produce_signature</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Tests signature function &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Test&#34;</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>Lab01Code</span> <span class=kn>import</span> <span class=n>ecdsa_key_gen</span><span class=p>,</span> <span class=n>ecdsa_sign</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>group</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ecdsa_sign</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_check_signature</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Tests signature and verification function &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Test&#34;</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>group</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sig</span> <span class=o>=</span> <span class=n>ecdsa_sign</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>ecdsa_verify</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>msg</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_check_fail</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Ensures verification fails when it should &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>msg</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Test&#34;</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>    <span class=n>msg2</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Text&#34;</span> <span class=o>*</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>group</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sig</span> <span class=o>=</span> <span class=n>ecdsa_sign</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=ow>not</span> <span class=n>ecdsa_verify</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>msg2</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ecdsa_key_gen</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Returns an EC group, a random private key for signing
</span></span></span><span class=line><span class=cl><span class=s2>        and the corresponding public key for verification&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>priv_sign</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>pub_verify</span> <span class=o>=</span> <span class=n>priv_sign</span> <span class=o>*</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>group</span><span class=p>,</span> <span class=n>priv_sign</span><span class=p>,</span> <span class=n>pub_verify</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ecdsa_sign</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv_sign</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Sign the SHA256 digest of the message using ECDSA and return a signature &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>digest</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>kinv_rp</span> <span class=o>=</span> <span class=n>do_ecdsa_setup</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv_sign</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sig</span> <span class=o>=</span> <span class=n>do_ecdsa_sign</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv_sign</span><span class=p>,</span> <span class=n>digest</span><span class=p>,</span> <span class=n>kinv_rp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sig</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ecdsa_verify</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>pub_verify</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>sig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Verify the ECDSA signature on the message &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>digest</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>message</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>do_ecdsa_verify</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>pub_verify</span><span class=p>,</span> <span class=n>sig</span><span class=p>,</span> <span class=n>digest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span>
</span></span></code></pre></div><h3 id=å®Œæ•´çš„åŠ å¯†é€šä¿¡å®ç° class="relative group">å®Œæ•´çš„åŠ å¯†é€šä¿¡å®ç° <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ae%8c%e6%95%b4%e7%9a%84%e5%8a%a0%e5%af%86%e9%80%9a%e4%bf%a1%e5%ae%9e%e7%8e%b0 aria-label=é”šç‚¹>#</a></span></h3><p>å°†ä¸Šé¢å®ç°çš„éƒ¨åˆ†ç»„åˆåˆ°ä¸€èµ·ï¼ŒåŠ ä¸Š DH å¯†é’¥äº¤æ¢ï¼Œå°±æ˜¯å®Œæ•´çš„åŠ å¯†é€šä¿¡è¿‡ç¨‹äº†ã€‚åœ¨ä¸‹é¢çš„ä»£ç é‡Œå‡è®¾ Alice å‘é€ Bob æ¥æ”¶ï¼Œä½†å› ä¸ºé€šä¿¡çš„å¯¹ç§°æ€§ï¼Œå¯¹äºç›¸åçš„æƒ…å†µä¹ŸåŒæ ·é€‚ç”¨ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task5</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_encrypt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_priv_alice</span><span class=p>,</span> <span class=n>ecdsa_pub_alice</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_sig</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_priv_alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dh_group</span><span class=p>,</span> <span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_bob</span> <span class=o>=</span> <span class=n>dh_get_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Hello World!&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>,</span> <span class=n>dh_pub_alice</span> <span class=o>=</span> <span class=n>dh_encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_pub_bob</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>alice_sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task5</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_decrypt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_priv_alice</span><span class=p>,</span> <span class=n>ecdsa_pub_alice</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_sig</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_priv_alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_ver</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_pub_alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dh_group</span><span class=p>,</span> <span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_bob</span> <span class=o>=</span> <span class=n>dh_get_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Hello World!&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>,</span> <span class=n>dh_pub_alice</span> <span class=o>=</span> <span class=n>dh_encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_pub_bob</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>alice_sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>m</span> <span class=o>==</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task5</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_fails</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_priv_alice</span><span class=p>,</span> <span class=n>ecdsa_pub_alice</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_sig</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_priv_alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_ver</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecdsa_group</span><span class=p>,</span> <span class=n>ecdsa_pub_alice</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>dh_group</span><span class=p>,</span> <span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_bob</span> <span class=o>=</span> <span class=n>dh_get_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Hello World!&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>,</span> <span class=n>dh_pub_alice</span> <span class=o>=</span> <span class=n>dh_encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_pub_bob</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>alice_sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span> <span class=o>==</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random ciphertext</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted</span> <span class=o>=</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)),</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random AES-GCM tag</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted</span> <span class=o>=</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>tag</span><span class=p>)),</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random IV</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted</span> <span class=o>=</span> <span class=p>(</span><span class=n>urandom</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>iv</span><span class=p>)),</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_normal</span> <span class=o>=</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>group_rand</span><span class=p>,</span> <span class=n>priv_rand</span><span class=p>,</span> <span class=n>pub_rand</span> <span class=o>=</span> <span class=n>dh_get_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random DH private key of Bob</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>priv_rand</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted_normal</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random DH public key of Alice</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>pub_rand</span><span class=p>,</span> <span class=n>encrypted_normal</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;decryption failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ecdsa_group_rand</span><span class=p>,</span> <span class=n>ecdsa_priv_rand</span><span class=p>,</span> <span class=n>ecdsa_pub_rand</span> <span class=o>=</span> <span class=n>ecdsa_key_gen</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>alice_ver_rand</span> <span class=o>=</span> <span class=p>(</span><span class=n>ecdsa_group_rand</span><span class=p>,</span> <span class=n>ecdsa_pub_rand</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random ECDSA verificaiton key</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted_normal</span><span class=p>,</span> <span class=n>alice_ver_rand</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;verification failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Random signature</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted</span> <span class=o>=</span> <span class=p>(</span><span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=p>(</span><span class=n>Bn</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span> <span class=n>Bn</span><span class=p>(</span><span class=mi>200</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>dh_decrypt</span><span class=p>(</span><span class=n>dh_priv_bob</span><span class=p>,</span> <span class=n>dh_pub_alice</span><span class=p>,</span> <span class=n>encrypted</span><span class=p>,</span> <span class=n>alice_ver</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=s1>&#39;verification failed&#39;</span> <span class=ow>in</span> <span class=nb>str</span><span class=p>(</span><span class=n>excinfo</span><span class=o>.</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dh_get_key</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generate a DH key pair &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>priv_dec</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>pub_enc</span> <span class=o>=</span> <span class=n>priv_dec</span> <span class=o>*</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>group</span><span class=p>,</span> <span class=n>priv_dec</span><span class=p>,</span> <span class=n>pub_enc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dh_encrypt</span><span class=p>(</span><span class=n>pub</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>alice_sig</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Assume you know the public key of someone else (Bob),
</span></span></span><span class=line><span class=cl><span class=s2>    and wish to Encrypt a message for them.
</span></span></span><span class=line><span class=cl><span class=s2>        - Generate a fresh DH key for this message.
</span></span></span><span class=line><span class=cl><span class=s2>        - Derive a fresh shared key.
</span></span></span><span class=line><span class=cl><span class=s2>        - Use the shared key to AES_GCM encrypt the message.
</span></span></span><span class=line><span class=cl><span class=s2>        - Optionally: sign the message with Alice&#39;s key.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>pub</span><span class=p>,</span> <span class=n>EcPt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>group</span><span class=p>,</span> <span class=n>priv_dh</span><span class=p>,</span> <span class=n>pub_dh</span> <span class=o>=</span> <span class=n>dh_get_key</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=n>priv_dh</span> <span class=o>*</span> <span class=n>pub</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span> <span class=n>EcPt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>secret</span><span class=o>.</span><span class=n>export</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span> <span class=o>=</span> <span class=n>encrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sig</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>alice_sig</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>group</span><span class=p>,</span> <span class=n>priv_sign</span> <span class=o>=</span> <span class=n>alice_sig</span>
</span></span><span class=line><span class=cl>        <span class=n>sig</span> <span class=o>=</span> <span class=n>ecdsa_sign</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>priv_sign</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>iv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span><span class=p>,</span> <span class=n>pub_dh</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dh_decrypt</span><span class=p>(</span><span class=n>priv</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>alice_ver</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Decrypt a received message encrypted using your public key,
</span></span></span><span class=line><span class=cl><span class=s2>    of which the private key is provided.
</span></span></span><span class=line><span class=cl><span class=s2>    Optionally verify the message came from Alice using her verification
</span></span></span><span class=line><span class=cl><span class=s2>    key.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>priv</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>pub</span><span class=p>,</span> <span class=n>EcPt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>secret</span> <span class=o>=</span> <span class=n>priv</span> <span class=o>*</span> <span class=n>pub</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span> <span class=n>EcPt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>secret</span><span class=o>.</span><span class=n>export</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>iv</span><span class=p>,</span> <span class=n>cipher</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>sig</span> <span class=o>=</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>    <span class=n>plain</span> <span class=o>=</span> <span class=n>decrypt_message</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>cipher</span><span class=p>,</span> <span class=n>tag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>alice_ver</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>group</span><span class=p>,</span> <span class=n>pub_verify</span> <span class=o>=</span> <span class=n>alice_ver</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>ecdsa_verify</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>pub_verify</span><span class=p>,</span> <span class=n>plain</span><span class=p>,</span> <span class=n>sig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;verification failed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>plain</span>
</span></span></code></pre></div><h3 id=ä¾§ä¿¡é“æ”»å‡» class="relative group">ä¾§ä¿¡é“æ”»å‡» <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%be%a7%e4%bf%a1%e9%81%93%e6%94%bb%e5%87%bb aria-label=é”šç‚¹>#</a></span></h3><p>æœ€åï¼Œæˆ‘ä»¬ç¼–å†™å‡½æ•°æµ‹è¯•æ¤­åœ†æ›²çº¿ç‚¹ä¹˜æ³•æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>time_scalar_mul</span><span class=p>(</span><span class=n>f</span><span class=p>):</span>  <span class=c1># pragma: no cover</span>
</span></span><span class=line><span class=cl>    <span class=n>start</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=mi>713</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>parameters</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span> <span class=o>=</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;b&#34;</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span> <span class=o>=</span> <span class=n>g</span><span class=o>.</span><span class=n>get_affine</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>gx0</span><span class=p>,</span> <span class=n>gy0</span><span class=p>,</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>r</span><span class=p>,</span> <span class=n>time</span><span class=o>.</span><span class=n>perf_counter</span><span class=p>()</span><span class=o>-</span><span class=n>start</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>time_double_add</span><span class=p>(</span><span class=n>times</span><span class=p>):</span>  <span class=c1># pragma: no cover</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>times</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>time_double_add</span> <span class=o>=</span> <span class=n>time_scalar_mul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>point_scalar_multiplication_double_and_add</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>time_double_add</span><span class=p>)</span>
</span></span></code></pre></div><blockquote><p>Python3.8 ç§»é™¤äº† <code>time.clock()</code>ï¼Œä½¿ç”¨ <code>time.perf_counter()</code> æ›¿ä»£ã€‚</p></blockquote><p>è¿è¡Œåå¯ä»¥å‘ç°ï¼Œå¿«é€Ÿå¹‚çš„æ–¹å¼èŠ±è´¹æ—¶é—´æµ®åŠ¨å¾ˆå¤§ï¼Œå¯èƒ½å¯¼è‡´åŸºäºæ—¶é—´çš„ä¾§ä¿¡é“æ”»å‡»ã€‚ä¸ºäº†é˜²æ­¢è¿™ä¸€æ”»å‡»ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ Montgomerry Ladder ç®—æ³•é‡æ–°å®ç°ä¹˜æ³•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>point_scalar_multiplication_montgomerry_ladder</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>scalar</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Implement Point multiplication with a scalar:
</span></span></span><span class=line><span class=cl><span class=s2>        r * (x, y) = (x, y) + ... + (x, y)    (r times)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Reminder of Double and Multiply algorithm: r * P
</span></span></span><span class=line><span class=cl><span class=s2>        R0 = infinity
</span></span></span><span class=line><span class=cl><span class=s2>        R1 = P
</span></span></span><span class=line><span class=cl><span class=s2>        for i in num_bits(P)-1 to zero:
</span></span></span><span class=line><span class=cl><span class=s2>            if di = 0:
</span></span></span><span class=line><span class=cl><span class=s2>                R1 = R0 + R1
</span></span></span><span class=line><span class=cl><span class=s2>                R0 = 2R0
</span></span></span><span class=line><span class=cl><span class=s2>            else
</span></span></span><span class=line><span class=cl><span class=s2>                R0 = R0 + R1
</span></span></span><span class=line><span class=cl><span class=s2>                R1 = 2 R1
</span></span></span><span class=line><span class=cl><span class=s2>        return R0
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>R0</span> <span class=o>=</span> <span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>R1</span> <span class=o>=</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>scalar</span><span class=p>,</span> <span class=n>Bn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>reversed</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>scalar</span><span class=o>.</span><span class=n>num_bits</span><span class=p>())):</span>
</span></span><span class=line><span class=cl>        <span class=c1># TODO: ADD YOUR CODE HERE</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>scalar</span><span class=o>.</span><span class=n>is_bit_set</span><span class=p>(</span><span class=n>i</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>R1</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>R0</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>R0</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>R1</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>R1</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>R0</span> <span class=o>=</span> <span class=n>point_double</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>R0</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>R0</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>R0</span> <span class=o>=</span> <span class=n>point_add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>R0</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>R0</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>R1</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>R1</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>R1</span> <span class=o>=</span> <span class=n>point_double</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>R1</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>R1</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>R0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>time_montgomery</span><span class=p>(</span><span class=n>times</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>times</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>time_montgomery</span> <span class=o>=</span> <span class=n>time_scalar_mul</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>point_scalar_multiplication_montgomerry_ladder</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>time_montgomery</span><span class=p>)</span>
</span></span></code></pre></div><p>æ­¤æ—¶çš„è®¡æ—¶ç»“æœéå¸¸ç¨³å®šï¼Œå› ä¸º Montgomerry Ladder ç®—æ³•ç¡®ä¿äº†å¯¹ä¸åŒè¾“å…¥çš„å¤„ç†èŠ±è´¹å¤§è‡´ç›¸åŒçš„æ—¶é—´ã€‚</p><h2 id=åŒ¿åé€šä¿¡-anonymous-communications class="relative group">åŒ¿åé€šä¿¡ Anonymous Communications <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%8c%bf%e5%90%8d%e9%80%9a%e4%bf%a1-anonymous-communications aria-label=é”šç‚¹>#</a></span></h2><p>åŒ¿åé€šä¿¡çš„åŒ¿åæ€§å¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>å‘é€è€…åŒ¿åï¼šAlice å‘é€æ¶ˆæ¯ç»™ Bobï¼ŒBob å¹¶ä¸çŸ¥é“å‘é€è€…æ˜¯è°</li><li>æ¥æ”¶è€…åŒ¿åï¼šAlice å‘é€æ¶ˆæ¯ç»™ Bobï¼Œä½†ä¸çŸ¥é“ Bob æ˜¯è°</li><li>åŒå‘åŒ¿åï¼šAlice ä¸ Bob é€šä¿¡ï¼Œä½†ä¸çŸ¥é“å¯¹æ–¹èº«ä»½</li><li>ç¬¬ä¸‰æ–¹åŒ¿åï¼šAlice ä¸ Bob é€šä¿¡å¹¶çŸ¥é“å¯¹æ–¹èº«ä»½ï¼Œä½†ç¬¬ä¸‰æ–¹å¹¶ä¸çŸ¥é“</li></ul><p>ä¸ºäº†æ»¡è¶³åŒ¿åæ€§ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦æ»¡è¶³ï¼š</p><ul><li>ä¸å¯è§‚æµ‹æ€§ï¼šAlice ä¸ Bob é€šä¿¡ï¼Œè€Œå…¶ä»–äººå¹¶ä¸çŸ¥é“ä»–ä»¬å„è‡ªåœ¨å‘é€è¿˜æ˜¯æ¥æ”¶æ¶ˆæ¯</li><li>ä¸å¯å…³è”æ€§ï¼šAlice å‘é€ï¼ˆæˆ– Bob æ¥æ”¶ï¼‰çš„ä»»æ„ä¸¤æ¡æ¶ˆæ¯æ— æ³•è¢«å…³è”åˆ°åŒä¸€ä¸ªå‘é€è€…ï¼ˆæˆ–æ¥æ”¶è€…ï¼‰</li><li>ä¼ªåŒ¿åæ€§ï¼šAlice çš„æ‰€æœ‰è¡Œä¸ºéƒ½å¯ä»¥è¢«å…³è”åˆ°ä¸€ä¸ªå®ä½“ï¼Œä½†å®ä½“çš„èº«ä»½æ— æ³•ç¡®å®š</li></ul><p>å®ç°åŒ¿åé€šä¿¡æœ‰å¤šç§æ–¹æ³•ï¼Œå…¶ä¸­æœ€ç®€å•çš„è«è¿‡äºæ‰€æœ‰å‘é€çš„æ¶ˆæ¯éƒ½é€šè¿‡å¹¿æ’­çš„æ–¹å¼ï¼Œå¦‚æœæ¥æ”¶åˆ°æ¶ˆæ¯çš„äººå‘ç°å¯ä»¥æˆåŠŸè§£å¯†ï¼Œè¯´æ˜æ¶ˆæ¯æ˜¯å‘é€ç»™è‡ªå·±çš„ï¼Œå¦åˆ™ä¸¢å¼ƒã€‚è¿™å½“ç„¶ä¸æ˜¯å¥½åŠæ³•ï¼Œä½†å¦‚æœæˆ‘ä»¬è¦è‡ªå·±è®¾è®¡åŒ¿åé€šä¿¡æœºåˆ¶ï¼Œéœ€è¦æ³¨æ„ä¸èƒ½æ¯”è¿™ä¸€åŠæ³•æ›´å·®ã€‚</p><h3 id=é«˜å»¶è¿ŸåŒ¿åé€šä¿¡ class="relative group">é«˜å»¶è¿ŸåŒ¿åé€šä¿¡ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%ab%98%e5%bb%b6%e8%bf%9f%e5%8c%bf%e5%90%8d%e9%80%9a%e4%bf%a1 aria-label=é”šç‚¹>#</a></span></h3><p>Mix æ˜¯ä¸€ç§é«˜å»¶è¿ŸåŒ¿åé€šä¿¡æœºåˆ¶ï¼Œå®é™…ä¸Šå°±æ˜¯å‘é€è€…å°†æ¶ˆæ¯éƒ½å‘åˆ°ä¸€ä¸ªå«åš Mix çš„é»‘ç›’å­é‡Œï¼Œéšåæ¶ˆæ¯ä»é»‘ç›’å­é‡Œå‡ºæ¥ï¼Œå†å‘é€åˆ°æ¥æ”¶è€…ã€‚å¦‚æœ Mix å¯ä»¥æŠµæŠ—æµé‡åˆ†æå¹¶æä¾›æ¯”ç‰¹çº§çš„ä¸å¯å…³è”æ€§ï¼Œé‚£ä¹ˆå°±èƒ½ä¿è¯åŒ¿åæ€§äº†ã€‚</p><p>Alice ç”¨ Mix å…¬é’¥åŠ å¯†æ¶ˆæ¯åå‘é€ç»™ Mixï¼Œéšå Mix è§£å¯†å¹¶å‘é€ç»™ Bobã€‚ç”±äºä»»ä½•äººéƒ½å¯ä»¥ç»™ Mix å‘æ¶ˆæ¯ï¼Œè€Œ Mix çš„æ¨¡å¼å®é™…ä¸Šä¸ºæ”»å‡»è€…æä¾›äº†ä¸€ä¸ªè§£å¯† Oracleï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¿®æ”¹è¾“å…¥æ¥è¿›è¡Œé€‰æ‹©å¯†æ–‡æ”»å‡»ï¼Œè¿™å°±è¦æ±‚åŠ å¯†æœºåˆ¶æ˜¯ IND-CCA çš„ã€‚å¦åˆ™ï¼Œæ”»å‡»è€…å°±å¯ä»¥å…³è”è¾“å…¥å’Œè¾“å‡ºï¼Œç ´åæ¯”ç‰¹ä¸å¯å…³è”æ€§ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ Mix é‡‡ç”¨ FIFO æ–¹å¼æ¥æ”¶å’Œå‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ”»å‡»è€…åªéœ€è¦è¿›è¡Œæµé‡åˆ†æå°±èƒ½ç®€å•åœ°å…³è”è¾“å…¥å’Œè¾“å‡ºäº†ï¼Œæ­¤æ—¶ Mix æ˜¯ä¸èƒ½æŠµæŠ—æµé‡åˆ†æçš„ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæŠ—æµé‡åˆ†æä¿æŠ¤å…ƒæ•°æ®ï¼Œè€Œæ¯”ç‰¹ä¸å¯å…³è”æ€§ä¿æŠ¤æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œé¡¾åæ€ä¹‰ï¼ŒMix éœ€è¦åƒæ´—ç‰Œä¸€æ ·æ‰“ä¹±æ”¶åˆ°çš„æ¶ˆæ¯å¹¶éšæœºè¾“å‡ºï¼Œåœ¨ Mix å†…éƒ¨ä¹Ÿéœ€è¦ä¸€ä¸ªæ¶ˆæ¯æ± æ¥æš‚å­˜è¿˜æ²¡æœ‰å‘å‡ºå»çš„æ¶ˆæ¯ï¼Œé€šè¿‡å»¶è¿Ÿã€æ•…æ„æ’å…¥æ— ç”¨åŒ…ã€æ•…æ„ä¸¢åŒ…ç­‰æ‰‹æ®µæŠµæŠ—æµé‡åˆ†æï¼Œè¿™å°±æ˜¯é«˜å»¶è¿Ÿçš„ç”±æ¥ã€‚</p><h4 id=å•ä¸ª-mix class="relative group">å•ä¸ª Mix <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%8d%95%e4%b8%aa-mix aria-label=é”šç‚¹>#</a></span></h4><p>æ¥ä¸‹æ¥æ¥æ„å»ºè¿™æ ·çš„é»‘ç›’å­ï¼Œé¦–å…ˆæ˜¯ Mix Server éƒ¨åˆ†ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; A helper function that implements AES Counter (CTR) Mode encryption and decryption.
</span></span></span><span class=line><span class=cl><span class=s2>    Expects a key (16 byte), and IV (16 bytes) and an input plaintext / ciphertext.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    If it is not obvious convince yourself that CTR encryption and decryption are in
</span></span></span><span class=line><span class=cl><span class=s2>    fact the same operations.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=s2>&#34;AES-128-CTR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>enc</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>enc</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span> <span class=o>=</span> <span class=n>enc</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span> <span class=o>+=</span> <span class=n>enc</span><span class=o>.</span><span class=n>finalize</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>output</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># This is the type of messages destined for the one-hop mix</span>
</span></span><span class=line><span class=cl><span class=n>OneHopMixMessage</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s1>&#39;OneHopMixMessage&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;ec_public_key&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                   <span class=s1>&#39;hmac&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                   <span class=s1>&#39;address&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                   <span class=s1>&#39;message&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_server_one_hop</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>message_list</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Implements the decoding for a simple one-hop mix.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Each message is decoded in turn:
</span></span></span><span class=line><span class=cl><span class=s2>        - A shared key is derived from the message public key and the mix private_key.
</span></span></span><span class=line><span class=cl><span class=s2>        - the hmac is checked against all encrypted parts of the message
</span></span></span><span class=line><span class=cl><span class=s2>        - the address and message are decrypted, decoded and returned
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>out_queue</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Process all messages</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>message_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Check elements and lengths</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>G</span><span class=o>.</span><span class=n>check_point</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>ec_public_key</span><span class=p>)</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>hmac</span><span class=p>)</span> <span class=o>==</span> <span class=mi>20</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>address</span><span class=p>)</span> <span class=o>==</span> <span class=mi>258</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>message</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1002</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Malformed input message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># First get a shared key</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_element</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>msg</span><span class=o>.</span><span class=n>ec_public_key</span>
</span></span><span class=line><span class=cl>        <span class=n>key_material</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>shared_element</span><span class=o>.</span><span class=n>export</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Use different parts of the shared key for different operations</span>
</span></span><span class=line><span class=cl>        <span class=n>hmac_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>address_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>message_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Check the HMAC</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>Hmac</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;sha512&#34;</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>expected_mac</span> <span class=o>=</span> <span class=n>h</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>secure_compare</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>hmac</span><span class=p>,</span> <span class=n>expected_mac</span><span class=p>[:</span><span class=mi>20</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;HMAC check failure&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Decrypt the address and the message</span>
</span></span><span class=line><span class=cl>        <span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>address_plaintext</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>address_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>msg</span><span class=o>.</span><span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>message_plaintext</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>message_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>msg</span><span class=o>.</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Decode the address and message</span>
</span></span><span class=line><span class=cl>        <span class=n>address_len</span><span class=p>,</span> <span class=n>address_full</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;!H256s&#34;</span><span class=p>,</span> <span class=n>address_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>message_len</span><span class=p>,</span> <span class=n>message_full</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;!H1000s&#34;</span><span class=p>,</span> <span class=n>message_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>output</span> <span class=o>=</span> <span class=p>(</span><span class=n>address_full</span><span class=p>[:</span><span class=n>address_len</span><span class=p>],</span> <span class=n>message_full</span><span class=p>[:</span><span class=n>message_len</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>out_queue</span> <span class=o>+=</span> <span class=p>[</span><span class=n>output</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>out_queue</span><span class=p>)</span>
</span></span></code></pre></div><p>æ ¹æ® Mix Server é€»è¾‘ç¼–å†™ Mix Client çš„é€»è¾‘ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_client_one_hop</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>address</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Encode a message to travel through a single mix with a set public key.
</span></span></span><span class=line><span class=cl><span class=s2>    The maximum size of the final address and the message are 256 bytes and 1000 bytes respectively.
</span></span></span><span class=line><span class=cl><span class=s2>    Returns an &#39;OneHopMixMessage&#39; with four parts: a public key, an HMAC (20 bytes),
</span></span></span><span class=line><span class=cl><span class=s2>    an address ciphertext (256 + 2 bytes) and a message ciphertext (1002 bytes).
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>G</span><span class=o>.</span><span class=n>check_point</span><span class=p>(</span><span class=n>public_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>address</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Encode the address and message</span>
</span></span><span class=line><span class=cl>    <span class=c1># Use those as the payload for encryption</span>
</span></span><span class=line><span class=cl>    <span class=n>address_plaintext</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;!H256s&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>address</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message_plaintext</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;!H1000s&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>),</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate a fresh public key</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>client_public_key</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># First get a shared key</span>
</span></span><span class=line><span class=cl>    <span class=n>shared_element</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>public_key</span>  <span class=c1># client&#39;s priv and mix&#39;s pub</span>
</span></span><span class=line><span class=cl>    <span class=n>key_material</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>shared_element</span><span class=o>.</span><span class=n>export</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Use different parts of the shared key for different operations</span>
</span></span><span class=line><span class=cl>    <span class=n>hmac_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>address_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>message_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Encrypt the address and the message</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>address_cipher</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>address_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>address_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message_cipher</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>message_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>message_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate HMAC tag</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=n>Hmac</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;sha512&#34;</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>address_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>expected_mac</span> <span class=o>=</span> <span class=n>h</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>20</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>OneHopMixMessage</span><span class=p>(</span><span class=n>client_public_key</span><span class=p>,</span> <span class=n>expected_mac</span><span class=p>,</span> <span class=n>address_cipher</span><span class=p>,</span> <span class=n>message_cipher</span><span class=p>)</span>
</span></span></code></pre></div><p>æµ‹è¯•æ¶ˆæ¯èƒ½å¦æ­£å¸¸å‘é€å’Œæ¥æ”¶ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>fixture</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode_Alice_message</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Encode a single message
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>mix_client_one_hop</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;Alice&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;Dear Alice,</span><span class=se>\n</span><span class=s2>Hello!</span><span class=se>\n</span><span class=s2>Bob&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>private_key</span><span class=p>,</span> <span class=n>m1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_Alice_message_overlong</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test overlong address or message
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mix_client_one_hop</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>1000</span><span class=p>),</span> <span class=sa>b</span><span class=s2>&#34;Dear Alice,</span><span class=se>\n</span><span class=s2>Hello!</span><span class=se>\n</span><span class=s2>Bob&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>mix_client_one_hop</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;Alice&#34;</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>10000</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_simple_client_part_type</span><span class=p>(</span><span class=n>encode_Alice_message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span><span class=p>,</span> <span class=n>Alice_message</span> <span class=o>=</span> <span class=n>encode_Alice_message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Ensure the client encodes a NamedTuple of type &#34;OneHopMixMessage&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>Alice_message</span><span class=p>,</span> <span class=nb>tuple</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>Alice_message</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>Alice_message</span><span class=o>.</span><span class=n>ec_public_key</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>Alice_message</span><span class=o>.</span><span class=n>hmac</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>Alice_message</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>Alice_message</span><span class=o>.</span><span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_simple_client_decode</span><span class=p>(</span><span class=n>encode_Alice_message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span><span class=p>,</span> <span class=n>Alice_message</span> <span class=o>=</span> <span class=n>encode_Alice_message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Ensure the mix can decode the message correctly</span>
</span></span><span class=line><span class=cl>    <span class=n>res1</span> <span class=o>=</span> <span class=n>mix_server_one_hop</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=p>[</span><span class=n>Alice_message</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>res1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>res1</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=sa>b</span><span class=s2>&#34;Alice&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>res1</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=sa>b</span><span class=s2>&#34;Dear Alice,</span><span class=se>\n</span><span class=s2>Hello!</span><span class=se>\n</span><span class=s2>Bob&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_simple_client_decode_many</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>messages</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>m</span> <span class=o>=</span> <span class=n>mix_client_one_hop</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>256</span><span class=p>),</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>1000</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>messages</span> <span class=o>+=</span> <span class=p>[</span><span class=n>m</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Ensure the mix can decode the message correctly</span>
</span></span><span class=line><span class=cl>    <span class=n>res1</span> <span class=o>=</span> <span class=n>mix_server_one_hop</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>messages</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>res1</span><span class=p>)</span> <span class=o>==</span> <span class=mi>100</span>
</span></span></code></pre></div><h4 id=å¤šä¸ª-mix class="relative group">å¤šä¸ª Mix <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%a4%9a%e4%b8%aa-mix aria-label=é”šç‚¹>#</a></span></h4><p>ä¸ºäº†åˆ†æ•£è´Ÿè½½å’Œä¿¡ä»»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ª Mixã€‚å¯ä»¥ç”¨çº§è”æ–¹å¼å¢å¼ºåŒ¿åæ€§ï¼ˆå¼±è´Ÿè½½å‡è¡¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨è‡ªç”±è·¯ç”±æ–¹å¼éšæœºé€‰ä¸€äº› Mix æ¥ä¼ é€’æ¶ˆæ¯ï¼Œæ­¤æ—¶å®‰å…¨æ€§å–å†³äºè·¯å¾„é•¿åº¦ã€‚</p><p>æ—¢ç„¶ç›®çš„ä¹‹ä¸€æ˜¯åˆ†æ•£ä¿¡ä»»ï¼Œå°±è¦è€ƒè™‘å¦‚æœæŸä¸ª Mix è¢« corrupt äº†æ€ä¹ˆåŠã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ä¸ä»…è¦å¯¹ç›‘å¬è€…ã€è¿˜è¦å¯¹ Mix æœ¬èº«éšè—è·¯å¾„é•¿åº¦ä»¥åŠå½“å‰æ­¥æ•°ã€‚ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ–¹æ³•å°±æ˜¯åµŒå¥—åŠ å¯†ï¼Œä½¿å¾— Mix ä½¿ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†æ—¶åªèƒ½çŸ¥é“æ¶ˆæ¯ä»å“ªæ¥åˆ°å“ªå»ï¼Œæ— æ³•äº†è§£å…¨å±€çš„è·¯å¾„ä¿¡æ¯ã€‚</p><p>åœ¨ä»£ç å®ç°ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ blinding factor éšè—å…¬é’¥ä¿¡æ¯ï¼Œå¹¶é‡‡ç”¨çº§è” HMAC æ¥æ£€æµ‹æ¶ˆæ¯ç¯¡æ”¹ï¼Œå°¤å…¶éœ€è¦æ³¨æ„çš„æ˜¯ blinding factor å’Œ HMAC çš„å¤„ç†é¡ºåºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># This is the type of messages destined for the n-hop mix</span>
</span></span><span class=line><span class=cl><span class=n>NHopMixMessage</span> <span class=o>=</span> <span class=n>namedtuple</span><span class=p>(</span><span class=s1>&#39;NHopMixMessage&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;ec_public_key&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=s1>&#39;hmacs&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=s1>&#39;address&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                               <span class=s1>&#39;message&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_server_n_hop</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=n>message_list</span><span class=p>,</span> <span class=n>final</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Decodes a NHopMixMessage message and outputs either messages destined
</span></span></span><span class=line><span class=cl><span class=s2>    to the next mix or a list of tuples (address, message) (if final=True) to be
</span></span></span><span class=line><span class=cl><span class=s2>    sent to their final recipients.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Broadly speaking the mix will process each message in turn:
</span></span></span><span class=line><span class=cl><span class=s2>        - it derives a shared key (using its private_key),
</span></span></span><span class=line><span class=cl><span class=s2>        - checks the first hmac,
</span></span></span><span class=line><span class=cl><span class=s2>        - decrypts all other parts,
</span></span></span><span class=line><span class=cl><span class=s2>        - either forwards or decodes the message.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>out_queue</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Process all messages</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>message_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Check elements and lengths</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>G</span><span class=o>.</span><span class=n>check_point</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>ec_public_key</span><span class=p>)</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>hmacs</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>hmacs</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>==</span> <span class=mi>20</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>address</span><span class=p>)</span> <span class=o>==</span> <span class=mi>258</span> <span class=ow>or</span> \
</span></span><span class=line><span class=cl>                <span class=ow>not</span> <span class=nb>len</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>message</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1002</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Malformed input message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># First get a shared key</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_element</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>msg</span><span class=o>.</span><span class=n>ec_public_key</span>
</span></span><span class=line><span class=cl>        <span class=n>key_material</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>shared_element</span><span class=o>.</span><span class=n>export</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Use different parts of the shared key for different operations</span>
</span></span><span class=line><span class=cl>        <span class=n>hmac_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>address_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>32</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>message_key</span> <span class=o>=</span> <span class=n>key_material</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Extract a blinding factor for the public_key</span>
</span></span><span class=line><span class=cl>        <span class=n>blinding_factor</span> <span class=o>=</span> <span class=n>Bn</span><span class=o>.</span><span class=n>from_binary</span><span class=p>(</span><span class=n>key_material</span><span class=p>[</span><span class=mi>48</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=n>new_ec_public_key</span> <span class=o>=</span> <span class=n>blinding_factor</span> <span class=o>*</span> <span class=n>msg</span><span class=o>.</span><span class=n>ec_public_key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Check the HMAC</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>Hmac</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;sha512&#34;</span><span class=p>,</span> <span class=n>hmac_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>other_mac</span> <span class=ow>in</span> <span class=n>msg</span><span class=o>.</span><span class=n>hmacs</span><span class=p>[</span><span class=mi>1</span><span class=p>:]:</span>
</span></span><span class=line><span class=cl>            <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>other_mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>expected_mac</span> <span class=o>=</span> <span class=n>h</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>secure_compare</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>hmacs</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>expected_mac</span><span class=p>[:</span><span class=mi>20</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;HMAC check failure&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Decrypt the hmacs, address and the message</span>
</span></span><span class=line><span class=cl>        <span class=n>aes</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>(</span><span class=s2>&#34;AES-128-CTR&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Decrypt hmacs</span>
</span></span><span class=line><span class=cl>        <span class=n>new_hmacs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>other_mac</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>msg</span><span class=o>.</span><span class=n>hmacs</span><span class=p>[</span><span class=mi>1</span><span class=p>:]):</span>
</span></span><span class=line><span class=cl>            <span class=c1># Ensure the IV is different for each hmac</span>
</span></span><span class=line><span class=cl>            <span class=n>iv</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;H14s&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>hmac_plaintext</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>hmac_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>other_mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>new_hmacs</span> <span class=o>+=</span> <span class=p>[</span><span class=n>hmac_plaintext</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Decrypt address &amp; message</span>
</span></span><span class=line><span class=cl>        <span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span> <span class=o>*</span> <span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>address_plaintext</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>address_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>msg</span><span class=o>.</span><span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>message_plaintext</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>message_key</span><span class=p>,</span> <span class=n>iv</span><span class=p>,</span> <span class=n>msg</span><span class=o>.</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>final</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Decode the address and message</span>
</span></span><span class=line><span class=cl>            <span class=n>address_len</span><span class=p>,</span> <span class=n>address_full</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;!H256s&#34;</span><span class=p>,</span> <span class=n>address_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>message_len</span><span class=p>,</span> <span class=n>message_full</span> <span class=o>=</span> <span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;!H1000s&#34;</span><span class=p>,</span> <span class=n>message_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>out_msg</span> <span class=o>=</span> <span class=p>(</span><span class=n>address_full</span><span class=p>[:</span><span class=n>address_len</span><span class=p>],</span> <span class=n>message_full</span><span class=p>[:</span><span class=n>message_len</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>out_queue</span> <span class=o>+=</span> <span class=p>[</span><span class=n>out_msg</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Pass the new mix message to the next mix</span>
</span></span><span class=line><span class=cl>            <span class=n>out_msg</span> <span class=o>=</span> <span class=n>NHopMixMessage</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>new_ec_public_key</span><span class=p>,</span> <span class=n>new_hmacs</span><span class=p>,</span> <span class=n>address_plaintext</span><span class=p>,</span> <span class=n>message_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>out_queue</span> <span class=o>+=</span> <span class=p>[</span><span class=n>out_msg</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>out_queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mix_client_n_hop</span><span class=p>(</span><span class=n>public_keys</span><span class=p>,</span> <span class=n>address</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Encode a message to travel through a sequence of mixes with a sequence public keys.
</span></span></span><span class=line><span class=cl><span class=s2>    The maximum size of the final address and the message are 256 bytes and 1000 bytes respectively.
</span></span></span><span class=line><span class=cl><span class=s2>    Returns an &#39;NHopMixMessage&#39; with four parts: a public key, a list of hmacs (20 bytes each),
</span></span></span><span class=line><span class=cl><span class=s2>    an address ciphertext (256 + 2 bytes) and a message ciphertext (1002 bytes).
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># assert G.check_point(public_key)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>address</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>address</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=nb>bytes</span><span class=p>)</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Encode the address and message</span>
</span></span><span class=line><span class=cl>    <span class=c1># use those encoded values as the payload you encrypt!</span>
</span></span><span class=line><span class=cl>    <span class=n>address_plaintext</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;!H256s&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>address</span><span class=p>),</span> <span class=n>address</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message_plaintext</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;!H1000s&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>),</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate a fresh public key</span>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>client_public_key</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>hmacs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>hmac_keys</span><span class=p>,</span> <span class=n>address_keys</span><span class=p>,</span> <span class=n>message_keys</span> <span class=o>=</span> <span class=p>[],</span> <span class=p>[],</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>blinding_factor</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Preprocess the keys</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>pubkey</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>public_keys</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># First get a shared key</span>
</span></span><span class=line><span class=cl>        <span class=n>shared_element</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>blinding_factor</span> <span class=o>*</span> <span class=n>pubkey</span>
</span></span><span class=line><span class=cl>        <span class=n>key_material</span> <span class=o>=</span> <span class=n>sha512</span><span class=p>(</span><span class=n>shared_element</span><span class=o>.</span><span class=n>export</span><span class=p>())</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=c1># Use different parts of the shared key for different operations</span>
</span></span><span class=line><span class=cl>        <span class=n>hmac_keys</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>key_material</span><span class=p>[:</span><span class=mi>16</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>address_keys</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>key_material</span><span class=p>[</span><span class=mi>16</span><span class=p>:</span><span class=mi>32</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>message_keys</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>key_material</span><span class=p>[</span><span class=mi>32</span><span class=p>:</span><span class=mi>48</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=c1># Update blinding factor for next round</span>
</span></span><span class=line><span class=cl>        <span class=n>blinding_factor</span> <span class=o>=</span> <span class=n>blinding_factor</span> <span class=o>*</span> <span class=n>Bn</span><span class=o>.</span><span class=n>from_binary</span><span class=p>(</span><span class=n>key_material</span><span class=p>[</span><span class=mi>48</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>hmac_keys</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=mi>16</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Traverse the mix server in reversed order</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Encrypt address &amp; message</span>
</span></span><span class=line><span class=cl>        <span class=n>address_cipher</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>address_keys</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>iv</span><span class=p>,</span> <span class=n>address_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>message_cipher</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>message_keys</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>iv</span><span class=p>,</span> <span class=n>message_plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Encrypt other HMAC tags, each with a different IV</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>j</span><span class=p>,</span> <span class=n>other_mac</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>hmacs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>iv</span> <span class=o>=</span> <span class=n>pack</span><span class=p>(</span><span class=s2>&#34;H14s&#34;</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=o>*</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>hmacs</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>aes_ctr_enc_dec</span><span class=p>(</span><span class=n>hmac_keys</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>iv</span><span class=p>,</span> <span class=n>other_mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Generate HMAC tag and insert to the beginning of hmacs</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span> <span class=o>=</span> <span class=n>Hmac</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;sha512&#34;</span><span class=p>,</span> <span class=n>hmac_keys</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>other_mac</span> <span class=ow>in</span> <span class=n>hmacs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>other_mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>address_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>message_cipher</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>expected_mac</span> <span class=o>=</span> <span class=n>h</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>20</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>hmacs</span><span class=o>.</span><span class=n>insert</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>expected_mac</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Update address &amp; message for next round</span>
</span></span><span class=line><span class=cl>        <span class=n>address_plaintext</span> <span class=o>=</span> <span class=n>address_cipher</span>
</span></span><span class=line><span class=cl>        <span class=n>message_plaintext</span> <span class=o>=</span> <span class=n>message_cipher</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>NHopMixMessage</span><span class=p>(</span><span class=n>client_public_key</span><span class=p>,</span> <span class=n>hmacs</span><span class=p>,</span> <span class=n>address_cipher</span><span class=p>,</span> <span class=n>message_cipher</span><span class=p>)</span>
</span></span></code></pre></div><p>ç„¶åæµ‹è¯•ä¸€ä¸‹ 1 è·³å’Œ 3 è·³ä¸¤ç§æƒ…å†µä¸‹çš„æ­£ç¡®æ€§ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_Alice_encode_1_hop</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test sending a multi-hop message through 1-hop
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private_key</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>public_key</span> <span class=o>=</span> <span class=n>private_key</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>address</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Alice&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Dear Alice,</span><span class=se>\n</span><span class=s2>Hello!</span><span class=se>\n</span><span class=s2>Bob&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>mix_client_n_hop</span><span class=p>([</span><span class=n>public_key</span><span class=p>],</span> <span class=n>address</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=n>mix_server_n_hop</span><span class=p>(</span><span class=n>private_key</span><span class=p>,</span> <span class=p>[</span><span class=n>m1</span><span class=p>],</span> <span class=n>final</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>out</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>address</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>message</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_Alice_encode_3_hop</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Test sending a multi-hop message through 1-hop
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>generator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>private_keys</span> <span class=o>=</span> <span class=p>[</span><span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=n>public_keys</span> <span class=o>=</span> <span class=p>[</span><span class=n>pk</span> <span class=o>*</span> <span class=n>g</span> <span class=k>for</span> <span class=n>pk</span> <span class=ow>in</span> <span class=n>private_keys</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>address</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Alice&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;Dear Alice,</span><span class=se>\n</span><span class=s2>Hello!</span><span class=se>\n</span><span class=s2>Bob&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>m1</span> <span class=o>=</span> <span class=n>mix_client_n_hop</span><span class=p>(</span><span class=n>public_keys</span><span class=p>,</span> <span class=n>address</span><span class=p>,</span> <span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=n>mix_server_n_hop</span><span class=p>(</span><span class=n>private_keys</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=p>[</span><span class=n>m1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=n>mix_server_n_hop</span><span class=p>(</span><span class=n>private_keys</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>out</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>out</span> <span class=o>=</span> <span class=n>mix_server_n_hop</span><span class=p>(</span><span class=n>private_keys</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>out</span><span class=p>,</span> <span class=n>final</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>out</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>address</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>out</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=n>message</span>
</span></span></code></pre></div><h4 id=æµé‡åˆ†æ class="relative group">æµé‡åˆ†æ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%b5%81%e9%87%8f%e5%88%86%e6%9e%90 aria-label=é”šç‚¹>#</a></span></h4><p>æˆ‘ä»¬é€šè¿‡ä¾‹å­æ¥çœ‹å¦‚ä½•é€šè¿‡ç®€å•çš„æµé‡åˆ†ææ¥æ¨æ–­ä¸€ä¸ªå‘é€è€…å‘é€æ¶ˆæ¯çš„ç›®æ ‡ã€‚é¦–å…ˆéšæœºç”Ÿæˆå¤§é‡å‘é€/æ¥æ”¶æ¶ˆæ¯çš„ traceï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_trace</span><span class=p>(</span><span class=n>number_of_users</span><span class=p>,</span> <span class=n>threshold_size</span><span class=p>,</span> <span class=n>number_of_rounds</span><span class=p>,</span> <span class=n>targets_friends</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generate a simulated trace of traffic. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>target</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=n>others</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>number_of_users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>all_users</span> <span class=o>=</span> <span class=nb>range</span><span class=p>(</span><span class=n>number_of_users</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>trace</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=c1># Generate traces in which Alice (user 0) is not sending</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>number_of_rounds</span> <span class=o>//</span> <span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>senders</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>others</span><span class=p>,</span> <span class=n>threshold_size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>receivers</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>all_users</span><span class=p>,</span> <span class=n>threshold_size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>trace</span> <span class=o>+=</span> <span class=p>[(</span><span class=n>senders</span><span class=p>,</span> <span class=n>receivers</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate traces in which Alice (user 0) is sending</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>number_of_rounds</span> <span class=o>//</span> <span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>senders</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>([</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>others</span><span class=p>,</span> <span class=n>threshold_size</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=c1># Alice sends to a friend</span>
</span></span><span class=line><span class=cl>        <span class=n>friend</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=n>targets_friends</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>receivers</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=n>friend</span><span class=p>]</span> <span class=o>+</span> <span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=n>all_users</span><span class=p>,</span> <span class=n>threshold_size</span> <span class=o>-</span> <span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>trace</span> <span class=o>+=</span> <span class=p>[(</span><span class=n>senders</span><span class=p>,</span> <span class=n>receivers</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>random</span><span class=o>.</span><span class=n>shuffle</span><span class=p>(</span><span class=n>trace</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>trace</span>
</span></span></code></pre></div><p>è¿™é‡Œ Alice ä¹Ÿå°±æ˜¯ user0 ä¼šå‘é€ä¸€äº›æ¶ˆæ¯ç»™å¥¹çš„å¥½å‹ï¼Œè€Œå…¶ä»–ç”¨æˆ·ä¹‹é—´çš„æ¶ˆæ¯æ”¶å‘æ˜¯å®Œå…¨éšæœºçš„ã€‚æˆ‘ä»¬ä¸éš¾å‘ç°ï¼ŒAlice çš„å¥½å‹åº”å½“æ¯”å…¶ä»–ç”¨æˆ·æ¥æ”¶åˆ°äº†æ›´å¤šæ¶ˆæ¯ï¼Œè¿™å°±æ˜¯è¿™æ¬¡æµé‡åˆ†æçš„å…³é”®ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>analyze_trace</span><span class=p>(</span><span class=n>trace</span><span class=p>,</span> <span class=n>target_number_of_friends</span><span class=p>,</span> <span class=n>target</span><span class=o>=</span><span class=mi>0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Given a trace of traffic, and a given number of friends,
</span></span></span><span class=line><span class=cl><span class=s2>    return the list of receiver identifiers that are the most likely
</span></span></span><span class=line><span class=cl><span class=s2>    friends of the target.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>max_users</span> <span class=o>=</span> <span class=mi>100</span>
</span></span><span class=line><span class=cl>    <span class=n>rcv_cnt</span> <span class=o>=</span> <span class=nb>dict</span><span class=o>.</span><span class=n>fromkeys</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>max_users</span><span class=p>),</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=nb>round</span> <span class=ow>in</span> <span class=n>trace</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>senders</span><span class=p>,</span> <span class=n>receivers</span> <span class=o>=</span> <span class=nb>round</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>user</span> <span class=ow>in</span> <span class=n>receivers</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>rcv_cnt</span><span class=p>[</span><span class=n>user</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># sort in descending order according to occurence</span>
</span></span><span class=line><span class=cl>    <span class=n>occur</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>rcv_cnt</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>d</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># select the top [target_number_of_friends] users</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>list</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>occur</span><span class=p>[:</span><span class=n>target_number_of_friends</span><span class=p>]))</span>
</span></span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬æ ¹æ®æ¥æ”¶æ¶ˆæ¯æ¬¡æ•°å¯¹ç”¨æˆ·è¿›è¡Œæ’åºï¼Œå¹¶é€‰æ‹©äº†å‰ <code>target_number_of_friends</code> ä¸ªç”¨æˆ·ï¼Œæ¨æ–­æ˜¯ Alice çš„å¥½å‹ã€‚è¿›è¡Œæµ‹è¯•ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_trace_static</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># A fixed set and number of friends</span>
</span></span><span class=line><span class=cl>    <span class=n>trace</span> <span class=o>=</span> <span class=n>generate_trace</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>friends</span> <span class=o>=</span> <span class=n>analyze_trace</span><span class=p>(</span><span class=n>trace</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>friends</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>friends</span><span class=p>)</span> <span class=o>==</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_trace_variable</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># A random number of friends and random contacts</span>
</span></span><span class=line><span class=cl>    <span class=n>friend_number</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>friends</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>sample</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span> <span class=n>friend_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>trace</span> <span class=o>=</span> <span class=n>generate_trace</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>1000</span><span class=p>,</span> <span class=n>friends</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>TA_friends</span> <span class=o>=</span> <span class=n>analyze_trace</span><span class=p>(</span><span class=n>trace</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>friends</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>TA_friends</span><span class=p>)</span> <span class=o>==</span> <span class=nb>len</span><span class=p>(</span><span class=n>friends</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>TA_friends</span><span class=p>)</span> <span class=o>==</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>friends</span><span class=p>)</span>
</span></span></code></pre></div><p>ç»å¤šæ¬¡å®éªŒï¼Œå‡å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæµ‹è¯•ã€‚</p><h3 id=ä½å»¶è¿ŸåŒ¿åé€šä¿¡ class="relative group">ä½å»¶è¿ŸåŒ¿åé€šä¿¡ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%bd%8e%e5%bb%b6%e8%bf%9f%e5%8c%bf%e5%90%8d%e9%80%9a%e4%bf%a1 aria-label=é”šç‚¹>#</a></span></h3><p>ä¹Ÿå°±æ˜¯ Onion è·¯ç”±ï¼Œæœ€è‘—åçš„ä¾‹å­æ˜¯ Tor ç½‘ç»œã€‚å¦‚æœ Alice è¦å‘é€æ¶ˆæ¯ç»™ Bobï¼Œé‚£ä¹ˆ Alice ä¼šé€‰æ‹© 3 ä¸ª Tor èŠ‚ç‚¹ï¼Œå°†æ¶ˆæ¯ç»ç”±è¿™ 3 ä¸ªèŠ‚ç‚¹å‘é€åˆ° Bobï¼Œè¿™æ ·ä»»æ„èŠ‚ç‚¹éƒ½ä¸çŸ¥é“æ¶ˆæ¯æ˜¯ä» Alice åˆ° Bob çš„ã€‚</p><p>ä¸Šè¿°æ–¹æ³•æä¾›äº†å‘é€è€…åŒ¿åæ€§ï¼Œä½†éœ€è¦ Alice çŸ¥é“ Bob èº«ä»½ã€‚å¦‚æœè¦åŒå‘åŒ¿åï¼Œåˆ™éœ€è¦ 6 ä¸ª Tor èŠ‚ç‚¹ï¼Œä¸¤è¾¹å¯¹ç§°ã€‚</p><p>Tor èŠ‚ç‚¹å°† IPã€å…¬é’¥ç­‰ä¿¡æ¯å…¬å¼€åˆ° Directory Authorities ä¸Šï¼Œåè€…åˆ™ç”Ÿæˆä¸€ä¸ª Consensus ä¾› Tor å®¢æˆ·ç«¯ä¸‹è½½ï¼Œä»è€Œè·å– Tor èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</p><p>å¯¹äºæ”»å‡»è€…æ¥è¯´ï¼Œä¾ç„¶å¯ä»¥ç”¨ç±»ä¼¼ä¾§ä¿¡é“çš„æ–¹å¼æ”»å‡» Onion è·¯ç”±ã€‚ä¸€ç§æ–¹æ³•æ˜¯å°†è¾“å…¥å’Œè¾“å‡ºæ”¾åˆ°æ¡¶ä¸­ï¼Œè®¡ç®—ä¸¤è€…å…³è”ï¼Œä½†æ¡¶çš„å­˜åœ¨ä¼šé™ä½ç²¾ç¡®åº¦ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯æ ¹æ®è¾“å…¥å’ŒåŒ…å»¶è¿Ÿçš„æ¦‚ç‡åˆ†å¸ƒæ„å»ºæ¨¡ç‰ˆï¼Œå¹¶ç”¨è¾“å‡ºå»åŒ¹é…æ¨¡ç‰ˆã€‚å› æ­¤ï¼Œä½å»¶è¿ŸåŒ¿åé€šä¿¡æ›´å®¹æ˜“å—åˆ°è¢«åŠ¨æ”»å‡»ã€‚</p><p>è€Œå¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶éƒ¨åˆ† Tor èŠ‚ç‚¹ï¼Œä¹Ÿä¸ä¸€å®šèƒ½æ§åˆ¶æŸæ¬¡é€šä¿¡çš„æ•´æ¡è·¯å¾„ã€‚å¦‚æœæ”»å‡»è€…æ§åˆ¶äº† Tor ç½‘ç»œä¸­çš„ c ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ•´æ¡è·¯å¾„è¢«æ§åˆ¶çš„æ¦‚ç‡ä¸º O(c^2)ï¼Œå› ä¸ºæ”»å‡»è€…å¿…é¡»æ§åˆ¶ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹æ‰è¡Œã€‚</p><h2 id=éšç§å‹å¥½å‹è®¡ç®—-privacy-friendly-computation class="relative group">éšç§å‹å¥½å‹è®¡ç®— Privacy-friendly Computation <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%9a%90%e7%a7%81%e5%8f%8b%e5%a5%bd%e5%9e%8b%e8%ae%a1%e7%ae%97-privacy-friendly-computation aria-label=é”šç‚¹>#</a></span></h2><p>åœ¨å‰ä¸¤éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å‘ç¬¬ä¸‰æ–¹éšè—éšç§ä¿¡æ¯ï¼Œå¦‚é€šä¿¡å†…å®¹ã€èº«ä»½ç­‰ï¼Œå¹¶ä¸”å·²ç»æœ‰ç±»ä¼¼ TLS å’Œ Tor è¿™ç±»æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œå¦‚æœæ˜¯è¦å‘é€šä¿¡çš„å¯¹æ–¹éšè—ä¿¡æ¯å‘¢ï¼Ÿ</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³è®¡ç®— $y=f(x_1,&mldr;,x_n)$ï¼Œå…¶ä¸­æ¶‰åŠçš„è¾“å…¥ $x_i$ æ¥è‡ª n ä¸ªä¸åŒçš„ä¸»ä½“ï¼Œå¹¶ä¸”æ¯ä¸ªä¸»ä½“éƒ½ä¸å¸Œæœ›åˆ«äººçŸ¥é“è‡ªå·±çš„ $x_i$ã€‚æœ€ç®€å•çš„åŠæ³•æ˜¯å¼•å…¥å¯ä¿¡ç¬¬ä¸‰æ–¹ï¼ˆTTPï¼‰æ¥è®¡ç®— yï¼Œç„¶è€Œä¸”ä¸è®º TTP æœªå¿…å­˜åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»å¾—è€ƒè™‘ 4C é—®é¢˜ï¼š</p><ul><li>Costï¼šTTP è¦èŠ±å¤šå°‘é’±ï¼Ÿ</li><li>Corruptionï¼šTTP çœŸçš„å¯ä¿¡å—ï¼Ÿ</li><li>Compulsionï¼šTTP æœ‰æ²¡æœ‰å¯èƒ½å—åˆ°ä¸å¯æŠ—åŠ›å½±å“ï¼ˆå¦‚æ³•å¾‹ï¼‰æ³„éœ²éšç§ï¼Ÿ</li><li>Compromiseï¼šTTP æœ‰æ²¡æœ‰å¯èƒ½è¢«å…¥ä¾µä»è€Œæ³„éœ²éšç§ï¼Ÿ</li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯„å¸Œæœ›äº TTP å¹¶ä¸æ˜æ™ºï¼Œä¸è¿‡è¿™å¯ä»¥ä½œä¸ºä¸€ä¸ªå¾ˆå¥½çš„æ¯”è¾ƒæ ‡å‡†ï¼Œå³æˆ‘ä»¬è®¾è®¡çš„æ–¹æ¡ˆåº”å°½å¯èƒ½æ¥è¿‘å¼•å…¥ TTP æ‰€èƒ½è¾¾åˆ°çš„æ•ˆæœã€‚</p><h3 id=åŒæ€åŠ å¯† class="relative group">åŒæ€åŠ å¯† <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%90%8c%e6%80%81%e5%8a%a0%e5%af%86 aria-label=é”šç‚¹>#</a></span></h3><p>ä¸€ç§æ–¹æ³•æ˜¯åŒæ€åŠ å¯†ï¼Œå³å¯¹å¯†æ–‡çš„è¿ç®—ç­‰åŒäºå¯¹æ˜æ–‡çš„è¿ç®—ï¼Œæ­¤æ—¶å¯ä»¥åœ¨ä¸çŸ¥é“æ˜æ–‡çš„æƒ…å†µä¸‹è®¡ç®—å‡ºç»è¿‡è¿ç®—çš„æ˜æ–‡æ‰€å¯¹åº”çš„å¯†æ–‡ã€‚ä»¥ ElGamal ä¸ºä¾‹ï¼Œæˆ‘ä»¬é€‰æ‹©ç¾¤ $G$ ä¸­çš„ä¸¤ä¸ªå…ƒç´  $g,h$ï¼Œéšæœºç”Ÿæˆ $x\in(0,ord(G))$ ä½œä¸ºç§é’¥ï¼Œé‚£ä¹ˆå…¬é’¥å°±æ˜¯ $g^x$ã€‚éšåå†é€‰æ‹©éšæœºçš„ $k\in(0,ord(G))$ï¼Œè®¡ç®—å¯†æ–‡ $E(m,k)=(g^k,g^{xk}h^m)$ã€‚</p><p>è§£å¯†æ—¶ï¼Œå¯¹äºå¯†æ–‡ $(a,b)$ï¼Œåªéœ€è®¡ç®— $m=log_h(b(a^x)^{-1})$ã€‚ç„¶è€Œç¦»æ•£å¯¹æ•°é—®é¢˜æ˜¯å›°éš¾çš„ï¼Œå› æ­¤å¯ä»¥å…ˆç¦»çº¿è®¡ç®—ä¸€å¼  $log_h$ è¡¨æ ¼ï¼ˆè¿™å°±è¦æ±‚æ˜æ–‡ç©ºé—´ä¸èƒ½å¤ªå¤§ï¼‰ã€‚æ­£ç¡®æ€§æ˜“è¯ï¼ŒåŒæ€æ€§åˆ™åŒ…å«åŠ æ³•å’Œå¸¸æ•°ä¹˜æ³•åŒæ€ï¼š</p><p>$$
E(m_0,k_0)=(a_0,b_0)\\
E(m_1,k_1)=(a_1,b_1)\\
E(m_0+m_1,k_0+k_1)=(a_0a_1,b_0b_1)=(g^{k0+k1},g^{x(k0+k1)}h^{m0+m1})\\
E(cm_0, ck_0)=((a_0)^c,(b_0)^c)
$$</p><blockquote><p>åªæ»¡è¶³å¸¸æ•°ä¹˜æ³•åŒæ€ï¼Œä¸æ»¡è¶³ä¹˜æ³•åŒæ€ã€‚</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨æ¤­åœ†æ›²çº¿ä¸Šå®ç° Elgamalã€‚éœ€è¦æ³¨æ„ä¸Šæ–‡æåˆ°çš„è¿ç®—é™é˜¶é—®é¢˜ï¼Œå…¬é’¥å˜æˆäº† $xg$ï¼Œå¯†æ–‡ä¸º $(kg,kxg+mh)$ï¼Œè§£å¯†æ—¶è®¡ç®— $log_h(b-xa)$ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_encrypt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=o>-</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=o>-</span><span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>raises</span><span class=p>(</span><span class=ne>Exception</span><span class=p>)</span> <span class=k>as</span> <span class=n>excinfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_decrypt</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>2</span><span class=p>))</span> <span class=o>==</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=o>-</span><span class=mi>2</span><span class=p>))</span> <span class=o>==</span> <span class=o>-</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>99</span><span class=p>))</span> <span class=o>==</span> <span class=mi>99</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>setup</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generates the Cryptosystem Parameters.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span> <span class=o>=</span> <span class=n>EcGroup</span><span class=p>(</span><span class=n>nid</span><span class=o>=</span><span class=mi>713</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>g</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>hash_to_point</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;g&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>hash_to_point</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;h&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generate a private / public key pair &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>priv</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>priv</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>m</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Encrypt a message under the public key &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=o>-</span><span class=mi>100</span> <span class=o>&lt;</span> <span class=n>m</span> <span class=o>&lt;</span> <span class=mi>100</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;Message value to low or high.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>k</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1># (g^k, (pub^k)*(h^m))</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=p>(</span><span class=n>k</span><span class=o>*</span><span class=n>g</span><span class=p>,</span> <span class=n>k</span><span class=o>*</span><span class=n>pub</span> <span class=o>+</span> <span class=n>m</span><span class=o>*</span><span class=n>h</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>isCiphertext</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Check a ciphertext &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span><span class=p>)</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>&amp;=</span> <span class=n>G</span><span class=o>.</span><span class=n>check_point</span><span class=p>(</span><span class=n>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ret</span> <span class=o>&amp;=</span> <span class=n>G</span><span class=o>.</span><span class=n>check_point</span><span class=p>(</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ret</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>_logh</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>logh</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>hm</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Compute a discrete log, for small number only &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>_logh</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Initialize the map of logh</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>_logh</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>_logh</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>1000</span><span class=p>,</span> <span class=mi>1000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>_logh</span><span class=p>[(</span><span class=n>m</span> <span class=o>*</span> <span class=n>h</span><span class=p>)]</span> <span class=o>=</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>hm</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>_logh</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s2>&#34;No decryption found.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>_logh</span><span class=p>[</span><span class=n>hm</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Decrypt a message using the private key &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>isCiphertext</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># b * (a^priv)^(-1)</span>
</span></span><span class=line><span class=cl>    <span class=n>hm</span> <span class=o>=</span> <span class=n>b</span> <span class=o>-</span> <span class=n>priv</span><span class=o>*</span><span class=n>a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>logh</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>hm</span><span class=p>)</span>
</span></span></code></pre></div><p>éšåï¼Œç¼–å†™åŒæ€åŠ å¯†å‡½æ•°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_add</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>one</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>two</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>three</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>one</span><span class=p>,</span> <span class=n>two</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>three</span><span class=p>)</span> <span class=o>==</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Try it for a range of numbers</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>Ex</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>E2x</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>Ex</span><span class=p>,</span> <span class=n>Ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>E2x</span><span class=p>)</span> <span class=o>==</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_mul</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>two</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>three</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>two</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>three</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Try it for a range of numbers</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=o>-</span><span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>Ex</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>E2x</span> <span class=o>=</span> <span class=n>mul</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>Ex</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>E2x</span><span class=p>)</span> <span class=o>==</span> <span class=mi>20</span> <span class=o>*</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>c2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Given two ciphertexts compute the ciphertext of the
</span></span></span><span class=line><span class=cl><span class=s2>        sum of their plaintexts.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>isCiphertext</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>c1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>isCiphertext</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a1</span><span class=p>,</span> <span class=n>b1</span> <span class=o>=</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>    <span class=n>a2</span><span class=p>,</span> <span class=n>b2</span> <span class=o>=</span> <span class=n>c2</span>
</span></span><span class=line><span class=cl>    <span class=n>c3</span> <span class=o>=</span> <span class=p>(</span><span class=n>a1</span><span class=o>+</span><span class=n>a2</span><span class=p>,</span> <span class=n>b1</span><span class=o>+</span><span class=n>b2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>mul</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>c1</span><span class=p>,</span> <span class=n>alpha</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Given a ciphertext compute the ciphertext of the
</span></span></span><span class=line><span class=cl><span class=s2>        product of the plaintext time alpha &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>isCiphertext</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>c1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a1</span><span class=p>,</span> <span class=n>b1</span> <span class=o>=</span> <span class=n>c1</span>
</span></span><span class=line><span class=cl>    <span class=n>c3</span> <span class=o>=</span> <span class=p>(</span><span class=n>alpha</span> <span class=o>*</span> <span class=n>a1</span><span class=p>,</span> <span class=n>alpha</span> <span class=o>*</span> <span class=n>b1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c3</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è§£å†³å¤šæ–¹å‚ä¸è®¡ç®—çš„é—®é¢˜ã€‚æˆ‘ä»¬æ ¹æ®å¤šæ–¹å…¬é’¥ï¼Œç”Ÿæˆå…¬å…±å…¬é’¥ã€‚åœ¨æ•´æ•°åŸŸè¡¨ç¤ºä¸º $g^{x_1+&mldr;+x_n}$ï¼Œåœ¨æ¤­åœ†æ›²çº¿ä¸Šåˆ™æ˜¯ $x_1g+&mldr;+x_ng$ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_groupKey</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span><span class=p>)</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate a group key</span>
</span></span><span class=line><span class=cl>    <span class=n>priv1</span><span class=p>,</span> <span class=n>pub1</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv2</span><span class=p>,</span> <span class=n>pub2</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>groupKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=p>[</span><span class=n>pub1</span><span class=p>,</span> <span class=n>pub2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Check it is valid</span>
</span></span><span class=line><span class=cl>    <span class=n>priv</span> <span class=o>=</span> <span class=p>(</span><span class=n>priv1</span> <span class=o>+</span> <span class=n>priv2</span><span class=p>)</span> <span class=o>%</span> <span class=n>o</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>groupKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pubKeys</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generate a group public key from a list of public keys &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>pubKeys</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pubKeys</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>infinite</span><span class=p>()</span>  <span class=c1># 0 elem</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pubKey</span> <span class=ow>in</span> <span class=n>pubKeys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pub</span> <span class=o>=</span> <span class=n>pubKey</span> <span class=o>+</span> <span class=n>pub</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pub</span>
</span></span></code></pre></div><p>éšåè¿›è¡Œéƒ¨åˆ†è§£å¯†ï¼Œæœ€åä¸€ä¸ªè§£å¯†çš„äººè¾“å‡ºæ˜æ–‡ã€‚åœ¨æ•´æ•°åŸŸè¡¨ç¤ºä¸º $b\cdot a^{-x_1}\cdot &mldr;\cdot a^{-x_n}$ï¼Œåœ¨æ¤­åœ†æ›²çº¿ä¸Šè¡¨ç¤ºä¸º $b-x_1a-&mldr;-x_na$ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_partial</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span><span class=p>)</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate a group key</span>
</span></span><span class=line><span class=cl>    <span class=n>priv1</span><span class=p>,</span> <span class=n>pub1</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv2</span><span class=p>,</span> <span class=n>pub2</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>groupKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=p>[</span><span class=n>pub1</span><span class=p>,</span> <span class=n>pub2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Each authority decrypts in turn</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cprime</span> <span class=o>=</span> <span class=n>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv1</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv2</span><span class=p>,</span> <span class=n>cprime</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>m</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>final</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Given a ciphertext and a private key, perform partial decryption.
</span></span></span><span class=line><span class=cl><span class=s2>        If final is True, then return the plaintext. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>isCiphertext</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>a1</span><span class=p>,</span> <span class=n>b1</span> <span class=o>=</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>    <span class=n>b1</span> <span class=o>=</span> <span class=n>b1</span> <span class=o>-</span> <span class=n>priv</span><span class=o>*</span><span class=n>a1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>final</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>logh</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>b1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>a1</span><span class=p>,</span> <span class=n>b1</span>
</span></span></code></pre></div><p>ç°åœ¨å‡è®¾æŸä¸€æ–¹æƒ³è¦è®©ç”Ÿæˆçš„å…¬å…±å…¬é’¥ç­‰äºè‡ªå·±çš„å…¬é’¥ï¼Œè¿™æ ·è‡ªå·±ä¸€ä¸ªäººå°±èƒ½è§£å¯†å¯†æ–‡äº†ã€‚é‚£ä¹ˆä»–åªéœ€è¦æäº¤ä¸€ä¸ªè‡ªå·±æ„é€ çš„å…¬é’¥å³å¯ï¼Œåœ¨æ•´æ•°åŸŸæ˜¯ $\frac{g^{x_j}}{\Pi_{i\neq j}\ g^{x_i}}$ï¼Œè¿™æ ·ç”Ÿæˆå…¬å…±å…¬é’¥ $\Pi_{i\neq j}\ g^{x_i}\cdot \frac{g^{x_j}}{\Pi_{i\neq j}\ g^{x_i}}=g^{x_j}$ã€‚åœ¨æ¤­åœ†æ›²çº¿ä¸Šåˆ™æ˜¯ $x_jg-\Sigma_{i\neq j}\ x_ig$ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task4</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_badpub</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span><span class=p>)</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Four authorities generate keys</span>
</span></span><span class=line><span class=cl>    <span class=n>priv1</span><span class=p>,</span> <span class=n>pub1</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv2</span><span class=p>,</span> <span class=n>pub2</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv3</span><span class=p>,</span> <span class=n>pub3</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv4</span><span class=p>,</span> <span class=n>pub4</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Derive a bad key</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>badpub</span> <span class=o>=</span> <span class=n>corruptPubKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=p>[</span><span class=n>pub1</span><span class=p>,</span> <span class=n>pub2</span><span class=p>,</span> <span class=n>pub3</span><span class=p>,</span> <span class=n>pub4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Derive the group key including the bad public key</span>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>groupKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=p>[</span><span class=n>pub1</span><span class=p>,</span> <span class=n>pub2</span><span class=p>,</span> <span class=n>pub3</span><span class=p>,</span> <span class=n>pub4</span><span class=p>,</span> <span class=n>badpub</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Check that the corrupt authority can decrypt a message</span>
</span></span><span class=line><span class=cl>    <span class=c1># encrypted under the group key with its secret only.</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>decrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>corruptPubKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>OtherPubKeys</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Simulate the operation of a corrupt decryption authority.
</span></span></span><span class=line><span class=cl><span class=s2>        Given a set of public keys from other authorities return a
</span></span></span><span class=line><span class=cl><span class=s2>        public key for the corrupt authority that leads to a group
</span></span></span><span class=line><span class=cl><span class=s2>        public key corresponding to a private key known to the
</span></span></span><span class=line><span class=cl><span class=s2>        corrupt authority. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>OtherPubKeys</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>OtherPubKeys</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>h</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>priv</span><span class=o>*</span><span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>pubkey</span> <span class=ow>in</span> <span class=n>OtherPubKeys</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pub</span> <span class=o>=</span> <span class=n>pub</span> <span class=o>-</span> <span class=n>pubkey</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>pub</span>
</span></span></code></pre></div><h3 id=ç§˜å¯†åˆ†äº« class="relative group">ç§˜å¯†åˆ†äº« <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%a7%98%e5%af%86%e5%88%86%e4%ba%ab aria-label=é”šç‚¹>#</a></span></h3><p>ç§˜å¯†åˆ†äº«é‡‡ç”¨äº†å¦ä¸€ç§æ€è·¯ï¼Œå°†ç§˜å¯†æ‹†åˆ†æˆè‹¥å¹²ç¢ç‰‡æä¾›ç»™ä¸åŒ authoritiesï¼Œä»è€Œåœ¨é¿å… authorities å¾—çŸ¥ç§˜å¯†çš„åŒæ—¶ï¼Œèƒ½å¤Ÿè®© authorities è¿›è¡ŒååŒè®¡ç®—ã€‚è¿™ä¸ªâ€œååŒè®¡ç®—â€éƒ¨åˆ†å®é™…ä¸Šæ˜¯ä¾èµ–äºåŠ æ³•åŒæ€åŠ å¯†çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬ç”¨ <code>&lt;a></code> è¡¨ç¤º a çš„ç¢ç‰‡é›†åˆï¼Œé‚£ä¹ˆ <code>&lt;a+b>=&lt;a>+&lt;b></code>ï¼Œæ­¤æ—¶è®¡ç®—å‡ºçš„æ˜¯ä¸€ä¸ªæ–°çš„ç§˜å¯†çš„ä¸€ä¸ªç¢ç‰‡ã€‚åŠ å¸¸æ•°å’Œä¹˜å¸¸æ•°ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœæ˜¯ç§˜å¯†ç¢ç‰‡ä¹‹é—´çš„ä¹˜æ³•å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œè¿™éœ€è¦ä¸€äº›é¢„è®¡ç®—çš„å€¼ä»¥åŠ authorities ä¹‹é—´çš„äº¤äº’ã€‚ä¾‹å¦‚ï¼Œè¦è®¡ç®— <code>&lt;x></code> å’Œ <code>&lt;y></code> çš„ç§¯ï¼Œæˆ‘ä»¬éœ€è¦å…ˆé¢„è®¡ç®— <code>&lt;a>,&lt;b>,&lt;c></code> ä½¿å¾— <code>&lt;c>=&lt;ab></code>ï¼Œå…¶ä¸­ <code>&lt;a>,&lt;b></code> æ˜¯éšæœºçš„ï¼Œè¿™æ ·æ‰èƒ½éšè— <code>&lt;x></code> å’Œ <code>&lt;y></code>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè®¡ç®— <code>&lt;e>=&lt;x>+&lt;a></code>ï¼Œ<code>&lt;d>=&lt;y>+&lt;b></code>ï¼Œå…¬å¼€ <code>&lt;e>,&lt;d></code> è·å¾— <code>e,d</code>ã€‚æ­¤æ—¶æ–¹èƒ½è®¡ç®— <code>&lt;z>=&lt;xy>=&lt;c>-e&lt;b>-d&lt;a>+ed</code>ã€‚</p><p>ç§˜å¯†åˆ†äº«ç›¸å¯¹äºåŒæ€åŠ å¯†çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥åŠ å…¥æœºåˆ¶ç¡®ä¿å®Œæ•´æ€§ã€‚ä¼ ç»Ÿæ–¹æ³•æ˜¯ authorities è¿›è¡Œé›¶çŸ¥è¯†è¯æ˜ï¼Œè¡¨æ˜å…¶å…¬å¼€çš„å€¼æ˜¯åˆæ³•çš„ï¼Œä½†æ€§èƒ½å ªå¿§ã€‚SPDZ åˆ™å¼•å…¥ MAC å¹¶å°† MAC ä¹Ÿæ‹†æˆç¢ç‰‡ï¼Œå¹¶é€šè¿‡å¹¶è¡ŒéªŒè¯æé«˜æ€§èƒ½ï¼Œä½¿å¾—å®Œæ•´æ€§æ£€æŸ¥è¾ƒä¸ºå»‰ä»·ã€‚</p><p>ç»¼åˆæ¥çœ‹ï¼Œç§˜å¯†åˆ†äº«é¢å¤–å¢åŠ äº†ç½‘ç»œè´Ÿæ‹…ï¼Œè€ŒåŒæ€åŠ å¯†é¢å¤–å¢åŠ äº†è®¡ç®—è´Ÿæ‹…ï¼Œå¯¹äºå¤§è§„æ¨¡è®¡ç®—è€Œè¨€æ€»ä½“æ€§èƒ½è¾ƒå·®ã€‚ç›®å‰ä¸¤è€…éƒ½ä¾ç„¶å¤„äºç ”ç©¶é˜¶æ®µï¼Œå°šä¸æˆç†Ÿã€‚</p><h3 id=ç§å¯†æŠ•ç¥¨ class="relative group">ç§å¯†æŠ•ç¥¨ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%a7%81%e5%af%86%e6%8a%95%e7%a5%a8 aria-label=é”šç‚¹>#</a></span></h3><p>æœ€åæˆ‘ä»¬å®ç°ä¸€ä¸ªç§å¯†æŠ•ç¥¨çš„åœºæ™¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task5</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_poll</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>votes</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>v0</span><span class=p>,</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>simulate_poll</span><span class=p>(</span><span class=n>votes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>v0</span> <span class=o>==</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>v1</span> <span class=o>==</span> <span class=mi>7</span>
</span></span></code></pre></div><p>æˆ‘ä»¬éœ€è¦åœ¨ä¸çŸ¥é“æ˜æ–‡çš„æƒ…å†µä¸‹ï¼Œç»Ÿè®¡ 0 å’Œ 1 çš„ä¸ªæ•°ã€‚é¦–å…ˆä¸º authorities ç”Ÿæˆå¯†é’¥å¯¹å¹¶ç”Ÿæˆå…¬å…±å…¬é’¥ï¼Œç”¨ <code>encode_vote()</code> æ¥åŠ å¯†æŠ•ç¥¨æƒ…å†µã€‚éšåè°ƒç”¨ <code>process_votes()</code> é’ˆå¯¹å¯†æ–‡ç»Ÿè®¡ä¸ªæ•°ï¼Œæœ€å <code>partialDecrypt()</code> è§£å¯†ä¸ªæ•°ä¿¡æ¯å¹¶è¿”å›ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>encode_vote</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>vote</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Given a vote 0 or 1 encode the vote as two
</span></span></span><span class=line><span class=cl><span class=s2>        ciphertexts representing the count of votes for
</span></span></span><span class=line><span class=cl><span class=s2>        zero and the votes for one.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>vote</span> <span class=ow>in</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>v0</span><span class=p>,</span> <span class=n>v1</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>vote</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>v0</span><span class=p>,</span> <span class=n>v1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>process_votes</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>encrypted_votes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Given a list of encrypted votes tally them
</span></span></span><span class=line><span class=cl><span class=s2>        to sum votes for zeros and votes for ones. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>encrypted_votes</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>tv1</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>  <span class=c1># 0 elem</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>encrypted_votes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>tv1</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>tv1</span><span class=p>,</span> <span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>total</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>encrypted_votes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># total + (-1)*tv1</span>
</span></span><span class=line><span class=cl>    <span class=n>tv0</span> <span class=o>=</span> <span class=n>encrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>total</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>tv0</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>tv0</span><span class=p>,</span> <span class=n>mul</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>tv1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tv0</span><span class=p>,</span> <span class=n>tv1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>simulate_poll</span><span class=p>(</span><span class=n>votes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Simulates the full process of encrypting votes,
</span></span></span><span class=line><span class=cl><span class=s2>        tallying them, and then decrypting the total. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate parameters for the crypto-system</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Make keys for 3 authorities</span>
</span></span><span class=line><span class=cl>    <span class=n>priv1</span><span class=p>,</span> <span class=n>pub1</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv2</span><span class=p>,</span> <span class=n>pub2</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>priv3</span><span class=p>,</span> <span class=n>pub3</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pub</span> <span class=o>=</span> <span class=n>groupKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=p>[</span><span class=n>pub1</span><span class=p>,</span> <span class=n>pub2</span><span class=p>,</span> <span class=n>pub3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Simulate encrypting votes</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted_votes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>v</span> <span class=ow>in</span> <span class=n>votes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>encrypted_votes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>encode_vote</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>v</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Tally the votes</span>
</span></span><span class=line><span class=cl>    <span class=n>total_v0</span><span class=p>,</span> <span class=n>total_v1</span> <span class=o>=</span> <span class=n>process_votes</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>encrypted_votes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Simulate threshold decryption</span>
</span></span><span class=line><span class=cl>    <span class=n>privs</span> <span class=o>=</span> <span class=p>[</span><span class=n>priv1</span><span class=p>,</span> <span class=n>priv2</span><span class=p>,</span> <span class=n>priv3</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>priv</span> <span class=ow>in</span> <span class=n>privs</span><span class=p>[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>total_v0</span> <span class=o>=</span> <span class=n>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>total_v0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>total_v1</span> <span class=o>=</span> <span class=n>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>total_v1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>total_v0</span> <span class=o>=</span> <span class=n>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>privs</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>total_v0</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>total_v1</span> <span class=o>=</span> <span class=n>partialDecrypt</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>privs</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>total_v1</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Return the plaintext values</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>total_v0</span><span class=p>,</span> <span class=n>total_v1</span>
</span></span></code></pre></div><h2 id=é›¶çŸ¥è¯†è¯æ˜-zkp class="relative group">é›¶çŸ¥è¯†è¯æ˜ ZKP <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%9b%b6%e7%9f%a5%e8%af%86%e8%af%81%e6%98%8e-zkp aria-label=é”šç‚¹>#</a></span></h2><p>é›¶çŸ¥è¯†è¯æ˜ä¸­ï¼Œprover å‘ verifier è¯æ˜å…³äº secret çš„ä¸€ä¸ªå‘½é¢˜ï¼Œå¹¶ä¸”ä¸æ³„éœ²ä»»ä½• secret çš„ä¿¡æ¯ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯æ•°å­—ç­¾åï¼Œprover è¯æ˜ä»–æ‹¥æœ‰ç§é’¥è€Œä¸æ³„éœ²ç§é’¥ä¿¡æ¯ã€‚</p><h3 id=schnorr-identification-åè®® class="relative group">Schnorr Identification åè®® <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#schnorr-identification-%e5%8d%8f%e8%ae%ae aria-label=é”šç‚¹>#</a></span></h3><ul><li>å…¬å…±å‚æ•°ï¼šç¾¤ $G$ï¼Œ$q=ord(G)$ï¼Œç”Ÿæˆå…ƒ $g$</li><li>Prover æ‹¥æœ‰ç§é’¥ $x$ï¼Œå…¬é’¥ $pub=g^x$ã€‚é€‰æ‹©éšæœºçš„ $w$ï¼Œè®¡ç®— $W=g^w$ å‘é€ç»™ Verifier</li><li>Verifier è¿”å›éšæœºçš„æŒ‘æˆ˜å€¼ $c$</li><li>Prover è®¡ç®— $r=w-cx\ (mod\ q)$ å‘é€ç»™ Verifier</li><li>Verifier éªŒè¯ $g^r\cdot pub^c=W$</li></ul><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåè®®æ˜¯å¦æ»¡è¶³é›¶çŸ¥è¯†è¯æ˜çš„å‡ æ¡æ€§è´¨ï¼š</p><ul><li>Completenessï¼šå³æ­£ç¡®æ€§</li><li>Integrity / Soundnessï¼šå³è¿™æ ·åšæ˜¯å¦å°±èƒ½è¯æ˜ Prover çœŸçš„çŸ¥é“ x</li><li>Privacy / Zero-knowledgeï¼šå³è¿™æ ·åšæ˜¯å¦ä¼šæ³„éœ² x çš„ä¿¡æ¯</li></ul><p>Completeness å¾ˆå®¹æ˜“è¯æ˜ï¼š$g^r\cdot (g^x)^c=g^{w-cx}g^{cx}=g^w=W$ã€‚</p><p>ä¸ºäº†è¯æ˜ Soundnessï¼Œæˆ‘ä»¬å‡è®¾å¯èƒ½çš„æŒ‘æˆ˜å€¼åªæœ‰ä¸¤ä¸ªï¼š$c$ å’Œ $c&rsquo;$ã€‚å¦‚æœè¦æˆåŠŸè¯æ˜ï¼ŒProver è¦ä»¥å¤§äºäºŒåˆ†ä¹‹ä¸€çš„æ¦‚ç‡ç»™å‡ºæ­£ç¡®çš„ $r$ æˆ– $r&rsquo;$ï¼Œ$r=w-cx$ï¼Œ$r&rsquo;=w-c&rsquo;x$ã€‚ç„¶è€Œå¦‚æœ Prover ä¸çŸ¥é“ $x$ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç­‰å¼å‡ä¸ºçº¿æ€§ç­‰å¼ä¸”æœ‰ä¸¤ä¸ªæœªçŸ¥æ•° $w$ å’Œ $x$ï¼Œæ­¤æ—¶ Prover ä¸å¯èƒ½ä»¥å¤§äºäºŒåˆ†ä¹‹ä¸€çš„æ¦‚ç‡ç»™å‡ºæ­£ç¡®ç­”æ¡ˆã€‚</p><p>Zero-knowledge çš„è¯æ˜æ–¹å¼åˆ™æ¯”è¾ƒå¥‡æ€ªã€‚æˆ‘ä»¬çœ‹åˆ°ä¸Šè¿°åè®®çš„ transcript æ˜¯ $(W,c,r)$ã€‚å‡å¦‚ä»»ä½•äººéƒ½èƒ½æ„é€ è¿™æ ·çš„ä¸‰å…ƒç»„ä½¿å¾—å…¶èƒ½é€šè¿‡ Verifier æ£€æŸ¥ï¼Œé‚£ä¹ˆè¿™å°±è¯´æ˜ $x$ çš„ä¿¡æ¯ä¸å¯èƒ½è¢«æ³„éœ²ï¼Œå› ä¸ºè¿™é‡Œæ ¹æœ¬æ²¡æœ‰ç”¨åˆ° $x$ã€‚è€Œè¦æ„é€ è¿™æ ·çš„ä¸‰å…ƒç»„ï¼Œåªéœ€è¦éšæœºé€‰æ‹© $r&rsquo;&rsquo;,c&rsquo;&rsquo;$ï¼Œè®¡ç®— $W&rsquo;&rsquo;=g^{r&rsquo;&rsquo;}pub^{c&rsquo;&rsquo;}$ï¼ˆæ³¨æ„ $pub=g^x$ æ˜¯å…¬é’¥ï¼Œå¹¶æ²¡æœ‰ç”¨åˆ° $x$ï¼‰ï¼Œé‚£ä¹ˆ $(W&rsquo;&rsquo;,c&rsquo;&rsquo;,r&rsquo;&rsquo;)$ å°±èƒ½é€šè¿‡æ£€æŸ¥ã€‚</p><h3 id=fiat-shamir-å¯å‘å¼æŠ€æœ¯ class="relative group">Fiat-Shamir å¯å‘å¼æŠ€æœ¯ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#fiat-shamir-%e5%90%af%e5%8f%91%e5%bc%8f%e6%8a%80%e6%9c%af aria-label=é”šç‚¹>#</a></span></h3><p>å®é™…è¿ç”¨ä¸­æˆ‘ä»¬æ›´å¤šæ—¶å€™å¸Œæœ›èƒ½æœ‰ä¸€ç§éäº¤äº’å¼çš„é›¶çŸ¥è¯†è¯æ˜ï¼Œè€Œ Fiat-Shamir å¯å‘å¼æŠ€æœ¯å°±æ˜¯ä¸€ç§å°† Schnorr Identification åè®®è½¬åŒ–ä¸ºéäº¤äº’å¼çš„é€šæ³•ã€‚</p><ul><li>å…¬å…±å‚æ•°ï¼šç¾¤ $G$ï¼Œ$q=ord(G)$ï¼Œç”Ÿæˆå…ƒ $g$</li><li>Prover æ‹¥æœ‰ç§é’¥ $x$ï¼Œå…¬é’¥ $pub=g^x$ã€‚é€‰æ‹©éšæœºçš„ $w$ï¼Œè®¡ç®— $W=g^w$</li><li>è®¡ç®— $c=H(pub,W,m)$ ï¼Œ$r=w-cx\ (mod\ q)$ï¼Œå‘é€ $m,(c,r)$ ç»™ Verifier</li><li>Verifier éªŒè¯ $H(pub,g^rpub^c,m)=c$</li></ul><p>å¦‚æœæ”»å‡»è€…è¦ä¼ªé€ è¯æ˜ï¼Œéœ€è¦å…ˆè®¾ç½® $r,c$ å†è®¡ç®— $W$ã€‚ç„¶è€Œåœ¨ç¬¬ä¸‰æ­¥ä¸­ $c$ ä¾èµ–äº $W$ çš„å“ˆå¸Œï¼Œå› æ­¤ä¸èƒ½è¿™æ ·è®¡ç®—ã€‚</p><p>ä¸‹é¢ç”¨éäº¤äº’å¼é›¶çŸ¥è¯†è¯æ˜æ¥è¯æ˜çŸ¥é“ DH ç§é’¥çš„ä¿¡æ¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_provekey_correct</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Correct proof</span>
</span></span><span class=line><span class=cl>    <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proof</span> <span class=o>=</span> <span class=n>proveKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>verifyKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>proof</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task1</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_provekey_incorrect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Incorrect proof</span>
</span></span><span class=line><span class=cl>    <span class=n>priv2</span><span class=p>,</span> <span class=n>pub2</span> <span class=o>=</span> <span class=n>keyGen</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proof2</span> <span class=o>=</span> <span class=n>proveKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv2</span><span class=p>,</span> <span class=n>pub2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=ow>not</span> <span class=n>verifyKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>proof2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>to_challenge</span><span class=p>(</span><span class=n>elements</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generates a Bn challenge by hashing a number of EC points &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>Cstring</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;,&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>hexlify</span><span class=p>(</span><span class=n>x</span><span class=o>.</span><span class=n>export</span><span class=p>())</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>elements</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>Chash</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>Cstring</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Bn</span><span class=o>.</span><span class=n>from_binary</span><span class=p>(</span><span class=n>Chash</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>proveKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>priv</span><span class=p>,</span> <span class=n>pub</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Uses the Schnorr non-interactive protocols produce a proof
</span></span></span><span class=line><span class=cl><span class=s2>        of knowledge of the secret priv such that pub = priv * g.
</span></span></span><span class=line><span class=cl><span class=s2>        Outputs: a proof (c, r)
</span></span></span><span class=line><span class=cl><span class=s2>                 c (a challenge)
</span></span></span><span class=line><span class=cl><span class=s2>                 r (the response)
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>hs</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>W</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>to_challenge</span><span class=p>([</span><span class=n>g</span><span class=p>,</span> <span class=n>W</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>w</span> <span class=o>-</span> <span class=n>c</span><span class=o>*</span><span class=n>priv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>,</span> <span class=n>r</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verifyKey</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>pub</span><span class=p>,</span> <span class=n>proof</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Schnorr non-interactive proof verification of knowledge of a secret.
</span></span></span><span class=line><span class=cl><span class=s2>        Returns a boolean indicating whether the verification was successful.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>hs</span><span class=p>,</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=n>proof</span>
</span></span><span class=line><span class=cl>    <span class=n>gw_prime</span> <span class=o>=</span> <span class=n>c</span> <span class=o>*</span> <span class=n>pub</span> <span class=o>+</span> <span class=n>r</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>to_challenge</span><span class=p>([</span><span class=n>g</span><span class=p>,</span> <span class=n>gw_prime</span><span class=p>])</span> <span class=o>==</span> <span class=n>c</span>
</span></span></code></pre></div><p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥è¯æ˜å…³äºä¸€ä¸ª Commitment çš„ç¦»æ•£å¯¹æ•°è¡¨ç¤ºï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_proveCommit_correct</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Correct proof</span>
</span></span><span class=line><span class=cl>    <span class=n>secrets</span> <span class=o>=</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=n>commit</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>secrets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proof</span> <span class=o>=</span> <span class=n>proveCommitment</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>secrets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>verifyCommitments</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>proof</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task2</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_proveCommit_incorrect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Correct proof</span>
</span></span><span class=line><span class=cl>    <span class=n>secrets</span> <span class=o>=</span> <span class=p>[</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=n>commit</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>secrets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proof</span> <span class=o>=</span> <span class=n>proveCommitment</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>secrets</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Incorrect proof</span>
</span></span><span class=line><span class=cl>    <span class=n>secrets2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>40</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>C2</span><span class=p>,</span> <span class=n>r2</span> <span class=o>=</span> <span class=n>commit</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>secrets2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proof2</span> <span class=o>=</span> <span class=n>proveCommitment</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C2</span><span class=p>,</span> <span class=n>r2</span><span class=p>,</span> <span class=n>secrets2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=ow>not</span> <span class=n>verifyCommitments</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>proof2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=ow>not</span> <span class=n>verifyCommitments</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C2</span><span class=p>,</span> <span class=n>proof</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>commit</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>secrets</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Produces a commitment C = r * g + Sum xi * hi,
</span></span></span><span class=line><span class=cl><span class=s2>        where secrets is a list of xi of length 4.
</span></span></span><span class=line><span class=cl><span class=s2>        Returns the commitment (C) and the opening (r).
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>secrets</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>),</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>x3</span> <span class=o>=</span> <span class=n>secrets</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>x0</span> <span class=o>*</span> <span class=n>h0</span> <span class=o>+</span> <span class=n>x1</span> <span class=o>*</span> <span class=n>h1</span> <span class=o>+</span> <span class=n>x2</span> <span class=o>*</span> <span class=n>h2</span> <span class=o>+</span> <span class=n>x3</span> <span class=o>*</span> <span class=n>h3</span> <span class=o>+</span> <span class=n>r</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>C</span><span class=p>,</span> <span class=n>r</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>proveCommitment</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>r</span><span class=p>,</span> <span class=n>secrets</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Prove knowledge of the secrets within a commitment,
</span></span></span><span class=line><span class=cl><span class=s2>        as well as the opening of the commitment.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Args: C (the commitment), r (the opening of the
</span></span></span><span class=line><span class=cl><span class=s2>                commitment), and secrets (a list of secrets).
</span></span></span><span class=line><span class=cl><span class=s2>        Returns: a challenge (c) and a list of responses.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>),</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>x0</span><span class=p>,</span> <span class=n>x1</span><span class=p>,</span> <span class=n>x2</span><span class=p>,</span> <span class=n>x3</span> <span class=o>=</span> <span class=n>secrets</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>w0</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>w1</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>w2</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>w3</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>W</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>g</span> <span class=o>+</span> <span class=n>w0</span> <span class=o>*</span> <span class=n>h0</span> <span class=o>+</span> <span class=n>w1</span> <span class=o>*</span> <span class=n>h1</span> <span class=o>+</span> <span class=n>w2</span> <span class=o>*</span> <span class=n>h2</span> <span class=o>+</span> <span class=n>w3</span> <span class=o>*</span> <span class=n>h3</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>to_challenge</span><span class=p>([</span><span class=n>g</span><span class=p>,</span> <span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>,</span> <span class=n>W</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>rr</span> <span class=o>=</span> <span class=n>w</span> <span class=o>-</span> <span class=n>c</span><span class=o>*</span><span class=n>r</span>
</span></span><span class=line><span class=cl>    <span class=n>r0</span> <span class=o>=</span> <span class=n>w0</span> <span class=o>-</span> <span class=n>c</span><span class=o>*</span><span class=n>x0</span>
</span></span><span class=line><span class=cl>    <span class=n>r1</span> <span class=o>=</span> <span class=n>w1</span> <span class=o>-</span> <span class=n>c</span><span class=o>*</span><span class=n>x1</span>
</span></span><span class=line><span class=cl>    <span class=n>r2</span> <span class=o>=</span> <span class=n>w2</span> <span class=o>-</span> <span class=n>c</span><span class=o>*</span><span class=n>x2</span>
</span></span><span class=line><span class=cl>    <span class=n>r3</span> <span class=o>=</span> <span class=n>w3</span> <span class=o>-</span> <span class=n>c</span><span class=o>*</span><span class=n>x3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>responses</span> <span class=o>=</span> <span class=p>(</span><span class=n>r0</span><span class=p>,</span> <span class=n>r1</span><span class=p>,</span> <span class=n>r2</span><span class=p>,</span> <span class=n>r3</span><span class=p>,</span> <span class=n>rr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>,</span> <span class=n>responses</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verifyCommitments</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>C</span><span class=p>,</span> <span class=n>proof</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Verify a proof of knowledge of the commitment.
</span></span></span><span class=line><span class=cl><span class=s2>        Return a boolean denoting whether the verification succeeded. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>),</span> <span class=n>o</span><span class=p>)</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>,</span> <span class=n>responses</span> <span class=o>=</span> <span class=n>proof</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>r0</span><span class=p>,</span> <span class=n>r1</span><span class=p>,</span> <span class=n>r2</span><span class=p>,</span> <span class=n>r3</span><span class=p>,</span> <span class=n>rr</span><span class=p>)</span> <span class=o>=</span> <span class=n>responses</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Cw_prime</span> <span class=o>=</span> <span class=n>c</span> <span class=o>*</span> <span class=n>C</span> <span class=o>+</span> <span class=n>r0</span> <span class=o>*</span> <span class=n>h0</span> <span class=o>+</span> <span class=n>r1</span> <span class=o>*</span> <span class=n>h1</span> <span class=o>+</span> <span class=n>r2</span> <span class=o>*</span> <span class=n>h2</span> <span class=o>+</span> <span class=n>r3</span> <span class=o>*</span> <span class=n>h3</span> <span class=o>+</span> <span class=n>rr</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>c_prime</span> <span class=o>=</span> <span class=n>to_challenge</span><span class=p>([</span><span class=n>g</span><span class=p>,</span> <span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>,</span> <span class=n>Cw_prime</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c_prime</span> <span class=o>==</span> <span class=n>c</span>
</span></span></code></pre></div><h3 id=ç›¸ç­‰æ€§è¯æ˜ class="relative group">ç›¸ç­‰æ€§è¯æ˜ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%9b%b8%e7%ad%89%e6%80%a7%e8%af%81%e6%98%8e aria-label=é”šç‚¹>#</a></span></h3><p>å®é™…ä¸Šï¼Œé›¶çŸ¥è¯†è¯æ˜ä¸ä»…å¯ä»¥ç”¨äºè¯æ˜çŸ¥é“æŸä¸ªç§˜å¯†ï¼Œè¿˜å¯ä»¥è¯æ˜ä»»æ„å…³äºæŸä¸ªç§˜å¯†çš„é€»è¾‘è¡¨è¾¾å¼ã€‚ä»¥ç›¸ç­‰æ€§è¯æ˜ä¸ºä¾‹ï¼Œå‡å¦‚æœ‰ $P_1=g^x,P_2=h^x$ï¼Œ$g,h$ æ˜¯ç¾¤ $G$ çš„ç”Ÿæˆå…ƒï¼Œè€Œ Prover æƒ³è¯æ˜ä¸¤ä¸ª $x$ ç›¸ç­‰ï¼Œé‚£ä¹ˆå¯ä»¥ç»“åˆ 2 æ¬¡ Schnorr åè®®ï¼Œé‡‡ç”¨ Fiat-Shamir æŠ€æœ¯å®ç° NIKPã€‚</p><ul><li>Prover é€‰æ‹©éšæœº $w$ï¼Œ$W_1=g^w,W_2=h^w$</li><li>è®¡ç®— $c=H(g,h,P_1,P_2,W_1,W_2)$ï¼Œ$r=w-cx$ï¼Œå‘é€ $(c,r)$ ç»™ Verifier</li><li>Verifier éªŒè¯ $H(g,h,P_1,P_2,g^rP_1^c,h^rP_2^c)=c$</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_proveEquality_correct</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span> <span class=o>=</span> <span class=n>gen2Keys</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>proof</span> <span class=o>=</span> <span class=n>proveDLEquality</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>verifyDLEquality</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span><span class=p>,</span> <span class=n>proof</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest</span><span class=o>.</span><span class=n>mark</span><span class=o>.</span><span class=n>task3</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_proveEquality_incorrect</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>setup</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span> <span class=o>=</span> <span class=n>gen2Keys</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>_</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>L2</span> <span class=o>=</span> <span class=n>gen2Keys</span><span class=p>(</span><span class=n>params</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>proof</span> <span class=o>=</span> <span class=n>proveDLEquality</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=ow>not</span> <span class=n>verifyDLEquality</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L2</span><span class=p>,</span> <span class=n>proof</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen2Keys</span><span class=p>(</span><span class=n>params</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generate two related public keys K = x * g and L = x * h0. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>),</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>x</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>L</span> <span class=o>=</span> <span class=n>x</span> <span class=o>*</span> <span class=n>h0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>proveDLEquality</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Generate a ZK proof that two public keys K, L have the same secret private key x,
</span></span></span><span class=line><span class=cl><span class=s2>        as well as knowledge of this private key. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>),</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=n>o</span><span class=o>.</span><span class=n>random</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>Kw</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>Lw</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>h0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=n>to_challenge</span><span class=p>([</span><span class=n>g</span><span class=p>,</span> <span class=n>h0</span><span class=p>,</span> <span class=n>Kw</span><span class=p>,</span> <span class=n>Lw</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=p>(</span><span class=n>w</span> <span class=o>-</span> <span class=n>c</span> <span class=o>*</span> <span class=n>x</span><span class=p>)</span> <span class=o>%</span> <span class=n>o</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>,</span> <span class=n>r</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>verifyDLEquality</span><span class=p>(</span><span class=n>params</span><span class=p>,</span> <span class=n>K</span><span class=p>,</span> <span class=n>L</span><span class=p>,</span> <span class=n>proof</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34; Return whether the verification of equality of two discrete logarithms succeeded. &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>G</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=p>(</span><span class=n>h0</span><span class=p>,</span> <span class=n>h1</span><span class=p>,</span> <span class=n>h2</span><span class=p>,</span> <span class=n>h3</span><span class=p>),</span> <span class=n>o</span> <span class=o>=</span> <span class=n>params</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>,</span> <span class=n>r</span> <span class=o>=</span> <span class=n>proof</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>k_prime</span> <span class=o>=</span> <span class=n>c</span><span class=o>*</span><span class=n>K</span> <span class=o>+</span> <span class=n>r</span><span class=o>*</span><span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>l_prime</span> <span class=o>=</span> <span class=n>c</span><span class=o>*</span><span class=n>L</span> <span class=o>+</span> <span class=n>r</span><span class=o>*</span><span class=n>h0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>to_challenge</span><span class=p>([</span><span class=n>g</span><span class=p>,</span> <span class=n>h0</span><span class=p>,</span> <span class=n>k_prime</span><span class=p>,</span> <span class=n>l_prime</span><span class=p>])</span> <span class=o>==</span> <span class=n>c</span>
</span></span></code></pre></div><h2 id=å®‰å…¨å¤šæ–¹è®¡ç®—-mpc class="relative group">å®‰å…¨å¤šæ–¹è®¡ç®— MPC <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ae%89%e5%85%a8%e5%a4%9a%e6%96%b9%e8%ae%a1%e7%ae%97-mpc aria-label=é”šç‚¹>#</a></span></h2><p>åœ¨å®‰å…¨å¤šæ–¹è®¡ç®—ä¸­ï¼Œå¤šä¸ªå®ä½“å¸Œæœ›èƒ½åˆ©ç”¨è‡ªå·±ç§æœ‰çš„è¾“å…¥ä¸€èµ·è®¡ç®—å‡ºä¸€ä¸ªè¾“å‡ºï¼Œä½†ä¸å¸Œæœ›æ³„éœ²ç§æœ‰è¾“å…¥çš„ä¿¡æ¯ã€‚</p><p>ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨ MPC çš„ä¾‹å­æ˜¯ Oblivious Transferï¼Œæ­¤æ—¶å‘é€è€…æ‹¥æœ‰å¤šä¸ªä¿¡æ¯ï¼Œæ¥æ”¶è€…å‘é€ä¸€ä¸ªæ•°å€¼ bï¼Œæ­¤æ—¶å‘é€è€…çš„å…¶ä¸­ä¸€æ¡ä¿¡æ¯ï¼ˆä¾‹å¦‚ä¸‹æ ‡ä¸º b çš„ä¿¡æ¯ï¼‰ä¼šè¢«å‘é€ç»™æ¥æ”¶è€…ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå‘é€è€…ä¸çŸ¥é“ bï¼Œæ¥æ”¶è€…ä¹Ÿä¸çŸ¥é“å…¶ä»–æ²¡æ¥æ”¶åˆ°çš„ä¿¡æ¯ã€‚å…¶ä»– MPC ç›¸å…³ä¾‹å­åŒ…æ‹¬ E-Votingã€Proof-of-Stakeã€ç§æœ‰é›†åˆäº¤é›†ç­‰ç­‰ã€‚</p><h3 id=å®‰å…¨å®šä¹‰ class="relative group">å®‰å…¨å®šä¹‰ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ae%89%e5%85%a8%e5%ae%9a%e4%b9%89 aria-label=é”šç‚¹>#</a></span></h3><p>å­˜åœ¨ä¸¤ç§æ–¹æ³•æ¥å¯¹ä¸€ä¸ªåè®®çš„å®‰å…¨ä½œå‡ºå®šä¹‰ï¼šå¯å‘å¼æ–¹æ³•å’Œä¸¥è°¨æ–¹æ³•ã€‚å‰è€…å°è¯•å¯¹åè®®è¿›è¡Œæ”»å‡»ï¼Œå¦‚æœæ”»å‡»æˆåŠŸåˆ™æ”¹è¿›åè®®ï¼Œç›´åˆ°æ— æ³•æ”»å‡»ä¸ºæ­¢ã€‚è¿™ç§æ–¹æ³•æ— æ³•è€ƒè™‘åˆ°æ‰€æœ‰æ”»å‡»ã€æˆ–æ˜¯æœªæ¥çš„æ–°çš„æ”»å‡»ï¼Œå› æ­¤å¹¶ä¸æ¨èã€‚ä¸¥è°¨æ–¹æ³•åˆ™å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹æ­¥éª¤ï¼š</p><ol><li>å®šä¹‰æ”»å‡»è€…çš„ç±»å‹å’Œèƒ½åŠ›<ol><li>è¢«åŠ¨ / ä¸»åŠ¨ï¼Ÿ</li><li>è®¡ç®—èƒ½åŠ›æœ‰é™ / æ— é™ï¼Ÿ</li><li>èƒ½å¦ä¸ç³»ç»Ÿä¸­å…¶ä»–å®ä½“åˆä½œï¼Ÿ</li></ol></li><li>å®šä¹‰ç½‘ç»œæ¨¡å‹<ol><li>å®ä½“é—´é€šä¿¡æ˜¯å¦ä½¿ç”¨å®‰å…¨ä¿¡é“ï¼Ÿ</li><li>æ”»å‡»è€…èƒ½å¦ä¿®æ”¹æ¶ˆæ¯é¡ºåºï¼Ÿ</li></ol></li><li>å®šä¹‰â€œå®‰å…¨â€çš„è¯­ä¹‰<ol><li>é€šè¿‡æ¸¸æˆå®šä¹‰ï¼ˆå¯†ç å­¦å¸¸ç”¨æ–¹æ³•ï¼‰</li><li>é€šè¿‡æ¨¡æ‹Ÿå®šä¹‰ï¼ˆMPC æ‰€ç”¨çš„æ–¹æ³•ï¼‰</li></ol></li><li>è®¾è®¡åè®®</li><li>è¯æ˜åè®®åœ¨ä¸Šè¿°æ¡ä»¶ä¸‹æ˜¯å®‰å…¨çš„</li></ol><p>æ¸¸æˆå®šä¹‰çš„å®‰å…¨æˆ‘ä»¬åœ¨å¯†ç å­¦ä¸­å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œè€Œæ¨¡æ‹Ÿå®šä¹‰çš„å®‰å…¨åˆ™åŸºäºä¸¤ä¸ªæ¨¡å‹ï¼šç†æƒ³æ¨¡å‹å’Œç°å®æ¨¡å‹ã€‚åœ¨ç†æƒ³æ¨¡å‹ä¸­ï¼Œå‚ä¸è€…å°†è¾“å…¥å‘é€ç»™ä¸€ä¸ªå¯ä¿¡ç¬¬ä¸‰æ–¹ï¼Œç”±å®ƒæ¥è®¡ç®—ç»“æœå¹¶è¾“å‡ºï¼›è€Œåœ¨ç°å®æ¨¡å‹ä¸­ï¼Œç”±äºå¹¶ä¸å­˜åœ¨è¿™æ ·çš„ TTPï¼Œä¼šå®é™…è¿è¡Œè¿™ä¸ª MPC åè®®æ¥è·å¾—è¾“å‡ºã€‚</p><p>å¦‚æœä»»æ„é’ˆå¯¹ç°å®æ¨¡å‹çš„æ”»å‡»éƒ½åŒæ ·èƒ½é’ˆå¯¹ç†æƒ³æ¨¡å‹ï¼Œé‚£ä¹ˆåè®®å°±æ˜¯å®‰å…¨çš„ï¼Œå› ä¸ºç†æƒ³æ¨¡å‹ä¸‹æ— æ³•å¼€å±•æ”»å‡»ã€‚è¿™é‡Œç”¨äº†ä¸€ç‚¹åè¯æ³•ï¼Œå®é™…ä¸Šå°±æ˜¯å¯†ç å­¦ä¸­å¸¸ç”¨çš„é‚£ç§å¥—å£³å½’çº¦çš„æ–¹æ³•ï¼ˆç»å…¸ä¾‹å­ï¼šå°† DH å¯†é’¥äº¤æ¢åè®®å½’çº¦åˆ° DDH é—®é¢˜ä¸Šï¼‰ã€‚ä¸€è¨€ä»¥è”½ä¹‹ï¼Œå¦‚æœæ”»å‡»è€…æ— æ³•åŒºåˆ†å®ƒå¤„äºç†æƒ³æ¨¡å‹ä¸­è¿˜æ˜¯ç°å®æ¨¡å‹ä¸­ï¼Œé‚£ä¹ˆåè®®å°±æ˜¯å®‰å…¨çš„ã€‚</p><h3 id=æ¶‰åŠæŠ€æœ¯ class="relative group">æ¶‰åŠæŠ€æœ¯ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%b6%89%e5%8f%8a%e6%8a%80%e6%9c%af aria-label=é”šç‚¹>#</a></span></h3><ul><li>åŒæ€åŠ å¯†<ul><li>å…¨åŒæ€åŠ å¯†ï¼ˆæ”¯æŒä»»æ„è¿ç®—ï¼Œå¼€é”€è¾ƒå¤§ï¼‰</li><li>éƒ¨åˆ†åŒæ€åŠ å¯†</li></ul></li><li>Commitment Scheme</li><li>ç§˜å¯†åˆ†äº«</li><li>å¯ä¿¡æ‰§è¡Œç¯å¢ƒ TEE</li><li>åŒºå—é“¾</li></ul><h2 id=ç§æœ‰é›†åˆäº¤é›†-psi class="relative group">ç§æœ‰é›†åˆäº¤é›† PSI <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%a7%81%e6%9c%89%e9%9b%86%e5%90%88%e4%ba%a4%e9%9b%86-psi aria-label=é”šç‚¹>#</a></span></h2><p>é¡¾åæ€ä¹‰ï¼ŒPSI æ—¨åœ¨è®¡ç®—å¤šä¸ªé›†åˆçš„äº¤é›†è€Œä¸æ³„éœ²é›†åˆçš„ä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæŠŠæ¯ä¸ªå‚ä¸è€…çš„ç§æœ‰é›†åˆä½œä¸ºè¾“å…¥ï¼Œé›†åˆäº¤é›†ä½œä¸ºè¿ç®—ï¼Œé‚£ä¹ˆ PSI å°±æ˜¯ MPC çš„ä¸€ç§ç‰¹ä¾‹ã€‚é¢å¯¹è¢«åŠ¨æ”»å‡»è€…æ—¶ï¼ŒPSI åªéœ€è¦æ»¡è¶³æœºå¯†æ€§å³å¯ï¼›è€Œé¢å¯¹ä¸»åŠ¨æ”»å‡»è€…ï¼ŒPSI éœ€è¦ç¡®ä¿äº¤é›†è¿ç®—çš„ç»“æœæ­£ç¡®ï¼Œå³èƒ½æ£€æµ‹å¯¹ç»“æœçš„ç¯¡æ”¹ã€‚</p><h3 id=æ¶‰åŠæŠ€æœ¯-1 class="relative group">æ¶‰åŠæŠ€æœ¯ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e6%b6%89%e5%8f%8a%e6%8a%80%e6%9c%af-1 aria-label=é”šç‚¹>#</a></span></h3><ul><li><p>å®‰å…¨æ€§</p><ul><li><p>åŒæ€åŠ å¯†</p></li><li><p>è¡¨ç¤ºä¸ºæœ‰é™åŸŸä¸Šçš„å¤šé¡¹å¼</p><ul><li>$p(x)=\Sigma_{i=1}^d(x-s_i)\ for\ S={s_1,&mldr;,s_d}$</li><li>å¤šé¡¹å¼çš„æ ¹å³é›†åˆå…ƒç´ ï¼Œå¤šé¡¹å¼ä¹‹å’Œçš„æ ¹å³ä¸ºäº¤é›†ï¼ˆæˆ–æ±‚ GCDï¼‰</li><li>å¯¹äº d æ¬¡å¤šé¡¹å¼ $p_A,p_B$ï¼ˆä»£è¡¨ $S^{(A)},S^{(B)}$ï¼‰ï¼Œä»¥åŠéšæœºçš„ d æ¬¡å¤šé¡¹å¼ $\gamma_A,\gamma_B$ï¼Œä»¤ $\theta=\gamma_A\cdot p_A+\gamma_B\cdot p_B=\mu\cdot gcd(p_A,p_B)$ï¼Œ$\mu$ ä¸ºéšæœºå¤šé¡¹å¼ï¼Œæ­¤æ—¶ $\theta$ ä»…åŒ…å« $S^{(A)}\cap S^{(B)}$ çš„ä¿¡æ¯è€Œä¸åŒ…å«ä»»ä¸€é›†åˆå…¶ä½™å…ƒç´ çš„ä¿¡æ¯</li></ul></li><li><p>å“ˆå¸Œå‡½æ•°</p></li><li><p>ä¼ªéšæœºå‡½æ•°</p></li></ul></li><li><p>æ€§èƒ½</p><ul><li>æ•°æ®ç»“æ„<ul><li>å“ˆå¸Œè¡¨ï¼šå°†é›†åˆå…ƒç´ å“ˆå¸Œåˆ°è¡¨ä¸­ï¼Œåœ¨è¡¨ä¸Šè®¡ç®—</li><li>å¸ƒéš†è¿‡æ»¤å™¨ï¼šçŠ¶æ€å‹ç¼©åè¿›è¡Œä¼ è¾“å’Œè®¡ç®—</li></ul></li><li>å°† ZKP æ›¿æ¢ä¸ºä¸€äº›ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå¦‚åœ¨è¾“å…¥ä¸­è®¾ç½®é™·é˜±æ¥é˜²ç¯¡æ”¹</li><li>Horner æ–¹æ³•</li></ul></li></ul><h3 id=åˆ†ç±» class="relative group">åˆ†ç±» <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%88%86%e7%b1%bb aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨ä¼ ç»Ÿ PSI ä¸­ï¼Œå‚ä¸è€…äº¤äº’å¼åœ°æ‰§è¡Œåè®®ä»¥è®¡ç®—ç»“æœï¼Œæ¯æ¬¡è®¡ç®—éƒ½è¦ä½¿ç”¨æœ¬åœ°çš„é›†åˆæ•°æ®ã€‚ç„¶è€Œåœ¨å§”æ‰˜å¼ PSI ä¸­ï¼Œå‚ä¸è€…å¯ä»¥å°†æ•°æ®ç¼–ç åä¸Šä¼ è‡³äº‘æœåŠ¡å•†ï¼Œå§”æ‰˜äº‘æœåŠ¡å•†è¿›è¡Œ PSI è®¡ç®—ï¼šè¿™ç§å§”æ‰˜å¯ä»¥æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå³æ¯æ¬¡è®¡ç®—éƒ½è¦é‡æ–°å°†æ•°æ®ç¼–ç ä¸Šä¼ ï¼›ä¹Ÿå¯ä»¥æ˜¯é‡å¤çš„ï¼Œä¸€æ¬¡ä¸Šä¼ å¤šæ¬¡ä½¿ç”¨ã€‚</p><h3 id=åº”ç”¨åœºæ™¯ class="relative group">åº”ç”¨åœºæ™¯ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af aria-label=é”šç‚¹>#</a></span></h3><ul><li>åœ¨çº¿æ¸¸æˆä½œå¼Šæ£€æµ‹</li><li>ç–«æƒ…æ¥è§¦è€…è¿½è¸ª</li><li>Chrome æ‰©å±•æ£€æŸ¥å¯†ç æ˜¯å¦åœ¨æ³„éœ²æ•°æ®åº“ä¸­</li><li>SNS æŸ¥æ‰¾å…±åŒå¥½å‹</li></ul><h3 id=-apple-psi class="relative group">ğŸŒ° Apple PSI <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#-apple-psi aria-label=é”šç‚¹>#</a></span></h3><p>Apple ä½¿ç”¨ PSI æŠ€æœ¯æ¥æ£€æµ‹ç”¨æˆ·çš„ iCloud ä¸­æ˜¯å¦å­˜å‚¨äº†éæ³•çš„å„¿ç«¥è‰²æƒ…å›¾ç‰‡ï¼ŒåŒæ—¶é¿å…æ³„éœ²ç”¨æˆ· iCloud ä¸­çš„æ­£å¸¸å›¾ç‰‡ã€‚</p><p>å‡è®¾ $X$ æ˜¯æœåŠ¡å™¨ä¸­éæ³•å›¾ç‰‡çš„å“ˆå¸Œå€¼é›†åˆï¼Œå®¢æˆ·ç«¯ä¸­çš„å›¾ç‰‡é›†åˆå¯ä»¥ç”¨ $Y=((y_1,id_1,ad_1),&mldr;,(y_m,id_m,ad_m))$ï¼Œå…¶ä¸­ $id$ æ˜¯æ¯ä¸ªå…ƒç´ çš„æ ‡è¯†ç¬¦ï¼Œ$y$ æ˜¯è¯¥å›¾ç‰‡çš„å“ˆå¸Œå€¼ï¼Œ$ad$ æ˜¯é™„åŠ ä¿¡æ¯ã€‚ç°åœ¨ï¼Œå¦‚æœå®¢æˆ·ç«¯æ‹¥æœ‰è¶…è¿‡é˜ˆå€¼ $t$ å¼ ç…§ç‰‡æ»¡è¶³å…¶å¯¹åº”çš„ $y_i$ ä½äº $X$ é›†åˆä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›èƒ½è·å¾—æ‰€æœ‰çš„å¯¹åº”çš„ $(id_i,ad_i)$ é›†åˆã€‚</p><blockquote><p>ä¾‹å¦‚ï¼Œ$X=(y_1,y_2,y_3,y_4,y_5),Y=((y_1,id_1,ad_1),(y_3,id_3,ad_3),(y_8,id_8,ad_8)),t=1$ï¼Œç”±äºç¬¦åˆæ¡ä»¶çš„ç…§ç‰‡æ•°è¶…è¿‡äº†é˜ˆå€¼ 1ï¼ŒæœåŠ¡å™¨åº”è¯¥èƒ½ä¸”åªèƒ½æ”¶åˆ° $(id_1,ad_1),(id_3,ad_3)$ï¼Œå¹¶ä¸”æ— æ³•è·å¾—ä»»ä½•å…³äº $(y_8,id_8,ad_8)$ çš„ä¿¡æ¯ã€‚</p></blockquote><p>é‚£ä¹ˆè¿™ä¸€ç›®æ ‡æ˜¯å¦‚ä½•è¾¾åˆ°çš„å‘¢ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p><ul><li>å“ˆå¸Œè¡¨ $T$ï¼Œå…¶å¯¹åº”çš„å“ˆå¸Œå‡½æ•°æ˜¯ $h$ï¼Œå®¹é‡ä¸º $n'$</li><li>å¯†é’¥ç”Ÿæˆå‡½æ•° $H'$</li><li>å¯¹ç§°åŠ å¯†æœºåˆ¶ $(Enc,Dec)$</li><li>å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•° $H$</li><li>é˜ˆå€¼ä¸º t çš„ç§˜å¯†åˆ†äº«æœºåˆ¶ï¼šè‡³å°‘éœ€è¦ t+1 ä»½ç§˜å¯†ç¢ç‰‡æ‰èƒ½é‡å»ºç§˜å¯†</li></ul><p>æ•´ä¸ªåè®®æ˜¯è¿™æ ·è¿è¡Œçš„ï¼š</p><ol><li><p>æœåŠ¡ç«¯æ ¹æ® $X$ è®¡ç®—å‡º <code>pdata</code> å’ŒæœåŠ¡ç«¯å¯†é’¥ï¼Œå‘é€ <code>pdata</code> ç»™å®¢æˆ·ç«¯</p></li><li><p>å®¢æˆ·ç«¯æ£€æŸ¥ <code>pdata</code> ä¸­å…ƒç´ ä¸¤ä¸¤ä¸åŒä¸”éç©ºï¼Œç”Ÿæˆå®¢æˆ·ç«¯å¯†é’¥ <code>adkey</code></p></li><li><p>å®¢æˆ·ç«¯åˆ©ç”¨å®¢æˆ·ç«¯å¯†é’¥ã€<code>pdata</code>ã€å®¢æˆ·ç«¯çš„ä¸€å¼ ç…§ç‰‡è®¡ç®—å‡ºå¯¹åº”çš„ <code>voucher</code> å‘é€ç»™æœåŠ¡å™¨</p></li><li><p>æœåŠ¡å™¨åˆ©ç”¨æœåŠ¡ç«¯å¯†é’¥ã€<code>voucher</code> è®¡ç®—å‡ºæœ€ç»ˆç»“æœ</p></li></ol><p>åœ¨ç¬¬ä¸€æ­¥ä¸­ï¼ŒæœåŠ¡å™¨å…ˆå°† $X$ ä¸­çš„å€¼æ’å…¥åˆ° $T$ ä¸­ï¼Œé€‰æ‹©éšæœºå€¼ $\alpha$ å’Œæœ‰é™åŸŸç”Ÿæˆå…ƒ $G$ï¼Œè®¡ç®— $L=G^\alpha$ï¼ˆä¸ºäº†éšè— $\alpha$ï¼Œç±»ä¼¼éå¯¹ç§°å¯†ç ï¼‰ã€‚å¯¹äºæ¯ä¸ª $T$ ä¸­å…ƒç´ ï¼Œå¦‚æœè¯¥å…ƒç´ éç©ºï¼Œè®¡ç®— $P_i=(H(T[i]))^\alpha$ï¼›å¦åˆ™ï¼Œè®¾ç½® $P_i$ ä¸ºéšæœºå€¼ã€‚æœ€åï¼Œ<code>pdata</code> è¢«è®¾ç½®ä¸º $(L,P_1,&mldr;,P_{n&rsquo;})$ å¹¶å‘é€ã€‚</p><p>åˆ°äº†ç¬¬ä¸‰æ­¥ï¼Œå®¢æˆ·ç«¯é¦–å…ˆåŠ å¯†é™„åŠ ä¿¡æ¯ï¼š$adct=Enc_{adkey}(ad)$ï¼Œç”Ÿæˆ $adkey$ çš„ç§˜å¯†ç¢ç‰‡ $sh$ï¼Œéšåéšæœºé€‰æ‹©æ–°çš„å¯†é’¥ $rkey$ï¼Œè®¡ç®— $rct=Enc_{rkey}((adct,sh))$ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå®¢æˆ·ç«¯éœ€è¦å¯¹è¿™å¼ ç…§ç‰‡çš„ $y$ è¿›è¡Œç¼–ç ï¼Œé¦–å…ˆå†³å®šå…¶åœ¨å“ˆå¸Œè¡¨çš„ä½ç½®ï¼š$w=h(y)$ï¼ŒéšååŠ å¯† $y$ å¾—åˆ° $Q$ å¹¶ç”Ÿæˆ tag $S$ï¼šé€‰æ‹©éšæœºçš„ $\beta,\gamma$ï¼Œè®¡ç®— $Q=(H(y))^\beta\cdot G^\gamma$ã€‚ä» <code>pdata</code> ä¸­å– $P_w,L$ï¼Œè®¡ç®— $S=(P_w)^\beta\cdot L^\gamma$ã€‚æ¥ç€ç”Ÿæˆæ–°å¯†é’¥ $S&rsquo;=H&rsquo;(S)$ï¼Œç”¨æ¥åŠ å¯† $rkey$ï¼š$ct=Enc_{S&rsquo;}(rkey)$ã€‚æœ€åï¼Œ<code>voucher</code> è¢«è®¾ç½®ä¸º $(id,Q,ct,rct)$ å¹¶å‘é€ã€‚</p><p>ç¬¬å››æ­¥ï¼ŒæœåŠ¡å™¨é¦–å…ˆåˆå§‹åŒ–ç©ºåˆ—è¡¨ <code>SHARES</code>ã€‚ä» <code>voucher</code> ä¸­è¯»å– $Q$ï¼Œè®¡ç®— $\hat{S}=Q^\alpha$ã€‚</p><blockquote><p>å¦‚æœç…§ç‰‡åœ¨ $X$ ä¸­ï¼Œé‚£ä¹ˆ $\hat{S}=Q^\alpha=(H(y))^{\beta\alpha}\cdot G^{\gamma\alpha}=(P_w)^\beta\cdot L^\gamma=S$ã€‚</p></blockquote><p>ç„¶åï¼ŒæœåŠ¡å™¨ç”Ÿæˆæ–°å¯†é’¥ $\hat{S&rsquo;}=H&rsquo;(\hat{S})$ï¼Œæå– $rkey=Dec_{\hat{S&rsquo;}}(ct)$ï¼Œå¦‚æœè§£å¯†å¤±è´¥åˆ™ä¸­æ­¢ã€‚ä¸‹ä¸€æ­¥åˆ™æ˜¯æå– $adct$ å’Œ $sh$ï¼Œåªéœ€è¦ $(adct,sh)=Dec_{rkey}(rct)$ï¼Œå¦‚æœè§£å¯†å¤±è´¥åŒæ ·ä¸­æ­¢ã€‚è§£å¯†å®Œæˆåï¼Œå°† $(id,adct,sh)$ åŠ å…¥åˆ° <code>SHARES</code> ä¸­ã€‚æ­¤æ—¶æˆ‘ä»¬æˆåŠŸåŒ¹é…åˆ°äº†éæ³•å›¾ç‰‡ã€‚</p><p>å¦‚æœ <code>SHARES</code> ä¸­å­˜åœ¨è‡³å°‘ t+1 ä»½ç¢ç‰‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥é‡å»º $adkey$ äº†ã€‚æœ€åä¸€æ­¥å°±æ˜¯åˆ©ç”¨ $adkey$ æå– $ad$ï¼š$ad=Dec_{adkey}(adct)$ã€‚</p><h2 id=selective-disclosure class="relative group">Selective Disclosure <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#selective-disclosure aria-label=é”šç‚¹>#</a></span></h2><p>ä¼ ç»Ÿè®¤è¯ç³»ç»Ÿå¾€å¾€å°†èº«ä»½å’Œå±æ€§ç»‘å®šï¼Œè¿™ä¼šå¯¼è‡´ä¸€å®šç¨‹åº¦çš„éšç§æ³„éœ²ã€‚è€Œåœ¨ Selective Disclosure ä¸­ï¼ŒVerifier ä¸ä¼šè·å¾—ä»»ä½•å…³äº Prover çš„éå¿…è¦çš„ä¿¡æ¯ã€‚é¦–å…ˆ Issuer ç»™ Prover ä¸€ä¸ªç±»ä¼¼è¯ä¹¦çš„ credentialï¼Œéšå Prover å¯¹è‡ªèº«çš„å±æ€§è¿›è¡Œæ–­è¨€å‘ç»™ Verifierï¼Œæœ€å Verifier å’Œ Issuer äº¤äº’æ¥éªŒè¯ Prover çš„æ–­è¨€æ˜¯å¦åˆæ³•ã€‚</p><p>è¿™é‡Œä»‹ç»ä¸€ç§åŸºäº MAC çš„æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆå‡è®¾ Issuer å’Œ Verifier æ˜¯åŒä¸€ä¸»ä½“ã€‚</p><p>ä¼ ç»Ÿæ–¹å¼ä¸­ï¼ŒProver å°†æ–­è¨€å‘ç»™ Verifier æ—¶ç”±äºç”¨åˆ°äº† MACï¼Œæ— æ³•ç ´åå®Œæ•´æ€§ï¼Œä½† MAC å¹¶ä¸æä¾›æœºå¯†æ€§ã€‚ä½†å¦‚æœåŠ å…¥é›¶çŸ¥è¯†è¯æ˜å’ŒåŒ¿åé€šä¿¡æœºåˆ¶ï¼Œé‚£ä¹ˆ Prover å°±å¯ä»¥é€šè¿‡åŒ¿åé€šä¿¡ä¿¡é“å’Œ Verifier äº¤äº’ï¼Œå¹¶é€šè¿‡é›¶çŸ¥è¯†è¯æ˜æ¥è¯æ˜æ–­è¨€ã€ä»¥åŠå¯¹åº”çš„ MACã€‚</p><h3 id=algebraic-mac class="relative group">Algebraic MAC <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#algebraic-mac aria-label=é”šç‚¹>#</a></span></h3><p>Algebraic MAC æä¾›äº†ä¸¤ä¸ªå¾ˆå¥½çš„æ€§è´¨ï¼š</p><ul><li>åœ¨å¯è¡Œæ—¶é—´é‡Œè¯æ˜ MAC çš„æ­£ç¡®ç”Ÿæˆï¼ˆIssuingï¼‰</li><li>åœ¨å¯è¡Œæ—¶é—´é‡Œè¯æ˜ MAC çš„æŒæœ‰ï¼ˆShowingï¼‰</li></ul><p>é¦–å…ˆéœ€è¦ä¸€ä¸ªç´ ç¾¤ Gï¼Œç”Ÿæˆå…ƒ g å’Œ hï¼Œéšåç”Ÿæˆç§é’¥ $sk={x_0,x_1,&mldr;,x_k}$ï¼Œå…¶ä¸­ k æ˜¯è¦ç¼–ç çš„å±æ€§ä¸ªæ•°ã€‚éšåå…¬å¸ƒ Issuer å‚æ•° $\texttt{iparams=}{X_i=h^{x_i}} \texttt{ for }i>0$ã€‚</p><p>Algebraic MAC ä»¥ç§é’¥å’Œ k ä¸ªå±æ€§ $m={m_i}\texttt{ for }1&lt;=i&lt;=k$ï¼Œé€‰æ‹©ä¸€ä¸ª $u\in G/{1}$,è®¡ç®— $u&rsquo;=u^{H_{sk}(m)}$ï¼Œå…¶ä¸­ $H_{sk}(m)=x_0+\Sigma m_ix_i$ã€‚æœ€åè¾“å‡º tagï¼š$(u,u&rsquo;)$</p><p>éªŒè¯çš„è¿‡ç¨‹åˆ™æ˜¯åè¿‡æ¥ï¼ŒéªŒè¯ $u&rsquo;$ æ˜¯å¦ç­‰äº $u^{H_{sk}(m)}$ã€‚è¿™é‡Œå¯ä»¥æ³¨æ„åˆ°ï¼ŒMAC çš„ç”Ÿæˆå’ŒéªŒè¯éƒ½éœ€è¦ç§é’¥ã€‚</p><h3 id=amac--zkp class="relative group">aMAC + ZKP <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#amac--zkp aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨ Selective Disclosure æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬è¦è®© Prover é›¶çŸ¥è¯†è¯æ˜å®ƒçŸ¥é“å…³äºè¿™äº›å±æ€§çš„åˆæ³•çš„ aMACã€‚æ•´ä¸ªæ–¹æ¡ˆåˆ†å››é˜¶æ®µï¼š</p><ul><li>Setup åˆå§‹åŒ–å‚æ•° ï¼ˆGï¼Œpï¼Œgï¼Œhï¼‰</li><li>CredKeyGen ç”Ÿæˆ Issue å¯†é’¥å’Œå…¬é’¥</li><li>Credential Issuance Protocol</li><li>Credential Showing Protocol</li></ul><p>åœ¨ CredKeyGen ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ– aMAC çš„å‚æ•°ï¼Œéšååœ¨ $Z_p$ ä¸­éšæœºé€‰æ‹© $o_{xo}$ï¼Œè®¡ç®— Commitment $C_{xo}=g^{x_0}h^{o_{xo}}$ã€‚è¾“å‡ºå…¬é’¥ $(\texttt{iparams}, C_{xo})$ï¼Œç§é’¥ $(sk,o_{xo})$ã€‚</p><p>Credential Issuance ä¸­ Issuer å°†å±æ€§ç¼–ç æˆæ¶ˆæ¯ $m_i$ï¼Œè®¡ç®— $Tag(u,u&rsquo;)=MAC(sk,{m_i})$ï¼Œç„¶åè®¡ç®—è¯æ˜ $\pi_0=NIZK\{(sk,o_{xo}):u&rsquo;,C_{xo},X_i\}$ã€‚Prover è·å¾— $(u,u&rsquo;)$ åï¼ŒéªŒè¯ $\pi_0$ã€‚</p><p>Credential Showing ä¸­ Prover åœ¨ $Z_p$ ä¸­éšæœºé€‰æ‹© $a,z_i,r$ï¼Œè®¡ç®—ï¼š</p><ul><li>$u_a,u_a&rsquo;=(u^a,u&rsquo;^a)$</li><li>$C_{mi}=u^{m_i}h^{z_i}$</li><li>$C_{u&rsquo;}=u_a&rsquo;g^r$</li></ul><p>éšåäº§ç”Ÿè¯æ˜ $\pi_1=NIZK\{(z_i,r,m_i):C_{mi},V=g^{-r}\Pi X_i^{z_i}+&mldr;\}$ï¼Œ <code>...</code> å¤„æ˜¯å…¶ä»–å…³äºå±æ€§çš„å£°æ˜ã€‚è¾“å‡º $(u_a,C_{mi}, C_{u&rsquo;}),\pi_1$.</p><blockquote><p>é€‰æ‹©è¿™ä¹ˆå¤šéšæœºæ•°éƒ½æ˜¯ä¸ºäº†è®©å±æ€§åŒ¿ååŒ–ã€‚</p></blockquote><p>æœ€åï¼ŒVerifier è®¡ç®— $V=u_a^{x_0}\Pi C_{mi}^{x_i}/C_{u&rsquo;}$ï¼Œå¹¶åˆ©ç”¨ V æ¥éªŒè¯ $\pi_1$.</p><h3 id=åº”ç”¨ class="relative group">åº”ç”¨ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%ba%94%e7%94%a8 aria-label=é”šç‚¹>#</a></span></h3><ul><li>åŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶</li><li>åˆ†å¸ƒå¼èº«ä»½ç®¡ç†</li><li>éšç§å‹å¥½çš„ç”µå­èº«ä»½ä¿¡æ¯</li></ul></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt=Mercury src=/my_avatar_huffcabec77dc887387e1e045311cbdc8b_49733_192x192_fill_box_smart1_3.png><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">ä½œè€…</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Mercury</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A student</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:signormercurio@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/SignorMercurio target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://t.me/m9r_at_tG target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/pwn-college/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">è¿½æœ¬æº¯æºï¼špwn.college ä½œä¸šè®°å½•</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-02-24 20:03:11 +0000 UTC">2022-02-24</time></span></span></a></span>
<span><a class="flex text-right group" href=/posts/distributed-systems/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">æ˜Ÿç½—æ£‹å¸ƒï¼šã€Šåˆ†å¸ƒå¼ç³»ç»Ÿä¸å®‰å…¨ã€‹è¯¾ç¨‹ç¬”è®°</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-10-18 11:04:07 +0000 UTC">2021-10-18</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer><script src=//unpkg.com/valine/dist/Valine.min.js></script><div id=vcomments class="mt-8 max-w-prose print:hidden"></div><script>new Valine({el:"#vcomments",appId:"RkxCznUcvfzFBgfMiMr0BAfd-gzGzoHsz",appKey:"sw2sEPOl4haCAXKUFYiBFMrR",avatar:"robohash",requiredFields:["nick"]})</script></article><div class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://creativecommons.org/licenses/by-nc/4.0/ title>CC BY-NC 4.0</a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Mercury</p><p class="text-xs text-neutral-500 dark:text-neutral-400">ç”± <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a> å¼ºåŠ›é©±åŠ¨</p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title=åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼>
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div></footer><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://blog.sigmerc.top><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>