<!doctype html><html lang=zh-cn dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>Why So Serialize: From Deserialization to RCE &#183; Lab on Mercury</title>
<meta name=title content="Why So Serialize: From Deserialization to RCE &#183; Lab on Mercury"><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.0cc88d860376b4ebb5a839f96b657fcc278e5d31a3e66dce89b994562abde23a.css integrity="sha256-DMiNhgN2tOu1qDn5a2V/zCeOXTGj5m3OibmUViq94jo="><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.5b9218820e6c6b9f04b4c5a03dffd0d57bc9189f511ee80ea74222de3a608e2f.js integrity="sha256-W5IYgg5sa58EtMWgPf/Q1XvJGJ9RHugOp0Ii3jpgji8=" data-copy=复制 data-copied=已复制></script><meta name=description content="
      
        专业英语的一次分享。
Slides。
      
    "><link rel=canonical href=https://blog.sigmerc.top/posts/why-so-serialize/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Why So Serialize: From Deserialization to RCE"><meta property="og:description" content="专业英语的一次分享。
Slides。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.sigmerc.top/posts/why-so-serialize/"><meta property="og:image" content="https://blog.sigmerc.top/posts/why-so-serialize/feature.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-12T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-23T16:24:21+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.sigmerc.top/posts/why-so-serialize/feature.jpg"><meta name=twitter:title content="Why So Serialize: From Deserialization to RCE"><meta name=twitter:description content="专业英语的一次分享。
Slides。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Why So Serialize: From Deserialization to RCE","headline":"Why So Serialize: From Deserialization to RCE","abstract":"\u003cp\u003e专业英语的一次分享。\n\u003ca href=\u0022https:\/\/slides.com\/mercury\/why-so-serialize\u0022 target=\u0022_blank\u0022 rel=\u0022noreferrer\u0022\u003eSlides\u003c\/a\u003e。\u003c\/p\u003e","inLanguage":"zh-cn","url":"https:\/\/blog.sigmerc.top\/posts\/why-so-serialize\/","author":{"@type":"Person","name":"Mercury"},"copyrightYear":"2020","dateCreated":"2020-11-12T00:00:00\u002b00:00","datePublished":"2020-11-12T00:00:00\u002b00:00","dateModified":"2023-12-23T16:24:21\u002b08:00","keywords":["反序列化","Java","PHP"],"mainEntityOfPage":"true","wordCount":"2875"}</script><meta name=author content="Mercury"><link href=mailto:signormercurio@gmail.com rel=me><link href=https://github.com/SignorMercurio rel=me><link href=https://t.me/m9r_at_tG rel=me></head><body class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral"><div id=the-top class="absolute flex self-center"><a class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span>跳到主要内容</a></div><header class="py-6 font-semibold text-neutral-900 print:hidden sm:py-10 dark:text-neutral"><nav class="flex items-start justify-between sm:items-center"><div class="z-40 flex flex-row items-center"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Lab on Mercury</a></div><label id=menu-button for=menu-controller class="block sm:hidden"><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper class="invisible fixed inset-0 z-30 m-auto h-full w-full cursor-default overflow-auto bg-neutral-100/50 opacity-0 backdrop-blur-sm transition-opacity dark:bg-neutral-900/50"><ul class="mx-auto flex w-full max-w-7xl list-none flex-col overflow-visible px-6 py-6 text-end sm:px-14 sm:py-10 sm:pt-10 md:px-24 lg:px-32"><li class=mb-1><span class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class="group mb-1"><a href=/posts/ title onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1"><a href=/categories/ title onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Categories</span></a></li><li class="group mb-1"><a href=/tags/ title onclick=close_menu()><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1"><a href=https://github.com/SignorMercurio/SignorMercurio.github.io title onclick=close_menu() target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1"><button id=search-button-1 title="搜索 (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></div></label><ul class="hidden list-none flex-row text-end sm:flex"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/posts/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Posts</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/categories/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Categories</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=/tags/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><a href=https://github.com/SignorMercurio/SignorMercurio.github.io title target=_blank><span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0"><button id=search-button-2 title="搜索 (/)">
<span class="group-dark:hover:text-primary-400 transition-colors group-hover:text-primary-600"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></span><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"></span></button></li></ul></nav></header><div class="relative flex grow flex-col"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 print:hidden dark:text-neutral-400"><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/>Lab on Mercury</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="hidden inline"><a class="dark:underline-neutral-600 decoration-neutral-300 hover:underline" href=/posts/why-so-serialize/>Why So Serialize: From Deserialization to RCE</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Why So Serialize: From Deserialization to RCE</h1><div class="mb-12 mt-8 text-base text-neutral-500 print:hidden dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2020-11-12 00:00:00 +0000 UTC">2020-11-12</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2023-12-23 16:24:21 +0800 +0800">更新于 2023-12-23</time></div><div class="my-1 flex flex-wrap text-xs leading-relaxed text-neutral-500 dark:text-neutral-400"><a href=/categories/web-%E5%AE%89%E5%85%A8/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">Web 安全</a>
<a href=/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">反序列化</a>
<a href=/tags/java/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">Java</a>
<a href=/tags/php/ class="mx-1 my-1 rounded-md border border-neutral-200 px-1 py-[1px] hover:border-primary-300 hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400">PHP</a></div></div><div class=prose><picture class="mb-6 -mt-4 rounded-md"><source srcset="/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_330x0_resize_q75_h2_box.webp 330w,/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_660x0_resize_q75_h2_box.webp 660w
,/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_781x440_resize_q75_h2_box.webp 781w
,/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_781x440_resize_q75_h2_box.webp 781w" sizes=100vw type=image/webp><img width=781 height=440 class="mb-6 -mt-4 rounded-md" src=/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_660x0_resize_q75_box.jpg srcset="/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_330x0_resize_q75_box.jpg 330w,/posts/why-so-serialize/feature_hu9a0e5d79acbf9404ca56c93cb07b3f9f_61291_660x0_resize_q75_box.jpg 660w
,/posts/why-so-serialize/feature.jpg 781w
,/posts/why-so-serialize/feature.jpg 781w" sizes=100vw></picture></div></header><section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="mt-0 sideNav rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block sticky top-0 py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">目录</summary><div class="py-2 pr-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#introduction>Introduction</a><ul><li><a href=#serialization-and-deserialization>Serialization and Deserialization</a></li><li><a href=#rce-attack>RCE Attack</a></li></ul></li><li><a href=#examples-of-serialized-data>Examples of Serialized Data</a><ul><li><a href=#php>PHP</a></li><li><a href=#java>Java</a></li></ul></li><li><a href=#php-deserialization>PHP Deserialization</a><ul><li><a href=#a-simple-scenario>A Simple Scenario</a></li><li><a href=#magic-functions>Magic Functions</a></li><li><a href=#searching-for-evil-functions>Searching for Evil Functions</a></li><li><a href=#bypassing-protections>Bypassing protections</a></li><li><a href=#property-oriented-programming>Property-Oriented Programming</a></li><li><a href=#advanced-topics>Advanced Topics</a></li></ul></li><li><a href=#java-deserialization>Java Deserialization</a><ul><li><a href=#ideal-scenario>Ideal Scenario</a></li><li><a href=#reflection>Reflection</a><ul><li><a href=#creating-the-classobject>Creating the ClassObject</a></li><li><a href=#accessing-the-attributes>Accessing the Attributes</a></li><li><a href=#accessing-methods>Accessing Methods</a></li><li><a href=#executing-code>Executing Code</a></li><li><a href=#why-reflection>Why Reflection</a></li></ul></li><li><a href=#locating-vulnerability>Locating Vulnerability</a></li><li><a href=#defending>Defending</a></li></ul></li><li><a href=#data-exchange-protocol>Data eXchange Protocol</a><ul><li><a href=#various-standards>Various Standards</a></li><li><a href=#common-feature>Common Feature</a></li><li><a href=#security-issues>Security Issues</a></li></ul></li><li><a href=#conclusions>Conclusions</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div></div><div class="min-h-0 min-w-0 max-w-prose grow"><p>专业英语的一次分享。
<a href=https://slides.com/mercury/why-so-serialize target=_blank rel=noreferrer>Slides</a>。</p><h2 id=abstract class="relative group">Abstract <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#abstract aria-label=锚点>#</a></span></h2><p>A brief and easy-to-understand introduction of deserialization vulnerability is presented in this article. Demonstrating with examples in PHP and Java programming language, the article shows how to achieve RCE by exploiting such vulnerabilities and several ways of defending, including language-specific methods and DXP.</p><h2 id=introduction class="relative group">Introduction <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#introduction aria-label=锚点>#</a></span></h2><p>An attacker can trigger RCE attacks through a dangerous, yet commonly-used technique called deserialization. Here we introduce some basic concepts about deserialization vulnerability.</p><h3 id=serialization-and-deserialization class="relative group">Serialization and Deserialization <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#serialization-and-deserialization aria-label=锚点>#</a></span></h3><p><strong>Serialization</strong> is the process of turning some object into a data format that can be restored later. People often serialize objects in order to save them to storage, or to send as part of communications.</p><p>Serialization is adapted as a cross-platform, language-independent technique to address the problem of data persistence as well as data transmission. In <em>RFC 1014</em><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, a standard was introduced where objects are serialized to bytes and vice versa.</p><p>On the other hand, <strong>deserialization</strong> is the reverse of that process, taking data structured from some format, and rebuilding it into an object. Today, the most popular data format for serializing data is JSON. Before that, it was XML.</p><p>However, many programming languages offer a native capability for serializing objects. These native formats usually offer more features than JSON or XML, including customizability of the serialization process.</p><p>Unfortunately, the features of these native deserialization mechanisms can be repurposed for malicious effect when operating on untrusted data. Attacks against deserializers have been found to allow denial-of-service, access control, and RCE attacks<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><h3 id=rce-attack class="relative group">RCE Attack <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rce-attack aria-label=锚点>#</a></span></h3><p>RCE, namely <em>Remote Code Execution</em>, is one of the most common types of attacks towards web applications. By triggering RCE, an attacker is able to execute PHP, Python, Java or even OS-level code directly from the Internet. Therefore, the attacker basically controls the server behind the web application, which is surely critical.</p><h2 id=examples-of-serialized-data class="relative group">Examples of Serialized Data <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#examples-of-serialized-data aria-label=锚点>#</a></span></h2><p>Here we present two examples of serialized data in PHP and Java.</p><h3 id=php class="relative group">PHP <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#php aria-label=锚点>#</a></span></h3><p>For example, here is a PHP class <code>A</code> containing an integer and an array of strings. And <code>b</code> is an instance of class <code>A</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$one</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$two</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;apple&#39;</span><span class=p>,</span> <span class=s1>&#39;pear&#39;</span><span class=p>,</span> <span class=s1>&#39;banana&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$b</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>A</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>Now if we serialize <code>b</code>, we got the serialized data below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;A&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;one&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>1</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;two&#34;</span><span class=p>;</span><span class=nx>a</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=p>{</span><span class=nx>i</span><span class=o>:</span><span class=mi>0</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>5</span><span class=o>:</span><span class=s2>&#34;apple&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>1</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;pear&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>2</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>6</span><span class=o>:</span><span class=s2>&#34;banana&#34;</span><span class=p>;}}</span>
</span></span></code></pre></div><p>Here <code>O</code> indicates an object, with a class name <code>A</code> whose length is one. It has two members, where the first one is called <code>one</code> which is an integer with value 1. The second one is called <code>two</code> which is an array with 3 elements: apple, pear, banana with index 0,1 and 2.</p><p>Readers may find this rule of serialization easy to remember, because it uses only ASCII characters to construct serialized data.</p><h3 id=java class="relative group">Java <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#java aria-label=锚点>#</a></span></h3><p>In Java, things are not as simple as in PHP.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.io.Serializable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>class</span> <span class=nc>TestSerial</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>For an object containing only two bytes <code>version</code> and <code>count</code> above, it takes 52 bytes to store its serialized data, which seems to be random<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>:</p><pre tabindex=0><code>AC ED 00 05 73 72 00 0A 53 65 72 69 61 6C 54 65

73 74 A0 0C 34 00 FE B1 DD F9 02 00 02 42 00 05

63 6F 75 6E 74 42 00 07 76 65 72 73 69 6F 6E 78

70 00 64
</code></pre><p>Since we have seen what serialized data looks like, and we already know that deserialization turns these data into language-specific objects, we are going to demonstrate why deserialization is dangerous, starting from PHP.</p><h2 id=php-deserialization class="relative group">PHP Deserialization <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#php-deserialization aria-label=锚点>#</a></span></h2><p>PHP uses a function called <code>unserialize()</code> to perform deserialization<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. The key to carry out our attack is to control the argument of this function, so that we can create arbitrary objects that enable us to do nearly anything.</p><h3 id=a-simple-scenario class="relative group">A Simple Scenario <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#a-simple-scenario aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>merc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$test</span> <span class=o>=</span> <span class=s1>&#39;123&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$object</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>merc</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nv>$data</span> <span class=o>=</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$object</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$new_object</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span>
</span></span></code></pre></div><p>For instance, if we pass in the string below to our <code>$data</code>, we can create a <code>merc</code> object whose value of <code>test</code> is 456, although in the original code there&rsquo;s no way to change the value of test for a <code>merc</code> object.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;merc&#34;</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;test&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;456&#34;</span><span class=p>;}</span>
</span></span></code></pre></div><p>Such an attack is certainly useless and can never achieve RCE. That is where magic functions come in handy.</p><h3 id=magic-functions class="relative group">Magic Functions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#magic-functions aria-label=锚点>#</a></span></h3><p>Every PHP object has these magic functions that will be called <strong>automatically</strong> under special conditions<sup id=fnref1:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p><ul><li><code>__construct()</code>: Called when the object is created using new operator, while using <code>unserialize()</code> won&rsquo;t have the same effect.</li><li><code>__destruct()</code>: Called when the object is being destroyed.</li><li><code>__toString()</code>: Called whenever the object needs to be converted to a string.</li><li><code>__call()</code>: Called when an access to a member function failed.</li><li><code>__wakeup()</code>: Called after <code>unserialize()</code> is called.</li></ul><p>The reason we need those functions is that it is impossible to call any function manually through deserialization vulnerability, so we need something that would be called <strong>automatically</strong>.</p><p>Besides, though deserialization may allow us to control <strong>attributes</strong> of an object, we can by no means modify its <strong>member functions</strong>. That leads us to think about the possibility to call other objects&rsquo; member functions, which can be found inside magic functions sometimes.</p><h3 id=searching-for-evil-functions class="relative group">Searching for Evil Functions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#searching-for-evil-functions aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>merc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$test</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=fm>__construct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>test</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>L</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>test</span><span class=o>-&gt;</span><span class=na>goodbye</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>L</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>goodbye</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;Bye~&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Here <code>merc</code> contains an attribute <code>test</code>, which is actually an instance of class <code>L</code>. It will call <code>goodbye()</code> function of class <code>L</code> when being destroyed, and everything seems normal.</p><p>However, here is another class <code>Evil</code> with a <code>goodbye()</code> function containing one of the most dangerous functions <code>eval()</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Evil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$bye_message</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=nf>goodbye</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>bye_message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;test&#39;</span><span class=p>]);</span>
</span></span></code></pre></div><p>This function reads a string, treat it as a code snippet, and execute it without any examination. <strong>Under no circumstances should it be used in code</strong>.</p><p>Since we can pass in our data through the GET parameter, it is a wise decision to simply create a <code>merc</code> object that calls <code>goodbye()</code> function of class <code>Evil</code>. Our payload is given below, where we put serialized data into the GET parameter test.</p><pre tabindex=0><code>http://url/?test=O:4:&#34;merc&#34;:1:{s:4:&#34;test&#34;;O:4:&#34;Evil&#34;:1:{s:11:&#34;bye_message&#34;;s:10:&#34;phpinfo();&#34;;}}
</code></pre><p>Next, we are going to show how the payload is constructed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>merc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$test</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=fm>__construct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>test</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Evil</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Evil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$bye_message</span> <span class=o>=</span> <span class=s2>&#34;phpinfo();&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$object</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>merc</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$object</span><span class=p>);</span>
</span></span></code></pre></div><p>The payload is actually generated by writing PHP code, in which we initialized the attribute <code>test</code> to be an instance of class <code>Evil</code>, and modified <code>$bye_message</code> of <code>test</code> to be <code>phpinfo()</code>, a function in PHP.</p><p>If this function is called, we&rsquo;ll see a page similar to Figure 1, proving that we have an RCE now.</p><p><figure><picture class="mx-auto my-0 rounded-md"><source srcset="/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_330x0_resize_q75_h2_box_3.webp 330w,/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_660x0_resize_q75_h2_box_3.webp 660w
,/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_1024x0_resize_q75_h2_box_3.webp 1024w
,/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_1320x0_resize_q75_h2_box_3.webp 1320w" sizes=100vw type=image/webp><img width=1990 height=1276 class="mx-auto my-0 rounded-md" loading=lazy decoding=async src=/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_660x0_resize_box_3.png srcset="/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_330x0_resize_box_3.png 330w,/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_660x0_resize_box_3.png 660w
,/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_1024x0_resize_box_3.png 1024w
,/posts/why-so-serialize/1_hu263cb72465d8b7c16f92734b87e5dc46_302603_1320x0_resize_box_3.png 1320w" sizes=100vw></picture><figcaption class=text-center>Figure 1. An example phpinfo() page.</figcaption></figure></p><p>So after our modification, in the <code>goodbye()</code> function of <code>test</code> we&rsquo;ll execute <code>eval("phpinfo();")</code>, performing an attack successfully.</p><h3 id=bypassing-protections class="relative group">Bypassing protections <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bypassing-protections aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>convent</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>var</span> <span class=nv>$warn</span> <span class=o>=</span> <span class=s2>&#34;No hacker.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>warn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span><span class=p>(</span><span class=nx>get_object_vars</span><span class=p>(</span><span class=nv>$this</span><span class=p>)</span> <span class=k>as</span> <span class=nv>$k</span> <span class=o>=&gt;</span> <span class=nv>$v</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=nv>$k</span> <span class=o>=</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=nx>cmd</span><span class=p>]);</span>
</span></span></code></pre></div><p>We have already shown a simple RCE attack above, but that is too simple and ideal. In this case we have a <code>__wakeup()|</code>function which wipes out the value of each attribute. Obviously there is no way to do harmful things without bypassing this <code>__wakeup()</code> function.</p><p>Fortunately, CVE-2016-7124<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup> tells us that when deserializing our data into an object, if it has fewer attributes than declared, <code>__wakeup()</code> function will be skipped<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>.</p><p>Take our payload as example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>cmd</span><span class=o>=</span><span class=nx>O</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;convent&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;warn&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>10</span><span class=o>:</span><span class=s2>&#34;phpinfo();&#34;</span><span class=p>;}</span>
</span></span></code></pre></div><p>The <code>convent</code> object has only one attribute here, which is <code>warn</code> with the value <code>phpinfo();</code>, whereas we have declared that it has two attributes. So right now <code>__wakeup()</code> function will not be called, and <code>phpinfo()</code> is executed.</p><h3 id=property-oriented-programming class="relative group">Property-Oriented Programming <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#property-oriented-programming aria-label=锚点>#</a></span></h3><p>In real-world vulnerability mining, a more complex technique called POP (Property-Oriented Programming) chain is more commonly used.</p><p><figure><picture class="mx-auto my-0 rounded-md"><source srcset="/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_330x0_resize_q75_h2_box_3.webp 330w,/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_660x0_resize_q75_h2_box_3.webp 660w
,/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_786x363_resize_q75_h2_box_3.webp 786w
,/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_786x363_resize_q75_h2_box_3.webp 786w" sizes=100vw type=image/webp><img width=786 height=363 class="mx-auto my-0 rounded-md" loading=lazy decoding=async src=/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_660x0_resize_box_3.png srcset="/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_330x0_resize_box_3.png 330w,/posts/why-so-serialize/2_hua2acb5621f178c270b0ebc35c7bd1b52_20828_660x0_resize_box_3.png 660w
,/posts/why-so-serialize/2.png 786w
,/posts/why-so-serialize/2.png 786w" sizes=100vw></picture><figcaption class=text-center>Figure 2. An example of POP chain in PHP.</figcaption></figure></p><p>In Figure 2, starting from a magic function of class <code>A</code>, it may be designed to call <code>goodbye()</code> function in <code>B</code>, but ended up being modified by attackers to call <code>goodbye()</code> in <code>C</code>. After that, it tries to call <code>foo()</code> in <code>D</code> but failed, for there is no such function in <code>D</code>. Thus the magic function <code>__call()</code> is called, resulting in the execution of <code>bar()</code> of class <code>E</code>. The chain goes on and on and on, until it reaches a vulnerable function like <code>eval()</code> and triggers RCE.</p><h3 id=advanced-topics class="relative group">Advanced Topics <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#advanced-topics aria-label=锚点>#</a></span></h3><p>To sum up, deserialization attacks in PHP usually requires an <code>unserialize()</code> function whose argument is not sanitized so that attackers has the ability to create objects as they like. Way of defending such attacks is pretty simple: Always sanitize the argument of <code>unserialize()</code>.</p><p>However, santizing is <strong>not enough</strong> for there are many fields not covered here in the world of PHP deserialization:</p><ul><li><code>phar://</code> Deserialization</li><li>Session Deserialization</li><li>String Escape</li><li>Object Escape</li><li>SoapClient + Deserialization = SSRF</li><li>Exception + Deserialization = XSS</li></ul><h2 id=java-deserialization class="relative group">Java Deserialization <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#java-deserialization aria-label=锚点>#</a></span></h2><p>Few backend developer uses PHP nowadays, and Java is becoming the mainstream programming language of enterprise applications.</p><p>In Java, a class needs to implement the <code>Serializable</code> interface to be serializable. We usually utilize <code>writeObject()</code> for serializing, and <code>readObject()</code> for the opposite (See Table 1). Clearly, if <code>readObject()</code> is overrided by the attacker, RCE happens.</p><table><thead><tr><th>Interface</th><th>Class</th><th>Serializing Method</th><th>Deserializating Method</th></tr></thead><tbody><tr><td><code>java.io.Serializable</code></td><td><code>ObjectOutputStream</code></td><td><code>writeObject()</code></td><td><code>readObject()</code></td></tr></tbody></table><h3 id=ideal-scenario class="relative group">Ideal Scenario <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#ideal-scenario aria-label=锚点>#</a></span></h3><p>Here is a simple example illustrating how we can maliciously override this function to execute our commands<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Evil</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>cmd</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>readObject</span><span class=p>(</span><span class=n>java</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>ObjectInputStream</span><span class=w> </span><span class=n>stream</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stream</span><span class=p>.</span><span class=na>defaultReadObject</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Runtime</span><span class=p>.</span><span class=na>getRuntime</span><span class=p>().</span><span class=na>exec</span><span class=p>(</span><span class=n>cmd</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>We <code>readObject()</code> like usual, and use <code>Runtime.exec()</code> to achieve RCE. But still, it is too ideal for real attacks.</p><h3 id=reflection class="relative group">Reflection <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#reflection aria-label=锚点>#</a></span></h3><p>There&rsquo;s no magic functions in Java. Instead, a much more powerful measure, reflection, is useful both in production and attacks<sup id=fnref1:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>.</p><p>Reflection is a concept that enables you to retrieve the information of Class or Object dynamically through calling special methods. It is super-handy, and super-handy means super-dangerous. Whatever language you are using, where there is reflection, there are deserialization vulnerabilities.</p><p>Back to Java, every class in Java is itself an Object of <code>java.lang.Class</code>, which we usually call ClassObject. It contains meta information for a specific class, such as what constructors, methods and attributes it has.</p><p>Suppose we have a class <code>User</code> below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>User</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>name</span><span class=o>=</span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>setName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>name</span><span class=o>=</span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getName</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h4 id=creating-the-classobject class="relative group">Creating the ClassObject <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-the-classobject aria-label=锚点>#</a></span></h4><p>To create a ClassObject for <code>User</code>, there are three ways:</p><ul><li><code>Class.forName("reflection.User")</code></li><li><code>User.class</code></li><li><code>new User().getClass()</code></li></ul><p>We use the first way in the following part as it is most frequently-used.</p><h4 id=accessing-the-attributes class="relative group">Accessing the Attributes <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#accessing-the-attributes aria-label=锚点>#</a></span></h4><p>To access the attributes, we try to get a constructor with one string argument of class <code>User</code>, and make use of the constructor to create an instance with the argument <code>mercury</code>. Then we get the attribute <code>name</code>, set it as accessible as it is private previously, and change its value to <code>merc</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span><span class=w> </span><span class=n>UserClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;reflection.User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Constructor</span><span class=w> </span><span class=n>constructor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserClass</span><span class=p>.</span><span class=na>getConstructor</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>User</span><span class=p>)</span><span class=w> </span><span class=n>constructor</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=s>&#34;mercury&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Field</span><span class=w> </span><span class=n>field</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserClass</span><span class=p>.</span><span class=na>getDeclaredField</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>field</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>field</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=s>&#34;merc&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=accessing-methods class="relative group">Accessing Methods <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#accessing-methods aria-label=锚点>#</a></span></h4><p>As for methods, we create the instance the same way before we get the <code>setName()</code> method (which needs one string argument) and invoke the method with our instance and argument <code>merc</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Class</span><span class=w> </span><span class=n>UserClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;reflection.User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Constructor</span><span class=w> </span><span class=n>constructor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserClass</span><span class=p>.</span><span class=na>getConstructor</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>User</span><span class=p>)</span><span class=w> </span><span class=n>constructor</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=s>&#34;mercury&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Method</span><span class=w> </span><span class=n>method</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>UserClass</span><span class=p>.</span><span class=na>getDeclaredMethod</span><span class=p>(</span><span class=s>&#34;setName&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>method</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>user</span><span class=p>,</span><span class=w> </span><span class=s>&#34;merc&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=executing-code class="relative group">Executing Code <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#executing-code aria-label=锚点>#</a></span></h4><p>Finally, to achieve RCE we need a general way to execute arbitrary code. Using the class <code>java.lang.Runtime</code> instead, we retrieve its static method <code>getRuntime()</code> and invoke it with <code>null</code> because it is <em>static</em>. Then we retrieve the <code>exec()</code> method and invoke it with the object <code>runtime</code> as well as a string <code>calc.exe</code>, starting the calculator to show that we have achieved RCE.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// java.lang.Runtime.getRuntime().exec(&#34;calc.exe&#34;);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Class</span><span class=w> </span><span class=n>runtimeClass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=s>&#34;java.lang.Runtime&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// getRuntime() is static</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=w> </span><span class=n>runtime</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>runtimeClass</span><span class=p>.</span><span class=na>getMethod</span><span class=p>(</span><span class=s>&#34;getRuntime&#34;</span><span class=p>).</span><span class=na>invoke</span><span class=p>(</span><span class=kc>null</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>runtimeClass</span><span class=p>.</span><span class=na>getMethod</span><span class=p>(</span><span class=s>&#34;exec&#34;</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>invoke</span><span class=p>(</span><span class=n>runtime</span><span class=p>,</span><span class=w> </span><span class=s>&#34;calc.exe&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h4 id=why-reflection class="relative group">Why Reflection <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#why-reflection aria-label=锚点>#</a></span></h4><p>It may seem unnecessarily complicated, but it is indispensable for an attacker. Using reflection brings flexibility and offers more choice in your attacking adventure. Moreover, in this way it&rsquo;s easier to bypass security restrictions.</p><p><figure><picture class="mx-auto my-0 rounded-md"><source srcset="/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_330x0_resize_q75_h2_box_3.webp 330w,/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_660x0_resize_q75_h2_box_3.webp 660w
,/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_718x198_resize_q75_h2_box_3.webp 718w
,/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_718x198_resize_q75_h2_box_3.webp 718w" sizes=100vw type=image/webp><img width=718 height=198 class="mx-auto my-0 rounded-md" loading=lazy decoding=async src=/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_660x0_resize_box_3.png srcset="/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_330x0_resize_box_3.png 330w,/posts/why-so-serialize/3_hu0f9180a38509e6f02a3c0cf47e1a99f7_15933_660x0_resize_box_3.png 660w
,/posts/why-so-serialize/3.png 718w
,/posts/why-so-serialize/3.png 718w" sizes=100vw></picture><figcaption class=text-center>Figure 3. Bypassing blacklisting with reflection.</figcaption></figure></p><p>For instance, suppose the target application blacklisted the word <code>Runtime</code>, like Figure 3. In the traditional way, the name of method (<code>getRuntime()</code>) has to be consequent, which would be banned here. With reflection, you may split the name of method, because now it&rsquo;s nothing more than <strong>a normal string</strong>! Or you can even encode it with base64. Actually, you can transform it as you like to cope with different situations, and transforming the name of methods is just the basic usage of reflection.</p><h3 id=locating-vulnerability class="relative group">Locating Vulnerability <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#locating-vulnerability aria-label=锚点>#</a></span></h3><p>Now we will consider the problem from the defender&rsquo;s perspective. That is, how we can locate the deserialization vulnerabilities in our Java code.</p><p>First we can check out our source code, starting from the entrypoints of deserialization, like these methods involving deserializing actions<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ObjectInputStream</span><span class=p>.</span><span class=na>readObject</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ObjectInputStream</span><span class=p>.</span><span class=na>readUnshared</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>XMLDecoder</span><span class=p>.</span><span class=na>readObject</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Yaml</span><span class=p>.</span><span class=na>load</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>XStream</span><span class=p>.</span><span class=na>fromXML</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ObjectMapper</span><span class=p>.</span><span class=na>readValue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>JSON</span><span class=p>.</span><span class=na>parseObject</span><span class=w>
</span></span></span></code></pre></div><p>Examining the libraries we have used also helps. For example, if we have used the library <strong>CommonsCollections</strong>, we have to pay extra attention to security issues. You may found tools like <em>ysoserial</em><sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup>, <em>marshalsec</em><sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup> and <em>JavaDeserH2HC</em><sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup> quite helpful.</p><p>Last but not least, remember that every class that can be serialized must implement the <code>Serializable</code> interface, so you just need to watch out for these classes.</p><p>On the other hand, we can monitor the network traffic and look for specific bytes. <code>AC ED 00 05</code> often appears at the beginning of serialized data in Java, while <code>rO0AB</code> is its base64-encoded form<sup id=fnref1:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>. There are also special network protocols in Java like RMI and JMX that is completely based on serialization<sup id=fnref2:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup>. Take care of them.</p><h3 id=defending class="relative group">Defending <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#defending aria-label=锚点>#</a></span></h3><p>Once we have located the potential vulnerabilities, we naturally think about how to defend deserialization attacks.</p><p>Sanitize your data before deserializing is always a good choice, but there is no way to guarantee this in large projects.</p><p>Alternatively, you may try to ban some dangerous classes, like <code>InvokerTransformer</code>. Luckily, tools like <em>SerialKiller</em><sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup> and <em>contrast-rO0</em><sup id=fnref:13><a href=#fn:13 class=footnote-ref role=doc-noteref>13</a></sup> can help us with that.</p><p>What&rsquo;s more, you can also define a whitelist, so that only those classes on the whitelist can be deserialized.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>protected</span><span class=w> </span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=w> </span><span class=n>resolveClass</span><span class=p>(</span><span class=n>ObjectStreamClass</span><span class=w> </span><span class=n>desc</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>desc</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InvalidClassException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;Unauthorized unserialization attempt&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>desc</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>resolveClass</span><span class=p>(</span><span class=n>desc</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>A concrete example of whitelisting is to hook the method <code>ObjectInputStream::resolveClass()</code>. Before deserializing using <code>readObject()</code>, <code>resolveClass()</code> is called to resolve the name of the class to be deserialized. Hence, we can hook this method and restrict the name of the class to be on our whitelist, which contains only class <code>User</code> in this case. Otherwise, an exception is thrown and the data won&rsquo;t be deserialized<sup id=fnref1:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup>.</p><h2 id=data-exchange-protocol class="relative group">Data eXchange Protocol <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#data-exchange-protocol aria-label=锚点>#</a></span></h2><p>In recent years, serialization is being replaced by DXP (Data eXchange Protocol).</p><h3 id=various-standards class="relative group">Various Standards <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#various-standards aria-label=锚点>#</a></span></h3><p>XML, which used to be very popular, uses an html-like grammar.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;note&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;to&gt;</span>Tove<span class=nt>&lt;/to&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;from&gt;</span>Jani<span class=nt>&lt;/from&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;heading&gt;</span>Reminder<span class=nt>&lt;/heading&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;body&gt;</span>Don&#39;t forget me this weekend!<span class=nt>&lt;/body&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/note&gt;</span>
</span></span></code></pre></div><p>JSON on the other hand, now replaces XML with a simpler grammar indicating key-value pairs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Tom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;Grade&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;age&#34;</span><span class=p>:</span> <span class=mi>11</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;gender&#34;</span><span class=p>:</span> <span class=s2>&#34;M&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Meanwhile, DXP does not have to produce readable data. Binary DXP protocols like protobuf, thrift, hessian are also rising these years<sup id=fnref:14><a href=#fn:14 class=footnote-ref role=doc-noteref>14</a></sup>. It is really hard to say which of them is better.</p><h3 id=common-feature class="relative group">Common Feature <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#common-feature aria-label=锚点>#</a></span></h3><p>But there is something in common, that they are all cross-platform and language-independent. And by observing the development of DXP, we find that it is becoming faster, safer, and with less redundant information. It is surely faster for it does not contain as much information as serialized data.</p><p>To demonstrate why it is safer, we can take JSON as an example. Whatever key or value we pass in, they are just strings and integers, and will only be treated as strings and integers. In other words, <strong>what is data is data</strong>. Data should never be treated as code.</p><p>But at the mean time, just because it will not be treated as code, the programmer has to do some extra work to make use of it in the code. Therefore, DXP is actually sacrificing flexibility for security.</p><h3 id=security-issues class="relative group">Security Issues <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#security-issues aria-label=锚点>#</a></span></h3><p>Despite the fact that DXP is invulnerable to deserialization attacks, handling DXP involves new security issues.</p><p>XML is vulnerable to XXE (XML eXternal Entity) attack, a technique that hacked Wechat Pay in 2018. Java libraries handling DXP data like XMLDecoder, Jackson and Fastjson are all vulnerable to deserialization attacks. Inappropriate handling of binary DXP data leads to heap overflow as well. It must be clarified that using DXP only does not mean you are safe.</p><h2 id=conclusions class="relative group">Conclusions <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusions aria-label=锚点>#</a></span></h2><p>Deserialization vulnerabilities affects various programming languages in language-specific ways, which can eventually leads to RCE. It is actually hard to discover, because the source code on server is necessary to find such a vulnerability. It is also hard to exploit, as constructing a POP chain is basically putting harmless code together to do harmful things.</p><p>In recent years, DXP is being adopted to avoid such vulnerabilities. Nevertheless, serialization technique still cannot be fully replaced due to its flexibility and better language integration.</p><h2 id=reference class="relative group">Reference <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#reference aria-label=锚点>#</a></span></h2><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://tools.ietf.org/html/rfc1014 target=_blank rel=noreferrer>RFC 1014</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://juejin.cn/post/6844903765921808397 target=_blank rel=noreferrer>Serialization and Deserialization</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://www.iteye.com/blog/longdick-458557 target=_blank rel=noreferrer>Dialysis of Java Deserialization Algorithm</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://www.k0rz3n.com/2018/11/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E target=_blank rel=noreferrer>Understanding PHP Deserialization Vulnerability in One Article</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-7124" target=_blank rel=noreferrer>CVE-2016-7124</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://xz.aliyun.com/t/7570 target=_blank rel=noreferrer>Learning Various Exploiting Techniques of PHP Deserialization Vulnerability through CTF</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p><a href=https://xz.aliyun.com/t/6787 target=_blank rel=noreferrer>Principle of Java Deserialization Vulnerability</a>&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref2:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p><a href=https://xz.aliyun.com/t/2041 target=_blank rel=noreferrer>Mastering Java Deserialization Vulnerability</a>&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p><a href=https://github.com/frohoff/ysoserial target=_blank rel=noreferrer>ysoserial</a>&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p><a href=https://github.com/mbechler/marshalsec target=_blank rel=noreferrer>marshalsec</a>&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p><a href=https://github.com/joaomatosf/JavaDeserH2HC target=_blank rel=noreferrer>JavaDeserH2HC</a>&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12><p><a href=https://github.com/ikkisoft/SerialKiller target=_blank rel=noreferrer>SerialKiller</a>&#160;<a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:13><p><a href=https://github.com/Contrast-Security-OSS/contrast-rO0 target=_blank rel=noreferrer>contrast-rO0</a>&#160;<a href=#fnref:13 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:14><p><a href=http://hengyunabc.github.io/thinking-about-grpc-protobuf/ target=_blank rel=noreferrer>Thinking about gRPC: Why Protobuf</a>&#160;<a href=#fnref:14 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></section><footer class="max-w-prose pt-8 print:hidden"><div class=flex><picture class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full"><img width=400 height=400 class="!mb-0 !mt-0 me-4 w-24 h-auto rounded-full" alt=Mercury loading=lazy decoding=async src=/avatar.png></picture><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Mercury</div><div class="text-sm text-neutral-700 dark:text-neutral-400">Security Engineer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=mailto:signormercurio@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://github.com/SignorMercurio target=_blank aria-label=Github rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></a><a class="px-1 transition-transform hover:scale-125 hover:text-primary-700 dark:hover:text-primary-400" style=will-change:transform href=https://t.me/m9r_at_tG target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/raw-packet/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">算无遗策：socket 编程发送 RAW 数据包</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2020-11-16 00:00:00 +0000 UTC">2020-11-16</time>
</span></span></a></span><span><a class="group flex text-right" href=/posts/aircrack-wpa/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">窥间伺隙：Aircrack 套件破解 WPA2 密码</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2020-10-18 00:00:00 +0000 UTC">2020-10-18</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline.css><link rel=stylesheet href=https://unpkg.com/@waline/client@v2/dist/waline-meta.css><div id=waline></div><script type=module>
  import { init } from 'https://unpkg.com/@waline/client@v2/dist/waline.mjs';

  init({
    el: '#waline',
    serverURL: 'https://waline-merc.vercel.app',
    emoji: [
      '//unpkg.com/@waline/emojis@1.1.0/alus',
      '//unpkg.com/@waline/emojis@1.1.0/tw-emoji',
    ],
    search: false,
    reaction: false,
    dark: 'auto',
  });
</script></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label=回到顶部 title=回到顶部>&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="group mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a href=https://creativecommons.org/licenses/by-nc/4.0/ title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">CC BY-NC 4.0</span></a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2024
Mercury</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a> 强力驱动</p></div><div class="flex flex-row items-center"><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex h-12 w-12 items-center justify-center dark:hidden" title=切换为深色模式><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden h-12 w-12 items-center justify-center dark:flex" title=切换为浅色模式><span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></div></footer><div id=search-wrapper class="invisible fixed inset-0 z-50 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm sm:p-6 md:p-[10vh] lg:p-[12vh] dark:bg-neutral-900/50" data-url=https://blog.sigmerc.top/><div id=search-modal class="top-20 mx-auto flex min-h-0 w-full max-w-3xl flex-col rounded-md border border-neutral-200 bg-neutral shadow-lg dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex flex-none items-center justify-between px-2"><form class="flex min-w-0 flex-auto items-center"><div class="flex h-8 w-8 items-center justify-center text-neutral-400"><span class="icon relative inline-block px-1 align-text-bottom"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="mx-1 flex h-12 flex-auto appearance-none bg-transparent focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=搜索 tabindex=0></form><button id=close-search-button class="flex h-8 w-8 items-center justify-center text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="关闭 (Esc)">
<span class="icon relative inline-block px-1 align-text-bottom"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto overflow-auto px-2"><ul id=search-results></ul></section></div></div></div></body></html>