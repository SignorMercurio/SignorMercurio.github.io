<!doctype html><html lang=zh dir=ltr class=scroll-smooth data-default-appearance=light data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="zh"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>高枕无忧：Google Cloud Platform 基础 &#183; Lab on Mercury</title><meta name=title content="高枕无忧：Google Cloud Platform 基础 &#183; Lab on Mercury"><meta name=description content="Lab on Mercury"><link rel=canonical href=/posts/gcp/><link type=text/css rel=stylesheet href=/css/main.bundle.min.30b84428f183ebd03670b28cea6928e01d2379973aa20987f3725dc7a4d505c99fbc90778068d8926246fff9f19e404caa490ab698aeb7bb7604e41f131849fb.css integrity="sha512-MLhEKPGD69A2cLKM6mko4B0jeZc6ogmH83Jdx6TVBcmfvJB3gGjYkmJG//nxnkBMqkkKtpiut7t2BOQfExhJ+w=="><script type=text/javascript src=/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1+ko+UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.b607eb5ea0f48ef635db6a1c024a35eeff4529157e49461941aac333a158a1f71cae4e530d45ac010598695f823dbe38a63142757e37c2d7b74a309d7296f681.js integrity="sha512-tgfrXqD0jvY122ocAko17v9FKRV+SUYZQarDM6FYofccrk5TDUWsAQWYaV+CPb44pjFCdX43wte3SjCdcpb2gQ==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="高枕无忧：Google Cloud Platform 基础"><meta property="og:description" content="待更新。"><meta property="og:type" content="article"><meta property="og:url" content="/posts/gcp/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-09-23T10:03:42+00:00"><meta property="article:modified_time" content="2022-01-12T10:03:42+00:00"><meta property="og:site_name" content="Lab on Mercury"><meta name=twitter:card content="summary"><meta name=twitter:title content="高枕无忧：Google Cloud Platform 基础"><meta name=twitter:description content="待更新。"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"高枕无忧：Google Cloud Platform 基础","headline":"高枕无忧：Google Cloud Platform 基础","abstract":"\u003cp\u003e待更新。\u003c\/p\u003e","inLanguage":"zh","url":"\/posts\/gcp\/","author":{"@type":"Person","name":"Mercury"},"copyrightYear":"2021","dateCreated":"2021-09-23T10:03:42\u002b00:00","datePublished":"2021-09-23T10:03:42\u002b00:00","dateModified":"2022-01-12T10:03:42\u002b00:00","keywords":["GCP","网络","认证"],"mainEntityOfPage":"true","wordCount":"1020"}]</script><meta name=author content="Mercury"><link href=mailto:signormercurio@gmail.com rel=me><link href=https://github.com/SignorMercurio rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentcolor" d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438.0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1H112L112.1 454.3zM191.4.0132C89.44.3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8 16.53 18.84 42.34 58.23 52.22 91.45.0313.25.0938.5166.125.7823h160.2c.0313-.2656.0938-.5166.125-.7823 9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1 368 78.61 288.9-.2837 191.4.0132zM192 96.01c-44.13.0-80 35.89-80 79.1.0 9.69-7.2 16.89-16 16.89S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1 8.844.0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg></span><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>Lab on Mercury</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>文章</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/categories/ title=Categories>分类</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>标签</a></li><li class="ltr:text-right rtl:text-left ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Lab on Mercury</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/gcp/>高枕无忧：Google Cloud Platform 基础</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">高枕无忧：Google Cloud Platform 基础</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2021-09-23 10:03:42 +0000 UTC">2021-09-23</time><span class="px-2 text-primary-500">&#183;</span><time datetime="2022-01-12 10:03:42 +0000 UTC">Updated: 2022-01-12</time><span class="px-2 text-primary-500">&#183;</span><span>1020 字</span><span class="px-2 text-primary-500">&#183;</span><span title=预计阅读>5 分钟</span></div><div class="my-1 text-xs text-neutral-500 dark:text-neutral-400"><a href=/categories/%E4%BA%91/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">云</a>
<a href=/tags/gcp/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">GCP</a>
<a href=/tags/%E7%BD%91%E7%BB%9C/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">网络</a>
<a href=/tags/%E8%AE%A4%E8%AF%81/ class="px-1 py-[1px] border rounded-md border-neutral-200 dark:border-neutral-600 hover:border-primary-300 hover:text-primary-700 dark:hover:border-primary-600 dark:hover:text-primary-400">认证</a></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 sideNav rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block sticky top-0 py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 pr-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#云计算是什么>云计算是什么？</a></li><li><a href=#gcp-地域和区域>GCP 地域和区域</a></li><li><a href=#gcp-资源层级树>GCP 资源层级树</a><ul><li><a href=#project-标识符>Project 标识符</a></li></ul></li><li><a href=#iam-策略>IAM 策略</a><ul><li><a href=#策略继承>策略继承</a></li></ul></li><li><a href=#云上虚拟机>云上虚拟机</a><ul><li><a href=#virtual-private-cloud-network>Virtual Private Cloud Network</a></li><li><a href=#compute-engine-实践>Compute Engine 实践</a></li></ul></li><li><a href=#云上存储>云上存储</a><ul><li><a href=#cloud-storage>Cloud Storage</a></li><li><a href=#cloud-bigtable--cloud-datastore>Cloud Bigtable & Cloud Datastore</a></li><li><a href=#cloud-sql--cloud-spanner>Cloud SQL & Cloud Spanner</a></li><li><a href=#对比>对比</a></li><li><a href=#cloud-storage--cloud-sql-实践>Cloud Storage & Cloud SQL 实践</a></li></ul></li><li><a href=#云上容器>云上容器</a></li><li><a href=#云上应用>云上应用</a><ul><li><a href=#app-engine-实践>App Engine 实践</a></li></ul></li><li><a href=#云上开发部署与监控>云上开发、部署与监控</a><ul><li><a href=#云上开发>云上开发</a></li><li><a href=#云上部署>云上部署</a></li><li><a href=#云上监控>云上监控</a></li><li><a href=#云上部署与监控实践>云上部署与监控实践</a></li></ul></li><li><a href=#云上数据处理>云上数据处理</a><ul><li><a href=#bigquery-实践>BigQuery 实践</a></li></ul></li><li><a href=#network-和-subnetwork>Network 和 Subnetwork</a><ul><li><a href=#dns>DNS</a></li><li><a href=#防火墙>防火墙</a></li><li><a href=#多网卡>多网卡</a></li><li><a href=#多网络>多网络</a></li></ul></li><li><a href=#负载均衡>负载均衡</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><figure><img class="my-0 rounded-md" src=0.png alt=featuredImage></figure><p>待更新。</p><h2 id=云计算是什么 class="relative group">云计算是什么？ <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e8%ae%a1%e7%ae%97%e6%98%af%e4%bb%80%e4%b9%88 aria-label=锚点>#</a></span></h2><ol><li>可以在任何时间自助地获取计算资源，无需人工干预；</li><li>可以在任何地点访问这些计算资源；</li><li>云服务商拥有计算资源池，并从池中分配资源给用户；</li><li>计算资源可以弹性收缩；</li><li>按量计费，停止使用即停止收费。</li></ol><h2 id=gcp-地域和区域 class="relative group">GCP 地域和区域 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#gcp-%e5%9c%b0%e5%9f%9f%e5%92%8c%e5%8c%ba%e5%9f%9f aria-label=锚点>#</a></span></h2><p>地域（Zone）是一块 GCP 资源的部署区，不过不一定是一个类似数据中心的单一的建筑。若干个地域组成了区域（Region），同一区域内的不同地域之间网络通信速度极快。可以认为，一个地域就是一个区域内的故障域。为了提高容灾性能，可以进行多地域部署。</p><p>更进一步，为了防止类似自然灾害等不可抗力造成的数据损失，还可以进行多区域部署（区域之间至少相隔 160 km）。</p><h2 id=gcp-资源层级树 class="relative group">GCP 资源层级树 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#gcp-%e8%b5%84%e6%ba%90%e5%b1%82%e7%ba%a7%e6%a0%91 aria-label=锚点>#</a></span></h2><p><figure><img class="my-0 rounded-md" srcset="/posts/gcp/1_hu05d19faa17c567b55244d65b76e5f343_33944_330x0_resize_box_3.png 330w,
/posts/gcp/1_hu05d19faa17c567b55244d65b76e5f343_33944_660x0_resize_box_3.png 660w,
/posts/gcp/1_hu05d19faa17c567b55244d65b76e5f343_33944_1024x0_resize_box_3.png 1024w,
/posts/gcp/1_hu05d19faa17c567b55244d65b76e5f343_33944_1320x0_resize_box_3.png 2x" src=/posts/gcp/1_hu05d19faa17c567b55244d65b76e5f343_33944_660x0_resize_box_3.png alt="图 1｜资源层级树"></figure></p><p>每个 GCP 计算资源（Resource）属于且仅属于一个项目（Project）。若干个项目可以组成文件夹（Folder），而文件夹通过层级树结构（和文件系统类似）从属于一个组织（Organization）。创建文件夹和组织并不是必须的，但创建文件夹前需要先创建组织。</p><h3 id=project-标识符 class="relative group">Project 标识符 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#project-%e6%a0%87%e8%af%86%e7%ac%a6 aria-label=锚点>#</a></span></h3><table><thead><tr><th>标识符</th><th>唯一性</th><th>标识符来源</th><th>可变性</th></tr></thead><tbody><tr><td>Project ID</td><td>全局唯一</td><td>用户可指定</td><td>不可变</td></tr><tr><td>Project name</td><td>无需唯一</td><td>用户可指定</td><td>可变</td></tr><tr><td>Project number</td><td>全局唯一</td><td>GCP 分配</td><td>不可变</td></tr></tbody></table><h2 id=iam-策略 class="relative group">IAM 策略 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#iam-%e7%ad%96%e7%95%a5 aria-label=锚点>#</a></span></h2><p>IAM 策略规定了：</p><ul><li>谁</li><li>对哪些资源</li><li>可以做什么</li></ul><p>其中，“谁” 部分可以针对：</p><ul><li>Google 账号</li><li>Google 群组</li><li>服务账号</li><li>G Suite</li><li>Cloud Identity Domain</li></ul><p>“对哪些资源” 部分比较简单，就是上面提到的任何资源节点（Resource / Project / Folder / Organization, etc.）。</p><p>“可以做什么” 部分由 IAM 角色定义。 IAM 角色是一系列权限的集合，可以分为三种角色：</p><ul><li>Primitive Role 只能应用到整个 Project，分为 Owner / Editor / Viewer / Billing administrator 四个角色，所拥有的权限显而易见；</li><li>Predefined Role 是 GCP 服务中预定义的一些角色，可以应用到 Resource / Project / Folder / Organization 层甚至是某个资源实例上，粒度更细。</li><li>Custom Role 只能应用到 Project 或 Organization，由用户自定义，粒度较 Predefined Role 更细。</li></ul><p>如果要授予权限给某个计算资源而不是一个用户，就需要针对该计算资源创建一个服务账号，将权限授予该服务账号。同时，服务账号本身也是一种 GCP 资源，因此 IAM 策略也可以应用到服务账号上，实现对服务账号本身的管理。</p><h3 id=策略继承 class="relative group">策略继承 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e7%ad%96%e7%95%a5%e7%bb%a7%e6%89%bf aria-label=锚点>#</a></span></h3><p>IAM 策略可以应用到任何资源节点，并且会自顶向下继承。比较反直觉的是，当顶层策略和底层策略冲突时，两者中更宽松的策略会生效。</p><ul><li>🌰 1️⃣<ul><li>Project 层策略规定某用户对某资源拥有修改权限</li><li>Organization 层策略规定该用户对该资源仅拥有读取权限</li><li>前者更宽松，因此生效</li></ul></li><li>🌰 2️⃣<ul><li>Project 层策略规定某用户对某资源拥有修改权限</li><li>Resource 层策略规定该用户对该资源仅拥有读取权限</li><li>前者更宽松，因此生效</li></ul></li></ul><p>可以看到，发生冲突时，一个 IAM 策略是否生效与其所在层级无关，仅与其是否更为宽松有关。</p><h2 id=云上虚拟机 class="relative group">云上虚拟机 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e8%99%9a%e6%8b%9f%e6%9c%ba aria-label=锚点>#</a></span></h2><h3 id=virtual-private-cloud-network class="relative group">Virtual Private Cloud Network <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#virtual-private-cloud-network aria-label=锚点>#</a></span></h3><p>VPC 用于在虚拟机（Compute Engine）之间构建网络，例如进行网段划分、防火墙设置、静态路由设置等。值得注意的是，VPC 是全局资源，是可以跨区域的，而 VPC 中创建的子网也可以跨地域。</p><p>类似物理网络，VPC 会维护一个路由表用于在虚拟机之间寻找路由，VPC 之间也可以互联。此外，VPC 还提供了分别针对区域内、外部流量的负载均衡、DNS 服务、CDN 服务等等。</p><h3 id=compute-engine-实践 class="relative group">Compute Engine 实践 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#compute-engine-%e5%ae%9e%e8%b7%b5 aria-label=锚点>#</a></span></h3><ol><li>在 Compute Engine 里创建新的 VM instance，命名为 my-vm-1，允许 HTTP 入站流量。</li><li>由于 my-vm-1 在 <code>us-central1-a</code> 地域中，我们在 Cloud Shell 中查找同区域内有哪些地域：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud compute zones list <span class=p>|</span> grep us-central1
</span></span></code></pre></div><ol start=3><li>随意选一个不同的地域，例如 <code>us-central1-b</code>，并修改当前地域：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud config <span class=nb>set</span> compute/zone us-central1-b
</span></span></code></pre></div><ol start=4><li>创建第二个虚拟机：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud compute instances create <span class=s2>&#34;my-vm-2&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--machine-type <span class=s2>&#34;n1-standard-1&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--image-project <span class=s2>&#34;debian-cloud&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--image-family <span class=s2>&#34;debian-10&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>--subnet <span class=s2>&#34;default&#34;</span>
</span></span></code></pre></div><ol start=5><li>退出 Cloud Shell，SSH 到 my-vm-2，然后 ping 一下 my-vm-1，注意主机名：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping my-vm-1.us-central1-a
</span></span></code></pre></div><ol start=6><li>在 my-vm-2 上连接 my-vm-1：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh my-vm-1.us-central1-a
</span></span></code></pre></div><ol start=7><li>在 my-vm-1 里上线一个网页并测试：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install nginx-light -y
</span></span><span class=line><span class=cl>sudo vim /var/www/html/index.nginx-debian.html
</span></span><span class=line><span class=cl>curl http://localhost
</span></span></code></pre></div><ol start=8><li>退出 SSH 回到 my-vm-2，访问 my-vm-1 上的网页：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl http://my-vm-1.us-central1-a/
</span></span></code></pre></div><h2 id=云上存储 class="relative group">云上存储 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e5%ad%98%e5%82%a8 aria-label=锚点>#</a></span></h2><h3 id=cloud-storage class="relative group">Cloud Storage <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cloud-storage aria-label=锚点>#</a></span></h3><p>常见的对象存储，上传文件，返回一个唯一的 URL。上传的文件按桶（bucket）组织，一旦上传便不可修改（但可以更新），访问权限则由 Cloud IAM 或更细粒度的 ACL 来控制。</p><p><figure><img class="my-0 rounded-md" srcset="/posts/gcp/2_hu07f8b44c6e0cf8b0bec20ddf00b68b9b_233961_330x0_resize_q75_box.jpg 330w,
/posts/gcp/2_hu07f8b44c6e0cf8b0bec20ddf00b68b9b_233961_660x0_resize_q75_box.jpg 660w,
/posts/gcp/2_hu07f8b44c6e0cf8b0bec20ddf00b68b9b_233961_1024x0_resize_q75_box.jpg 1024w,
/posts/gcp/2_hu07f8b44c6e0cf8b0bec20ddf00b68b9b_233961_1320x0_resize_q75_box.jpg 2x" src=/posts/gcp/2_hu07f8b44c6e0cf8b0bec20ddf00b68b9b_233961_660x0_resize_q75_box.jpg alt="图 2｜Cloud Storage Classes"></figure></p><h3 id=cloud-bigtable--cloud-datastore class="relative group">Cloud Bigtable & Cloud Datastore <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cloud-bigtable--cloud-datastore aria-label=锚点>#</a></span></h3><p>Cloud Bigtable 提供存储大量数据的 NoSQL 数据库服务，因为采用 key-value 对存储所以也可以当持久化的哈希表来用。可以通过开源的 HBase API 访问，因此也兼容 Apache Hadoop 生态。</p><p>Cloud Datastore 则是应用特化型的 NoSQL，区别主要在于对交易和类 SQL 查询的支持。当然，最重要的是有每日免费用量。</p><h3 id=cloud-sql--cloud-spanner class="relative group">Cloud SQL & Cloud Spanner <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cloud-sql--cloud-spanner aria-label=锚点>#</a></span></h3><p>Cloud SQL 提供基于 MySQL 或 PostgreSQL 的 SQL 数据库服务，并配有冗余备份、容灾恢复等功能。而 Cloud Spanner 则可以认为是高配版的 Cloud SQL，在数据一致性和可用性方面都更优秀。</p><h3 id=对比 class="relative group">对比 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%af%b9%e6%af%94 aria-label=锚点>#</a></span></h3><p><figure><img class="my-0 rounded-md" srcset="/posts/gcp/3_hu72b63419c018c7871f272506ea7fe68d_631205_330x0_resize_box_3.png 330w,
/posts/gcp/3_hu72b63419c018c7871f272506ea7fe68d_631205_660x0_resize_box_3.png 660w,
/posts/gcp/3_hu72b63419c018c7871f272506ea7fe68d_631205_1024x0_resize_box_3.png 1024w,
/posts/gcp/3_hu72b63419c018c7871f272506ea7fe68d_631205_1320x0_resize_box_3.png 2x" src=/posts/gcp/3_hu72b63419c018c7871f272506ea7fe68d_631205_660x0_resize_box_3.png alt="图 3｜GCP 存储服务对比"></figure></p><p>BigQuery 主要用于数据处理而不是数据存储，会在下文介绍。</p><h3 id=cloud-storage--cloud-sql-实践 class="relative group">Cloud Storage & Cloud SQL 实践 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#cloud-storage--cloud-sql-%e5%ae%9e%e8%b7%b5 aria-label=锚点>#</a></span></h3><ol><li>在 Compute Engine 里创建新的 VM instance，命名为 blogpost，允许 HTTP 入站流量，并在启动脚本中安装服务器：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apt-get update
</span></span><span class=line><span class=cl>apt-get install apache2 php php-mysql -y
</span></span><span class=line><span class=cl>service apache2 restart
</span></span></code></pre></div><ol start=2><li>在 Cloud Shell 中创建 Cloud Storage，注意 bucket 名称需要唯一，可以用 Project ID 来确保这一点：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gsutil mb -l US gs://<span class=nv>$DEVSHELL_PROJECT_ID</span>
</span></span></code></pre></div><ol start=3><li>从另一个桶中复制一张图片到 Cloud Shell：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gsutil cp gs://cloud-training/gcpfci/my-excellent-blog.png my-excellent-blog.png
</span></span><span class=line><span class=cl>ls
</span></span></code></pre></div><ol start=4><li>从 Cloud Shell 复制图片到新创建的桶：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gsutil cp my-excellent-blog.png gs://<span class=nv>$DEVSHELL_PROJECT_ID</span>/my-excellent-blog.png
</span></span></code></pre></div><ol start=5><li>检查是否成功：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gsutil ls gs://<span class=nv>$DEVSHELL_PROJECT_ID</span>
</span></span></code></pre></div><ol start=6><li>在控制台创建和 blogpost 同区域的 Cloud SQL，命名为 blog-db，并设置 root 密码；创建完毕后，新建一个用户，设置用户名和密码。</li><li>接下来，要让我们的 blog-db 只能被 blogpost 访问。为此，先查看 blogpost 的公网 IP，然后在 blog-db 配置面板的 Connections 选项卡里新建一个 Authorized Network，并填入这个 IP。由于要求 CIDR 格式而我们只想要单个机器能访问，填入 <code>x.x.x.x/32</code> 即可。</li><li>随后要让 blogpost 去使用 blog-db。SSH 到 blogpost，编写 <code>/var/www/html/index.php</code>：</li></ol><pre tabindex=0><code class=language-php+HTML data-lang=php+HTML>&lt;html&gt;
&lt;head&gt;&lt;title&gt;Welcome to my excellent blog&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Welcome to my excellent blog&lt;/h1&gt;
&lt;?php
 $dbserver = &#34;CLOUDSQLIP&#34;;
$dbuser = &#34;blogdbuser&#34;;
$dbpassword = &#34;DBPASSWORD&#34;;
// In a production blog, we would not store the MySQL
// password in the document root. Instead, we would store it in a
// configuration file elsewhere on the web server VM instance.
$conn = new mysqli($dbserver, $dbuser, $dbpassword);
if (mysqli_connect_error()) {
        echo (&#34;Database connection failed:&#34; . mysqli_connect_error());
} else {
        echo (&#34;Database connection succeeded.&#34;);
}
?&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre><ol start=9><li>重启 apache2，访问 blogpost 的公网 IP，检查数据库连接。</li><li>接下来把之前那张图片加到网站上。在控制台 Storage -> Cloud Storage -> Browser 里找到图片，勾选 <code>Share publicly</code> 从而获得一个 URL（或者运行下面的命令）。随后在原来的 html 里插入图片即可。</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gsutil acl ch -u allUsers:R gs://<span class=nv>$DEVSHELL_PROJECT_ID</span>/my-excellent-blog.png
</span></span></code></pre></div><ol start=11><li>重复第 9 步。</li></ol><h2 id=云上容器 class="relative group">云上容器 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e5%ae%b9%e5%99%a8 aria-label=锚点>#</a></span></h2><p>也就是 Google Kubernetes Engine，后面单独开篇博客写。</p><h2 id=云上应用 class="relative group">云上应用 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e5%ba%94%e7%94%a8 aria-label=锚点>#</a></span></h2><p>在 Compute Engine 中，用户自己选择虚拟机作为运行应用的基础设施；到了 Kubernetes Engine，这个基础设施变成了容器。但如果我们只是想快速部署一个应用，根本不想关心基础设施呢？这就是 App Engine 的作用。</p><p>App Engine 提供了类似 NoSQL 数据库、负载均衡、日志记录、用户认证、自动伸缩等服务，用户只需要关心业务代码、以及如何在代码中调用这些服务。在 Standard 模式中，因为提供了免费日限额，只要应用流量不太大就相当于永久免费使用 App Engine 服务。</p><p>Standard 模式运行在沙箱中，因此存在一些限制：</p><ul><li>不能向文件系统写文件，数据持久化必须通过数据库</li><li>任意网络请求最大超时时间为 60 秒</li><li>安装第三方软件也会受到限制</li></ul><p>不过，Standard 模式只支持 Java、Python、PHP 和 Go 的 SDK，其他语言则需要使用 Flexible 模式。</p><p>Flexible 模式不受沙箱限制，因为这种模式实际上是在 Compute Engine 上运行用户自定义的容器。这会导致启动速度变慢，但应用对底层的访问更宽松，当然价格上也不存在免费额度了。</p><p><figure><img class="my-0 rounded-md" srcset="/posts/gcp/4_hu9c386c19325e8697f76ffaf6b76527bc_471615_330x0_resize_box_3.png 330w,
/posts/gcp/4_hu9c386c19325e8697f76ffaf6b76527bc_471615_660x0_resize_box_3.png 660w,
/posts/gcp/4_hu9c386c19325e8697f76ffaf6b76527bc_471615_1024x0_resize_box_3.png 1024w,
/posts/gcp/4_hu9c386c19325e8697f76ffaf6b76527bc_471615_1320x0_resize_box_3.png 2x" src=/posts/gcp/4_hu9c386c19325e8697f76ffaf6b76527bc_471615_660x0_resize_box_3.png alt="图 4｜App Engine 两种模式对比"></figure></p><h3 id=app-engine-实践 class="relative group">App Engine 实践 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#app-engine-%e5%ae%9e%e8%b7%b5 aria-label=锚点>#</a></span></h3><ol><li>克隆示例应用：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/GoogleCloudPlatform/appengine-guestbook-python
</span></span><span class=line><span class=cl><span class=nb>cd</span> appengine-guestbook-python
</span></span></code></pre></div><ol start=2><li>在 <code>app.yaml</code> 中存储了应用的部署配置，可以先在本地运行起来测试下：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dev_appserver.py ./app.yaml
</span></span></code></pre></div><ol start=3><li>用 Cloud Shell 的 Preview 功能查看应用。</li><li>确认没有问题后进行部署：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud app deploy ./index.yaml ./app.yaml
</span></span></code></pre></div><h2 id=云上开发部署与监控 class="relative group">云上开发、部署与监控 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e5%bc%80%e5%8f%91%e9%83%a8%e7%bd%b2%e4%b8%8e%e7%9b%91%e6%8e%a7 aria-label=锚点>#</a></span></h2><h3 id=云上开发 class="relative group">云上开发 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e5%bc%80%e5%8f%91 aria-label=锚点>#</a></span></h3><ul><li>Cloud Source Repositories，也就是 GCP 中的 Git Repositories，优势在于和 GCP Project 以及其他产品的融合</li><li>Cloud Functions，也就是 GCP 中的云函数，这种方式目前可以说是对一个应用而言最高层面的抽象</li><li>Cloud Endpoint，也就是 GCP 中用于维护 API 的服务</li></ul><p><figure><img class="my-0 rounded-md" srcset="/posts/gcp/5_huf4ef1504b96336c48951f3071258e74c_1149936_330x0_resize_box_3.png 330w,
/posts/gcp/5_huf4ef1504b96336c48951f3071258e74c_1149936_660x0_resize_box_3.png 660w,
/posts/gcp/5_huf4ef1504b96336c48951f3071258e74c_1149936_1024x0_resize_box_3.png 1024w,
/posts/gcp/5_huf4ef1504b96336c48951f3071258e74c_1149936_1320x0_resize_box_3.png 2x" src=/posts/gcp/5_huf4ef1504b96336c48951f3071258e74c_1149936_660x0_resize_box_3.png alt="图 5｜应用部署抽象层级的对比"></figure></p><h3 id=云上部署 class="relative group">云上部署 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e9%83%a8%e7%bd%b2 aria-label=锚点>#</a></span></h3><ul><li>Deployment Manager 提供了声明式的方式来设定部署环境，有点像 Kubernetes deployment，也可以把设定文件放在 Cloud Source Repositories 里</li></ul><h3 id=云上监控 class="relative group">云上监控 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e7%9b%91%e6%8e%a7 aria-label=锚点>#</a></span></h3><ul><li>Stackdriver 用于监控云上资源，没有发现什么有特色的地方？</li></ul><h3 id=云上部署与监控实践 class="relative group">云上部署与监控实践 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e9%83%a8%e7%bd%b2%e4%b8%8e%e7%9b%91%e6%8e%a7%e5%ae%9e%e8%b7%b5 aria-label=锚点>#</a></span></h3><ol><li>准备环境，下载 Deployment Manager 的模版：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>MY_ZONE</span><span class=o>=</span>us-central1-a
</span></span><span class=line><span class=cl>gsutil cp gs://cloud-training/gcpfcoreinfra/mydeploy.yaml mydeploy.yaml
</span></span></code></pre></div><ol start=2><li>替换模版中的字段：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sed -i -e <span class=s2>&#34;s/PROJECT_ID/</span><span class=nv>$DEVSHELL_PROJECT_ID</span><span class=s2>/&#34;</span> mydeploy.yaml
</span></span><span class=line><span class=cl>sed -i -e <span class=s2>&#34;s/ZONE/</span><span class=nv>$MY_ZONE</span><span class=s2>/&#34;</span> mydeploy.yaml
</span></span></code></pre></div><ol start=3><li>最终模版大约是这样的：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>resources</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-vm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>compute.v1.instance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>properties</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>zone</span><span class=p>:</span><span class=w> </span><span class=l>us-central1-a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>machineType</span><span class=p>:</span><span class=w> </span><span class=l>zones/us-central1-a/machineTypes/n1-standard-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>items</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>startup-script</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;apt-get update&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>disks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>deviceName</span><span class=p>:</span><span class=w> </span><span class=l>boot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>PERSISTENT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>boot</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>autoDelete</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>initializeParams</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>sourceImage</span><span class=p>:</span><span class=w> </span><span class=l>https://www.googleapis.com/compute/v1/projects/debian-cloud/global/images/debian-9-stretch-v20180806</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>networkInterfaces</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>network</span><span class=p>:</span><span class=w> </span><span class=l>https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-dcdf854d278b50cd/global/networks/default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>accessConfigs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>External NAT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ONE_TO_ONE_NAT</span><span class=w>
</span></span></span></code></pre></div><ol start=4><li>部署：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud deployment-manager deployments create my-first-depl --config mydeploy.yaml
</span></span></code></pre></div><ol start=5><li>查看已部署的 Compute Engine。</li><li>编辑模版中的 startup script，更新为：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;apt-get update; apt-get install nginx-light -y&#34;</span><span class=w>
</span></span></span></code></pre></div><ol start=7><li>执行更新：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud deployment-manager deployments update my-first-depl --config mydeploy.yaml
</span></span></code></pre></div><ol start=8><li>检查 Compute Engine 中新的 startup script。</li><li>停止虚拟机，设置 Service account 为 <code>Compute Engine default service account</code> 并 <code>Allow full access to all Cloud APIs</code>。启动虚拟机。</li><li>SSH 到虚拟机，运行如下命令增加 CPU 负载：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dd <span class=k>if</span><span class=o>=</span>/dev/urandom <span class=p>|</span> gzip -9 &gt;&gt; /dev/null <span class=p>&amp;</span>
</span></span></code></pre></div><ol start=11><li>控制台中为 Project 开启 Monitoring Workspace（自动），随后在虚拟机中安装 agent：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -sSO https://dl.google.com/cloudagents/install-monitoring-agent.sh
</span></span><span class=line><span class=cl>sudo bash install-monitoring-agent.sh
</span></span><span class=line><span class=cl>curl -sSO https://dl.google.com/cloudagents/install-logging-agent.sh
</span></span><span class=line><span class=cl>sudo bash install-logging-agent.sh
</span></span></code></pre></div><ol start=12><li>控制台 Monitoring 面板中点击 Metrics Explorer -> Metric，选择虚拟机资源和 CPU 使用情况并查看图表。</li><li>运行 <code>kill %1</code> 停止占用 CPU，再次查看图表。</li></ol><h2 id=云上数据处理 class="relative group">云上数据处理 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e4%ba%91%e4%b8%8a%e6%95%b0%e6%8d%ae%e5%a4%84%e7%90%86 aria-label=锚点>#</a></span></h2><ul><li>Cloud Dataproc，用于在 GCP 上运行 Hadoop、Spark、Hive、Pig 等数据集群</li><li>Cloud Dataflow，用于构建数据流水线，提供了资源自动伸缩的功能，相比 Cloud Dataproc 更灵活</li><li>BigQuery，顾名思义，提供针对大量数据提供高速 SQL 查询服务</li><li>Cloud Pub/Sub，提供可靠的、多对多的异步消息推送 / 拉取服务</li><li>Cloud Datalab，也就是 GCP 中的 Jupyter Notebook，底层基础设施使用的是 BigQuery、Compute Engine 和 Cloud Storage</li><li>Cloud ML，也就是在 GCP 上运行 TensorFlow，好处是可以利用 GCP 上的高性能计算资源</li></ul><h3 id=bigquery-实践 class="relative group">BigQuery 实践 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bigquery-%e5%ae%9e%e8%b7%b5 aria-label=锚点>#</a></span></h3><ol><li>在 BigQuery 中新建数据集 <code>logdata</code>，随后创建表 <code>accesslog</code>，数据源来自 Cloud Storage，URL 为 <code>gs://cloud-training/gcpfci/access_log.csv</code>。</li><li>创建完成后，在表详情页面可以 Preview 一些数据。</li><li>在控制台运行 query：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>int64_field_6</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>hour</span><span class=p>,</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>hitcount</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>logdata</span><span class=p>.</span><span class=n>accesslog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>hour</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>hour</span><span class=w>
</span></span></span></code></pre></div><ol start=4><li>类似上一步的查询也可以用 <code>bq</code> 命令行工具完成：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>bq query <span class=s2>&#34;select string_field_10 as request, count(*) as requestcount from logdata.accesslog group by request order by requestcount desc&#34;</span>
</span></span></code></pre></div><h2 id=network-和-subnetwork class="relative group">Network 和 Subnetwork <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#network-%e5%92%8c-subnetwork aria-label=锚点>#</a></span></h2><p>Network 是跨 Region 的，拥有自己的 DNS。处于同一 Network 的虚拟机之间，即使处于不同 Region，也可以通过内网 IP 互相通信。同理，同一 Region 中的虚拟机，如果不处于同一 Network，就无法通过内网 IP 通信。</p><p>同理，Subnetwork 是跨 Zone 的。处于同一 Subnetwork 的虚拟机之间，即使处于不同 Zone，也可以通过内网 IP 通信。Subnetwork 实际上就是通常意义下的子网，也就是 RFC 1918。Subnetwork 只能扩展不能缩小。</p><h3 id=dns class="relative group">DNS <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#dns aria-label=锚点>#</a></span></h3><p>Network 内部的 DNS 是为了确保虚拟机内部 IP 变化时，对虚拟机的访问不受影响。这一点和 K8s 如出一辙。至于 IP 地址、路由，也和通常意义下的差不多。</p><h3 id=防火墙 class="relative group">防火墙 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e9%98%b2%e7%81%ab%e5%a2%99 aria-label=锚点>#</a></span></h3><p>每个 VPC 实际上就是一个分布式防火墙，只不过出入控制是虚拟机级的。也就是说，不仅整个网络受到防火墙保护，每个虚拟机也是如此。这使得防火墙规则也可以针对每个虚拟机进行不同设置。</p><p>最后，保底规则是拒绝全部 Ingress 请求，允许全部 Egress 请求。防火墙规则也遵循上文提到的资源层级树层层继承。</p><h3 id=多网卡 class="relative group">多网卡 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%a4%9a%e7%bd%91%e5%8d%a1 aria-label=锚点>#</a></span></h3><p>每个虚拟机在创建时可以指定多个网卡，从而接入多个不同的 Network。不过，Network 内部的 DNS 只能解析到 <code>nic0</code> 也就是第一个网卡，如果 <code>nic0</code> 并不对应该 Network，DNS 解析会失效。</p><h3 id=多网络 class="relative group">多网络 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e5%a4%9a%e7%bd%91%e7%bb%9c aria-label=锚点>#</a></span></h3><p>Shared VPC 可以连接多个不同 Project 的计算资源，使得计算资源之间可以通过内网 IP 通信。类似地，VPC Network Peering 可以跨 Organiztion 连接计算资源，实现点对点的连接。两者最大的区别在于，网络管理是否是中心化的。</p><table><thead><tr><th></th><th>Shared VPC</th><th>VPC Network Peering</th></tr></thead><tbody><tr><td>跨 Organization</td><td>❎</td><td>✅</td></tr><tr><td>连接同一 Project 内的资源</td><td>❎</td><td>✅</td></tr><tr><td>网络管理模式</td><td>中心化</td><td>去中心化</td></tr></tbody></table><h2 id=负载均衡 class="relative group">负载均衡 <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#%e8%b4%9f%e8%bd%bd%e5%9d%87%e8%a1%a1 aria-label=锚点>#</a></span></h2><p>负载均衡是基于虚拟机实例组的，类似于 K8s 里的一个 ReplicaSet，甚至也包含了自动伸缩、滚动更新、健康检查等功能。一个虚拟机实例组一般在同一 Region 内。</p><p>HTTP(S) 负载均衡器将用户请求发送至 HTTP(S) 代理，随后转发给 backend service，最终发送到不同 Region 的实例组。对于非 HTTP 请求，则可以使用 TCP 和 SSL 负载均衡器。如果需要发送 UDP 请求或者 TCP 和 SSL 负载均衡器不支持的请求，则可以使用适用范围更广的 Network 负载均衡器。最后，如果服务不需要对公网开放，则可以使用同样支持 TCP / UDP 请求，但速度更快、配置更简单的内网负载均衡器（基于 Andromeda）。</p><p>可以通过如下流程图来选择合适的负载均衡器：</p><p><figure><img class="my-0 rounded-md" srcset="/posts/gcp/6_hu027ce801f7cdb96107f5152c0a0bc976_1043610_330x0_resize_box_3.png 330w,
/posts/gcp/6_hu027ce801f7cdb96107f5152c0a0bc976_1043610_660x0_resize_box_3.png 660w,
/posts/gcp/6_hu027ce801f7cdb96107f5152c0a0bc976_1043610_1024x0_resize_box_3.png 1024w,
/posts/gcp/6_hu027ce801f7cdb96107f5152c0a0bc976_1043610_1320x0_resize_box_3.png 2x" src=/posts/gcp/6_hu027ce801f7cdb96107f5152c0a0bc976_1043610_660x0_resize_box_3.png alt="图 6｜选择合适的负载均衡器"></figure></p></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt=Mercury src=/my_avatar_huffcabec77dc887387e1e045311cbdc8b_49733_192x192_fill_box_smart1_3.png><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">作者</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Mercury</div><div class="text-sm text-neutral-700 dark:text-neutral-400">A student</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:signormercurio@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/SignorMercurio target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/dockerfile2gke/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">再探 GitHub Actions：从 Dockerfile 到 GKE</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-09-25 18:44:35 +0000 UTC">2021-09-25</time></span></span></a></span>
<span><a class="flex text-right group" href=/posts/cloud-native/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">风谲云诡：云原生技术原理</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2021-09-10 09:27:59 +0000 UTC">2021-09-10</time></span></span>
<span class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span></a></span></div></div></footer><script src=//unpkg.com/valine/dist/Valine.min.js></script><div id=vcomments class="mt-8 max-w-prose print:hidden"></div><script>new Valine({el:"#vcomments",appId:"RkxCznUcvfzFBgfMiMr0BAfd-gzGzoHsz",appKey:"sw2sEPOl4haCAXKUFYiBFMrR",avatar:"robohash",requiredFields:["nick"]})</script></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://creativecommons.org/licenses/by-nc/4.0/ title>CC BY-NC 4.0</a></li></ul></nav><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Mercury</p><p class="text-xs text-neutral-500 dark:text-neutral-400">由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a> 强力驱动</p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title=切换为深色模式>
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div></footer><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>